file_diff,commit_time,file_diff_id
"@@ -22,7 +22,6 @@
 import java.io.IOException;
 import java.io.StringReader;
 import java.io.StringWriter;
-import java.net.InetAddress;
 import java.net.UnknownHostException;
 import java.util.Hashtable;
 import java.util.List;
@@ -169,8 +168,7 @@ private static void initStatic() throws ConfigurationException, UnknownHostExcep
                 if (managementAddress.equals(""0.0.0.0"")) {
                     managementAddress = ""localhost"";
                 }
-                client = ModelControllerClient.Factory.create(""remote"", InetAddress.getByName(managementAddress), 9999,
-                        getCallbackHandler());
+                client = ModelControllerClient.Factory.create(""remote"", managementAddress, 9999, getCallbackHandler(), null, 20 * 1000);
             }
         }
     }",2014-01-22T14:45:32Z,47
"@@ -2,7 +2,7 @@
 <!--  See src/resources/configuration/ReadMe.txt for how the configuration assembly works -->
 <config>
    <extension-module>org.jboss.as.deployment-scanner</extension-module>
-   <subsystem xmlns=""urn:jboss:domain:deployment-scanner:1.1"">
-       <deployment-scanner path=""deployments"" relative-to=""jboss.server.base.dir"" scan-interval=""5000""/>
+   <subsystem xmlns=""urn:jboss:domain:deployment-scanner:2.0"">
+       <deployment-scanner path=""deployments"" relative-to=""jboss.server.base.dir"" scan-interval=""5000"" runtime-failure-causes-rollback=""${jboss.deployment.scanner.rollback.on.failure:false}""/>
    </subsystem>
 </config>
\ No newline at end of file",2013-12-04T15:59:51Z,177
"@@ -5,6 +5,7 @@
    <subsystem xmlns=""urn:jboss:domain:ee:2.0"">
         <spec-descriptor-property-replacement>false</spec-descriptor-property-replacement>
         <jboss-descriptor-property-replacement>true</jboss-descriptor-property-replacement>
+        <ejb-annotation-property-replacement>false</ejb-annotation-property-replacement>
         <concurrent>
             <context-services>
                 <context-service name=""default"" jndi-name=""java:jboss/ee/concurrency/context/default"" use-transaction-setup-provider=""true""/>",2013-12-04T15:59:51Z,178
"@@ -18,13 +18,11 @@
            </bean-instance-pools>
        </pools>
        <caches>
-           <cache name=""simple"" aliases=""NoPassivationCache""/>
-           <cache name=""passivating"" passivation-store-ref=""file"" aliases=""SimpleStatefulCache""/>
-           <?CLUSTERED-CACHE?>
+           <cache name=""simple""/>
+           <cache name=""distributable"" aliases=""passivating clustered"" passivation-store-ref=""infinispan""/>
        </caches>
        <passivation-stores>
-           <file-passivation-store name=""file""/>
-           <?CLUSTER-PASSIVATION-STORE?>
+           <passivation-store name=""infinispan"" cache-container=""ejb"" max-size=""10000""/>
        </passivation-stores>
        <async thread-pool-name=""default""/>
        <timer-service thread-pool-name=""default"" default-data-store=""default-file-store"">
@@ -53,21 +51,15 @@
          <iiop enable-by-default=""false"" use-qualified-name=""false""/>
       </replacement>
       <replacement placeholder=""MDB"">
-	       <mdb>
-	           <resource-adapter-ref resource-adapter-name=""hornetq-ra""/>
-	           <bean-instance-pool-ref pool-name=""mdb-strict-max-pool""/>
-	       </mdb>
+         <mdb>
+             <resource-adapter-ref resource-adapter-name=""${ejb.resource-adapter-name:hornetq-ra.rar}""/>
+             <bean-instance-pool-ref pool-name=""mdb-strict-max-pool""/>
+         </mdb>
       </replacement>
    </supplement>
    <supplement name=""ha"">
       <replacement placeholder=""STATEFUL-BEAN"">
-         <stateful default-access-timeout=""5000"" cache-ref=""simple"" clustered-cache-ref=""clustered"" passivation-disabled-cache-ref=""simple""/>
-      </replacement>
-      <replacement placeholder=""CLUSTERED-CACHE"">
-         <cache name=""clustered"" passivation-store-ref=""infinispan"" aliases=""StatefulTreeCache""/>
-      </replacement>
-      <replacement placeholder=""CLUSTER-PASSIVATION-STORE"">
-         <cluster-passivation-store name=""infinispan"" cache-container=""ejb""/>
+         <stateful default-access-timeout=""5000"" cache-ref=""simple"" clustered-cache-ref=""distributable"" passivation-disabled-cache-ref=""simple""/>
       </replacement>
    </supplement>
    <supplement name=""full-ha"" includes=""full ha""/>",2013-12-04T15:59:51Z,179
"@@ -7,8 +7,19 @@
     </subsystem>
     <supplement name=""default"">
         <replacement placeholder=""CACHE-CONTAINERS"">
-            <cache-container name=""web"" aliases=""standard-session-cache"" default-cache=""local-web"" module=""org.wildfly.clustering.web.infinispan"">
-                <local-cache name=""local-web"" batching=""true"">
+            <cache-container name=""web"" default-cache=""passivation"" module=""org.wildfly.clustering.web.infinispan"">
+                <local-cache name=""passivation"" batching=""true"">
+                    <file-store passivation=""true"" purge=""false""/>
+                </local-cache>
+                <local-cache name=""persistent"" batching=""true"">
+                    <file-store passivation=""false"" purge=""false""/>
+                </local-cache>
+            </cache-container>
+            <cache-container name=""ejb"" aliases=""sfsb"" default-cache=""passivation"" module=""org.wildfly.clustering.ejb.infinispan"">
+                <local-cache name=""passivation"" batching=""true"">
+                    <file-store passivation=""true"" purge=""false""/>
+                </local-cache>
+                <local-cache name=""persistent"" batching=""true"">
                     <file-store passivation=""false"" purge=""false""/>
                 </local-cache>
             </cache-container>
@@ -38,27 +49,15 @@
                     <locking isolation=""REPEATABLE_READ""/>
                 </replicated-cache>
             </cache-container>
-            <cache-container name=""web"" aliases=""standard-session-cache"" default-cache=""repl"" module=""org.wildfly.clustering.web.infinispan"">
+            <cache-container name=""web"" default-cache=""dist"" module=""org.wildfly.clustering.web.infinispan"">
                 <transport lock-timeout=""60000""/>
-                <replicated-cache name=""repl"" mode=""ASYNC"" batching=""true"">
-                    <file-store/>
-                </replicated-cache>
-                <replicated-cache name=""sso"" mode=""SYNC"" batching=""true""/>
-                <distributed-cache name=""dist"" mode=""ASYNC"" batching=""true"" l1-lifespan=""0"">
+                <distributed-cache name=""dist"" mode=""ASYNC"" batching=""true"" l1-lifespan=""0"" owners=""4"">
                     <file-store/>
                 </distributed-cache>
             </cache-container>
-            <cache-container name=""ejb"" aliases=""sfsb sfsb-cache"" default-cache=""repl"" module=""org.jboss.as.clustering.ejb3.infinispan"">
+            <cache-container name=""ejb"" aliases=""sfsb"" default-cache=""dist"" module=""org.wildfly.clustering.ejb.infinispan"">
                 <transport lock-timeout=""60000""/>
-                <replicated-cache name=""repl"" mode=""ASYNC"" batching=""true"">
-                    <eviction strategy=""LRU"" max-entries=""10000""/>
-                    <file-store/>
-                </replicated-cache>
-                <!-- Clustered cache used internally by EJB subsytem for managing the client-mapping(s) of
-                the socketbinding referenced by the EJB remoting connector -->
-                <replicated-cache name=""remote-connector-client-mappings"" mode=""SYNC"" batching=""true""/>
-                <distributed-cache name=""dist"" mode=""ASYNC"" batching=""true"" l1-lifespan=""0"">
-                    <eviction strategy=""LRU"" max-entries=""10000""/>
+                <distributed-cache name=""dist"" mode=""ASYNC"" batching=""true"" l1-lifespan=""0"" owners=""4"">
                     <file-store/>
                 </distributed-cache>
             </cache-container>",2013-12-04T15:59:51Z,180
"@@ -84,7 +84,22 @@
            </protocol>
        </replacement>
    </supplement>
+   <supplement name=""gossip-discovery"">
+       <replacement placeholder=""TCP-DISCOVERY"">
+           <protocol type=""TCPGOSSIP"">
+               <property name=""initial_hosts"">${jboss.jgroups.gossip.initial_hosts}</property>
+               <property name=""num_initial_members"">${jboss.jgroups.gossip.num_initial_members}</property>
+           </protocol>
+       </replacement>
+       <replacement placeholder=""UDP-DISCOVERY"">
+           <protocol type=""TCPGOSSIP"">
+               <property name=""initial_hosts"">${jboss.jgroups.gossip.initial_hosts}</property>
+               <property name=""num_initial_members"">${jboss.jgroups.gossip.num_initial_members}</property>
+           </protocol>
+       </replacement>
+   </supplement>
    <supplement name=""ec2"" includes=""no-multicast s3-ping""/>
+   <supplement name=""gossip"" includes=""no-multicast gossip-discovery""/>
    <socket-binding name=""jgroups-mping"" port=""0"" multicast-address=""${jboss.default.multicast.address:230.0.0.4}"" multicast-port=""45700""/>
    <socket-binding name=""jgroups-tcp"" port=""7600""/>
    <socket-binding name=""jgroups-tcp-fd"" port=""57600""/>",2013-12-04T15:59:51Z,181
"@@ -2,8 +2,8 @@
 <!--  See src/resources/configuration/ReadMe.txt for how the configuration assembly works -->
 <config>
    <extension-module>org.jboss.as.mail</extension-module>
-   <subsystem xmlns=""urn:jboss:domain:mail:1.1"">
-       <mail-session jndi-name=""java:jboss/mail/Default"">
+   <subsystem xmlns=""urn:jboss:domain:mail:2.0"">
+       <mail-session name=""default"" jndi-name=""java:jboss/mail/Default"">
            <smtp-server outbound-socket-binding-ref=""mail-smtp""/>
        </mail-session>
    </subsystem>",2013-12-04T15:59:51Z,182
"@@ -2,7 +2,7 @@
 <!--  See src/resources/configuration/ReadMe.txt for how the configuration assembly works -->
 <config>
    <extension-module>org.jboss.as.messaging</extension-module>
-   <subsystem xmlns=""urn:jboss:domain:messaging:1.4"">
+   <subsystem xmlns=""urn:jboss:domain:messaging:2.0"">
        <hornetq-server>
            <?CLUSTERED?>
            <persistence-enabled>true</persistence-enabled>
@@ -14,7 +14,6 @@
                <netty-connector name=""netty-throughput"" socket-binding=""messaging-throughput"">
                    <param key=""batch-delay"" value=""50""/>
                </netty-connector>
-               <servlet-connector name=""servlet"" socket-binding=""http"" host=""default-host"" />
                <in-vm-connector name=""in-vm"" server-id=""0""/>
            </connectors>
 
@@ -65,14 +64,6 @@
                        <entry name=""java:/ConnectionFactory""/>
                    </entries>
                </connection-factory>
-               <connection-factory name=""ServletConnectionFactory"">
-                   <connectors>
-                       <connector-ref connector-name=""servlet""/>
-                   </connectors>
-                   <entries>
-                       <entry name=""java:jboss/exported/jms/ServletConnectionFactory""/>
-                   </entries>
-               </connection-factory>
                <connection-factory name=""RemoteConnectionFactory"">
                    <connectors>
                        <connector-ref connector-name=""netty""/>",2013-12-04T15:59:51Z,183
"@@ -31,11 +31,10 @@
             <buffer-cache name=""default"" buffer-size=""1024"" buffers-per-region=""1024"" max-regions=""10""/>
         </buffer-caches>
         <server name=""default-server"">
-            <http-listener name=""default"" socket-binding=""http"" max-post-size=""10485760""/>
+            <http-listener name=""default"" socket-binding=""http"" />
             <?AJP?>
             <host name=""default-host"" alias=""localhost"">
-                <location name=""/"" handler=""welcome-content"">
-                </location>
+                <location name=""/"" handler=""welcome-content"" />
             </host>
         </server>
         <servlet-container name=""default"" default-buffer-cache=""default"" stack-trace-on-error=""local-only"" >
@@ -48,7 +47,7 @@
     </subsystem>
     <supplement name=""ha"">
         <replacement placeholder=""AJP"">
-            <ajp-listener name=""ajp"" socket-binding=""ajp"" max-post-size=""10485760""/>
+            <ajp-listener name=""ajp"" socket-binding=""ajp"" />
         </replacement>
     </supplement>
     <socket-binding name=""http"" port=""${jboss.http.port:8080}""/>",2013-12-04T15:59:51Z,184
"@@ -1,98 +0,0 @@
-@echo off
-REM  ======================================================================
-REM
-REM  This is the main entry point for the build system.
-REM
-REM  Users should be sure to execute this file rather than 'mvn' to ensure
-REM  the correct version is being used with the correct configuration.
-REM
-REM  ======================================================================
-REM
-REM $Id: build.bat 105735 2010-06-04 19:45:13Z pgier $
-REM
-REM Authors:
-REM     Jason Dillon <jason@planet57.com>
-REM     Sacha Labourey <sacha.labourey@cogito-info.ch>
-REM
-
-REM ******************************************************
-REM Ignore the MAVEN_HOME variable: we want to use *our*
-REM Maven version and associated JARs.
-REM ******************************************************
-REM Ignore the users classpath, cause it might mess
-REM things up
-REM ******************************************************
-
-set PWD=%~dp0
-
-
-SETLOCAL
-
-set BPA=vc9x32
-
-set CLASSPATH=
-set M2_HOME=
-set MAVEN_HOME=
-
-set MVN_OPTIONS=-gs tools\maven\conf\settings.xml -Dbpa=%BPA%
-
-REM ******************************************************
-REM - ""for"" loops have been unrolled for compatibility
-REM   with some WIN32 systems.
-REM ******************************************************
-
-set NAMES=tools;tools\maven;tools\apache\maven
-set SUBFOLDERS=.;..;..\..;..\..\..;..\..\..\..
-
-REM ******************************************************
-REM ******************************************************
-
-SET EXECUTED=FALSE
-for %%i in (%NAMES%) do call :subLoop %%i %1 %2 %3 %4 %5 %6
-
-goto :EOF
-
-
-REM ******************************************************
-REM ********* Search for names in the subfolders *********
-REM ******************************************************
-
-:subLoop
-for %%j in (%SUBFOLDERS%) do call :testIfExists %%j\%1\bin\mvn.bat %2 %3 %4 %5 %6 %7
-
-goto :EOF
-
-
-REM ******************************************************
-REM ************ Test if Maven Batch file exists ***********
-REM ******************************************************
-
-:testIfExists
-if exist %1 call :BatchFound %1 %2 %3 %4 %5 %6 %7 %8
-
-goto :EOF
-
-
-REM ******************************************************
-REM ************** Batch file has been found *************
-REM ******************************************************
-
-:BatchFound
-if (%EXECUTED%)==(FALSE) call :ExecuteBatch %1 %2 %3 %4 %5 %6 %7 %8
-set EXECUTED=TRUE
-
-goto :EOF
-
-REM ******************************************************
-REM ************* Execute Batch file only once ***********
-REM ******************************************************
-
-:ExecuteBatch
-set GOAL=%2
-if ""%GOAL%""=="""" set GOAL=install
-echo Calling %1 %MVN_OPTIONS% %GOAL% %3 %4 %5 %6 %7 %8
-call %1 %MVN_OPTIONS% %GOAL% %3 %4 %5 %6 %7 %8
-
-:end
-
-if ""%NOPAUSE%"" == """" pause",2013-09-26T10:56:06Z,170
"@@ -1,205 +0,0 @@
-#!/bin/sh
-### ====================================================================== ###
-##                                                                          ##
-##  This is the main entry point for the build system.                      ##
-##                                                                          ##
-##  Users should execute this file rather than 'mvn' to ensure              ##
-##  the correct version is being used with the correct configuration.       ##
-##                                                                          ##
-### ====================================================================== ###
-
-# $Id: build.sh 105735 2010-06-04 19:45:13Z pgier $
-
-# Create the bpa if you can
-BPA=
-
-uname | grep Linux >> /dev/null
-if [ ""$?"" -ne ""1"" ]; then
-	uname -a | grep x86_64 >> /dev/null
-	if [ ""$?"" -ne ""1"" ]; then
-		BPA=""-Dbpa=centos54x64""
-	else
-		BPA=""-Dbpa=centos55x32""
-	fi
-  # This is required for the upgrade of g++ https://issues.jboss.org/browse/JBTM-1787
-  if [ -f /etc/fedora-release ]
-  then
-    grep ""Fedora release 18"" /etc/fedora-release > /dev/null
-  	if [ ""$?"" -eq ""0"" ]; then
-  		BPA=""-Dbpa=fc18x64""
-    fi
-    grep ""Fedora release 19"" /etc/fedora-release > /dev/null
-  	if [ ""$?"" -eq ""0"" ]; then
-  		BPA=""-Dbpa=fc18x64""
-    fi
-  fi
-fi
-
-PROGNAME=`basename $0`
-DIRNAME=`dirname $0`
-GREP=""grep""
-ROOT=""/""
-
-# Ignore user's MAVEN_HOME if it is set
-M2_HOME=""""
-MAVEN_HOME=""""
-
-MAVEN_OPTS=""$MAVEN_OPTS -Xmx128M""
-export MAVEN_OPTS
-
-# the default search path for maven
-MAVEN_SEARCH_PATH=""\
-    tools
-    tools/maven \
-    tools/apache/maven \
-    maven""
-
-# the default arguments
-MVN_OPTIONS=""$BPA -gs tools/maven/conf/settings.xml -Demma.jar.location=`pwd`/../ext/""
-
-# Use the maximum available, or set MAX_FD != -1 to use that
-MAX_FD=""maximum""
-
-# OS specific support (must be 'true' or 'false').
-cygwin=false;
-darwin=false;
-case ""`uname`"" in
-    CYGWIN*)
-        cygwin=true
-        ;;
-
-    Darwin*)
-        darwin=true
-        ;;
-esac
-
-#
-# Helper to complain.
-#
-die() {
-    echo ""${PROGNAME}: $*""
-    exit 1
-}
-
-#
-# Helper to complain.
-#
-warn() {
-    echo ""${PROGNAME}: $*""
-}
-
-#
-# Helper to source a file if it exists.
-#
-maybe_source() {
-    for file in $*; do
-	if [ -f ""$file"" ]; then
-	    . $file
-	fi
-    done
-}
-
-search() {
-    search=""$*""
-    for d in $search; do
-	MAVEN_HOME=""`pwd`/$d""
-	MVN=""$MAVEN_HOME/bin/mvn""
-	if [ -x ""$MVN"" ]; then
-	    # found one
-	    echo $MAVEN_HOME
-	    break
-	fi
-    done
-}
-
-#
-# Main function.
-#
-main() {
-    # if there is a build config file. then source it
-    maybe_source ""$DIRNAME/build.conf"" ""$HOME/.build.conf""
-
-    # Increase the maximum file descriptors if we can
-    if [ $cygwin = ""false"" ]; then
-	MAX_FD_LIMIT=`ulimit -H -n`
-	if [ $? -eq 0 ]; then
-	    if [ ""$MAX_FD"" = ""maximum"" -o ""$MAX_FD"" = ""max"" ]; then
-		# use the system max
-		MAX_FD=""$MAX_FD_LIMIT""
-	    fi
-
-	    ulimit -n $MAX_FD
-	    if [ $? -ne 0 ]; then
-		warn ""Could not set maximum file descriptor limit: $MAX_FD""
-	    fi
-	else
-	    warn ""Could not query system maximum file descriptor limit: $MAX_FD_LIMIT""
-	fi
-    fi
-
-    # try the search path
-    MAVEN_HOME=`search $MAVEN_SEARCH_PATH`
-
-    # try looking up to root
-    if [ ""x$MAVEN_HOME"" = ""x"" ]; then
-	target=""build""
-	_cwd=`pwd`
-
-	while [ ""x$MAVEN_HOME"" = ""x"" ] && [ ""$cwd"" != ""$ROOT"" ]; do
-	    cd ..
-	    cwd=`pwd`
-	    MAVEN_HOME=`search $MAVEN_SEARCH_PATH`
-	done
-
-	# make sure we get back
-	cd $_cwd
-
-	if [ ""$cwd"" != ""$ROOT"" ]; then
-	    found=""true""
-	fi
-
-	# complain if we did not find anything
-	if [ ""$found"" != ""true"" ]; then
-	    die ""Could not locate Maven; check \$MVN or \$MAVEN_HOME.""
-	fi
-    fi
-
-    # make sure we have one
-    MVN=$MAVEN_HOME/bin/mvn
-    if [ ! -x ""$MVN"" ]; then
-	die ""Maven file is not executable: $MVN""
-    fi
-
-    # need to specify planet57/buildmagic protocol handler package
-    MVN_OPTS=""-Djava.protocol.handler.pkgs=org.jboss.net.protocol""
-
-    # setup some build properties
-    MVN_OPTS=""$MVN_OPTS -Dbuild.script=$0""
-
-    # change to the directory where the script lives so users are not forced
-    # to be in the same directory as build.xml
-    cd $DIRNAME
-
-    MVN_GOAL=$@
-    if [ -z ""$MVN_GOAL"" ]; then
-      MVN_GOAL=""install""
-    fi
-    
-    # export some stuff for maven
-    export MVN MAVEN_HOME MVN_OPTS MVN_GOAL
-
-    echo ""$MVN $MVN_OPTIONS $MVN_GOAL""
-    
-    # execute in debug mode, or simply execute
-    if [ ""x$MVN_DEBUG"" != ""x"" ]; then
-	  /bin/sh -x $MVN $MVN_OPTIONS $MVN_GOAL
-    else
-	  exec $MVN $MVN_OPTIONS $MVN_GOAL
-    fi
-}
-
-##
-## Bootstrap
-##
-
-main ""$@""",2013-09-26T10:56:06Z,171
"@@ -1,102 +0,0 @@
-function fatal {
-  comment_on_pull ""Tests failed: $1""
-  echo ""$1""
-  exit -1
-}
-
-function comment_on_pull
-{
-    if [ ""$COMMENT_ON_PULL"" = """" ]; then return; fi
-
-    PULL_NUMBER=$(echo $GIT_BRANCH | awk -F 'pull' '{ print $2 }' | awk -F '/' '{ print $2 }')
-    if [ ""$PULL_NUMBER"" != """" ]
-    then
-        JSON=""{ \""body\"": \""$1\"" }""
-        curl -d ""$JSON"" -ujbosstm-bot:$BOT_PASSWORD https://api.github.com/repos/$GIT_ACCOUNT/$GIT_REPO/issues/$PULL_NUMBER/comments
-    else
-        echo ""Not a pull request, so not commenting""
-    fi
-}
-
-ulimit -c unlimited
-
-# CHECK IF WORKSPACE IS SET
-if [ -n ""${WORKSPACE+x}"" ]; then
-  echo WORKSPACE is set
-else
-  echo WORKSPACE not set
-  exit
-fi
-
-if [ -n ""${JBOSS_HOME+x}"" ]; then
-  echo JBOSS_HOME is set
-else
-  echo JBOSS_HOME not set
-  exit
-fi
-
-
-if [ -z ""${JBOSSAS_IP_ADDR+x}"" ]; then
-  echo JBOSSAS_IP_ADDR not set
-  JBOSSAS_IP_ADDR=localhost
-fi
-
-# KILL ANY PREVIOUS BUILD REMNANTS
-ps -f
-for i in `ps -eaf | grep java | grep ""standalone.*xml"" | grep -v grep | cut -c10-15`; do kill -9 $i; done
-killall -9 -r memcheck
-killall -9 testsuite
-killall -9 server
-killall -9 client
-killall -9 cs
-ps -f
-
-# FOR DEBUGGING SUBSEQUENT ISSUES
-free -m
-
-# GET THE TNS NAMES
-TNS_ADMIN=$WORKSPACE/instantclient_11_2/network/admin
-mkdir -p $TNS_ADMIN
-if [ -e $TNS_ADMIN/tnsnames.ora ]; then
-	echo ""tnsnames.ora already downloaded""
-else
-	(cd $TNS_ADMIN; wget http://albany/userContent/blacktie/tnsnames.ora)
-fi
-
-# INITIALIZE JBOSS
-ant -f scripts/hudson/initializeJBoss.xml -DJBOSS_HOME=$JBOSS_HOME -Dbasedir=. initializeJBoss
-if [ ""$?"" != ""0"" ]; then
-	fatal ""Failed to init JBoss: $BUILD_URL""
-fi
-
-export JBOSS_HOME=$WORKSPACE/jboss-as/
-
-chmod u+x $JBOSS_HOME/bin/standalone.sh
-
-# START JBOSS
-export JAVA_OPTS=""$JAVA_OPTS -Xmx256m -XX:MaxPermSize=256m""
-$JBOSS_HOME/bin/standalone.sh -c standalone-blacktie.xml -Djboss.bind.address=$JBOSSAS_IP_ADDR -Djboss.bind.address.unsecure=$JBOSSAS_IP_ADDR&
-sleep 5
-
-# BUILD BLACKTIE
-cd $WORKSPACE
-./build.sh clean install -Djbossas.ip.addr=$JBOSSAS_IP_ADDR ""$@""
-if [ ""$?"" != ""0"" ]; then
-	ps -f
-	for i in `ps -eaf | grep java | grep ""standalone.*xml"" | grep -v grep | cut -c10-15`; do kill -9 $i; done
-	killall -9 testsuite
-	killall -9 server
-	killall -9 client
-	killall -9 cs
-    ps -f
-	fatal ""Some tests failed: $BUILD_URL""
-fi
-
-# KILL ANY BUILD REMNANTS
-ps -f
-for i in `ps -eaf | grep java | grep ""standalone.*xml"" | grep -v grep | cut -c10-15`; do kill -9 $i; done
-killall -9 testsuite
-killall -9 server
-killall -9 client
-killall -9 cs
-ps -f",2013-09-26T10:56:06Z,172
"@@ -1,61 +0,0 @@
-set NOPAUSE=true
-
-rem SHUTDOWN ANY PREVIOUS BUILD REMNANTS
-FOR /F ""usebackq tokens=5"" %%i in (`""netstat -ano|findstr 9999.*LISTENING""`) DO taskkill /F /PID %%i
-tasklist
-taskkill /F /IM mspdbsrv.exe
-taskkill /F /IM testsuite.exe
-taskkill /F /IM server.exe
-taskkill /F /IM client.exe
-taskkill /F /IM cs.exe
-tasklist
-
-if not defined WORKSPACE (call:fail_build && exit -1)
-
-if not defined JBOSSAS_IP_ADDR echo ""JBOSSAS_IP_ADDR not set"" & for /f ""delims="" %%a in ('hostname') do @set JBOSSAS_IP_ADDR=%%a
-
-rem INITIALIZE JBOSS
-cd %WORKSPACE%
-call ant -f scripts/hudson/initializeJBoss.xml -DJBOSS_HOME=%JBOSS_HOME% -Dbasedir=. initializeJBoss -debug || (call:fail_build && exit -1)
-
-rem wget -P jboss-as\standalone\deployments\ -N http://172.17.131.2/job/narayana-populateM2-taconic/lastSuccessfulBuild/artifact/rts/at/webservice/target/restat-web-5.0.0.M2-SNAPSHOT.war
-rem IF %ERRORLEVEL% NEQ 0 call:comment_on_pull ""Can not wget restat-web war"" & exit -1
-
-set JBOSS_HOME=
-
-rem START JBOSS
-cd jboss-as\bin
-rem set JAVA_OPTS=""%JAVA_OPTS% -Xmx1024m -XX:MaxPermSize=512m""
-start /B standalone.bat -c standalone-blacktie.xml -Djboss.bind.address=%JBOSSAS_IP_ADDR% -Djboss.bind.address.unsecure=%JBOSSAS_IP_ADDR%
-echo ""Started server""
-@ping 127.0.0.1 -n 20 -w 1000 > nul
-
-rem BUILD BLACKTIE
-cd %WORKSPACE%
-call build.bat clean install ""-Djbossas.ip.addr=%JBOSSAS_IP_ADDR%"" || (call:fail_build && exit -1)
-
-rem SHUTDOWN ANY PREVIOUS BUILD REMNANTS
-tasklist & FOR /F ""usebackq tokens=5"" %%i in (`""netstat -ano|findstr 9999.*LISTENING""`) DO taskkill /F /PID %%i
-echo ""Finished build""
-
-rem -------------------------------------------------------
-rem -                 Functions bellow                    -
-rem -------------------------------------------------------
-
-goto:eof
-
-:fail_build
-  call:comment_on_pull ""Build failed %BUILD_URL%""
-  tasklist & FOR /F ""usebackq tokens=5"" %%i in (`""netstat -ano|findstr 9999.*LISTENING""`) DO taskkill /F /PID %%i
-  exit -1
-goto:eof
-
-:comment_on_pull
-   if not ""%COMMENT_ON_PULL%""==""1"" goto:eof
-
-   for /f ""tokens=1,2,3,4 delims=/"" %%a in (""%GIT_BRANCH%"") do set IS_PULL=%%b&set PULL_NUM=%%c
-   if not ""%IS_PULL%""==""pull"" goto:eof
-   
-   curl -d ""{ \""body\"": \""%~1\"" }"" -ujbosstm-bot:%BOT_PASSWORD% https://api.github.com/repos/%GIT_ACCOUNT%/%GIT_REPO%/issues/%PULL_NUM%/comments
-
-goto:eof",2013-09-26T10:56:06Z,173
"@@ -2,24 +2,20 @@
 <project name=""blacktie-dependencies"">
     <target name=""initializeJBoss"">
         <!--       <get src=""http://172.17.131.2/userContent/blacktie/jbossesb-4.9.zip"" dest=""./jbossesb-4.9.zip"" verbose=""true"" usetimestamp=""true"" skipexisting=""true""/>  -->
-        <delete dir=""jboss-as""/>
-        <copy todir=""jboss-as"">
-            <fileset dir=""${JBOSS_HOME}""/>
-        </copy>
-        <copy file=""jboss-as/docs/examples/configs/standalone-blacktie.xml"" tofile=""jboss-as/standalone/configuration/standalone-blacktie.xml"" overwrite=""true"" />
-        <replaceregexp byline=""true"" match=""address=8787,server=y,suspend=n&quot;"" replace=""address=8787,server=y,suspend=n&quot;&#10;set &quot;JAVA_OPTS=%JAVA_OPTS% -DOrbPortabilityEnvironmentBean.resolveService=NAME_SERVICE&quot;"" file=""jboss-as/bin/standalone.conf.bat""/>
-        <replaceregexp byline=""true"" match=""address=8787,server=y,suspend=n&quot;"" replace=""address=8787,server=y,suspend=n&quot;&#10;export JAVA_OPTS=&quot;$JAVA_OPTS -DOrbPortabilityEnvironmentBean.resolveService=NAME_SERVICE&quot;"" file=""jboss-as/bin/standalone.conf""/>
-        <replaceregexp byline=""true"" match=""&quot;spec&quot;"" replace=""&quot;on&quot;"" file=""jboss-as/standalone/configuration/standalone-blacktie.xml""/>
-        <replaceregexp byline=""true"" match=""&lt;coordinator-environment default-timeout=&quot;300&quot;/&gt;"" replace=""&lt;coordinator-environment default-timeout=&quot;300&quot;/&gt;&#10;            &lt;jts/&gt;"" file=""jboss-as/standalone/configuration/standalone-blacktie.xml""/>
-        <replaceregexp byline=""true"" match=""&lt;root-logger&gt;"" replace=""&lt;logger category=&quot;org.jboss.ejb.client&quot;&gt;&#10;                &lt;level name=&quot;ALL&quot;/&gt;&#10;            &lt;/logger&gt;&#10;            &lt;logger category=&quot;org.jboss.as.ejb3&quot;&gt;&#10;                &lt;level name=&quot;ALL&quot;/&gt;&#10;            &lt;/logger&gt;&#10;            &lt;logger category=&quot;org.jboss.narayana.blacktie&quot;&gt;&#10;                &lt;level name=&quot;ALL&quot;/&gt;&#10;            &lt;/logger&gt;&#10;            &lt;logger category=&quot;org.codehaus.stomp&quot;&gt;&#10;                &lt;level name=&quot;ALL&quot;/&gt;&#10;            &lt;/logger&gt;&#10;            &lt;logger category=&quot;org.hornetq&quot;&gt;&#10;                &lt;level name=&quot;ALL&quot;/&gt;&#10;            &lt;/logger&gt;&#10;            &lt;root-logger&gt;"" file=""jboss-as/standalone/configuration/standalone-blacktie.xml""/>
-        <replaceregexp byline=""true"" match=""&lt;/hornetq-server&gt;"" replace=""&lt;jms-destinations&gt;&#10;                    &lt;jms-queue name=&quot;BTR_TestOne&quot;&gt;&#10;                        &lt;entry name=&quot;queue/BTR_TestOne&quot;/&gt;&#10;                        &lt;entry name=&quot;java:jboss/exported/jms/queue/BTR_TestOne&quot;/&gt;&#10;                    &lt;/jms-queue&gt;&#10;                    &lt;jms-queue name=&quot;BTR_TestTwo&quot;&gt;&#10;                        &lt;entry name=&quot;queue/BTR_TestTwo&quot;/&gt;&#10;                        &lt;entry name=&quot;java:jboss/exported/jms/queue/BTR_TestTwo&quot;/&gt;&#10;                    &lt;/jms-queue&gt;&#10;                    &lt;jms-queue name=&quot;BTC_ConvService&quot;&gt;&#10;                        &lt;entry name=&quot;queue/BTC_ConvService&quot;/&gt;&#10;                        &lt;entry name=&quot;java:jboss/exported/jms/queue/BTC_ConvService&quot;/&gt;&#10;                    &lt;/jms-queue&gt;&#10;                    &lt;jms-queue name=&quot;BTR_JAVA_Converse&quot;&gt;&#10;                        &lt;entry name=&quot;queue/BTR_JAVA_Converse&quot;/&gt;&#10;                        &lt;entry name=&quot;java:jboss/exported/jms/queue/BTR_JAVA_Converse&quot;/&gt;&#10;                    &lt;/jms-queue&gt;&#10;                    &lt;jms-topic name=&quot;BTR_JAVA_Topic&quot;&gt;&#10;                        &lt;entry name=&quot;topic/BTR_JAVA_Topic&quot;/&gt;&#10;                        &lt;entry name=&quot;java:jboss/exported/jms/topic/BTR_JAVA_Topic&quot;/&gt;&#10;                    &lt;/jms-topic&gt;&lt;/jms-destinations&gt;&#10;                    &#10;            &lt;/hornetq-server&gt;"" file=""jboss-as/standalone/configuration/standalone-blacktie.xml""/>
-        <replaceregexp byline=""true"" match=""&lt;security-settings&gt;"" replace=""&lt;security-settings&gt;&#10;                    &lt;security-setting match=&quot;jms.queue.BTR_BTDomainAdmin&quot;&gt;&#10;                       &lt;permission type=&quot;send&quot; roles=&quot;blacktie&quot;/&gt;&#10;                       &lt;permission type=&quot;consume&quot; roles=&quot;blacktie&quot;/&gt;&#10;                    &lt;/security-setting&gt;&#10;                    &lt;security-setting match=&quot;jms.queue.BTR_BTStompAdmin&quot;&gt;&#10;                       &lt;permission type=&quot;send&quot; roles=&quot;blacktie&quot;/&gt;&#10;                       &lt;permission type=&quot;consume&quot; roles=&quot;blacktie&quot;/&gt;&#10;                    &lt;/security-setting&gt;"" file=""jboss-as/standalone/configuration/standalone-blacktie.xml""/>
-        <replaceregexp byline=""true"" match=""#guest=guest"" replace=""guest=guest,blacktie&#10;"" file=""jboss-as/standalone/configuration/application-roles.properties""/>
-        <echo file=""jboss-as/standalone/configuration/application-roles.properties"" append=""true"">dynsub=guest,blacktie,dynsub</echo>
-        <replaceregexp byline=""true"" match=""&lt;security-settings&gt;"" replace=""&lt;security-settings&gt;&#10;                    &lt;security-setting match=&quot;jms.queue.BTR_SECURE&quot;&gt;&#10;                       &lt;permission type=&quot;send&quot; roles=&quot;dynsub&quot;/&gt;&#10;                       &lt;permission type=&quot;consume&quot; roles=&quot;dynsub&quot;/&gt;&#10;                    &lt;/security-setting&gt;&#10;"" file=""jboss-as/standalone/configuration/standalone-blacktie.xml""/>
-        <replaceregexp byline=""true"" match=""&lt;connection-factory name=&quot;InVmConnectionFactory&quot;&gt;"" replace=""&lt;connection-factory name=&quot;InVmConnectionFactory&quot;&gt;&#10;                        &lt;connection-ttl&gt;-1&lt;/connection-ttl&gt;&#10;                        &lt;client-failure-check-period&gt;86400000&lt;/client-failure-check-period&gt;"" file=""jboss-as/standalone/configuration/standalone-blacktie.xml""/>
-        <replaceregexp byline=""true"" match=""&lt;pooled-connection-factory name=&quot;hornetq-ra&quot;&gt;"" replace=""&lt;pooled-connection-factory name=&quot;hornetq-ra&quot;&gt;&#10;                        &lt;connection-ttl&gt;-1&lt;/connection-ttl&gt;&#10;                        &lt;client-failure-check-period&gt;86400000&lt;/client-failure-check-period&gt;"" file=""jboss-as/standalone/configuration/standalone-blacktie.xml""/>
-		<replaceregexp byline=""true"" match=""&lt;module name=&quot;org.omg.api&quot;/&gt;"" replace=""&lt;module name=&quot;org.omg.api&quot;/&gt;&#10;        &lt;module name=&quot;org.jboss.as.jacorb&quot;/&gt;"" file=""jboss-as/modules/system/layers/base/org/jboss/as/transactions/main/module.xml""/>
+        <copy file=""${JBOSS_HOME}/docs/examples/configs/standalone-blacktie.xml"" tofile=""${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml"" overwrite=""true"" />
+        <replaceregexp byline=""true"" match=""address=8787,server=y,suspend=n&quot;"" replace=""address=8787,server=y,suspend=n&quot;&#10;set &quot;JAVA_OPTS=%JAVA_OPTS% -DOrbPortabilityEnvironmentBean.resolveService=NAME_SERVICE&quot;"" file=""${JBOSS_HOME}/bin/standalone.conf.bat""/>
+        <replaceregexp byline=""true"" match=""address=8787,server=y,suspend=n&quot;"" replace=""address=8787,server=y,suspend=n&quot;&#10;export JAVA_OPTS=&quot;$JAVA_OPTS -DOrbPortabilityEnvironmentBean.resolveService=NAME_SERVICE&quot;"" file=""${JBOSS_HOME}/bin/standalone.conf""/>
+        <replaceregexp byline=""true"" match=""&quot;spec&quot;"" replace=""&quot;on&quot;"" file=""${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml""/>
+        <replaceregexp byline=""true"" match=""&lt;coordinator-environment default-timeout=&quot;300&quot;/&gt;"" replace=""&lt;coordinator-environment default-timeout=&quot;300&quot;/&gt;&#10;            &lt;jts/&gt;"" file=""${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml""/>
+        <replaceregexp byline=""true"" match=""&lt;root-logger&gt;"" replace=""&lt;logger category=&quot;org.jboss.ejb.client&quot;&gt;&#10;                &lt;level name=&quot;ALL&quot;/&gt;&#10;            &lt;/logger&gt;&#10;            &lt;logger category=&quot;org.jboss.as.ejb3&quot;&gt;&#10;                &lt;level name=&quot;ALL&quot;/&gt;&#10;            &lt;/logger&gt;&#10;            &lt;logger category=&quot;org.jboss.narayana.blacktie&quot;&gt;&#10;                &lt;level name=&quot;ALL&quot;/&gt;&#10;            &lt;/logger&gt;&#10;            &lt;logger category=&quot;org.codehaus.stomp&quot;&gt;&#10;                &lt;level name=&quot;ALL&quot;/&gt;&#10;            &lt;/logger&gt;&#10;            &lt;logger category=&quot;org.hornetq&quot;&gt;&#10;                &lt;level name=&quot;ALL&quot;/&gt;&#10;            &lt;/logger&gt;&#10;            &lt;root-logger&gt;"" file=""${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml""/>
+        <replaceregexp byline=""true"" match=""&lt;/hornetq-server&gt;"" replace=""&lt;jms-destinations&gt;&#10;                    &lt;jms-queue name=&quot;BTR_TestOne&quot;&gt;&#10;                        &lt;entry name=&quot;queue/BTR_TestOne&quot;/&gt;&#10;                        &lt;entry name=&quot;java:jboss/exported/jms/queue/BTR_TestOne&quot;/&gt;&#10;                    &lt;/jms-queue&gt;&#10;                    &lt;jms-queue name=&quot;BTR_TestTwo&quot;&gt;&#10;                        &lt;entry name=&quot;queue/BTR_TestTwo&quot;/&gt;&#10;                        &lt;entry name=&quot;java:jboss/exported/jms/queue/BTR_TestTwo&quot;/&gt;&#10;                    &lt;/jms-queue&gt;&#10;                    &lt;jms-queue name=&quot;BTC_ConvService&quot;&gt;&#10;                        &lt;entry name=&quot;queue/BTC_ConvService&quot;/&gt;&#10;                        &lt;entry name=&quot;java:jboss/exported/jms/queue/BTC_ConvService&quot;/&gt;&#10;                    &lt;/jms-queue&gt;&#10;                    &lt;jms-queue name=&quot;BTR_JAVA_Converse&quot;&gt;&#10;                        &lt;entry name=&quot;queue/BTR_JAVA_Converse&quot;/&gt;&#10;                        &lt;entry name=&quot;java:jboss/exported/jms/queue/BTR_JAVA_Converse&quot;/&gt;&#10;                    &lt;/jms-queue&gt;&#10;                    &lt;jms-topic name=&quot;BTR_JAVA_Topic&quot;&gt;&#10;                        &lt;entry name=&quot;topic/BTR_JAVA_Topic&quot;/&gt;&#10;                        &lt;entry name=&quot;java:jboss/exported/jms/topic/BTR_JAVA_Topic&quot;/&gt;&#10;                    &lt;/jms-topic&gt;&lt;/jms-destinations&gt;&#10;                    &#10;            &lt;/hornetq-server&gt;"" file=""${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml""/>
+        <replaceregexp byline=""true"" match=""&lt;security-settings&gt;"" replace=""&lt;security-settings&gt;&#10;                    &lt;security-setting match=&quot;jms.queue.BTR_BTDomainAdmin&quot;&gt;&#10;                       &lt;permission type=&quot;send&quot; roles=&quot;blacktie&quot;/&gt;&#10;                       &lt;permission type=&quot;consume&quot; roles=&quot;blacktie&quot;/&gt;&#10;                    &lt;/security-setting&gt;&#10;                    &lt;security-setting match=&quot;jms.queue.BTR_BTStompAdmin&quot;&gt;&#10;                       &lt;permission type=&quot;send&quot; roles=&quot;blacktie&quot;/&gt;&#10;                       &lt;permission type=&quot;consume&quot; roles=&quot;blacktie&quot;/&gt;&#10;                    &lt;/security-setting&gt;"" file=""${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml""/>
+        <replaceregexp byline=""true"" match=""#guest=guest"" replace=""guest=guest,blacktie&#10;"" file=""${JBOSS_HOME}/standalone/configuration/application-roles.properties""/>
+        <echo file=""${JBOSS_HOME}/standalone/configuration/application-roles.properties"" append=""true"">dynsub=guest,blacktie,dynsub</echo>
+        <replaceregexp byline=""true"" match=""&lt;security-settings&gt;"" replace=""&lt;security-settings&gt;&#10;                    &lt;security-setting match=&quot;jms.queue.BTR_SECURE&quot;&gt;&#10;                       &lt;permission type=&quot;send&quot; roles=&quot;dynsub&quot;/&gt;&#10;                       &lt;permission type=&quot;consume&quot; roles=&quot;dynsub&quot;/&gt;&#10;                    &lt;/security-setting&gt;&#10;"" file=""${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml""/>
+        <replaceregexp byline=""true"" match=""&lt;connection-factory name=&quot;InVmConnectionFactory&quot;&gt;"" replace=""&lt;connection-factory name=&quot;InVmConnectionFactory&quot;&gt;&#10;                        &lt;connection-ttl&gt;-1&lt;/connection-ttl&gt;&#10;                        &lt;client-failure-check-period&gt;86400000&lt;/client-failure-check-period&gt;"" file=""${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml""/>
+        <replaceregexp byline=""true"" match=""&lt;pooled-connection-factory name=&quot;hornetq-ra&quot;&gt;"" replace=""&lt;pooled-connection-factory name=&quot;hornetq-ra&quot;&gt;&#10;                        &lt;connection-ttl&gt;-1&lt;/connection-ttl&gt;&#10;                        &lt;client-failure-check-period&gt;86400000&lt;/client-failure-check-period&gt;"" file=""${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml""/>
+		<replaceregexp byline=""true"" match=""&lt;module name=&quot;org.omg.api&quot;/&gt;"" replace=""&lt;module name=&quot;org.omg.api&quot;/&gt;&#10;        &lt;module name=&quot;org.jboss.as.jacorb&quot;/&gt;"" file=""${JBOSS_HOME}/modules/system/layers/base/org/jboss/as/transactions/main/module.xml""/>
 
 	<!-- Copy the required users into the AS domain -->
 	<!--
@@ -29,8 +25,8 @@
 	(cd jboss-as/bin/ && ./add-user.sh guest password -a \-\-silent=true)
 	(cd jboss-as/bin/ && ./add-user.sh dynsub password -a \-\-silent=true)
 	-->
-	<copy todir=""jboss-as/"" overwrite=""true"">
-		<fileset dir=""scripts/hudson/config/""/>
+	<copy todir=""${JBOSS_HOME}/"" overwrite=""true"">
+		<fileset dir=""config/""/>
 	</copy>
     </target>
 </project>",2013-09-26T10:56:06Z,52
"@@ -33,7 +33,7 @@ set M2_HOME=
 set MAVEN_HOME=
 
 set MAVEN_OPTS=%MAVEN_OPTS% -Xms512m -XX:MaxPermSize=256m
-set MVN_OPTIONS=-gs tools\maven\conf\settings.xml -Dorson.jar.location=%PWD%\ext\
+set MVN_OPTIONS=-gs tools\maven\conf\settings.xml -Dorson.jar.location=%PWD%\ext\ -Dbpa=vc9x32
 
 REM ******************************************************
 REM - ""for"" loops have been unrolled for compatibility",2013-09-26T10:56:06Z,174
"@@ -10,6 +10,30 @@
 
 # $Id: build.sh 105735 2010-06-04 19:45:13Z pgier $
 
+# Create the bpa if you can
+BPA=
+uname | grep Linux >> /dev/null
+if [ ""$?"" -ne ""1"" ]; then
+	uname -a | grep x86_64 >> /dev/null
+	if [ ""$?"" -ne ""1"" ]; then
+		BPA=""-Dbpa=centos54x64""
+	else
+		BPA=""-Dbpa=centos55x32""
+	fi
+  # This is required for the upgrade of g++ https://issues.jboss.org/browse/JBTM-1787
+  if [ -f /etc/fedora-release ]
+  then
+    grep ""Fedora release 18"" /etc/fedora-release > /dev/null
+  	if [ ""$?"" -eq ""0"" ]; then
+  		BPA=""-Dbpa=fc18x64""
+    fi
+    grep ""Fedora release 19"" /etc/fedora-release > /dev/null
+  	if [ ""$?"" -eq ""0"" ]; then
+  		BPA=""-Dbpa=fc18x64""
+    fi
+  fi
+fi
+
 PROGNAME=`basename $0`
 DIRNAME=`dirname $0`
 GREP=""grep""
@@ -30,7 +54,7 @@ MAVEN_SEARCH_PATH=""\
     maven""
 
 #  Default arguments
-MVN_OPTIONS=""-s tools/maven/conf/settings.xml -Dorson.jar.location=`pwd`/ext/ -Demma.jar.location=`pwd`/ext/""
+MVN_OPTIONS=""-s tools/maven/conf/settings.xml -Dorson.jar.location=`pwd`/ext/ -Demma.jar.location=`pwd`/ext/ $BPA""
 
 #  Use the maximum available, or set MAX_FD != -1 to use that
 MAX_FD=""maximum""",2013-09-26T10:56:06Z,35
"@@ -1,3 +1,5 @@
+if not defined WORKSPACE (call:fail_build && exit -1)
+
 call:comment_on_pull ""Started testing this pull request with BLACKTIE profile on Windows: %BUILD_URL%""
 
 call build.bat clean install ""-DskipTests"" || (call:comment_on_pull ""BLACKTIE profile tests failed on Windows - Narayana Failed %BUILD_URL%"" && exit -1)
@@ -10,13 +12,12 @@ cd jboss-as
 git remote add upstream https://github.com/wildfly/wildfly.git
 git pull --rebase --ff-only -s recursive -Xtheirs upstream master
 if %ERRORLEVEL% NEQ 0 exit -1
-
 echo ""Building AS""
 set MAVEN_OPTS=""-Xmx768M""
 call build.bat clean install ""-DskipTests"" ""-Drelease=true"" || (call:comment_on_pull ""BLACKTIE profile tests failed on Windows - AS Failed %BUILD_URL%"" && exit -1)
+cd ..\
 
 echo ""Building Blacktie Subsystem""
-cd ..\
 call build.bat -f blacktie\wildfly-blacktie\pom.xml clean install || (call:comment_on_pull ""BLACKTIE profile tests failed on Windows - Build Blacktie Subsystem Failed %BUILD_URL%"" && exit -1)
 
 echo ""Building BlackTie
@@ -25,15 +26,55 @@ rmdir wildfly-%WILDFLY_MASTER_VERSION% /s /q
 unzip ..\jboss-as\dist\target\wildfly-%WILDFLY_MASTER_VERSION%.zip
 set JBOSS_HOME=%CD%\wildfly-%WILDFLY_MASTER_VERSION%\
 unzip wildfly-blacktie\build\target\wildfly-blacktie-build-%WILDFLY_MASTER_VERSION%-bin.zip -d %JBOSS_HOME%
-set WORKSPACE=%WORKSPACE%\blacktie 
-call scripts\hudson\blacktie-vc9x32.bat || (call:comment_on_pull ""BLACKTIE profile tests failed on Windows - BlackTie Failed %BUILD_URL%"" && exit -1)
+cd ..\
+
+set NOPAUSE=true
+
+rem SHUTDOWN ANY PREVIOUS BUILD REMNANTS
+FOR /F ""usebackq tokens=5"" %%i in (`""netstat -ano|findstr 9999.*LISTENING""`) DO taskkill /F /PID %%i
+tasklist
+taskkill /F /IM mspdbsrv.exe
+taskkill /F /IM testsuite.exe
+taskkill /F /IM server.exe
+taskkill /F /IM client.exe
+taskkill /F /IM cs.exe
+tasklist
+
+if not defined JBOSSAS_IP_ADDR echo ""JBOSSAS_IP_ADDR not set"" & for /f ""delims="" %%a in ('hostname') do @set JBOSSAS_IP_ADDR=%%a
+
+rem INITIALIZE JBOSS
+call ant -f blacktie/scripts/hudson/initializeJBoss.xml -DJBOSS_HOME=%WORKSPACE%\blacktie\wildfly-${WILDFLY_MASTER_VERSION} initializeJBoss -debug || (call:fail_build && exit -1)
+
+rem wget -P jboss-as\standalone\deployments\ -N http://172.17.131.2/job/narayana-populateM2-taconic/lastSuccessfulBuild/artifact/rts/at/webservice/target/restat-web-5.0.0.M2-SNAPSHOT.war
+rem IF %ERRORLEVEL% NEQ 0 call:comment_on_pull ""Can not wget restat-web war"" & exit -1
+
+set JBOSS_HOME=%WORKSPACE%\blacktie\wildfly-${WILDFLY_MASTER_VERSION}
+
+rem START JBOSS
+rem set JAVA_OPTS=""%JAVA_OPTS% -Xmx1024m -XX:MaxPermSize=512m""
+start /B %JBOSS_HOME%\bin\standalone.bat -c standalone-blacktie.xml -Djboss.bind.address=%JBOSSAS_IP_ADDR% -Djboss.bind.address.unsecure=%JBOSSAS_IP_ADDR%
+echo ""Started server""
+@ping 127.0.0.1 -n 20 -w 1000 > nul
+
+rem BUILD BLACKTIE
+call build.bat -f blacktie/pom.xml clean install ""-Djbossas.ip.addr=%JBOSSAS_IP_ADDR%"" || (call:fail_build && exit -1)
+
+rem SHUTDOWN ANY PREVIOUS BUILD REMNANTS
+tasklist & FOR /F ""usebackq tokens=5"" %%i in (`""netstat -ano|findstr 9999.*LISTENING""`) DO taskkill /F /PID %%i
+echo ""Finished build""
 
 call:comment_on_pull ""BLACKTIE profile tests passed on Windows - Job complete %BUILD_URL%""
 
-rem -------------------------------------------------------
-rem -                 Functions bellow                    -
-rem -------------------------------------------------------
+rem ------------------------------------------------------
+rem -                 Functions below                    -
+rem ------------------------------------------------------
+
+goto:eof
 
+:fail_build
+  call:comment_on_pull ""Build failed %BUILD_URL%""
+  tasklist & FOR /F ""usebackq tokens=5"" %%i in (`""netstat -ano|findstr 9999.*LISTENING""`) DO taskkill /F /PID %%i
+  exit -1
 goto:eof
 
 :comment_on_pull",2013-09-26T10:56:06Z,147
"@@ -197,17 +197,9 @@ function build_as {
   #Enable remote debugger
   echo JAVA_OPTS='""$JAVA_OPTS -agentlib:jdwp=transport=dt_socket,address=8787,server=y,suspend=n""' >> ./build/target/wildfly-*/bin/standalone.conf
 
-  build_blacktie_subsystem
   init_jboss_home
 }
 
-function build_blacktie_subsystem {
-  echo ""Building Blacktie Subsystem""
-  cd ${WORKSPACE}
-  ./build.sh -f blacktie/wildfly-blacktie/pom.xml clean install
-  [ $? = 0 ] || fatal ""Blacktie Subsystem build failed""
-}
-
 function init_jboss_home {
   cd $WORKSPACE
   JBOSS_VERSION=`ls -1 ${WORKSPACE}/jboss-as/build/target | grep wildfly`
@@ -248,13 +240,67 @@ function rts_tests {
 
 function blacktie {
   echo ""#0. BlackTie""
-  cd blacktie
-  rm -rf $PWD/wildfly-${WILDFLY_MASTER_VERSION}
-  unzip ../jboss-as/dist/target/wildfly-${WILDFLY_MASTER_VERSION}.zip
-  unzip ${WORKSPACE}/blacktie/wildfly-blacktie/build/target/wildfly-blacktie-build-${WILDFLY_MASTER_VERSION}-bin.zip -d $PWD/wildfly-${WILDFLY_MASTER_VERSION}
-  WORKSPACE=$WORKSPACE/blacktie JBOSS_HOME=$PWD/wildfly-${WILDFLY_MASTER_VERSION} ./scripts/hudson/blacktie-linux.sh ""$@""
-  [ $? = 0 ] || fatal ""BlackTie build failed""
-  cd -
+  ulimit -c unlimited
+  if [ -z ""${JBOSSAS_IP_ADDR+x}"" ]; then
+    echo JBOSSAS_IP_ADDR not set
+    JBOSSAS_IP_ADDR=localhost
+  fi
+  # KILL ANY PREVIOUS BUILD REMNANTS
+  ps -f
+  for i in `ps -eaf | grep java | grep ""standalone.*xml"" | grep -v grep | cut -c10-15`; do kill -9 $i; done
+  killall -9 -r memcheck
+  killall -9 testsuite
+  killall -9 server
+  killall -9 client
+  killall -9 cs
+  ps -f
+  # FOR DEBUGGING SUBSEQUENT ISSUES
+  free -m
+
+  echo ""Building Blacktie Subsystem""
+  cd ${WORKSPACE}
+  ./build.sh -f blacktie/wildfly-blacktie/pom.xml clean install ""$@""
+  [ $? = 0 ] || fatal ""Blacktie Subsystem build failed""
+  rm -rf ${WORKSPACE}/blacktie/wildfly-${WILDFLY_MASTER_VERSION}
+  unzip ${WORKSPACE}/jboss-as/dist/target/wildfly-${WILDFLY_MASTER_VERSION}.zip -d $PWD/blacktie
+  [ $? = 0 ] || fatal ""Could not unzip wildfly""
+  unzip ${WORKSPACE}/blacktie/wildfly-blacktie/build/target/wildfly-blacktie-build-${WILDFLY_MASTER_VERSION}-bin.zip -d $PWD/blacktie/wildfly-${WILDFLY_MASTER_VERSION}
+  [ $? = 0 ] || fatal ""Could not unzip blacktie into widfly""
+  # INITIALIZE JBOSS
+  ant -f blacktie/scripts/hudson/initializeJBoss.xml -DJBOSS_HOME=$WORKSPACE/blacktie/wildfly-${WILDFLY_MASTER_VERSION} initializeJBoss
+  if [ ""$?"" != ""0"" ]; then
+	  fatal ""Failed to init JBoss: $BUILD_URL""
+  fi
+  chmod u+x $WORKSPACE/blacktie/wildfly-${WILDFLY_MASTER_VERSION}/bin/standalone.sh
+
+  if [[ $# == 0 || $# > 0 && ""$1"" != ""-DskipTests"" ]]; then
+    # START JBOSS
+    JBOSS_HOME=`pwd`/blacktie/wildfly-${WILDFLY_MASTER_VERSION} JAVA_OPTS=""$JAVA_OPTS -Xmx256m -XX:MaxPermSize=256m"" blacktie/wildfly-${WILDFLY_MASTER_VERSION}/bin/standalone.sh -c standalone-blacktie.xml -Djboss.bind.address=$JBOSSAS_IP_ADDR -Djboss.bind.address.unsecure=$JBOSSAS_IP_ADDR&
+    sleep 5
+  fi
+
+  # BUILD BLACKTIE
+  ./build.sh -f blacktie/pom.xml clean install -Djbossas.ip.addr=$JBOSSAS_IP_ADDR ""$@""
+  if [ ""$?"" != ""0"" ]; then
+  	ps -f
+	  for i in `ps -eaf | grep java | grep ""standalone.*xml"" | grep -v grep | cut -c10-15`; do kill -9 $i; done
+  	killall -9 testsuite
+	  killall -9 server
+	  killall -9 client
+  	killall -9 cs
+    ps -f
+  	fatal ""Some tests failed: $BUILD_URL""
+  fi
+
+  # KILL ANY BUILD REMNANTS
+  ps -f
+  for i in `ps -eaf | grep java | grep ""standalone.*xml"" | grep -v grep | cut -c10-15`; do kill -9 $i; done
+  killall -9 testsuite
+  killall -9 server
+  killall -9 client
+  killall -9 cs
+  ps -f
+  [ $? = 0 ] || fatal ""BlackTie build failed: $BUILD_URL""
 }
 
 function jta_cdi_tests {",2013-09-26T10:56:06Z,10
"@@ -144,6 +144,7 @@ protected void stopContainer() {
         deployer.undeploy(DEPLOYMENT_NAME);
         containerController.stop(CONTAINER_NAME);
         containerController.kill(CONTAINER_NAME);
+        clearObjectStore();
     }
 
     protected void clearObjectStore() {",2013-11-12T17:16:05Z,185
"@@ -20,8 +20,6 @@
  */
 package org.jboss.jbossts.star.test;
 
-import java.util.Collection;
-
 import java.io.IOException;
 import java.net.HttpURLConnection;
 
@@ -165,14 +163,4 @@ public void testCommitInvalidTx() throws IOException
         // commit it properly
         txn.commitTx();
     }
-    
-    @Test
-    public void testListTransactionsWhenNoActiveTxns() throws IOException
-    {
-        TxSupport txn = new TxSupport();
-        
-        Collection<String> transactionsInProgress = txn.getTransactions();
-        
-        Assert.assertEquals(0, transactionsInProgress.size());
-    }
 }",2012-03-15T13:49:46Z,186
"@@ -0,0 +1,29 @@
+package org.jboss.jbossts.star.test;
+
+import java.io.IOException;
+import java.util.Collection;
+import org.jboss.jbossts.star.util.TxSupport;
+import org.junit.Assert;
+import org.junit.BeforeClass;
+import org.junit.Test;
+
+public class TxSupportTest extends BaseTest {
+
+    @BeforeClass
+    public static void beforeClass() throws Exception {
+        startContainer(TXN_MGR_URL);
+    }
+
+    // This test needs to be run in isolation so that previously running/incomplete txns don't affect the results
+    // Needs to be considered before adding new tests here
+    @Test
+    public void testListTransactionsWhenNoActiveTxns() throws IOException {
+        TxSupport txn = new TxSupport();
+
+        // This should be a collection of size 0.
+        Collection<String> transactionsInProgress = txn.getTransactions();
+
+        Assert.assertEquals(0, transactionsInProgress.size());
+    }
+
+}",2012-03-15T13:49:46Z,187
"@@ -32,14 +32,11 @@
 import javax.enterprise.inject.spi.PassivationCapable;
 import javax.naming.InitialContext;
 import javax.naming.NamingException;
-import javax.transaction.Status;
-import javax.transaction.SystemException;
-import javax.transaction.Transaction;
-import javax.transaction.TransactionManager;
-import javax.transaction.TransactionScoped;
-import javax.transaction.TransactionSynchronizationRegistry;
+import javax.transaction.*;
 import java.lang.annotation.Annotation;
 
+import java.util.HashMap;
+import java.util.Map;
 
 /**
  * @author paul.robinson@redhat.com 01/05/2013
@@ -50,9 +47,10 @@ public class TransactionContext implements Context {
 
     private static TransactionSynchronizationRegistry transactionSynchronizationRegistry;
 
+    private Map<Transaction, TransactionScopeCleanup> transactions = new HashMap<Transaction, TransactionScopeCleanup>();
+
     @Override
     public Class<? extends Annotation> getScope() {
-
         return TransactionScoped.class;
     }
 
@@ -72,8 +70,21 @@ public <T> T get(Contextual<T> contextual, CreationalContext<T> creationalContex
         if (resource != null) {
             return (T) resource;
         } else if (creationalContext != null) {
+            Transaction currentTransaction = getCurrentTransaction();
             T t = contextual.create(creationalContext);
             tsr.putResource(bean.getId(), t);
+
+            synchronized (transactions) {
+                TransactionScopeCleanup synch = transactions.get(currentTransaction);
+
+                if (synch == null) {
+                    synch = new TransactionScopeCleanup(this, currentTransaction);
+                    transactions.put(currentTransaction, synch);
+                }
+
+                synch.registerBean(contextual, creationalContext, t);
+            }
+
             return t;
         } else {
             return null;
@@ -106,6 +117,12 @@ public boolean isActive() {
         }
     }
 
+    void cleanupScope(Transaction transaction) {
+        synchronized (transactions) {
+            transactions.remove(transaction);
+        }
+    }
+
     private Transaction getCurrentTransaction() {
 
         try {",2013-10-25T16:28:38Z,188
"@@ -0,0 +1,66 @@
+package com.arjuna.ats.jta.cdi;
+
+import com.arjuna.ats.jta.logging.jtaLogger;
+
+import javax.enterprise.context.spi.Contextual;
+import javax.enterprise.context.spi.CreationalContext;
+import javax.transaction.RollbackException;
+import javax.transaction.Synchronization;
+import javax.transaction.SystemException;
+import javax.transaction.Transaction;
+import java.util.Set;
+import java.util.concurrent.CopyOnWriteArraySet;
+
+public class TransactionScopeCleanup<T> implements Synchronization {
+    private Set<TransactionScopedBean> beans;
+    private TransactionContext context;
+    private Transaction transaction;
+
+    public TransactionScopeCleanup(TransactionContext context, Transaction transaction) {
+        this.context = context;
+        this.transaction = transaction;
+        this.beans = new CopyOnWriteArraySet<TransactionScopedBean>();
+
+        try {
+            transaction.registerSynchronization(this);
+        } catch (RollbackException e) {
+            throw new RuntimeException(jtaLogger.i18NLogger.get_transaction_arjunacore_syncwhenaborted());
+        } catch (SystemException e) {
+            throw new RuntimeException(jtaLogger.i18NLogger.get_transaction_arjunacore_nullparam());
+        }
+    }
+
+    public void registerBean(Contextual<T> contextual, CreationalContext<T> creationalContext, T bean) {
+        beans.add(new TransactionScopedBean(contextual, creationalContext, bean));
+    }
+
+    @Override
+    public void beforeCompletion() {
+    }
+
+    @Override
+    public void afterCompletion(int i) {
+        for (TransactionScopedBean bean : beans)
+            bean.destroy();
+
+        context.cleanupScope(transaction);
+    }
+
+    private class TransactionScopedBean<T> {
+        Contextual<T> contextual;
+        CreationalContext<T> creationalContext;
+        T bean;
+
+        private TransactionScopedBean(Contextual<T> contextual, CreationalContext<T> creationalContext, T bean) {
+            this.contextual = contextual;
+            this.creationalContext = creationalContext;
+            this.bean = bean;
+        }
+
+        public <T> void destroy() {
+            contextual.destroy(bean, creationalContext);
+        }
+    }
+
+
+}",2013-10-25T16:28:38Z,189
"@@ -1,8 +1,11 @@
 package com.hp.mwtests.ts.jta.cdi.transactionScoped;
 
+import javax.annotation.PostConstruct;
+import javax.annotation.PreDestroy;
 import javax.inject.Named;
 import javax.transaction.TransactionScoped;
 import java.io.Serializable;
+import java.util.concurrent.atomic.AtomicInteger;
 
 /**
  * @author paul.robinson@redhat.com 01/05/2013
@@ -11,8 +14,16 @@
 @TransactionScoped
 public class TestCDITransactionScopeBean implements Serializable {
 
+    private static AtomicInteger preDestroyCnt = new AtomicInteger(0);
+
+    private boolean postConstructCalled;
+
     private int value = 0;
 
+    @PostConstruct
+    public void postConstruct() {
+        postConstructCalled = true;
+    }
     public int getValue() {
 
         return value;
@@ -22,4 +33,17 @@ public void setValue(int value) {
 
         this.value = value;
     }
+
+    public boolean isPostConstructCalled() {
+        return postConstructCalled;
+    }
+
+    public static int getPreDestroyCnt() {
+        return preDestroyCnt.get();
+    }
+
+    @PreDestroy
+    public void preDestroy() {
+        preDestroyCnt.incrementAndGet();
+    }
 }
\ No newline at end of file",2013-10-25T16:28:38Z,190
"@@ -0,0 +1,49 @@
+package com.hp.mwtests.ts.jta.cdi.transactionScoped;
+
+import javax.annotation.PostConstruct;
+import javax.annotation.PreDestroy;
+import javax.inject.Named;
+import javax.transaction.TransactionScoped;
+import java.io.Serializable;
+import java.util.concurrent.atomic.AtomicInteger;
+
+/**
+ * @author paul.robinson@redhat.com 01/05/2013
+ */
+@Named(""TestCDITransactionScopeBean2"")
+@TransactionScoped
+public class TestCDITransactionScopeBean2 implements Serializable {
+
+    private static AtomicInteger preDestroyCnt = new AtomicInteger(0);
+
+    private boolean postConstructCalled;
+
+    private int value = 0;
+
+    @PostConstruct
+    public void postConstruct() {
+        postConstructCalled = true;
+    }
+    public int getValue() {
+
+        return value;
+    }
+
+    public void setValue(int value) {
+
+        this.value = value;
+    }
+
+    public boolean isPostConstructCalled() {
+        return postConstructCalled;
+    }
+
+    public static int getPreDestroyCnt() {
+        return preDestroyCnt.get();
+    }
+
+    @PreDestroy
+    public void preDestroy() {
+        preDestroyCnt.incrementAndGet();
+    }
+}
\ No newline at end of file",2013-10-25T16:28:38Z,191
"@@ -25,10 +25,8 @@
 import junit.framework.Assert;
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
-import org.jboss.shrinkwrap.api.ArchivePaths;
 import org.jboss.shrinkwrap.api.ShrinkWrap;
 import org.jboss.shrinkwrap.api.asset.EmptyAsset;
-import org.jboss.shrinkwrap.api.asset.StringAsset;
 import org.jboss.shrinkwrap.api.spec.JavaArchive;
 import org.junit.After;
 import org.junit.Test;
@@ -40,12 +38,20 @@
 import javax.transaction.TransactionManager;
 import javax.transaction.UserTransaction;
 
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.Set;
+import java.util.TreeSet;
+import java.util.concurrent.*;
+
+import static org.junit.Assert.assertFalse;
+import static org.junit.Assert.assertTrue;
+
 /**
  * @author paul.robinson@redhat.com 01/05/2013
  */
 @RunWith(Arquillian.class)
 public class TransactionScopedTest {
-
     @Inject
     UserTransaction userTransaction;
 
@@ -54,11 +60,17 @@ public class TransactionScopedTest {
     @Inject
     TestCDITransactionScopeBean testTxAssociationChangeBean;
 
+    @Inject
+    TestCDITransactionScopeBean2 testTxAssociationChangeBean2;
+
+    private static Set<String> timestamps = new TreeSet<String>();
+
     @Deployment
     public static JavaArchive createTestArchive() {
 
         return  ShrinkWrap.create(JavaArchive.class, ""test.jar"")
                 .addClass(TestCDITransactionScopeBean.class)
+                .addClass(TestCDITransactionScopeBean2.class)
                 .addAsManifestResource(EmptyAsset.INSTANCE, ""beans.xml"");
     }
 
@@ -72,30 +84,107 @@ public void tearDown() {
         }
     }
 
+    private void addTimestamp(String message) {
+        timestamps.add(String.format(""%d - %s (%s)%n"", System.nanoTime(), Thread.currentThread().getId(), message));
+    }
+
     //Based on test case from JTA 1.2 spec
-    @Test
-    public void testTxAssociationChange() throws Exception {
+    private void testTxAssociationChange() throws Exception {
 
         transactionManager = com.arjuna.ats.jta.TransactionManager.transactionManager();
 
+        addTimestamp(""begin1"");
         userTransaction.begin(); //tx1 begun
+        assertTrue(testTxAssociationChangeBean.isPostConstructCalled());
+        assertTrue(testTxAssociationChangeBean2.isPostConstructCalled());
+
         testTxAssociationChangeBean.setValue(1);
+        testTxAssociationChangeBean2.setValue(10);
+
+        addTimestamp(""suspend"");
         Transaction transaction = transactionManager.suspend();
 
         assertContextUnavailable();
 
+        addTimestamp(""begin2"");
         userTransaction.begin(); //tx2 begun
         Assert.assertEquals(0, testTxAssociationChangeBean.getValue());
+        Assert.assertEquals(0, testTxAssociationChangeBean2.getValue());
+
         testTxAssociationChangeBean.setValue(2);
+        testTxAssociationChangeBean2.setValue(20);
+
+        addTimestamp(""commit1"");
         userTransaction.commit();
 
         assertContextUnavailable();
 
+        addTimestamp(""resume"");
         transactionManager.resume(transaction);
         Assert.assertEquals(1, testTxAssociationChangeBean.getValue());
+        Assert.assertEquals(10, testTxAssociationChangeBean2.getValue());
+
+        addTimestamp(""commit2"");
         userTransaction.commit();
 
         assertContextUnavailable();
+        addTimestamp(""finished"");
+    }
+
+    @Test
+    // run the test sequentially to ensure that state from different scopes do not interfere with each other
+    public void testTxAssociationChangeSequentially() throws Exception {
+        final int TEST_RUNS = 2;
+        final int EXPECTED_MINIMUM_DESTROY_CNT = TEST_RUNS + TestCDITransactionScopeBean.getPreDestroyCnt();
+
+        // run the test multiple times (sequentially)
+        for (int i = 0; i < TEST_RUNS; i++) {
+            try {
+                testTxAssociationChange();
+            } catch (Exception e) {
+                throw new Exception(""Sequential testTxAssociationChange failed with exception"", e);
+            }
+        }
+
+        // ensure that preDestroy was called on the bean at least TEST_RUNS times
+        assertTrue(EXPECTED_MINIMUM_DESTROY_CNT <= TestCDITransactionScopeBean.getPreDestroyCnt());
+    }
+
+    @Test
+    // run the test concurrently to ensure that state from different scopes do not interfere with each other
+    public void testTxAssociationChangeConcurrently() throws Exception {
+        final int TEST_RUNS = 5;
+        final int EXPECTED_MINIMUM_DESTROY_CNT = TEST_RUNS + TestCDITransactionScopeBean.getPreDestroyCnt();
+
+        ExecutorService executor = Executors.newFixedThreadPool(TEST_RUNS);
+        Collection<Future<Boolean>> tasks = new ArrayList<Future<Boolean>>();
+
+        timestamps.clear();
+        // run the test multiple times (concurrently)
+        for (int i = 0; i < TEST_RUNS; i++) {
+            tasks.add(executor.submit(new Callable<Boolean>() {
+                public Boolean call() throws Exception {
+                    testTxAssociationChange();
+                    return true;
+                }
+            }));
+        }
+
+        // see if each individual test run completed successfully
+        for (Future<Boolean> task : tasks) {
+            try {
+                if (!task.get())
+                    throw new Exception(""Concurrent testTxAssociationChange failed"");
+            } catch (Exception e) {
+                throw new Exception(""Concurrent testTxAssociationChange failed with exception"", e);
+            }
+        }
+
+        // ensure that preDestroy was called on the bean at least TEST_RUNS times
+        assertTrue(EXPECTED_MINIMUM_DESTROY_CNT <= TestCDITransactionScopeBean.getPreDestroyCnt());
+
+        for (String s : timestamps)
+            System.out.print(s);
     }
 
     private void assertContextUnavailable() {
@@ -107,6 +196,4 @@ private void assertContextUnavailable() {
             //Expected
         }
     }
-
-
 }
\ No newline at end of file",2013-10-25T16:28:38Z,105
"@@ -57,18 +57,9 @@ public class TransactionScopedTest {
     @Deployment
     public static JavaArchive createTestArchive() {
 
-        JavaArchive archive = ShrinkWrap.create(JavaArchive.class, ""test.jar"")
+        return  ShrinkWrap.create(JavaArchive.class, ""test.jar"")
                 .addClass(TestCDITransactionScopeBean.class)
                 .addAsManifestResource(EmptyAsset.INSTANCE, ""beans.xml"");
-
-        archive.delete(ArchivePaths.create(""META-INF/MANIFEST.MF""));
-
-        String ManifestMF = ""Manifest-Version: 1.0\n""
-                + ""Dependencies: org.jboss.jts export services\n"";
-
-        archive.setManifest(new StringAsset(ManifestMF));
-
-        return archive;
     }
 
     @After",2013-07-15T10:36:50Z,105
"@@ -30,6 +30,7 @@
 import org.jboss.shrinkwrap.api.asset.EmptyAsset;
 import org.jboss.shrinkwrap.api.asset.StringAsset;
 import org.jboss.shrinkwrap.api.spec.JavaArchive;
+import org.jboss.shrinkwrap.api.spec.WebArchive;
 import org.junit.After;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -38,6 +39,7 @@
 import javax.inject.Inject;
 import javax.transaction.Transaction;
 import javax.transaction.TransactionManager;
+import javax.transaction.Transactional;
 import javax.transaction.TransactionalException;
 import javax.transaction.UserTransaction;
 
@@ -54,20 +56,11 @@ public class TransactionalImplTest {
     TestTransactionalBean testTransactionalBean;
 
     @Deployment
-    public static JavaArchive createTestArchive() {
+    public static WebArchive createTestArchive() {
 
-        JavaArchive archive = ShrinkWrap.create(JavaArchive.class, ""test.jar"")
+        return ShrinkWrap.create(WebArchive.class, ""test.war"")
                 .addPackage(""com.hp.mwtests.ts.jta.cdi.transactional"")
-                .addAsManifestResource(EmptyAsset.INSTANCE, ""beans.xml"");
-
-        archive.delete(ArchivePaths.create(""META-INF/MANIFEST.MF""));
-
-        String ManifestMF = ""Manifest-Version: 1.0\n""
-                + ""Dependencies: org.jboss.jts export services\n"";
-
-        archive.setManifest(new StringAsset(ManifestMF));
-
-        return archive;
+                .addAsWebInfResource(EmptyAsset.INSTANCE, ""beans.xml"");
     }
 
     @After",2013-07-15T10:36:50Z,107
"@@ -20,8 +20,6 @@
  */
 package org.jboss.jbossts.star.test;
 
-import java.util.Collection;
-
 import java.io.IOException;
 import java.net.HttpURLConnection;
 
@@ -165,14 +163,4 @@ public void testCommitInvalidTx() throws IOException
         // commit it properly
         txn.commitTx();
     }
-    
-    @Test
-    public void testListTransactionsWhenNoActiveTxns() throws IOException
-    {
-        TxSupport txn = new TxSupport();
-        
-        Collection<String> transactionsInProgress = txn.getTransactions();
-        
-        Assert.assertEquals(0, transactionsInProgress.size());
-    }
 }",2012-03-15T13:49:46Z,186
"@@ -0,0 +1,29 @@
+package org.jboss.jbossts.star.test;
+
+import java.io.IOException;
+import java.util.Collection;
+import org.jboss.jbossts.star.util.TxSupport;
+import org.junit.Assert;
+import org.junit.BeforeClass;
+import org.junit.Test;
+
+public class TxSupportTest extends BaseTest {
+
+    @BeforeClass
+    public static void beforeClass() throws Exception {
+        startContainer(TXN_MGR_URL);
+    }
+
+    // This test needs to be run in isolation so that previously running/incomplete txns don't affect the results
+    // Needs to be considered before adding new tests here
+    @Test
+    public void testListTransactionsWhenNoActiveTxns() throws IOException {
+        TxSupport txn = new TxSupport();
+
+        // This should be a collection of size 0.
+        Collection<String> transactionsInProgress = txn.getTransactions();
+
+        Assert.assertEquals(0, transactionsInProgress.size());
+    }
+
+}",2012-03-15T13:49:46Z,187
"@@ -140,7 +140,7 @@ private void findParticipants(List<UidWrapper> recuids, RecordList list, Partici
                     } else {
                         if (tsLogger.logger.isTraceEnabled())
                             tsLogger.logger.trace(""participant record is not a LogRecordWrapper"");
-                        lw = createParticipant(rec, listType);
+                        lw = createParticipant(rec, listType, recuids.get(i));
                     }
                 } else {
                     lw = createParticipant(rec, listType);
@@ -163,6 +163,9 @@ protected LogRecordWrapper createParticipant(AbstractRecord rec, ParticipantStat
         return new LogRecordWrapper(this, rec, listType);
     }
 
+    protected LogRecordWrapper createParticipant(AbstractRecord rec, ParticipantStatus listType, UidWrapper wrapper) {
+        return new LogRecordWrapper(this, rec, listType, wrapper);
+    }
     /**
      * See if there is participant Bean corresponding to the given record
      * @param rec the record for the target participant",2012-07-09T13:29:01Z,192
"@@ -17,6 +17,11 @@ public LogRecordWrapper(Uid uid) {
 		objName = ""type=unitialised,puid="" + uid.fileStringForm();
 	}
 
+	public LogRecordWrapper(ActionBean parent, AbstractRecord rec, ParticipantStatus listType, UidWrapper wrapper) {
+		super(wrapper);
+		init(parent,  rec, listType);
+	}
+
 	public LogRecordWrapper(ActionBean parent, AbstractRecord rec, ParticipantStatus listType) {
 		init(parent,  rec, listType);
 	}",2012-07-09T13:29:01Z,193
"@@ -2,7 +2,9 @@
 
 import com.arjuna.ats.arjuna.common.Uid;
 import com.arjuna.ats.arjuna.coordinator.AbstractRecord;
+import com.arjuna.ats.arjuna.exceptions.ObjectStoreException;
 import com.arjuna.ats.arjuna.logging.tsLogger;
+import com.arjuna.ats.arjuna.objectstore.StoreManager;
 import com.arjuna.ats.arjuna.tools.osb.util.JMXServer;
 
 /**
@@ -71,4 +73,30 @@ public Uid getUid() {
 	public StringBuilder toString(String prefix, StringBuilder sb) {
 		return sb.append(prefix).append('\t').append(getId()).append('\n');
 	}
+
+	/**
+	 * Remove this record from the ObjectStore
+	 * @return a textual indication of whether the remove operation succeeded
+	 */
+	public String remove() {
+		try {
+			if (StoreManager.getRecoveryStore().remove_committed(getUid(), w.getType())) {
+				w.probe();
+
+				return ""Record successfully removed"";
+			}
+
+			if (tsLogger.logger.isDebugEnabled())
+				tsLogger.logger.debug(""Remove committed failed for uid "" + getUid());
+
+			return ""Remove committed failed for uid "" + getUid();
+		} catch (ObjectStoreException e) {
+			if (tsLogger.logger.isDebugEnabled())
+				tsLogger.logger.debug(""Remove committed failed for uid "" + getUid()
+				    + "" - "" + e.getMessage());
+
+			return ""Remove committed failed for uid "" + getUid()
+			    + "" - "" + e.getMessage();
+		}
+	}
 }",2012-07-09T13:29:01Z,194
"@@ -1,9 +1,13 @@
 package com.arjuna.ats.arjuna.tools.osb.mbean;
 
 import com.arjuna.ats.arjuna.tools.osb.annotation.MXBeanDescription;
+import com.arjuna.ats.arjuna.tools.osb.annotation.MXBeanPropertyDescription;
 
 @MXBeanDescription("""")
 public interface OSEntryBeanMBean extends ObjStoreItemMBean {
 	String getType();
 	String getId();
+
+	@MXBeanPropertyDescription(""Tell the Transaction Manager to remove this record"")
+	String remove();
 }",2012-07-09T13:29:01Z,195
"@@ -38,6 +38,7 @@ public class ObjStoreBrowser implements ObjStoreBrowserMBean {
     private Map<String, String> stateTypes = null; // defines which object store types will be instrumented
     private Map<String, String> beanTypes = null;  // defines which bean types are used to represent object store types
     private Map<String, List<UidWrapper>> allUids;
+    private boolean exposeAllLogs = false;
 
     /**
      * Initialise the MBean
@@ -208,7 +209,7 @@ public void probe() {
                                 allUids.put(tname, uids);
                             }
 
-                            if (beanTypes.containsKey(tname))
+                            if (exposeAllLogs || beanTypes.containsKey(tname))
                                 updateMBeans(uids, System.currentTimeMillis(), true, tname);
                         }
                     } catch (IOException e1) {
@@ -249,6 +250,10 @@ public void viewSubordinateAtomicActions(boolean enable) {
         }
     }
 
+    public void setExposeAllRecordsAsMBeans(boolean exposeAllLogs) {
+        this.exposeAllLogs = exposeAllLogs;
+    }
+
     /**
      * Register new MBeans of the requested type (or unregister ones whose
      * corresponding ObjectStore entry has been removed)
@@ -268,6 +273,13 @@ public List<UidWrapper> probe(String type, String beantype) {
         return uids;
     }
 
+    private String getBeanType(String type) {
+        if (beanTypes.containsKey(type))
+            return beanTypes.get(type);
+
+        return OSEntryBean.class.getName();
+    }
+
     private void updateMBeans(List<UidWrapper> uids, long tstamp, boolean register, String type) {
         ObjectStoreIterator iter = new ObjectStoreIterator(StoreManager.getRecoveryStore(), type);
 
@@ -277,7 +289,7 @@ private void updateMBeans(List<UidWrapper> uids, long tstamp, boolean register,
                 break;
 
 
-            UidWrapper w = new UidWrapper(this, beanTypes.get(type), type, stateTypes.get(type), u);
+            UidWrapper w = new UidWrapper(this, getBeanType(type), type, stateTypes.get(type), u);
             int i = uids.indexOf(w);
 
             if (i == -1) {",2012-07-09T13:29:01Z,45
"@@ -7,7 +7,16 @@
 public interface ObjStoreBrowserMBean extends ObjStoreItemMBean {
 	@MXBeanPropertyDescription(""See if any new transactions have been created or completed"")
 	void probe();
-	@MXBeanPropertyDescription(""Enable/disable viewing of Subordinate Atomic Actions (afterwards use the probe operation to rescan the store):""
-            + "" WARNING THIS OPERATION WILL TRIGGER A RECOVERY ATTEMPT (recovery is normally performed by the Recovery Manager). Use the text \""true\"" to enable"")
+
+	@MXBeanPropertyDescription(""Enable/disable viewing of Subordinate Atomic Actions (afterwards""
+	    + "" use the probe operation to rescan the store):""
+	    + "" WARNING THIS OPERATION WILL TRIGGER A RECOVERY ATTEMPT (recovery is normally performed""
+	    + "" by the Recovery Manager). Use the text \""true\"" to enable"")
 	void viewSubordinateAtomicActions(boolean enable);
+
+	@MXBeanPropertyDescription(""By default only a subset of transaction logs are exposed as MBeans,""
+	    + "" this operation changes this default.""
+	    + ""Use the text \""true\"" to expose all logs as MBeans. You must invoke the probe method for the""
+	    + "" change to take effect"")
+	void setExposeAllRecordsAsMBeans(boolean exposeAllLogs);
 }",2012-07-09T13:29:01Z,196
"@@ -0,0 +1,142 @@
+package com.hp.mwtests.ts.arjuna.tools;
+
+import static org.junit.Assert.assertFalse;
+import static org.junit.Assert.assertTrue;
+import org.junit.Test;
+
+import com.arjuna.ats.arjuna.objectstore.RecoveryStore;
+import com.arjuna.ats.arjuna.objectstore.StoreManager;
+import com.arjuna.ats.arjuna.state.InputObjectState;
+import com.arjuna.ats.arjuna.tools.osb.mbean.ObjStoreBrowser;
+import com.arjuna.ats.arjuna.tools.osb.util.JMXServer;
+import com.arjuna.ats.internal.arjuna.common.UidHelper;
+
+import com.arjuna.ats.arjuna.common.Uid;
+import com.arjuna.ats.arjuna.state.OutputObjectState;
+
+import javax.management.AttributeNotFoundException;
+import javax.management.MBeanServer;
+import javax.management.ObjectName;
+import java.util.HashMap;
+import java.util.HashSet;
+import java.util.Map;
+import java.util.Set;
+
+/**
+ * Test that the tooling can exposed all log record types
+ */
+public class ExposeAllLogsTest {
+    private static final String FOO_TYPE = ""/StateManager/LockManager/foo"";
+    private static final String osMBeanName = ""jboss.jta:type=ObjectStore"";
+
+    @Test
+    public void test() throws Exception
+    {
+        RecoveryStore store = StoreManager.getRecoveryStore();
+        ObjStoreBrowser osb = new ObjStoreBrowser();
+        Set<Uid> uids;
+        Map<Uid, ObjectName> uids2 = new HashMap<Uid, ObjectName>();
+        JMXServer agent = JMXServer.getAgent();
+
+        // create a record that by default the tooling does not expose
+        byte[] data = new byte[10240];
+        OutputObjectState state = new OutputObjectState();
+        Uid u = new Uid();
+
+        state.packBytes(data);
+        assertTrue(store.write_committed(u, FOO_TYPE, state));
+
+        // make sure the object store tooling MBean is ready
+        osb.start();
+
+        // check that the record is not exposed
+        osb.probe();
+        // get uids via the object store API
+        uids = getUids(store, new HashSet<Uid>(), FOO_TYPE);
+        // and validate that there is a uid corresponding to u
+        assertTrue(uids.contains(u));
+
+        // get uids via JMX
+        getUids(uids2, agent.queryNames(osMBeanName + "",*"", null));
+
+        // and validate that there is no MBean corresponding to u
+        assertFalse(uids2.containsKey(u));
+
+        // now tell the browser to expose all log records
+        osb.setExposeAllRecordsAsMBeans(true);
+        osb.probe();
+
+        // and get the uids for log record MBeans
+        uids2.clear();
+        getUids(uids2, agent.queryNames(osMBeanName + "",*"", null));
+
+        // and validate that there is now an MBean corresponding to u
+        assertTrue(uids2.containsKey(u));
+
+        // test that the MBean remove operation works
+        agent.getServer().invoke(uids2.get(u), ""remove"", null, null);
+
+        // check that both the log record and the MBean were removed
+        uids.clear();
+        getUids(store, uids, FOO_TYPE);
+        assertFalse(uids.contains(u));
+
+        uids2.clear();
+        getUids(uids2, agent.queryNames(osMBeanName + "",*"", null));
+        assertFalse(uids2.containsKey(u));
+    }
+
+    // Given a set of MBean names find their corresponding Uids
+    private Map<Uid, ObjectName> getUids(Map<Uid, ObjectName> uids, Set<ObjectName> osEntries) {
+        MBeanServer mbs = JMXServer.getAgent().getServer();
+
+        for (ObjectName name : osEntries) {
+            Object id = getProperty(mbs, name, ""Id"");
+
+            if (id != null)
+                uids.put(new Uid(id.toString()), name);
+        }
+
+        return uids;
+    }
+
+    // look up an MBean property
+    private static Object getProperty(MBeanServer mbs, ObjectName name, String id) {
+        try {
+            return mbs.getAttribute(name, id);
+        } catch (AttributeNotFoundException e) {
+            // ok
+        } catch (Exception e) {
+            System.out.println(""Exception looking up attribute "" + id + "" for object name "" + name);
+            e.printStackTrace();
+        }
+
+        return null;
+    }
+
+    // lookup all log records of a given type
+    private Set<Uid> getUids(RecoveryStore recoveryStore, Set<Uid> uids, String type) {
+        try {
+            InputObjectState states = new InputObjectState();
+
+            if (recoveryStore.allObjUids(type, states) && states.notempty()) {
+                boolean finished = false;
+
+                do {
+                    Uid uid = UidHelper.unpackFrom(states);
+
+                    if (uid.notEquals(Uid.nullUid())) {
+                        uids.add(uid);
+                    } else {
+                        finished = true;
+                    }
+
+                } while (!finished);
+            }
+        } catch (Exception e) {
+            e.printStackTrace();
+        }
+
+        return uids;
+    }
+}",2012-07-09T13:29:01Z,197
"@@ -30,7 +30,6 @@ fi
 mvn $CLEAN install || fail
 kill-jboss
 $JBOSS_BUILD_HOME/build.sh $CLEAN install -f $JBOSS_BUILD_HOME/xts/pom.xml -DskipTests || fail
-$JBOSS_BUILD_HOME/build.sh $CLEAN install -f $JBOSS_BUILD_HOME/txf/pom.xml -DskipTests || fail
 $JBOSS_BUILD_HOME/build.sh $CLEAN install -f $JBOSS_BUILD_HOME/build/pom.xml -DskipTests || fail
 
 JBOSS_BUILD_NAME=$(ls $JBOSS_BUILD_HOME/build/target/ | grep jboss-as)",2013-02-21T12:08:31Z,198
"@@ -64,7 +64,7 @@ public static WebArchive createTestArchive() {
         archive.delete(ArchivePaths.create(""META-INF/MANIFEST.MF""));
 
         String ManifestMF = ""Manifest-Version: 1.0\n""
-                + ""Dependencies: org.jboss.resteasy.resteasy-jaxrs,javax.ws.rs.api,javax.ejb.api,org.jboss.jts,org.jboss.narayana.txframework\n"";
+                + ""Dependencies: org.jboss.resteasy.resteasy-jaxrs,javax.ws.rs.api,javax.ejb.api,org.jboss.jts,org.jboss.xts\n"";
         archive.setManifest(new StringAsset(ManifestMF));
 
         return archive;",2013-02-21T12:08:31Z,199
"@@ -72,7 +72,7 @@ public static WebArchive createTestArchive() {
         archive.delete(ArchivePaths.create(""META-INF/MANIFEST.MF""));
 
         String ManifestMF = ""Manifest-Version: 1.0\n""
-                + ""Dependencies: org.jboss.resteasy.resteasy-jaxrs,javax.ws.rs.api,javax.ejb.api,org.jboss.jts,org.jboss.narayana.txframework\n"";
+                + ""Dependencies: org.jboss.resteasy.resteasy-jaxrs,javax.ws.rs.api,javax.ejb.api,org.jboss.jts,org.jboss.xts\n"";
         archive.setManifest(new StringAsset(ManifestMF));
 
         return archive;",2013-02-21T12:08:31Z,200
"@@ -59,7 +59,7 @@ public static JavaArchive createTestArchive() {
         archive.delete(ArchivePaths.create(""META-INF/MANIFEST.MF""));
 
         String ManifestMF = ""Manifest-Version: 1.0\n""
-                + ""Dependencies: org.jboss.narayana.txframework\n"";
+                + ""Dependencies: org.jboss.xts\n"";
 
         archive.setManifest(new StringAsset(ManifestMF));
 ",2013-02-21T12:08:31Z,201
"@@ -67,7 +67,7 @@ public static WebArchive createTestArchive() {
         archive.delete(ArchivePaths.create(""META-INF/MANIFEST.MF""));
 
         String ManifestMF = ""Manifest-Version: 1.0\n""
-                + ""Dependencies: org.jboss.narayana.txframework\n"";
+                + ""Dependencies: org.jboss.xts\n"";
         archive.setManifest(new StringAsset(ManifestMF));
 
         return archive;",2013-02-21T12:08:31Z,202
"@@ -60,7 +60,7 @@ public static JavaArchive createTestArchive() {
         archive.delete(ArchivePaths.create(""META-INF/MANIFEST.MF""));
 
         String ManifestMF = ""Manifest-Version: 1.0\n""
-                + ""Dependencies: org.jboss.narayana.txframework\n"";
+                + ""Dependencies: org.jboss.xts\n"";
 
 
         archive.setManifest(new StringAsset(ManifestMF));",2013-02-21T12:08:31Z,115
"@@ -69,7 +69,7 @@ public static JavaArchive createTestArchive() {
         archive.delete(ArchivePaths.create(""META-INF/MANIFEST.MF""));
 
         String ManifestMF = ""Manifest-Version: 1.0\n""
-                + ""Dependencies: org.jboss.narayana.txframework\n"";
+                + ""Dependencies: org.jboss.xts\n"";
 
 
         archive.setManifest(new StringAsset(ManifestMF));",2013-02-21T12:08:31Z,116
"@@ -65,7 +65,7 @@ public static JavaArchive createTestArchive() {
         archive.delete(ArchivePaths.create(""META-INF/MANIFEST.MF""));
 
         String ManifestMF = ""Manifest-Version: 1.0\n""
-                + ""Dependencies: org.jboss.narayana.txframework\n"";
+                + ""Dependencies: org.jboss.xts\n"";
 
         archive.setManifest(new StringAsset(ManifestMF));
 ",2013-02-21T12:08:31Z,117
"@@ -0,0 +1,90 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+package org.jboss.jbossts.txbridge.inbound;
+
+import com.arjuna.mw.wst.TxContext;
+import com.arjuna.mw.wst11.TransactionManagerFactory;
+import com.arjuna.wst.SystemException;
+import org.jboss.jbossts.txbridge.utils.txbridgeLogger;
+
+import javax.xml.ws.handler.Handler;
+import javax.xml.ws.handler.MessageContext;
+
+/**
+ * @author <a href=""mailto:gytis@redhat.com"">Gytis Trikleris</a>
+ */
+public class OptionalJaxWSTxInboundBridgeHandler implements Handler {
+
+    final JaxWSTxInboundBridgeHandler delegate;
+
+    public OptionalJaxWSTxInboundBridgeHandler() {
+        delegate = new JaxWSTxInboundBridgeHandler();
+    }
+
+    @Override
+    public boolean handleMessage(final MessageContext messageContext) {
+        if (txbridgeLogger.logger.isTraceEnabled()) {
+            txbridgeLogger.logger.trace(""OptionalJaxWSTxInboundBridgeHandler.handleMessage()"");
+        }
+
+        if (isTransactionAvailable()) {
+            return delegate.handleMessage(messageContext);
+        }
+
+        return true;
+    }
+
+    @Override
+    public boolean handleFault(final MessageContext messageContext) {
+        if (txbridgeLogger.logger.isTraceEnabled()) {
+            txbridgeLogger.logger.trace(""OptionalJaxWSTxInboundBridgeHandler.handleFault()"");
+        }
+
+        if (isTransactionAvailable()) {
+            return delegate.handleFault(messageContext);
+        }
+
+        return true;
+    }
+
+    @Override
+    public void close(final MessageContext messageContext) {
+        if (txbridgeLogger.logger.isTraceEnabled()) {
+            txbridgeLogger.logger.trace(""OptionalJaxWSTxInboundBridgeHandler.close()"");
+        }
+
+        if (isTransactionAvailable()) {
+            delegate.close(messageContext);
+        }
+    }
+
+    private boolean isTransactionAvailable() {
+        TxContext txContext = null;
+
+        try {
+            txContext = TransactionManagerFactory.transactionManager().currentTransaction();
+        } catch (SystemException e) {
+        }
+
+        return txContext != null;
+    }
+}",2013-10-10T10:05:55Z,163
"@@ -174,7 +174,10 @@ public org.omg.CosTransactions.Vote prepare () throws HeuristicMixed, HeuristicH
 
 	ServerTransaction theTransaction = (ServerTransaction) _theControl.getImplHandle();
 
-	ThreadActionData.pushAction(theTransaction); // LockManager needs to know if there is a transaction
+	// the locking scheme used by LockManager depends upon whether or not there is a
+	// transaction associated (note that this change is already on the master branch
+	// where it was introduced by JBTM-1350)
+//	ThreadActionData.pushAction(theTransaction); // LockManager needs to know if there is a transaction
 
 	int result = TwoPhaseOutcome.PREPARE_NOTOK;
 ",2013-06-28T15:02:01Z,203
"@@ -49,6 +49,8 @@ public class TestGroupBase
     private int clientCount = 0;
     private int taskCount = 0;
 
+    private static final boolean usingExecutionWrapper = System.getProperty(""additional.elements"", """").contains(ExecutionWrapper.class.getCanonicalName());
+
     @Before public void setUp()
 	{
         clientCount = 0;
@@ -200,4 +202,8 @@ protected void removeServerIORStore(String name, String... params) {
         FileServerIORStore store = new FileServerIORStore();
         store.remove();
     }
+
+    protected boolean isUsingExecutionWrapper() {
+        return usingExecutionWrapper;
+    }
 }",2013-06-28T15:02:01Z,204
"@@ -35,20 +35,20 @@ public String getTestGroupName()
 
 	@Before public void setUp()
 	{
-		super.setUp();
+		/*
+		 * Always run the hornetq store in process since that store is loaded only once
+		 * on startup (ie subsequent additions to the store by external processes will
+		 * never be loaded).
+		 */
+		isRecoveryManagerNeeded = !isUsingExecutionWrapper();
 		Task setup0 = createTask(""setup0"", org.jboss.jbossts.qa.CrashRecovery12Setups.Setup01.class, Task.TaskType.EXPECT_PASS_FAIL, 240);
 		setup0.perform(""CR12_01.log"");
-		server0 = createTask(""server0"", com.arjuna.ats.arjuna.recovery.RecoveryManager.class, Task.TaskType.EXPECT_READY, 240);
-		server0.start(""-test"");
+		super.setUp();
 	}
 
 	@After public void tearDown()
 	{
-		try {
-			server0.terminate();
-		} finally {
-			super.tearDown();
-		}
+		super.tearDown();
 	}
 
 	@Test public void CrashRecovery12_Test01()
@@ -73,12 +73,11 @@ public String getTestGroupName()
 	@Test public void CrashRecovery12_Test03()
 	{
 		setTestName(""Test03"");
-		Task client0 = createTask(""client0"", org.jboss.jbossts.qa.CrashRecovery12Clients.Client01.class, Task.TaskType.EXPECT_PASS_FAIL, 240);
+		Task client0 = createTask(""client0"", org.jboss.jbossts.qa.CrashRecovery12Clients.Client01.class, Task.TaskType.EXPECT_PASS_FAIL, 240, ""store"");
 		client0.start(""commit"", ""CR12_03.log"");
-		Task outcome0 = createTask(""outcome0"", org.jboss.jbossts.qa.CrashRecovery12Outcomes.Outcome01.class, Task.TaskType.EXPECT_PASS_FAIL, 240);
+		Task outcome0 = createTask(""outcome0"", org.jboss.jbossts.qa.CrashRecovery12Outcomes.Outcome01.class, Task.TaskType.EXPECT_PASS_FAIL, 240, ""store"");
 		outcome0.start(""CR12_03.log"", ""yes"");
 		outcome0.waitFor();
-        client0.waitFor();
 	}
 
 	@Test public void CrashRecovery12_Test04()
@@ -89,7 +88,7 @@ public String getTestGroupName()
 		Task outcome0 = createTask(""outcome0"", org.jboss.jbossts.qa.CrashRecovery12Outcomes.Outcome01.class, Task.TaskType.EXPECT_PASS_FAIL, 240);
 		outcome0.start(""CR12_04.log"", ""no"");
 		outcome0.waitFor();
-        client0.waitFor();
+		client0.waitFor();
 	}
 
 	@Test public void CrashRecovery12_Test05()
@@ -106,10 +105,10 @@ public String getTestGroupName()
 	@Test public void CrashRecovery12_Test06()
 	{
 		setTestName(""Test06"");
-		Task client0 = createTask(""client0"", org.jboss.jbossts.qa.CrashRecovery12Clients.Client01.class, Task.TaskType.EXPECT_PASS_FAIL, 240);
+		Task client0 = createTask(""client0"", org.jboss.jbossts.qa.CrashRecovery12Clients.Client01.class, Task.TaskType.EXPECT_PASS_FAIL, 240, ""store"");
 		client0.start(""commit"", ""CR12_06.log"");
 		client0.waitFor();
-		Task outcome0 = createTask(""outcome0"", org.jboss.jbossts.qa.CrashRecovery12Outcomes.Outcome01.class, Task.TaskType.EXPECT_PASS_FAIL, 240);
+		Task outcome0 = createTask(""outcome0"", org.jboss.jbossts.qa.CrashRecovery12Outcomes.Outcome01.class, Task.TaskType.EXPECT_PASS_FAIL, 240, ""store"");
 		outcome0.start(""CR12_06.log"", ""yes"");
 		outcome0.waitFor();
 	}
@@ -124,4 +123,4 @@ public String getTestGroupName()
 		outcome0.start(""CR12_07.log"", ""no"");
 		outcome0.waitFor();
 	}
-}
\ No newline at end of file
+}",2013-06-28T15:02:01Z,205
"@@ -2,16 +2,16 @@
 
 import org.jboss.narayana.rest.integration.api.Participant;
 
-import com.arjuna.ats.arjuna.common.Uid;
-
 /**
  *
  * @author <a href=""mailto:gytis@redhat.com"">Gytis Trikleris</a>
  *
  */
 public final class ParticipantInformation {
 
-    private final Uid id;
+    private final String id;
+
+    private final String applicationId;
 
     private final String recoveryURL;
 
@@ -21,12 +21,13 @@ public final class ParticipantInformation {
 
     private String status;
 
-    public ParticipantInformation(final Uid id, final String recoveryURL, final String baseUrl, final Participant participant) {
-        this(id, recoveryURL, baseUrl, participant, null);
+    public ParticipantInformation(final String id, final String applicationId, final String recoveryURL, final String baseUrl, final Participant participant) {
+        this(id, applicationId, recoveryURL, baseUrl, participant, null);
     }
 
-    public ParticipantInformation(final Uid id, final String recoveryURL, final String baseUrl, final Participant participant, final String status) {
+    public ParticipantInformation(final String id, final String applicationId, final String recoveryURL, final String baseUrl, final Participant participant, final String status) {
         this.id = id;
+        this.applicationId = applicationId;
         this.recoveryURL = recoveryURL;
         this.baseUrl = baseUrl;
         this.participant = participant;
@@ -41,10 +42,14 @@ public void setStatus(final String status) {
         this.status = status;
     }
 
-    public Uid getId() {
+    public String getId() {
         return id;
     }
 
+    public String getApplicationId() {
+        return applicationId;
+    }
+
     public String getRecoveryURL() {
         return recoveryURL;
     }",2013-05-28T09:15:31Z,206
"@@ -25,8 +25,6 @@
 import org.jboss.narayana.rest.integration.api.Vote;
 import org.jboss.resteasy.client.ClientRequest;
 
-import com.arjuna.ats.arjuna.common.Uid;
-
 /**
  *
  * @author <a href=""mailto:gytis@redhat.com"">Gytis Trikleris</a>
@@ -40,7 +38,7 @@ public final class ParticipantResource {
     private static final Logger LOG = Logger.getLogger(ParticipantResource.class);
 
     @HEAD
-    public Response getTerminatorUrl(@PathParam(""participantId"") final Uid participantId, @Context final UriInfo uriInfo) {
+    public Response getTerminatorUrl(@PathParam(""participantId"") final String participantId, @Context final UriInfo uriInfo) {
         if (LOG.isTraceEnabled()) {
             LOG.trace(""HEAD request on ParticipantResource. ParticipantId: "" + participantId);
         }
@@ -61,13 +59,13 @@ public Response getTerminatorUrl(@PathParam(""participantId"") final Uid participa
 
     @GET
     @Produces(TxMediaType.TX_STATUS_MEDIA_TYPE)
-    public Response getStatus(@PathParam(""participantId"") final Uid participantId) {
+    public Response getStatus(@PathParam(""participantId"") final String participantId) {
         if (LOG.isTraceEnabled()) {
             LOG.trace(""GET request on ParticipantResource. ParticipantId: "" + participantId);
         }
 
-        final ParticipantInformation participantInformation = ParticipantsContainer.getInstance().getParticipantInformation(
-                participantId);
+        final ParticipantInformation participantInformation = ParticipantsContainer.getInstance()
+                .getParticipantInformation(participantId);
 
         if (participantInformation == null) {
             if (LOG.isTraceEnabled()) {
@@ -83,13 +81,15 @@ public Response getStatus(@PathParam(""participantId"") final Uid participantId) {
     @PUT
     @Consumes(TxMediaType.TX_STATUS_MEDIA_TYPE)
     @Produces(TxMediaType.TX_STATUS_MEDIA_TYPE)
-    public Response terminate(@PathParam(""participantId"") final Uid participantId, final String content) throws HeuristicException {
+    public Response terminate(@PathParam(""participantId"") final String participantId, final String content)
+            throws HeuristicException {
+
         if (LOG.isTraceEnabled()) {
             LOG.trace(""PUT request on ParticipantResource. ParticipantId: "" + participantId + "", content: "" + content);
         }
 
-        final ParticipantInformation participantInformation = ParticipantsContainer.getInstance().getParticipantInformation(
-                participantId);
+        final ParticipantInformation participantInformation = ParticipantsContainer.getInstance()
+                .getParticipantInformation(participantId);
 
         if (participantInformation == null) {
             if (LOG.isTraceEnabled()) {
@@ -134,13 +134,13 @@ public Response terminate(@PathParam(""participantId"") final Uid participantId, f
     }
 
     @DELETE
-    public Response forgetHeuristic(@PathParam(""participantId"") final Uid participantId) {
+    public Response forgetHeuristic(@PathParam(""participantId"") final String participantId) {
         if (LOG.isTraceEnabled()) {
             LOG.trace(""DELETE request on ParticipantResource. ParticipantId: "" + participantId);
         }
 
-        final ParticipantInformation participantInformation = ParticipantsContainer.getInstance().getParticipantInformation(
-                participantId);
+        final ParticipantInformation participantInformation = ParticipantsContainer.getInstance()
+                .getParticipantInformation(participantId);
 
         if (participantInformation == null) {
             if (LOG.isTraceEnabled()) {
@@ -155,6 +155,7 @@ public Response forgetHeuristic(@PathParam(""participantId"") final Uid participan
                 || TxStatus.TransactionHeuristicHazard.name().equals(participantInformation.getStatus())
                 || TxStatus.TransactionHeuristicMixed.name().equals(participantInformation.getStatus())) {
 
+            RecoveryManager.getInstance().removeParticipantInformation(participantInformation);
             ParticipantsContainer.getInstance().removeParticipantInformation(participantInformation.getId());
 
             return Response.ok().build();
@@ -176,6 +177,7 @@ private Vote prepare(final ParticipantInformation participantInformation) throws
             rollback(participantInformation);
         } else if (vote instanceof Prepared) {
             participantInformation.setStatus(TxStatus.TransactionPrepared.name());
+            RecoveryManager.getInstance().persistParticipantInformation(participantInformation);
         } else if (vote instanceof ReadOnly) {
             readOnly(participantInformation);
         }
@@ -187,6 +189,7 @@ private Vote prepareHeuristic(final ParticipantInformation participantInformatio
         if (TxStatus.TransactionHeuristicCommit.name().equals(participantInformation.getStatus())) {
             return new Prepared();
         } else {
+            RecoveryManager.getInstance().removeParticipantInformation(participantInformation);
             return new Aborted();
         }
     }
@@ -202,11 +205,13 @@ private void commit(final ParticipantInformation participantInformation) throws
             } catch (HeuristicException e) {
                 if (!e.getHeuristicType().equals(HeuristicType.HEURISTIC_COMMIT)) {
                     participantInformation.setStatus(e.getHeuristicType().toTxStatus());
+                    RecoveryManager.getInstance().persistParticipantInformation(participantInformation);
                     throw new HeuristicException(e.getHeuristicType());
                 }
             }
 
             participantInformation.setStatus(TxStatus.TransactionCommitted.name());
+            RecoveryManager.getInstance().removeParticipantInformation(participantInformation);
             ParticipantsContainer.getInstance().removeParticipantInformation(participantInformation.getId());
         }
     }
@@ -216,6 +221,7 @@ private void commitHeuristic(final ParticipantInformation participantInformation
             throw new HeuristicException(HeuristicType.fromTxStatus(participantInformation.getStatus()));
         } else {
             participantInformation.setStatus(TxStatus.TransactionCommitted.name());
+            RecoveryManager.getInstance().removeParticipantInformation(participantInformation);
             ParticipantsContainer.getInstance().removeParticipantInformation(participantInformation.getId());
         }
     }
@@ -240,11 +246,13 @@ private void rollback(final ParticipantInformation participantInformation) throw
             } catch (HeuristicException e) {
                 if (!e.getHeuristicType().equals(HeuristicType.HEURISTIC_ROLLBACK)) {
                     participantInformation.setStatus(e.getHeuristicType().toTxStatus());
+                    RecoveryManager.getInstance().persistParticipantInformation(participantInformation);
                     throw new HeuristicException(e.getHeuristicType());
                 }
             }
 
             participantInformation.setStatus(TxStatus.TransactionRolledBack.name());
+            RecoveryManager.getInstance().removeParticipantInformation(participantInformation);
             ParticipantsContainer.getInstance().removeParticipantInformation(participantInformation.getId());
         }
     }
@@ -254,6 +262,7 @@ private void rollbackHeuristic(final ParticipantInformation participantInformati
             throw new HeuristicException(HeuristicType.fromTxStatus(participantInformation.getStatus()));
         } else {
             participantInformation.setStatus(TxStatus.TransactionRolledBack.name());
+            RecoveryManager.getInstance().removeParticipantInformation(participantInformation);
             ParticipantsContainer.getInstance().removeParticipantInformation(participantInformation.getId());
         }
     }
@@ -264,7 +273,7 @@ private void readOnly(final ParticipantInformation participantInformation) {
         try {
             new ClientRequest(participantInformation.getRecoveryURL()).delete();
         } catch (Exception e) {
-            // TODO log
+            LOG.warn(e.getMessage(), e);
         }
 
         ParticipantsContainer.getInstance().removeParticipantInformation(participantInformation.getId());",2013-05-28T09:15:31Z,207
"@@ -3,8 +3,6 @@
 import java.util.Map;
 import java.util.concurrent.ConcurrentHashMap;
 
-import com.arjuna.ats.arjuna.common.Uid;
-
 /**
  *
  * @author <a href=""mailto:gytis@redhat.com"">Gytis Trikleris</a>
@@ -14,25 +12,25 @@ public final class ParticipantsContainer {
 
     private static final ParticipantsContainer INSTANCE = new ParticipantsContainer();
 
-    private final Map<Uid, ParticipantInformation> participantsInformation;
+    private final Map<String, ParticipantInformation> participantsInformation;
 
     public static ParticipantsContainer getInstance() {
         return INSTANCE;
     }
 
     private ParticipantsContainer() {
-        participantsInformation = new ConcurrentHashMap<Uid, ParticipantInformation>();
+        participantsInformation = new ConcurrentHashMap<String, ParticipantInformation>();
     }
 
-    public ParticipantInformation getParticipantInformation(final Uid participantId) {
+    public ParticipantInformation getParticipantInformation(final String participantId) {
         return participantsInformation.get(participantId);
     }
 
-    public void addParticipantInformation(final Uid participantId, final ParticipantInformation participantInformation) {
+    public void addParticipantInformation(final String participantId, final ParticipantInformation participantInformation) {
         participantsInformation.put(participantId, participantInformation);
     }
 
-    public void removeParticipantInformation(final Uid participantId) {
+    public void removeParticipantInformation(final String participantId) {
         participantsInformation.remove(participantId);
     }
 ",2013-05-28T09:15:31Z,208
"@@ -2,6 +2,7 @@
 
 import org.jboss.jbossts.star.util.TxStatus;
 import org.jboss.jbossts.star.util.TxSupport;
+import org.jboss.narayana.rest.integration.api.ParticipantDeserializer;
 import org.jboss.narayana.rest.integration.api.HeuristicType;
 import org.jboss.narayana.rest.integration.api.Participant;
 import org.jboss.narayana.rest.integration.api.ParticipantsManager;
@@ -15,7 +16,7 @@
  */
 public final class ParticipantsManagerImpl implements ParticipantsManager {
 
-    public String baseUrl;
+    private String baseUrl;
 
     @Override
     public String getBaseUrl() {
@@ -28,23 +29,18 @@ public void setBaseUrl(final String baseUrl) {
     }
 
     @Override
-    public Uid enlist(final TxSupport txSupport, final Participant participant) {
-        return enlist(txSupport.getDurableParticipantEnlistmentURI(), participant);
-    }
-
-    @Override
-    public Uid enlist(final String participantEnlistmentURL, final Participant participant) {
+    public String enlist(final String applicationId, final String participantEnlistmentURL, final Participant participant) {
         if (baseUrl == null) {
             throw new IllegalStateException(""Base URL was not defined."");
         }
 
-        final Uid participantId = new Uid();
+        final String participantId = new Uid().toString();
         final String participantUrl = getParticipantUrl(participantId, baseUrl);
 
         String participantRecoveryURL = enlistParticipant(participantUrl, participantEnlistmentURL);
 
-        ParticipantInformation participantInformation = new ParticipantInformation(participantId, participantRecoveryURL,
-                baseUrl, participant);
+        ParticipantInformation participantInformation = new ParticipantInformation(participantId, applicationId,
+                participantRecoveryURL, baseUrl, participant);
         participantInformation.setStatus(TxStatus.TransactionActive.name());
 
         ParticipantsContainer.getInstance().addParticipantInformation(participantId, participantInformation);
@@ -53,32 +49,39 @@ public Uid enlist(final String participantEnlistmentURL, final Participant parti
     }
 
     @Override
-    public void reportHeuristic(Uid participantId, HeuristicType heuristicType) {
-        final ParticipantInformation participantInformation = ParticipantsContainer.getInstance().getParticipantInformation(
-                participantId);
-
-            switch (heuristicType) {
-                case HEURISTIC_ROLLBACK:
-                    participantInformation.setStatus(TxStatus.TransactionHeuristicRollback.name());
-                    break;
-
-                case HEURISTIC_COMMIT:
-                    participantInformation.setStatus(TxStatus.TransactionHeuristicCommit.name());
-                    break;
-
-                case HEURISTIC_HAZARD:
-                    participantInformation.setStatus(TxStatus.TransactionHeuristicHazard.name());
-                    break;
-
-                case HEURISTIC_MIXED:
-                    participantInformation.setStatus(TxStatus.TransactionHeuristicMixed.name());
-                    break;
-
-                default:
-                    throw new IllegalArgumentException(""Unknown heuristic type"");
-            }
+    public void registerDeserializer(final String applicationId, final ParticipantDeserializer deserializer) {
+        RecoveryManager.getInstance().registerDeserializer(applicationId, deserializer);
+    }
+
+    @Override
+    public void reportHeuristic(String participantId, HeuristicType heuristicType) {
+        final ParticipantInformation participantInformation = ParticipantsContainer.getInstance()
+                .getParticipantInformation(participantId);
+
+        switch (heuristicType) {
+            case HEURISTIC_ROLLBACK:
+                participantInformation.setStatus(TxStatus.TransactionHeuristicRollback.name());
+                break;
+
+            case HEURISTIC_COMMIT:
+                participantInformation.setStatus(TxStatus.TransactionHeuristicCommit.name());
+                break;
+
+            case HEURISTIC_HAZARD:
+                participantInformation.setStatus(TxStatus.TransactionHeuristicHazard.name());
+                break;
+
+            case HEURISTIC_MIXED:
+                participantInformation.setStatus(TxStatus.TransactionHeuristicMixed.name());
+                break;
+
+            default:
+                throw new IllegalArgumentException(""Unknown heuristic type"");
         }
 
+        RecoveryManager.getInstance().persistParticipantInformation(participantInformation);
+    }
+
     private String enlistParticipant(final String participantUrl, final String participantEnlistmentURL) {
         TxSupport txSupport = new TxSupport();
         String participantLinkHeader = txSupport.makeTwoPhaseAwareParticipantLinkHeader(participantUrl, participantUrl);
@@ -87,7 +90,7 @@ private String enlistParticipant(final String participantUrl, final String parti
         return recoveryUrl;
     }
 
-    private String getParticipantUrl(final Uid participantId, String baseUrl) {
+    private String getParticipantUrl(final String participantId, String baseUrl) {
         if (!baseUrl.substring(baseUrl.length() - 1).equals(""/"")) {
             baseUrl += ""/"";
         }",2013-05-28T09:15:31Z,209
"@@ -0,0 +1,230 @@
+package org.jboss.narayana.rest.integration;
+
+import com.arjuna.ats.arjuna.common.Uid;
+import com.arjuna.ats.arjuna.exceptions.ObjectStoreException;
+import com.arjuna.ats.arjuna.objectstore.RecoveryStore;
+import com.arjuna.ats.arjuna.objectstore.StoreManager;
+import com.arjuna.ats.arjuna.state.InputObjectState;
+import com.arjuna.ats.arjuna.state.OutputObjectState;
+import com.arjuna.ats.internal.arjuna.common.UidHelper;
+import org.jboss.jbossts.star.util.TxLinkNames;
+import org.jboss.logging.Logger;
+import org.jboss.narayana.rest.integration.api.Participant;
+import org.jboss.narayana.rest.integration.api.ParticipantDeserializer;
+import org.jboss.narayana.rest.integration.api.ParticipantsManagerFactory;
+import org.jboss.narayana.rest.integration.api.PersistableParticipant;
+import org.jboss.resteasy.client.ClientRequest;
+import org.jboss.resteasy.spi.Link;
+
+import java.io.ByteArrayInputStream;
+import java.io.ByteArrayOutputStream;
+import java.io.IOException;
+import java.io.ObjectInputStream;
+import java.io.ObjectOutputStream;
+import java.io.Serializable;
+import java.util.Map;
+import java.util.concurrent.ConcurrentHashMap;
+
+/**
+ * @author <a href=""mailto:gytis@redhat.com"">Gytis Trikleris</a>
+ */
+public final class RecoveryManager {
+
+    private static final String PARTICIPANT_INFORMATION_RECORD_TYPE = ""/REST-AT/Integration/ParticipantInformationRecoveryRecord"";
+
+    private static final Logger LOG = Logger.getLogger(RecoveryManager.class);
+
+    private static final RecoveryManager INSTANCE = new RecoveryManager();
+
+    private final Map<String, ParticipantDeserializer> deserializers = new ConcurrentHashMap<String, ParticipantDeserializer>();
+
+    private RecoveryManager() {
+    }
+
+    public static RecoveryManager getInstance() {
+        return INSTANCE;
+    }
+
+    public void registerDeserializer(final String applicationId, final ParticipantDeserializer deserializer) {
+        if (!deserializers.containsKey(applicationId)) {
+            deserializers.put(applicationId, deserializer);
+            recoverParticipants();
+        }
+    }
+
+    public void persistParticipantInformation(final ParticipantInformation participantInformation) {
+        if (!isRecoverableParticipant(participantInformation.getParticipant())) {
+            return;
+        }
+
+        try {
+            final RecoveryStore recoveryStore = StoreManager.getRecoveryStore();
+            final OutputObjectState state = getParticipantInformationOutputState(participantInformation);
+            final Uid uid = new Uid(participantInformation.getId());
+
+            recoveryStore.write_committed(uid, PARTICIPANT_INFORMATION_RECORD_TYPE, state);
+        } catch (Exception e) {
+            LOG.warn(""Failure while persisting participant information."", e);
+        }
+    }
+
+    public void removeParticipantInformation(final ParticipantInformation participantInformation) {
+        final RecoveryStore recoveryStore = StoreManager.getRecoveryStore();
+        final Uid uid = new Uid(participantInformation.getId());
+
+        try {
+            recoveryStore.remove_committed(uid, PARTICIPANT_INFORMATION_RECORD_TYPE);
+        } catch (ObjectStoreException e) {
+            LOG.warn(""Failure while removing participant information from the object store."", e);
+        }
+    }
+
+    private OutputObjectState getParticipantInformationOutputState(final ParticipantInformation participantInformation)
+            throws IOException {
+
+        final Uid uid = new Uid(participantInformation.getId());
+        final OutputObjectState state = new OutputObjectState(uid, PARTICIPANT_INFORMATION_RECORD_TYPE);
+
+        state.packString(participantInformation.getId());
+        state.packString(participantInformation.getApplicationId());
+        state.packString(participantInformation.getStatus());
+        state.packString(participantInformation.getBaseUrl());
+        state.packString(participantInformation.getRecoveryURL());
+        state.packBytes(getParticipantBytes(participantInformation.getParticipant()));
+
+        return state;
+    }
+
+    private byte[] getParticipantBytes(final Participant participant) throws IOException {
+        if (participant instanceof Serializable) {
+            return serializeParticipant(participant);
+        } else if (participant instanceof PersistableParticipant) {
+            return ((PersistableParticipant) participant).getRecoveryState();
+        }
+
+        // Shouldn't happen
+        return new byte[] {};
+    }
+
+    private byte[] serializeParticipant(final Participant participant) throws IOException {
+        final ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
+        final ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream);
+        objectOutputStream.writeObject(participant);
+
+        return byteArrayOutputStream.toByteArray();
+    }
+
+    private boolean isRecoverableParticipant(final Participant participant) {
+        return (participant instanceof Serializable) || (participant instanceof PersistableParticipant);
+    }
+
+    private void recoverParticipants() {
+        if (ParticipantsManagerFactory.getInstance().getBaseUrl() != null) {
+            final RecoveryStore recoveryStore = StoreManager.getRecoveryStore();
+            final InputObjectState states = new InputObjectState();
+
+            try {
+                if (recoveryStore.allObjUids(PARTICIPANT_INFORMATION_RECORD_TYPE, states)) {
+                    Uid uid;
+
+                    while ((uid = UidHelper.unpackFrom(states)).notEquals(Uid.nullUid())) {
+                        final ParticipantInformation participantInformation = recreateParticipantInformation(
+                                recoveryStore, uid);
+
+                        if (participantInformation != null) {
+                            ParticipantsContainer.getInstance().addParticipantInformation(
+                                    participantInformation.getId(), participantInformation);
+                        }
+                    }
+                }
+            } catch (ObjectStoreException e) {
+                LOG.warn(e.getMessage(), e);
+            } catch (IOException e) {
+                LOG.warn(e.getMessage(), e);
+            }
+        } else {
+            LOG.warn(""Participants cannot be loaded from the object store, because base URL was not set."");
+        }
+    }
+
+    private ParticipantInformation recreateParticipantInformation(final RecoveryStore recoveryStore, final Uid uid)
+            throws ObjectStoreException, IOException {
+
+        final InputObjectState inputObjectState = recoveryStore.read_committed(uid, PARTICIPANT_INFORMATION_RECORD_TYPE);
+        final String id = inputObjectState.unpackString();
+
+        if (ParticipantsContainer.getInstance().getParticipantInformation(id) != null) {
+            // Participant is already loaded.
+            return null;
+        }
+
+        final String applicationId = inputObjectState.unpackString();
+
+        if (!deserializers.containsKey(applicationId)) {
+            // There is no appropriate deserializer.
+            return null;
+        }
+
+        final String status = inputObjectState.unpackString();
+        final String baseUrl = inputObjectState.unpackString();
+        final String recoveryUrl = inputObjectState.unpackString();
+        final Participant participant = recreateParticipant(inputObjectState, applicationId);
+
+        if (participant == null) {
+            // Deserializer failed to recreate participant.
+            return null;
+        }
+
+        ParticipantInformation participantInformation = new ParticipantInformation(id, applicationId, recoveryUrl,
+                baseUrl, participant, status);
+
+        if (!ParticipantsManagerFactory.getInstance().getBaseUrl().equals(baseUrl)) {
+            notifyCoordinatorAboutNewUrl(participantInformation);
+            participantInformation = new ParticipantInformation(id, applicationId, recoveryUrl,
+                    ParticipantsManagerFactory.getInstance().getBaseUrl(), participant, status);
+        }
+
+        return participantInformation;
+    }
+
+    private Participant recreateParticipant(final InputObjectState inputObjectState, final String applicationId)
+            throws IOException {
+
+        final ParticipantDeserializer deserializer = deserializers.get(applicationId);
+        final byte[] participantBytes = inputObjectState.unpackBytes();
+
+        Participant participant = deserializer.recreate(participantBytes);
+
+        if (participant == null) {
+            final ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(participantBytes);
+            final ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream);
+
+            participant = deserializer.deserialize(objectInputStream);
+        }
+
+        return participant;
+    }
+
+    private void notifyCoordinatorAboutNewUrl(final ParticipantInformation participantInformation) {
+        final String participantUrl = getParticipantUrl(participantInformation.getId(), participantInformation.getBaseUrl());
+        final Link participantLink = new Link(TxLinkNames.PARTICIPANT_RESOURCE, TxLinkNames.PARTICIPANT_RESOURCE,
+                participantUrl, null, null);
+        final Link terminatorLink = new Link(TxLinkNames.PARTICIPANT_TERMINATOR, TxLinkNames.PARTICIPANT_TERMINATOR,
+                participantUrl, null, null);
+
+        try {
+            new ClientRequest(participantInformation.getRecoveryURL()).addLink(participantLink).addLink(terminatorLink).put();
+        } catch (Exception e) {
+            LOG.warn(e.getMessage(), e);
+        }
+    }
+
+    private String getParticipantUrl(final String participantId, String baseUrl) {
+        if (!baseUrl.substring(baseUrl.length() - 1).equals(""/"")) {
+            baseUrl += ""/"";
+        }
+
+        return baseUrl + ParticipantResource.BASE_PATH_SEGMENT + ""/"" + participantId;
+    }
+
+}",2013-05-28T09:15:31Z,210
"@@ -1,13 +1,11 @@
 package org.jboss.narayana.rest.integration.api;
 
-import java.io.Serializable;
-
 /**
  *
  * @author <a href=""mailto:gytis@redhat.com"">Gytis Trikleris</a>
  *
  */
-public interface Participant extends Serializable {
+public interface Participant {
 
     Vote prepare();
 ",2013-05-28T09:15:31Z,211
"@@ -0,0 +1,30 @@
+package org.jboss.narayana.rest.integration.api;
+
+import java.io.ObjectInputStream;
+
+
+/**
+ *
+ * @author <a href=""mailto:gytis@redhat.com"">Gytis Trikleris</a>
+ *
+ */
+public interface ParticipantDeserializer {
+
+    /**
+     * Deserializes serializable participants.
+     *
+     *
+     * @param objectInputStream
+     * @return Participant instance if participant can be deserialized or null if not.
+     */
+    Participant deserialize(ObjectInputStream objectInputStream);
+
+    /**
+     * Recreates participant from byte array.
+     *
+     * @param recoveryState
+     * @return Participant instance if participant can be recreated or null if not.
+     */
+    Participant recreate(byte[] recoveryState);
+
+}",2013-05-28T09:15:31Z,212
"@@ -1,24 +1,52 @@
 package org.jboss.narayana.rest.integration.api;
 
-import org.jboss.jbossts.star.util.TxSupport;
-
-import com.arjuna.ats.arjuna.common.Uid;
-
 /**
  *
  * @author <a href=""mailto:gytis@redhat.com"">Gytis Trikleris</a>
  *
  */
 public interface ParticipantsManager {
 
+    /**
+     * Returns the URL of the deployment which contains the ParticipantsManager.
+     *
+     * @return
+     */
     String getBaseUrl();
 
+    /**
+     * Set the URL of the deployment which contains the ParticipantsManager.
+     *
+     * NOTE: not needed if application is deployed to the WildFly and uses RTS subsystem.
+     *
+     * @param baseUrl
+     */
     void setBaseUrl(String baseUrl);
 
-    Uid enlist(String participantEnlistmentURL, Participant participant);
-
-    Uid enlist(TxSupport txSupport, Participant participant);
-
-    void reportHeuristic(Uid participantId, HeuristicType heuristicType);
+    /**
+     * Enlist participant to REST-AT transaction.
+     *
+     * @param applicationId Application ID unique in the container scope.
+     * @param participantEnlistmentURL Participant enlistment URL returned by the transaction manager after creating REST-AT transaction.
+     * @param participant Participant to be enlisted.
+     * @return Participant ID which can be later used to report heuristic decision.
+     */
+    String enlist(String applicationId, String participantEnlistmentURL, Participant participant);
+
+    /**
+     * Register ParticipantDeserializer instance which can be used during recovery to recreate participant instances.
+     *
+     * @param applicationId Application ID unique in the container scope.
+     * @param deserializer Instance of ParticipantDeserializer.
+     */
+    void registerDeserializer(String applicationId, ParticipantDeserializer deserializer);
+
+    /**
+     * Report heuristic decision.
+     *
+     * @param participantId Participant ID received after enlisting participant to the transaction.
+     * @param heuristicType Type of the heuristic.
+     */
+    void reportHeuristic(String participantId, HeuristicType heuristicType);
 
 }",2013-05-28T09:15:31Z,213
"@@ -0,0 +1,13 @@
+package org.jboss.narayana.rest.integration.api;
+
+/**
+ * Participants implementing this interface can write their state to the byte array which is later written to the object
+ * store for recovery.
+ *
+ * @author <a href=""mailto:gytis@redhat.com"">Gytis Trikleris</a>
+ */
+public interface PersistableParticipant {
+
+    byte[] getRecoveryState();
+
+}",2013-05-28T09:15:31Z,214
"@@ -1,5 +1,6 @@
 package org.jboss.narayana.rest.integration.test.common;
 
+import java.io.Serializable;
 import java.util.ArrayList;
 import java.util.List;
 
@@ -11,7 +12,7 @@
  * @author <a href=""mailto:gytis@redhat.com"">Gytis Trikleris</a>
  *
  */
-public final class LoggingParticipant implements Participant {
+public final class LoggingParticipant implements Participant, Serializable {
 
     private static final long serialVersionUID = 7584938841973602732L;
 
@@ -49,4 +50,8 @@ public List<String> getInvocations() {
         return invocations;
     }
 
+    public Vote getOutcome() {
+        return outcome;
+    }
+
 }",2013-05-28T09:15:31Z,215
"@@ -0,0 +1,36 @@
+package org.jboss.narayana.rest.integration.test.common;
+
+import org.jboss.narayana.rest.integration.api.Participant;
+import org.jboss.narayana.rest.integration.api.ParticipantDeserializer;
+
+import java.io.ObjectInputStream;
+
+/**
+ * @author <a href=""mailto:gytis@redhat.com"">Gytis Trikleris</a>
+ */
+public class TestParticipantDeserializer implements ParticipantDeserializer {
+
+    @Override
+    public Participant deserialize(ObjectInputStream objectInputStream) {
+        Object object = null;
+
+        try {
+            object = objectInputStream.readObject();
+        } catch (Exception e) {
+            e.printStackTrace();
+            return null;
+        }
+
+        if (object instanceof Participant) {
+            return (Participant) object;
+        }
+
+        return null;
+    }
+
+    @Override
+    public Participant recreate(byte[] recoveryState) {
+        return null;
+    }
+
+}",2013-05-28T09:15:31Z,216
"@@ -0,0 +1,71 @@
+package org.jboss.narayana.rest.integration.test.common;
+
+import javax.ws.rs.GET;
+import javax.ws.rs.POST;
+import javax.ws.rs.PUT;
+import javax.ws.rs.Path;
+import javax.ws.rs.QueryParam;
+import javax.ws.rs.core.Context;
+import javax.ws.rs.core.Response;
+import javax.ws.rs.core.UriInfo;
+
+import org.codehaus.jettison.json.JSONArray;
+import org.jboss.narayana.rest.integration.ParticipantInformation;
+import org.jboss.narayana.rest.integration.ParticipantsContainer;
+import org.jboss.narayana.rest.integration.api.Aborted;
+import org.jboss.narayana.rest.integration.api.ParticipantsManagerFactory;
+import org.jboss.narayana.rest.integration.api.Prepared;
+import org.jboss.narayana.rest.integration.api.ReadOnly;
+import org.jboss.narayana.rest.integration.api.Vote;
+
+/**
+ *
+ * @author <a href=""mailto:gytis@redhat.com"">Gytis Trikleris</a>
+ *
+ */
+@Path(""/"" + TransactionalService.PATH_SEGMENT)
+public final class TransactionalService {
+
+    public static final String APPLICATION_ID = ""org.jboss.narayana.rest.integration.test.common.TransactionalService"";
+
+    public static final String PATH_SEGMENT = ""transactional-service"";
+
+    @GET
+    public Response getParticipantInvocations(@QueryParam(""participantId"") final String participantId) {
+        ParticipantInformation information = ParticipantsContainer.getInstance().getParticipantInformation(participantId);
+
+        if (information == null) {
+            return Response.status(404).build();
+        }
+
+        final JSONArray jsonArray = new JSONArray(((LoggingParticipant)information.getParticipant()).getInvocations());
+
+        return Response.ok().entity(jsonArray.toString()).build();
+    }
+
+    @POST
+    public String enlistParticipant(@QueryParam(""participantEnlistmentUrl"") final String participantEnlistmentUrl,
+                                    @QueryParam(""vote"") final String stringVote, @Context final UriInfo uriInfo) {
+
+        final Vote vote = stringVoteToVote(stringVote);
+        final LoggingParticipant participant = new LoggingParticipant(vote);
+
+        return ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, participantEnlistmentUrl, participant).toString();
+    }
+
+    @PUT
+    public void registerDeserializer() {
+        ParticipantsManagerFactory.getInstance().registerDeserializer(APPLICATION_ID, new TestParticipantDeserializer());
+    }
+
+    private Vote stringVoteToVote(final String stringVote) {
+        if (Prepared.class.getName().equals(stringVote)) {
+            return new Prepared();
+        } else if (ReadOnly.class.getName().equals(stringVote)) {
+            return new ReadOnly();
+        }
+
+        return new Aborted();
+    }
+
+}
\ No newline at end of file",2013-05-28T09:15:31Z,217
"@@ -13,6 +13,7 @@
 import org.jboss.narayana.rest.integration.ParticipantResource;
 import org.jboss.narayana.rest.integration.ParticipantsContainer;
 import org.jboss.narayana.rest.integration.api.Aborted;
+import org.jboss.narayana.rest.integration.api.HeuristicType;
 import org.jboss.narayana.rest.integration.api.Participant;
 import org.jboss.narayana.rest.integration.api.Prepared;
 import org.jboss.narayana.rest.integration.api.ReadOnly;
@@ -39,13 +40,20 @@
  */
 public final class ParticipantResourceTestCase {
 
+    private static final String APPLICATION_ID = ""org.jboss.narayana.rest.integration.test.functional.ParticipantResourceTestCase"";
+
     private static final String BASE_URL = ""http://localhost:"" + TestPortProvider.getPort();
 
     private static final String PARTICIPANT_URL = BASE_URL + ""/"" + ParticipantResource.BASE_PATH_SEGMENT;
 
     private static NettyJaxrsServer NETTY;
 
-    private Uid participantId;
+    private String participantId;
+
+    @Test
+    public void simpleTest() {
+        System.out.println(HeuristicType.valueOf(""HEURISTIC_ROLLBACK""));
+    }
 
     @BeforeClass
     public static void beforeClass() {
@@ -68,7 +76,7 @@ public static void afterClass() {
 
     @Before
     public void before() {
-        participantId = new Uid();
+        participantId = new Uid().toString();
         ParticipantsContainer.getInstance().clear();
     }
 
@@ -305,43 +313,46 @@ public void testForgetHeuristicWithoutHeuristic() throws Exception {
         Assert.assertEquals(TxStatus.TransactionActive.name(), participantInformation.getStatus());
     }
 
-    private void registerParticipant(final Uid participantId, final Participant participant) throws MalformedURLException {
-        ParticipantInformation participantInformation = new ParticipantInformation(participantId, """", BASE_URL, participant);
+    private void registerParticipant(final String participantId, final Participant participant)
+            throws MalformedURLException {
+
+        ParticipantInformation participantInformation = new ParticipantInformation(participantId, APPLICATION_ID, """",
+                BASE_URL, participant);
         participantInformation.setStatus(TxStatus.TransactionActive.name());
         ParticipantsContainer.getInstance().addParticipantInformation(participantId, participantInformation);
     }
 
     @SuppressWarnings(""rawtypes"")
-    private ClientResponse getParticipantTerminator(final Uid participantId) throws Exception {
+    private ClientResponse getParticipantTerminator(final String participantId) throws Exception {
         return new ClientRequest(PARTICIPANT_URL + ""/"" + participantId).head();
     }
 
-    private ClientResponse<String> getParticipantStatus(final Uid participantId) throws Exception {
+    private ClientResponse<String> getParticipantStatus(final String participantId) throws Exception {
         return new ClientRequest(PARTICIPANT_URL + ""/"" + participantId).get(String.class);
     }
 
-    private ClientResponse<String> prepareParticipant(final Uid participantId) throws Exception {
+    private ClientResponse<String> prepareParticipant(final String participantId) throws Exception {
         return new ClientRequest(PARTICIPANT_URL + ""/"" + participantId).body(TxMediaType.TX_STATUS_MEDIA_TYPE,
                 TxSupport.toStatusContent(TxStatus.TransactionPrepared.name())).put(String.class);
     }
 
-    private ClientResponse<String> commitParticipant(final Uid participantId) throws Exception {
+    private ClientResponse<String> commitParticipant(final String participantId) throws Exception {
         return new ClientRequest(PARTICIPANT_URL + ""/"" + participantId).body(TxMediaType.TX_STATUS_MEDIA_TYPE,
                 TxSupport.toStatusContent(TxStatus.TransactionCommitted.name())).put(String.class);
     }
 
-    private ClientResponse<String> commitParticipantInOnePhase(final Uid participantId) throws Exception {
+    private ClientResponse<String> commitParticipantInOnePhase(final String participantId) throws Exception {
         return new ClientRequest(PARTICIPANT_URL + ""/"" + participantId).body(TxMediaType.TX_STATUS_MEDIA_TYPE,
                 TxSupport.toStatusContent(TxStatus.TransactionCommittedOnePhase.name())).put(String.class);
     }
 
-    private ClientResponse<String> rollbackParticipant(final Uid participantId) throws Exception {
+    private ClientResponse<String> rollbackParticipant(final String participantId) throws Exception {
         return new ClientRequest(PARTICIPANT_URL + ""/"" + participantId).body(TxMediaType.TX_STATUS_MEDIA_TYPE,
                 TxSupport.toStatusContent(TxStatus.TransactionRolledBack.name())).put(String.class);
     }
 
     @SuppressWarnings(""rawtypes"")
-    private ClientResponse forgetParticipantHeuristic(final Uid participantId) throws Exception {
+    private ClientResponse forgetParticipantHeuristic(final String participantId) throws Exception {
         return new ClientRequest(PARTICIPANT_URL + ""/"" + participantId).delete();
     }
 ",2013-05-28T09:15:31Z,218
"@@ -20,6 +20,8 @@
 
 public final class ParticipantsManagerTestCase {
 
+    private static final String APPLICATION_ID = ""org.jboss.narayana.rest.integration.test.functional.ParticipantResourceTestCase"";
+
     private ParticipantsManager participantsManager;
 
     @Before
@@ -43,7 +45,7 @@ public void testSetBaseUrl() {
 
     @Test
     public void testReportHeuristic() throws MalformedURLException {
-        final Uid participantId = new Uid();
+        final String participantId = new Uid().toString();
         registerParticipant(participantId, new LoggingParticipant(new Prepared()));
         final ParticipantInformation participantInformation = ParticipantsContainer.getInstance().getParticipantInformation(participantId);
         participantInformation.setStatus(TxStatus.TransactionPrepared.name());
@@ -53,8 +55,8 @@ public void testReportHeuristic() throws MalformedURLException {
         Assert.assertEquals(TxStatus.TransactionHeuristicRollback.name(), participantInformation.getStatus());
     }
 
-    private void registerParticipant(final Uid participantId, final Participant participant) throws MalformedURLException {
-        ParticipantInformation participantInformation = new ParticipantInformation(participantId, """", """", participant);
+    private void registerParticipant(final String participantId, final Participant participant) throws MalformedURLException {
+        ParticipantInformation participantInformation = new ParticipantInformation(participantId, APPLICATION_ID, """", """", participant);
         participantInformation.setStatus(TxStatus.TransactionActive.name());
         ParticipantsContainer.getInstance().addParticipantInformation(participantId, participantInformation);
     }",2013-05-28T09:15:31Z,219
"@@ -0,0 +1,69 @@
+package org.jboss.narayana.rest.integration.test.functional;
+
+import com.arjuna.ats.arjuna.common.Uid;
+import junit.framework.Assert;
+import org.jboss.jbossts.star.util.TxStatus;
+import org.jboss.narayana.rest.integration.ParticipantInformation;
+import org.jboss.narayana.rest.integration.ParticipantsContainer;
+import org.jboss.narayana.rest.integration.RecoveryManager;
+import org.jboss.narayana.rest.integration.api.ParticipantsManagerFactory;
+import org.jboss.narayana.rest.integration.api.Prepared;
+import org.jboss.narayana.rest.integration.test.common.LoggingParticipant;
+import org.jboss.narayana.rest.integration.test.common.TestParticipantDeserializer;
+import org.junit.Test;
+
+/**
+ * @author <a href=""mailto:gytis@redhat.com"">Gytis Trikleris</a>
+ */
+public class RecoveryManagerTestCase {
+
+    private static final String APPLICATION_ID = ""org.jboss.narayana.rest.integration.test.functional.RecoveryManagerTestCase"";
+
+    @Test
+    public void testRecoveryWithExistingDeserializer() {
+        final String participantId = new Uid().toString();
+        final LoggingParticipant loggingParticipantBefore = new LoggingParticipant(new Prepared());
+        loggingParticipantBefore.commit();
+
+        final ParticipantInformation participantInformationBefore = new ParticipantInformation(participantId, APPLICATION_ID,
+                """", """", loggingParticipantBefore, TxStatus.TransactionCommitted.name());
+
+        ParticipantsContainer.getInstance().clear();
+        ParticipantsManagerFactory.getInstance().setBaseUrl("""");
+        RecoveryManager.getInstance().persistParticipantInformation(participantInformationBefore);
+        RecoveryManager.getInstance().registerDeserializer(APPLICATION_ID, new TestParticipantDeserializer());
+
+        final ParticipantInformation participantInformationAfter = ParticipantsContainer.getInstance()
+                .getParticipantInformation(participantId);
+        Assert.assertEquals(participantInformationBefore.getApplicationId(), participantInformationAfter.getApplicationId());
+        Assert.assertEquals(participantInformationBefore.getBaseUrl(), participantInformationAfter.getBaseUrl());
+        Assert.assertEquals(participantInformationBefore.getStatus(), participantInformationAfter.getStatus());
+        Assert.assertEquals(participantInformationBefore.getRecoveryURL(), participantInformationAfter.getRecoveryURL());
+        Assert.assertEquals(participantInformationBefore.getId(), participantInformationAfter.getId());
+
+        final LoggingParticipant loggingParticipantAfter = (LoggingParticipant) participantInformationAfter.getParticipant();
+        Assert.assertEquals(loggingParticipantBefore.getInvocations(), loggingParticipantAfter.getInvocations());
+        Assert.assertTrue(loggingParticipantAfter.getOutcome() instanceof Prepared);
+
+    }
+
+    @Test
+    public void testRecoveryWithoutDeserializer() {
+        final String participantId = new Uid().toString();
+        final LoggingParticipant loggingParticipantBefore = new LoggingParticipant(new Prepared());
+        loggingParticipantBefore.commit();
+
+        final ParticipantInformation participantInformationBefore = new ParticipantInformation(participantId, APPLICATION_ID + ""1"",
+                """", """", loggingParticipantBefore, TxStatus.TransactionCommitted.name());
+
+        ParticipantsContainer.getInstance().clear();
+        ParticipantsManagerFactory.getInstance().setBaseUrl("""");
+        RecoveryManager.getInstance().persistParticipantInformation(participantInformationBefore);
+        RecoveryManager.getInstance().registerDeserializer(APPLICATION_ID + ""2"", new TestParticipantDeserializer());
+
+        final ParticipantInformation participantInformationAfter = ParticipantsContainer.getInstance()
+                .getParticipantInformation(participantId);
+        Assert.assertNull(participantInformationAfter);
+    }
+
+}",2013-05-28T09:15:31Z,220
"@@ -28,8 +28,6 @@
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
-import com.arjuna.ats.arjuna.common.Uid;
-
 /**
  *
  * TODO implement test for heuristics after prepare.
@@ -40,6 +38,8 @@
 @RunWith(Arquillian.class)
 public final class BasicIntegrationTestCase extends AbstractIntegrationTestCase {
 
+    private static final String APPLICATION_ID = ""org.jboss.narayana.rest.integration.test.integration.BasicIntegrationTestCase"";
+
     private static final String DEPENDENCIES = ""Dependencies: org.jboss.narayana.rts\n"";
 
     @Deployment(name = DEPLOYMENT_NAME, managed = false, testable = true)
@@ -66,8 +66,8 @@ public void testCommit() {
         LoggingParticipant participant1 = new LoggingParticipant(new Prepared());
         LoggingParticipant participant2 = new LoggingParticipant(new Prepared());
 
-        ParticipantsManagerFactory.getInstance().enlist(txSupport, participant1);
-        ParticipantsManagerFactory.getInstance().enlist(txSupport, participant2);
+        ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(), participant1);
+        ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(), participant2);
 
         txSupport.commitTx();
 
@@ -81,7 +81,8 @@ public void testCommitOnePhase() {
 
         LoggingParticipant participant = new LoggingParticipant(new Prepared());
 
-        ParticipantsManagerFactory.getInstance().enlist(txSupport, participant);
+        ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(),
+                participant);
 
         txSupport.commitTx();
 
@@ -97,7 +98,7 @@ public void testReadOnly() {
                 new LoggingParticipant(new Prepared()) });
 
         for (LoggingParticipant p : participants) {
-            ParticipantsManagerFactory.getInstance().enlist(txSupport, p);
+            ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(), p);
         }
 
         txSupport.commitTx();
@@ -122,8 +123,8 @@ public void testRollback() {
         LoggingParticipant participant1 = new LoggingParticipant(new Prepared());
         LoggingParticipant participant2 = new LoggingParticipant(new Prepared());
 
-        ParticipantsManagerFactory.getInstance().enlist(txSupport, participant1);
-        ParticipantsManagerFactory.getInstance().enlist(txSupport, participant2);
+        ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(), participant1);
+        ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(), participant2);
 
         txSupport.rollbackTx();
 
@@ -139,7 +140,7 @@ public void testRollbackByParticipant() {
                 new LoggingParticipant(new Aborted()), new LoggingParticipant(new Aborted()), });
 
         for (LoggingParticipant p : participants) {
-            ParticipantsManagerFactory.getInstance().enlist(txSupport, p);
+            ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(), p);
         }
 
         txSupport.commitTx();
@@ -163,10 +164,11 @@ public void testHeuristicRollbackBeforePrepare() throws JAXBException {
         final List<LoggingParticipant> participants = Arrays.asList(new LoggingParticipant[] {
                 new LoggingParticipant(new Prepared()), new LoggingParticipant(new Prepared()) });
 
-        Uid lastParticipantid = null;
+        String lastParticipantid = null;
 
         for (LoggingParticipant p : participants) {
-            lastParticipantid = ParticipantsManagerFactory.getInstance().enlist(txSupport, p);
+            lastParticipantid = ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID,
+                    txSupport.getDurableParticipantEnlistmentURI(), p);
         }
 
         ParticipantsManagerFactory.getInstance().reportHeuristic(lastParticipantid, HeuristicType.HEURISTIC_ROLLBACK);
@@ -189,10 +191,11 @@ public void testSecondParticipantHeuristicCommitWithFirstParticipantSuccessfullP
         final List<LoggingParticipant> participants = Arrays.asList(new LoggingParticipant[] {
                 new LoggingParticipant(new Prepared()), new LoggingParticipant(new Prepared()) });
 
-        Uid lastParticipantid = null;
+        String lastParticipantid = null;
 
         for (LoggingParticipant p : participants) {
-            lastParticipantid = ParticipantsManagerFactory.getInstance().enlist(txSupport, p);
+            lastParticipantid = ParticipantsManagerFactory.getInstance().enlist(
+                    APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(), p);
         }
 
         ParticipantsManagerFactory.getInstance().reportHeuristic(lastParticipantid, HeuristicType.HEURISTIC_COMMIT);
@@ -211,8 +214,10 @@ public void testSecondParticipantHeuristicCommitWithFirstParticipantUnsuccessful
         LoggingParticipant loggingParticipant1 = new LoggingParticipant(new Aborted());
         LoggingParticipant loggingParticipant2 = new LoggingParticipant(new Prepared());
 
-        ParticipantsManagerFactory.getInstance().enlist(txSupport, loggingParticipant1);
-        Uid lastParticipantid = ParticipantsManagerFactory.getInstance().enlist(txSupport, loggingParticipant2);
+        ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(),
+                loggingParticipant1);
+        String lastParticipantid = ParticipantsManagerFactory.getInstance().enlist(
+                APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(), loggingParticipant2);
 
         ParticipantsManagerFactory.getInstance().reportHeuristic(lastParticipantid, HeuristicType.HEURISTIC_COMMIT);
 
@@ -232,8 +237,10 @@ public void testHeuristicCommitAfterSuccessfullPrepare() {
         LoggingParticipant loggingParticipant = new LoggingParticipant(new Prepared());
         HeuristicParticipant heuristicParticipant = new HeuristicParticipant(HeuristicType.HEURISTIC_COMMIT, new Prepared());
 
-        ParticipantsManagerFactory.getInstance().enlist(txSupport, loggingParticipant);
-        ParticipantsManagerFactory.getInstance().enlist(txSupport, heuristicParticipant);
+        ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(),
+                loggingParticipant);
+        ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(),
+                heuristicParticipant);
 
         final String transactionStatus = TxSupport.getStatus(txSupport.commitTx());
 
@@ -249,8 +256,10 @@ public void testHeuristicCommitAfterUnsuccessfullPrepare() {
         LoggingParticipant loggingParticipant = new LoggingParticipant(new Aborted());
         HeuristicParticipant heuristicParticipant = new HeuristicParticipant(HeuristicType.HEURISTIC_COMMIT, new Prepared());
 
-        ParticipantsManagerFactory.getInstance().enlist(txSupport, loggingParticipant);
-        ParticipantsManagerFactory.getInstance().enlist(txSupport, heuristicParticipant);
+        ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(),
+                loggingParticipant);
+        ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(),
+                heuristicParticipant);
 
         final String transactionStatus = TxSupport.getStatus(txSupport.commitTx());
 
@@ -266,8 +275,10 @@ public void testHeuristicRollbackAfterSuccessfullPrepare() {
         LoggingParticipant loggingParticipant = new LoggingParticipant(new Prepared());
         HeuristicParticipant heuristicParticipant = new HeuristicParticipant(HeuristicType.HEURISTIC_ROLLBACK, new Prepared());
 
-        ParticipantsManagerFactory.getInstance().enlist(txSupport, loggingParticipant);
-        ParticipantsManagerFactory.getInstance().enlist(txSupport, heuristicParticipant);
+        ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(),
+                loggingParticipant);
+        ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(),
+                heuristicParticipant);
 
         final String transactionStatus = TxSupport.getStatus(txSupport.commitTx());
 
@@ -283,8 +294,10 @@ public void testHeuristicRollbackAfterUnsuccessfullPrepare() {
         LoggingParticipant loggingParticipant = new LoggingParticipant(new Aborted());
         HeuristicParticipant heuristicParticipant = new HeuristicParticipant(HeuristicType.HEURISTIC_ROLLBACK, new Prepared());
 
-        ParticipantsManagerFactory.getInstance().enlist(txSupport, loggingParticipant);
-        ParticipantsManagerFactory.getInstance().enlist(txSupport, heuristicParticipant);
+        ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(),
+                loggingParticipant);
+        ParticipantsManagerFactory.getInstance().enlist(APPLICATION_ID, txSupport.getDurableParticipantEnlistmentURI(),
+                heuristicParticipant);
 
         final String transactionStatus = TxSupport.getStatus(txSupport.commitTx());
 ",2013-05-28T09:15:31Z,221
"@@ -0,0 +1,108 @@
+package org.jboss.narayana.rest.integration.test.integration;
+
+import org.jboss.arquillian.container.test.api.Deployment;
+import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.star.provider.HttpResponseException;
+import org.jboss.jbossts.star.util.media.txstatusext.TransactionStatusElement;
+import org.jboss.narayana.rest.integration.api.Prepared;
+import org.jboss.narayana.rest.integration.api.Vote;
+import org.jboss.narayana.rest.integration.test.common.LoggingParticipant;
+import org.jboss.narayana.rest.integration.test.common.TransactionalService;
+import org.jboss.resteasy.client.ClientRequest;
+import org.jboss.resteasy.client.ClientResponse;
+import org.jboss.shrinkwrap.api.ShrinkWrap;
+import org.jboss.shrinkwrap.api.asset.StringAsset;
+import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.After;
+import org.junit.Assert;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+
+import java.io.File;
+
+/**
+ * @author <a href=""mailto:gytis@redhat.com"">Gytis Trikleris</a>
+ */
+@RunWith(Arquillian.class)
+public final class RecoveryIntegrationTestCase extends AbstractIntegrationTestCase {
+
+    private static final String DEPENDENCIES = ""Dependencies: org.jboss.narayana.rts,org.jboss.jts,org.codehaus.jettison\n"";
+
+    private static final int RECOVERY_PERIOD = 2;
+
+    private static final int RECOVERY_WAIT_CYCLES = 5;
+
+    private static final String VM_ARGUMENTS = ""-Xms64m -Xmx512m -XX:MaxPermSize=256m -Dcom.arjuna.ats.arjuna.recovery.periodicRecoveryPeriod=""
+            + RECOVERY_PERIOD;
+
+    private static final String BYTEMAN_ARGUMENTS = ""-Dorg.jboss.byteman.verbose -Djboss.modules.system.pkgs=org.jboss.byteman -Dorg.jboss.byteman.transform.all -javaagent:lib/byteman.jar=script:scripts/@BMScript@.btm,boot:lib/byteman.jar,listener:true"";
+
+    @Deployment(name = DEPLOYMENT_NAME, managed = false, testable = false)
+    public static WebArchive getDeployment() {
+        return ShrinkWrap.create(WebArchive.class, DEPLOYMENT_NAME + "".war"")
+                .addPackages(false, LoggingParticipant.class.getPackage()).addAsWebInfResource(new File(""web.xml""), ""web.xml"")
+                .addAsManifestResource(new StringAsset(DEPENDENCIES), ""MANIFEST.MF"");
+    }
+
+    @After
+    public void after() {
+        super.after();
+        stopContainer();
+    }
+
+    @Test
+    public void testCommit() throws Exception {
+        startContainer(VM_ARGUMENTS + "" "" + BYTEMAN_ARGUMENTS.replace(""@BMScript@"", ""CrashBeforeCommit""));
+
+        txSupport.startTx();
+
+        enlistParticipant(txSupport.getDurableParticipantEnlistmentURI(), new Prepared());
+        enlistParticipant(txSupport.getDurableParticipantEnlistmentURI(), new Prepared());
+
+        Assert.assertEquals(2, txSupport.getTransactionInfo().getTwoPhaseAware().size());
+
+        try {
+            // JVM is killed here.
+            txSupport.commitTx();
+        } catch (HttpResponseException e) {
+        }
+
+        restartContainer(VM_ARGUMENTS);
+        registerDeserializer();
+
+        TransactionStatusElement status;
+        int cycles = 0;
+
+        do {
+            Thread.sleep(RECOVERY_PERIOD * 2000);
+            status = null;
+            try {
+                // Updates coordinator's active transactions list
+                txSupport.getTransactions();
+                // After successful recovery transaction is removed and 404 is returned.
+                status = txSupport.getTransactionInfo().getStatus();
+            } catch (HttpResponseException e) {
+            }
+        } while (status != null && cycles++ < RECOVERY_WAIT_CYCLES);
+
+        if (status != null) {
+            Assert.fail(""Recovery failed"");
+        }
+    }
+
+    private void enlistParticipant(final String enlistmentUrl, final Vote vote) throws Exception {
+        ClientResponse<String> clientResponse = new ClientRequest(DEPLOYMENT_URL + ""/"" + TransactionalService.PATH_SEGMENT)
+                .queryParameter(""participantEnlistmentUrl"", enlistmentUrl).queryParameter(""vote"", vote.getClass().getName())
+                .post(String.class);
+
+        Assert.assertEquals(200, clientResponse.getStatus());
+    }
+
+    private void registerDeserializer() throws Exception {
+        ClientResponse<String> clientResponse = new ClientRequest(DEPLOYMENT_URL + ""/"" + TransactionalService.PATH_SEGMENT)
+                .put(String.class);
+
+        Assert.assertEquals(204, clientResponse.getStatus());
+    }
+
+}",2013-05-28T09:15:31Z,222
"@@ -38,6 +38,7 @@
   </build>
   <modules>
     <module>jta</module>
+    <module>spi</module>
     <module>cdi</module>
     <module>jdbc</module>
     <module>narayana-jta</module>",2013-09-17T09:24:53Z,223
"@@ -0,0 +1,206 @@
+<?xml version=""1.0"" encoding=""UTF-8""?>
+<!--
+  JBoss, Home of Professional Open Source.
+  Copyright 2013, Red Hat, Inc., and individual contributors
+  as indicated by the @author tags. See the copyright.txt file in the
+  distribution for a full listing of individual contributors.
+
+  This is free software; you can redistribute it and/or modify it
+  under the terms of the GNU Lesser General Public License as
+  published by the Free Software Foundation; either version 2.1 of
+  the License, or (at your option) any later version.
+
+  This software is distributed in the hope that it will be useful,
+  but WITHOUT ANY WARRANTY; without even the implied warranty of
+  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+  Lesser General Public License for more details.
+
+  You should have received a copy of the GNU Lesser General Public
+  License along with this software; if not, write to the Free
+  Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+  02110-1301 USA, or see the FSF site: http://www.fsf.org.
+-->
+<project xmlns=""http://maven.apache.org/POM/4.0.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xsi:schemaLocation=""http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"">
+    <parent>
+        <groupId>org.jboss.narayana.jta</groupId>
+        <artifactId>narayana-jta-all</artifactId>
+        <version>5.0.0.M5-SNAPSHOT</version>
+        <relativePath>../pom.xml</relativePath>
+    </parent>
+    <modelVersion>4.0.0</modelVersion>
+    <artifactId>jboss-transaction-spi-tests</artifactId>
+    <name>Narayana: Transaction 7.0.2 SPI Testing</name>
+    <description>Narayana: Transaction 7.0.2 SPI Testing</description>
+
+    <packaging>jar</packaging>
+
+    <properties>
+        <ipv6.server.jvm.args>-Djboss.bind.address=[::1] -Djboss.bind.address.management=[::1]
+            -Djboss.bind.address.unsecure=[::1] -Djava.net.preferIPv4Stack=false -Djava.net.preferIPv6Addresses=true
+        </ipv6.server.jvm.args>
+    </properties>
+
+    <build>
+        <plugins>
+            <plugin>
+                <artifactId>maven-surefire-plugin</artifactId>
+                <configuration>
+                    <skip>true</skip>
+                </configuration>
+            </plugin>
+        </plugins>
+    </build>
+    <dependencies>
+        <dependency>
+            <groupId>org.jboss</groupId>
+            <artifactId>jboss-transaction-spi</artifactId>
+            <version>${version.org.jboss.jboss-transaction-spi}</version>
+            <scope>provided</scope>
+            <exclusions>
+                <exclusion>
+                    <groupId>org.jboss.logging</groupId>
+                    <artifactId>jboss-logging-spi</artifactId>
+                </exclusion>
+            </exclusions>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.spec.javax.interceptor</groupId>
+            <artifactId>jboss-interceptors-api_1.2_spec</artifactId>
+            <version>${version.org.jboss.spec.javax.interceptor}</version>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.spec.javax.transaction</groupId>
+            <artifactId>jboss-transaction-api_1.2_spec</artifactId>
+            <version>${version.org.jboss.spec.javax.transaction}</version>
+            <scope>provided</scope>
+        </dependency>
+        <dependency>
+            <groupId>junit</groupId>
+            <artifactId>junit</artifactId>
+            <version>${version.junit}</version>
+            <scope>test</scope>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.arquillian.protocol</groupId>
+            <artifactId>arquillian-protocol-servlet</artifactId>
+            <version>${version.org.jboss.arquillian.core}</version>
+            <scope>test</scope>
+        </dependency>
+        <dependency>
+            <groupId>javax.enterprise</groupId>
+            <artifactId>cdi-api</artifactId>
+            <version>${version.javax.enterprise}</version>
+            <scope>provided</scope>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.arquillian.junit</groupId>
+            <artifactId>arquillian-junit-container</artifactId>
+            <version>${version.org.jboss.arquillian.core}</version>
+            <scope>provided</scope>
+        </dependency>
+        <dependency>
+            <groupId>javax.annotation</groupId>
+            <artifactId>javax.annotation-api</artifactId>
+            <version>${version.javax.annotation}</version>
+            <scope>provided</scope>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.spec.javax.ejb</groupId>
+            <artifactId>jboss-ejb-api_3.1_spec</artifactId>
+            <version>${version.org.jboss.spec.javax.ejb}</version>
+            <scope>provided</scope>
+        </dependency>
+    </dependencies>
+
+    <profiles>
+        <profile>
+            <id>arq</id>
+            <activation>
+                <activeByDefault>false</activeByDefault>
+            </activation>
+            <dependencies>
+                <dependency>
+                    <groupId>org.wildfly</groupId>
+                    <artifactId>wildfly-arquillian-container-managed</artifactId>
+                    <version>${jboss-as.version}</version>
+                    <scope>test</scope>
+                </dependency>
+            </dependencies>
+            <build>
+                <plugins>
+                    <plugin>
+                        <artifactId>maven-surefire-plugin</artifactId>
+                        <configuration>
+                            <skip>false</skip>
+                            <systemPropertyVariables combine.children=""append"">
+                                <!--
+                                    Used in arquillian.xml
+                                -->
+                                <server.jvm.args>${jvm.args.other} ${jvm.args.memory}</server.jvm.args>
+                                <node.address>127.0.0.1</node.address>
+                            </systemPropertyVariables>
+                            <redirectTestOutputToFile>true</redirectTestOutputToFile>
+                        </configuration>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
+        <profile>
+            <id>arqIPv6</id>
+            <activation>
+                <activeByDefault>false</activeByDefault>
+            </activation>
+            <dependencies>
+                <dependency>
+                    <groupId>org.wildfly</groupId>
+                    <artifactId>wildfly-arquillian-container-managed</artifactId>
+                    <version>${jboss-as.version}</version>
+                    <scope>test</scope>
+                </dependency>
+            </dependencies>
+            <build>
+                <plugins>
+                    <plugin>
+                        <artifactId>maven-surefire-plugin</artifactId>
+                        <configuration>
+                            <skip>false</skip>
+                            <argLine>${ipv6.server.jvm.args}</argLine>
+                            <systemPropertyVariables combine.children=""append"">
+                                <!--
+                                    Used in arquillian.xml
+                                -->
+                                <server.jvm.args>${jvm.args.other} ${jvm.args.memory} ${ipv6.server.jvm.args}</server.jvm.args>
+                                <node.address>[::1]</node.address>
+                            </systemPropertyVariables>
+                            <redirectTestOutputToFile>true</redirectTestOutputToFile>
+                        </configuration>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
+        <profile>
+            <id>arq-remote</id>
+            <activation>
+                <activeByDefault>false</activeByDefault>
+            </activation>
+            <build>
+                <plugins>
+                    <plugin>
+                        <artifactId>maven-surefire-plugin</artifactId>
+                        <configuration>
+                            <skip>false</skip>
+                        </configuration>
+                    </plugin>
+                </plugins>
+            </build>
+            <dependencies>
+                <dependency>
+                    <groupId>org.wildfly</groupId>
+                    <artifactId>wildfly-arquillian-container-remote</artifactId>
+                    <version>${jboss-as.version}</version>
+                    <scope>test</scope>
+                </dependency>
+            </dependencies>
+        </profile>
+    </profiles>
+</project>",2013-09-17T09:24:53Z,28
"@@ -0,0 +1,118 @@
+/*
+ * JBoss, Home of Professional Open Source
+ * Copyright 2013, Red Hat Inc., and individual contributors as indicated
+ * by the @authors tag. See the copyright.txt in the distribution for a
+ * full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+package org.jboss.tm;
+
+import org.jboss.arquillian.container.test.api.Deployment;
+import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.shrinkwrap.api.ShrinkWrap;
+import org.jboss.shrinkwrap.api.asset.EmptyAsset;
+import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.Assert;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+
+import javax.annotation.Resource;
+import javax.inject.Inject;
+import javax.transaction.*;
+import org.jboss.tm.TxUtils;
+
+/**
+ * Transaction SPI integration tests
+ */
+@RunWith(Arquillian.class)
+public class TestSPI {
+    @Resource(lookup = ""java:jboss/TransactionManager"")
+    private javax.transaction.TransactionManager transactionManager;
+
+    @Deployment
+    public static WebArchive createTestArchive() {
+
+        return ShrinkWrap.create(WebArchive.class, ""test.war"")
+                .addPackage(""org.jboss.tm"")
+                .addAsWebInfResource(EmptyAsset.INSTANCE, ""beans.xml"");
+    }
+
+    @Test
+    public void sanityCheck() {
+        Assert.assertTrue(Boolean.TRUE);
+    }
+
+    @Test
+    public void testTimeouts() throws Exception {
+        Transaction oldTxn = null;
+        final int SLEEP = 5;
+        final int timeout = 2;
+        final boolean[] afterCompletionViaTMTimeoutThread = {false};
+
+        try {
+            oldTxn = transactionManager.suspend();
+            transactionManager.setTransactionTimeout(timeout);
+            transactionManager.begin();
+
+            Transaction newTxn = transactionManager.getTransaction();
+
+            newTxn.registerSynchronization(new Synchronization() {
+                @Override
+                public void beforeCompletion() {
+                }
+
+                @Override
+                public void afterCompletion(int status) {
+                    System.out.printf(""afterCompletion callback. Txn Status=%d%n"", status);
+                    afterCompletionViaTMTimeoutThread[0] = TxUtils.isTransactionManagerTimeoutThread();
+                    Assert.assertTrue(""afterCompletion synchronization not called via TransactionManagerTimeoutThread"",
+                            afterCompletionViaTMTimeoutThread[0]);
+                }
+            });
+
+            Thread.sleep(SLEEP * 1000); // sleep for longer than the transaction timeout period
+            int status = transactionManager.getStatus();
+
+            Assert.assertTrue(""ERROR transaction should have timed out but its state is "" + status,
+                    status == Status.STATUS_ROLLEDBACK);
+
+            transactionManager.commit();
+
+            Assert.assertTrue(""testTimeouts synchronization was not invoked"", afterCompletionViaTMTimeoutThread[0]);
+        } catch (RollbackException e) {
+            // SUCCESS: rollback exception expected
+            // any other exception is a failure
+        } finally {
+            try {
+                if (transactionManager.getStatus() == Status.STATUS_ACTIVE)
+                    transactionManager.rollback();
+            } catch (SystemException e) {
+                System.err.printf(""testTimeouts: cleanup exception %s%n"", e.getMessage());
+            }
+            if (oldTxn != null) {
+                try {
+                    transactionManager.resume(oldTxn);
+                } catch (SystemException e) {
+                    System.err.printf(""testTimeouts: resume exception %s%n"", e.getMessage());
+                } catch (InvalidTransactionException e) {
+                    System.err.printf(""testTimeouts: resume exception %s%n"", e.getMessage());
+                }
+            }
+        }
+
+    }
+}",2013-09-17T09:24:53Z,224
"@@ -474,7 +474,7 @@
     <version.org.jboss.arquillian.core>1.0.3.Final</version.org.jboss.arquillian.core>
     <version.javax.annotation>1.2-b04</version.javax.annotation>
     <version.org.jboss.arquillian.osgi>2.0.0.CR2</version.org.jboss.arquillian.osgi>
-    <version.org.jboss.jboss-transaction-spi>7.0.1.Final</version.org.jboss.jboss-transaction-spi>
+    <version.org.jboss.jboss-transaction-spi>7.0.2.Final</version.org.jboss.jboss-transaction-spi>
 
     <!-- Maven plugin versions -->
     <version.org.eclipse.m2e.lifecycle-mapping>1.0.0</version.org.eclipse.m2e.lifecycle-mapping>",2013-09-17T09:24:53Z,39
"@@ -47,6 +47,7 @@
 
 import com.arjuna.ats.arjuna.common.Uid;
 import com.arjuna.ats.arjuna.exceptions.ObjectStoreException;
+import com.arjuna.ats.arjuna.logging.tsLogger;
 import com.arjuna.ats.arjuna.objectstore.RecoveryStore;
 import com.arjuna.ats.arjuna.objectstore.StateStatus;
 import com.arjuna.ats.arjuna.objectstore.StoreManager;
@@ -71,7 +72,6 @@
 
 public class XARecoveryModule implements RecoveryModule
 {
-
 	public XARecoveryModule()
 	{
 		this(new com.arjuna.ats.internal.jta.recovery.arjunacore.XARecoveryResourceManagerImple(),
@@ -91,6 +91,15 @@ public void addXAResourceRecoveryHelper(XAResourceRecoveryHelper xaResourceRecov
 
     public void removeXAResourceRecoveryHelper(XAResourceRecoveryHelper xaResourceRecoveryHelper) {
         synchronized (_xaResourceRecoveryHelpers) {
+			if (scanning) {
+				try {
+					// do not allow a recovery helper to be removed while the
+					// scan is in progress
+					_xaResourceRecoveryHelpers.wait();
+				} catch (InterruptedException e) {
+					tsLogger.logger.warn(""problem waiting for scanLock"", e);
+				}
+			}
             _xaResourceRecoveryHelpers.remove(xaResourceRecoveryHelper);
         }
     }
@@ -121,8 +130,12 @@ public List<SerializableXAResourceDeserializer> getSeriablizableXAResourceDeseri
 	public synchronized void periodicWorkFirstPass()
 	{
 		// JBTM-1354 allow a second thread to execute the first pass but make sure it is only done once per scan (TMSTART/ENDSCAN)
-		if (!requireFirstPass) {
-			return;
+		synchronized (_xaResourceRecoveryHelpers) {
+			if (scanning) {
+				return;
+			} else {
+				scanning = true;
+			}
 		}
         if(jtaLogger.logger.isDebugEnabled()) {
             jtaLogger.logger.debugv(""{0} - first pass"", _logName);
@@ -160,17 +173,11 @@ public synchronized void periodicWorkFirstPass()
 		List<XAResource> resources = new ArrayList<XAResource>(_resources);
 		for (XAResource xaResource : resources) {
 			try {
-				// This calls out to remote systems and may block. Consider
-				// using alternate concurrency
-				// control rather than sync on __xaResourceRecoveryHelpers
-				// to
-				// avoid blocking problems?
 				xaRecoveryFirstPass(xaResource);
 			} catch (Exception ex) {
 				jtaLogger.i18NLogger.warn_recovery_getxaresource(ex);
 			}
 		}
-		requireFirstPass = false;
 	}
 
 	public void periodicWorkSecondPass()
@@ -205,8 +212,9 @@ public void periodicWorkSecondPass()
 
 		clearAllFailures();
 
-		synchronized (this) {
-			requireFirstPass = true;
+		synchronized (_xaResourceRecoveryHelpers) {
+			scanning = false;
+			_xaResourceRecoveryHelpers.notify();
 		}
 	}
 
@@ -409,11 +417,6 @@ record = _recoveryManagerClass.getResource(theUid);
     private void bottomUpRecovery() {
 			for (XAResource xaResource : _resources) {
 				try {
-					// This calls out to remote systems and may block. Consider
-					// using alternate concurrency
-					// control rather than sync on __xaResourceRecoveryHelpers
-					// to
-					// avoid blocking problems?
 					xaRecoverySecondPass(xaResource);
 				} catch (Exception ex) {
 					jtaLogger.i18NLogger.warn_recovery_getxaresource(ex);
@@ -896,7 +899,7 @@ private void clearAllFailures()
 
 	private List<XAResource> _resources;
 
-	private boolean requireFirstPass = true;
+	private boolean scanning;
 
 	private final List<XAResourceRecovery> _xaRecoverers;
 ",2013-09-26T07:28:33Z,18
"@@ -55,7 +55,7 @@ public interface JDBCAccess
      * @throws NamingException 
      */
 
-    public Connection getConnection () throws SQLException, NamingException;
+    public Connection getConnection () throws SQLException;
 
     /**
      * This method can be used to pass additional information to the",2013-08-22T09:46:40Z,58
"@@ -57,8 +57,9 @@
 
 public abstract class JDBCImple_driver {
 
-	protected static ThreadLocal<Connection> connection;
+	// protected Connection connection;
 	protected String tableName;
+	private JDBCAccess jdbcAccess;
 
 	public boolean commit_state(Uid objUid, String typeName)
 			throws ObjectStoreException {
@@ -70,13 +71,12 @@ public boolean commit_state(Uid objUid, String typeName)
 		PreparedStatement pstmt = null;
 		PreparedStatement pstmt2 = null;
 		try {
+			Connection connection = jdbcAccess.getConnection();
 			// Delete any previously committed state
 			pstmt = connection
-					.get()
-					.prepareStatement(
-							""DELETE FROM ""
-									+ tableName
-									+ "" WHERE UidString = ? AND TypeName = ? AND StateType = ?"");
+					.prepareStatement(""DELETE FROM ""
+							+ tableName
+							+ "" WHERE UidString = ? AND TypeName = ? AND StateType = ?"");
 
 			pstmt.setString(1, objUid.stringForm());
 			pstmt.setString(2, typeName);
@@ -90,23 +90,22 @@ public boolean commit_state(Uid objUid, String typeName)
 
 			// now do the commit itself:
 			pstmt2 = connection
-					.get()
-					.prepareStatement(
-							""UPDATE ""
-									+ tableName
-									+ "" SET StateType = 1 WHERE UidString = ? AND TypeName = ? AND StateType = ""
-									+ StateStatus.OS_UNCOMMITTED);
+					.prepareStatement(""UPDATE ""
+							+ tableName
+							+ "" SET StateType = 1 WHERE UidString = ? AND TypeName = ? AND StateType = ""
+							+ StateStatus.OS_UNCOMMITTED);
 
 			pstmt2.setString(1, objUid.stringForm());
 			pstmt2.setString(2, typeName);
 
 			int rowcount2 = pstmt2.executeUpdate();
 			if (rowcount2 > 0) {
 				result = true;
-				connection.get().commit();
+				connection.commit();
 			} else {
-				connection.get().rollback();
+				connection.rollback();
 			}
+			connection.close();
 
 		} catch (SQLException e) {
 			tsLogger.i18NLogger.warn_objectstore_JDBCImple_writefailed(e);
@@ -139,12 +138,11 @@ public boolean hide_state(Uid objUid, String typeName)
 
 		PreparedStatement pstmt = null;
 		try {
+			Connection connection = jdbcAccess.getConnection();
 			pstmt = connection
-					.get()
-					.prepareStatement(
-							""UPDATE ""
-									+ tableName
-									+ "" SET Hidden = 1 WHERE UidString = ? AND TypeName = ? AND Hidden = 0"");
+					.prepareStatement(""UPDATE ""
+							+ tableName
+							+ "" SET Hidden = 1 WHERE UidString = ? AND TypeName = ? AND Hidden = 0"");
 
 			pstmt.setString(1, objUid.stringForm());
 			pstmt.setString(2, typeName);
@@ -153,7 +151,8 @@ public boolean hide_state(Uid objUid, String typeName)
 			if (rowcount > 0) {
 				result = true;
 			}
-			connection.get().commit();
+			connection.commit();
+			connection.close();
 		} catch (SQLException e) {
 			tsLogger.i18NLogger.warn_objectstore_JDBCImple_1(e);
 		} finally {
@@ -178,12 +177,11 @@ public boolean reveal_state(Uid objUid, String typeName)
 
 		PreparedStatement pstmt = null;
 		try {
+			Connection connection = jdbcAccess.getConnection();
 			pstmt = connection
-					.get()
-					.prepareStatement(
-							""UPDATE ""
-									+ tableName
-									+ "" SET Hidden = 0 WHERE UidString = ? AND TypeName = ? AND Hidden = 1"");
+					.prepareStatement(""UPDATE ""
+							+ tableName
+							+ "" SET Hidden = 0 WHERE UidString = ? AND TypeName = ? AND Hidden = 1"");
 
 			pstmt.setString(1, objUid.stringForm());
 			pstmt.setString(2, typeName);
@@ -192,7 +190,8 @@ public boolean reveal_state(Uid objUid, String typeName)
 			if (rowcount > 0) {
 				result = true;
 			}
-			connection.get().commit();
+			connection.commit();
+			connection.close();
 		} catch (SQLException e) {
 			tsLogger.i18NLogger.warn_objectstore_JDBCImple_2(e);
 		} finally {
@@ -223,8 +222,10 @@ public int currentState(Uid objUid, String typeName)
 
 		PreparedStatement pstmt = null;
 		try {
-			pstmt = connection.get().prepareStatement(
-					""SELECT StateType, Hidden FROM "" + tableName
+			Connection connection = jdbcAccess.getConnection();
+			pstmt = connection
+					.prepareStatement(""SELECT StateType, Hidden FROM ""
+							+ tableName
 							+ "" WHERE UidString = ? AND TypeName = ?"");
 
 			pstmt.setString(1, objUid.stringForm());
@@ -261,7 +262,8 @@ public int currentState(Uid objUid, String typeName)
 					break;
 				}
 			}
-			connection.get().commit();
+			connection.commit();
+			connection.close();
 
 			// examine in reverse order:
 			if (have_OS_COMMITTED_HIDDEN) {
@@ -311,7 +313,8 @@ public boolean allObjUids(String typeName, InputObjectState state, int match)
 		try {
 			OutputObjectState store = new OutputObjectState();
 
-			Statement stmt = connection.get().createStatement();
+			Connection connection = jdbcAccess.getConnection();
+			Statement stmt = connection.createStatement();
 			ResultSet rs = null;
 
 			try {
@@ -339,7 +342,8 @@ public boolean allObjUids(String typeName, InputObjectState state, int match)
 						finished = true;
 					}
 				}
-				connection.get().commit();
+				connection.commit();
+				connection.close();
 			} catch (Exception e) {
 				tsLogger.i18NLogger.warn_objectstore_JDBCImple_4(e);
 			} finally {
@@ -368,7 +372,8 @@ public boolean allTypes(InputObjectState foundTypes)
 		try {
 			OutputObjectState store = new OutputObjectState();
 
-			Statement stmt = connection.get().createStatement();
+			Connection connection = jdbcAccess.getConnection();
+			Statement stmt = connection.createStatement();
 			ResultSet rs = null;
 
 			try {
@@ -395,7 +400,8 @@ public boolean allTypes(InputObjectState foundTypes)
 					}
 				}
 
-				connection.get().commit();
+				connection.commit();
+				connection.close();
 			} catch (Exception e) {
 				tsLogger.i18NLogger.warn_objectstore_JDBCImple_6(e);
 			} finally {
@@ -428,12 +434,11 @@ public boolean remove_state(Uid objUid, String typeName, int stateType)
 
 				PreparedStatement pstmt = null;
 				try {
+					Connection connection = jdbcAccess.getConnection();
 					pstmt = connection
-							.get()
-							.prepareStatement(
-									""DELETE FROM ""
-											+ tableName
-											+ "" WHERE UidString = ? AND TypeName = ? AND StateType = ?"");
+							.prepareStatement(""DELETE FROM ""
+									+ tableName
+									+ "" WHERE UidString = ? AND TypeName = ? AND StateType = ?"");
 
 					pstmt.setString(1, objUid.stringForm());
 					pstmt.setString(2, typeName);
@@ -443,7 +448,8 @@ public boolean remove_state(Uid objUid, String typeName, int stateType)
 						result = true;
 					}
 
-					connection.get().commit();
+					connection.commit();
+					connection.close();
 				} catch (SQLException e) {
 					tsLogger.i18NLogger.warn_objectstore_JDBCImple_8(e);
 				} finally {
@@ -480,19 +486,16 @@ public InputObjectState read_state(Uid objUid, String typeName,
 
 			PreparedStatement pstmt = null;
 			try {
+				Connection connection = jdbcAccess.getConnection();
 				pstmt = connection
-						.get()
-						.prepareStatement(
-								""SELECT ObjectState FROM ""
-										+ tableName
-										+ "" WHERE UidString = ? AND TypeName = ? AND StateType = ?"");
+						.prepareStatement(""SELECT ObjectState FROM ""
+								+ tableName
+								+ "" WHERE UidString = ? AND TypeName = ? AND StateType = ?"");
 				pstmt.setString(1, objUid.stringForm());
 				pstmt.setString(2, typeName);
 				pstmt.setInt(3, stateType);
 
 				rs = pstmt.executeQuery();
-
-				connection.get().commit();
 				if (rs.next()) {
 
 					byte[] buffer = rs.getBytes(1);
@@ -504,6 +507,9 @@ public InputObjectState read_state(Uid objUid, String typeName,
 								.warn_objectstore_JDBCImple_readfailed();
 					}
 				}
+
+				connection.commit();
+				connection.close();
 			} catch (SQLException e) {
 				tsLogger.i18NLogger.warn_objectstore_JDBCImple_14(e);
 			} finally {
@@ -546,8 +552,8 @@ public boolean write_state(Uid objUid, String typeName,
 			PreparedStatement pstmt = null;
 			PreparedStatement pstmt2 = null;
 			try {
+				Connection connection = jdbcAccess.getConnection();
 				pstmt = connection
-						.get()
 						.prepareStatement(
 								""SELECT ObjectState, UidString, StateType, TypeName FROM ""
 										+ tableName
@@ -565,14 +571,12 @@ public boolean write_state(Uid objUid, String typeName,
 					updateBytes(rs, 1, b);
 					rs.updateRow();
 				} else {
-					connection.get().commit();
+					// TODO connection.get().commit();
 					// not in database, do insert:
 					pstmt2 = connection
-							.get()
-							.prepareStatement(
-									""INSERT INTO ""
-											+ tableName
-											+ "" (StateType,Hidden,TypeName,UidString,ObjectState) VALUES (?,0,?,?,?)"");
+							.prepareStatement(""INSERT INTO ""
+									+ tableName
+									+ "" (StateType,Hidden,TypeName,UidString,ObjectState) VALUES (?,0,?,?,?)"");
 
 					pstmt2.setInt(1, stateType);
 					pstmt2.setString(2, typeName);
@@ -582,7 +586,8 @@ public boolean write_state(Uid objUid, String typeName,
 					pstmt2.executeUpdate();
 				}
 
-				connection.get().commit();
+				connection.commit();
+				connection.close();
 				result = true;
 			} catch (SQLException e) {
 				tsLogger.i18NLogger.warn_objectstore_JDBCImple_writefailed(e);
@@ -623,28 +628,31 @@ public boolean write_state(Uid objUid, String typeName,
 	public void initialise(final JDBCAccess jdbcAccess, String tableName,
 			ObjectStoreEnvironmentBean jdbcStoreEnvironmentBean)
 			throws SQLException, NamingException {
+		this.jdbcAccess = jdbcAccess;
 
-		connection = new ThreadLocal<Connection>() {
+		// connection = new ThreadLocal<Connection>() {
+		//
+		// @Override
+		// protected Connection initialValue() {
+		// try {
+		// return jdbcAccess.getConnection();
+		// } catch (Exception e) {
+		// throw new RuntimeException(e);
+		// }
+		// }
+		// };
 
-			@Override
-			protected Connection initialValue() {
-				try {
-					return jdbcAccess.getConnection();
-				} catch (Exception e) {
-					throw new RuntimeException(e);
-				}
-			}
-		};
+		Connection connection = jdbcAccess.getConnection();
 
-		Statement stmt = connection.get().createStatement();
+		Statement stmt = connection.createStatement();
 
 		// table [type, object UID, format, blob]
 
 		if (jdbcStoreEnvironmentBean.getDropTable()) {
 			try {
 				stmt.executeUpdate(""DROP TABLE "" + tableName);
 			} catch (SQLException ex) {
-				checkDropTableException(ex);
+				checkDropTableException(connection, ex);
 			}
 		}
 
@@ -659,9 +667,11 @@ protected Connection initialValue() {
 		stmt.close();
 
 		// This can be the case when triggering via EmptyObjectStore
-		if (!connection.get().getAutoCommit()) {
-			connection.get().commit();
+		if (!connection.getAutoCommit()) {
+			connection.commit();
 		}
+		connection.close();
+
 		this.tableName = tableName;
 	}
 
@@ -687,7 +697,7 @@ protected String getObjectStateSQLType() {
 	protected abstract void checkCreateTableError(SQLException ex)
 			throws SQLException;
 
-	protected abstract void checkDropTableException(SQLException ex)
+	protected abstract void checkDropTableException(Connection connection, SQLException ex)
 			throws SQLException;
 
 	public int getMaxStateSize() {",2013-08-22T09:46:40Z,59
"@@ -44,11 +44,11 @@
 
 public class DataSourceJDBCAccess implements JDBCAccess {
 
+	private DataSource dataSource;
 	private String datasourceName;
 
-	public Connection getConnection() throws SQLException, NamingException {
-		Connection connection = ((DataSource) new InitialContext()
-				.lookup(datasourceName)).getConnection();
+	public Connection getConnection() throws SQLException {
+		Connection connection = dataSource.getConnection();
 		connection.setAutoCommit(false);
 		return connection;
 	}
@@ -69,6 +69,12 @@ public void initialise(StringTokenizer tokenizer) {
 			throw new FatalError(
 					""The JDBC ObjectStore was not configured with a datasource name"");
 		}
+		
+		try {
+			InitialContext context = new InitialContext();
+			dataSource = (DataSource) context.lookup(datasourceName);
+		} catch (NamingException ex) {
+			throw new FatalError(toString() + "" : "" + ex, ex);
+		}
 	}
-
 }",2013-08-22T09:46:40Z,60
"@@ -39,7 +39,6 @@
 import java.util.Map;
 import java.util.StringTokenizer;
 
-import javax.naming.NamingException;
 import javax.sql.DataSource;
 
 import com.arjuna.ats.arjuna.exceptions.FatalError;
@@ -48,7 +47,7 @@
 public class DynamicDataSourceJDBCAccess implements JDBCAccess {
 	private DataSource dataSource;
 
-	public Connection getConnection() throws SQLException, NamingException {
+	public Connection getConnection() throws SQLException {
 		Connection connection = dataSource.getConnection();
 		connection.setAutoCommit(false);
 		return connection;",2013-08-22T09:46:40Z,61
"@@ -20,6 +20,7 @@
  */
 package com.arjuna.ats.internal.arjuna.objectstore.jdbc.drivers;
 
+import java.sql.Connection;
 import java.sql.SQLException;
 
 import com.arjuna.ats.internal.arjuna.objectstore.jdbc.JDBCImple_driver;
@@ -38,7 +39,8 @@ protected void checkCreateTableError(SQLException ex) throws SQLException {
 	}
 
 	@Override
-	protected void checkDropTableException(SQLException ex) throws SQLException {
+	protected void checkDropTableException(Connection connection,
+			SQLException ex) throws SQLException {
 		if (!ex.getSQLState().equals(""42S02"")) {
 			throw ex;
 		}",2013-08-22T09:46:40Z,62
"@@ -20,6 +20,7 @@
  */
 package com.arjuna.ats.internal.arjuna.objectstore.jdbc.drivers;
 
+import java.sql.Connection;
 import java.sql.SQLException;
 
 /**
@@ -42,7 +43,8 @@ protected void checkCreateTableError(SQLException ex) throws SQLException {
 	}
 
 	@Override
-	protected void checkDropTableException(SQLException ex) throws SQLException {
+	protected void checkDropTableException(Connection connection,
+			SQLException ex) throws SQLException {
 		if (!ex.getSQLState().equals(""42704"") && ex.getErrorCode() != -204) {
 			throw ex;
 		}",2013-08-22T09:46:40Z,63
"@@ -20,6 +20,7 @@
  */
 package com.arjuna.ats.internal.arjuna.objectstore.jdbc.drivers;
 
+import java.sql.Connection;
 import java.sql.SQLException;
 
 import com.arjuna.ats.internal.arjuna.objectstore.jdbc.JDBCImple_driver;
@@ -43,7 +44,8 @@ protected void checkCreateTableError(SQLException ex) throws SQLException {
 	}
 
 	@Override
-	protected void checkDropTableException(SQLException ex) throws SQLException {
+	protected void checkDropTableException(Connection connection,
+			SQLException ex) throws SQLException {
 		if (ex.getErrorCode() != 3701) {
 			throw ex;
 		}",2013-08-22T09:46:40Z,64
"@@ -37,6 +37,7 @@
 
 package com.arjuna.ats.internal.arjuna.objectstore.jdbc.drivers;
 
+import java.sql.Connection;
 import java.sql.SQLException;
 
 import com.arjuna.ats.internal.arjuna.objectstore.jdbc.JDBCImple_driver;
@@ -59,7 +60,8 @@ protected void checkCreateTableError(SQLException ex) throws SQLException {
 	}
 
 	@Override
-	protected void checkDropTableException(SQLException ex) throws SQLException {
+	protected void checkDropTableException(Connection connection,
+			SQLException ex) throws SQLException {
 		if (!ex.getSQLState().equals(""S0005"") && ex.getErrorCode() != 3701) {
 			throw ex;
 		}",2013-08-22T09:46:40Z,65
"@@ -20,6 +20,7 @@
  */
 package com.arjuna.ats.internal.arjuna.objectstore.jdbc.drivers;
 
+import java.sql.Connection;
 import java.sql.SQLException;
 
 /**
@@ -43,7 +44,8 @@ protected void checkCreateTableError(SQLException ex) throws SQLException {
 	}
 
 	@Override
-	protected void checkDropTableException(SQLException ex) throws SQLException {
+	protected void checkDropTableException(Connection connection,
+			SQLException ex) throws SQLException {
 		if (!ex.getSQLState().equals(""42S02"")) {
 			throw ex;
 		}",2013-08-22T09:46:40Z,66
"@@ -42,6 +42,7 @@
 package com.arjuna.ats.internal.arjuna.objectstore.jdbc.drivers;
 
 import java.sql.Blob;
+import java.sql.Connection;
 import java.sql.ResultSet;
 import java.sql.SQLException;
 
@@ -76,7 +77,8 @@ protected void checkCreateTableError(SQLException ex) throws SQLException {
 	}
 
 	@Override
-	protected void checkDropTableException(SQLException ex) throws SQLException {
+	protected void checkDropTableException(Connection connection,
+			SQLException ex) throws SQLException {
 		if (!ex.getSQLState().equals(""42000"") && ex.getErrorCode() != 942) {
 			throw ex;
 		}",2013-08-22T09:46:40Z,67
"@@ -20,6 +20,7 @@
  */
 package com.arjuna.ats.internal.arjuna.objectstore.jdbc.drivers;
 
+import java.sql.Connection;
 import java.sql.SQLException;
 
 import com.arjuna.ats.internal.arjuna.objectstore.jdbc.JDBCImple_driver;
@@ -38,13 +39,14 @@ protected void checkCreateTableError(SQLException ex) throws SQLException {
 	}
 
 	@Override
-	protected void checkDropTableException(SQLException ex) throws SQLException {
+	protected void checkDropTableException(Connection connection,
+			SQLException ex) throws SQLException {
 		if (!ex.getSQLState().equals(""42P01"")) {
 			throw ex;
 		} else {
 			// For some reason PSQL leaves the transaction in a bad state on a
 			// failed drop
-			connection.get().commit();
+			connection.commit();
 		}
 	}
 }",2013-08-22T09:46:40Z,68
"@@ -38,6 +38,7 @@
   </build>
   <modules>
     <module>jta</module>
+    <module>spi</module>
     <module>cdi</module>
     <module>jdbc</module>
     <module>narayana-jta</module>",2013-09-17T09:24:53Z,223
"@@ -0,0 +1,206 @@
+<?xml version=""1.0"" encoding=""UTF-8""?>
+<!--
+  JBoss, Home of Professional Open Source.
+  Copyright 2013, Red Hat, Inc., and individual contributors
+  as indicated by the @author tags. See the copyright.txt file in the
+  distribution for a full listing of individual contributors.
+
+  This is free software; you can redistribute it and/or modify it
+  under the terms of the GNU Lesser General Public License as
+  published by the Free Software Foundation; either version 2.1 of
+  the License, or (at your option) any later version.
+
+  This software is distributed in the hope that it will be useful,
+  but WITHOUT ANY WARRANTY; without even the implied warranty of
+  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+  Lesser General Public License for more details.
+
+  You should have received a copy of the GNU Lesser General Public
+  License along with this software; if not, write to the Free
+  Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+  02110-1301 USA, or see the FSF site: http://www.fsf.org.
+-->
+<project xmlns=""http://maven.apache.org/POM/4.0.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xsi:schemaLocation=""http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"">
+    <parent>
+        <groupId>org.jboss.narayana.jta</groupId>
+        <artifactId>narayana-jta-all</artifactId>
+        <version>5.0.0.M5-SNAPSHOT</version>
+        <relativePath>../pom.xml</relativePath>
+    </parent>
+    <modelVersion>4.0.0</modelVersion>
+    <artifactId>jboss-transaction-spi-tests</artifactId>
+    <name>Narayana: Transaction 7.0.2 SPI Testing</name>
+    <description>Narayana: Transaction 7.0.2 SPI Testing</description>
+
+    <packaging>jar</packaging>
+
+    <properties>
+        <ipv6.server.jvm.args>-Djboss.bind.address=[::1] -Djboss.bind.address.management=[::1]
+            -Djboss.bind.address.unsecure=[::1] -Djava.net.preferIPv4Stack=false -Djava.net.preferIPv6Addresses=true
+        </ipv6.server.jvm.args>
+    </properties>
+
+    <build>
+        <plugins>
+            <plugin>
+                <artifactId>maven-surefire-plugin</artifactId>
+                <configuration>
+                    <skip>true</skip>
+                </configuration>
+            </plugin>
+        </plugins>
+    </build>
+    <dependencies>
+        <dependency>
+            <groupId>org.jboss</groupId>
+            <artifactId>jboss-transaction-spi</artifactId>
+            <version>${version.org.jboss.jboss-transaction-spi}</version>
+            <scope>provided</scope>
+            <exclusions>
+                <exclusion>
+                    <groupId>org.jboss.logging</groupId>
+                    <artifactId>jboss-logging-spi</artifactId>
+                </exclusion>
+            </exclusions>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.spec.javax.interceptor</groupId>
+            <artifactId>jboss-interceptors-api_1.2_spec</artifactId>
+            <version>${version.org.jboss.spec.javax.interceptor}</version>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.spec.javax.transaction</groupId>
+            <artifactId>jboss-transaction-api_1.2_spec</artifactId>
+            <version>${version.org.jboss.spec.javax.transaction}</version>
+            <scope>provided</scope>
+        </dependency>
+        <dependency>
+            <groupId>junit</groupId>
+            <artifactId>junit</artifactId>
+            <version>${version.junit}</version>
+            <scope>test</scope>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.arquillian.protocol</groupId>
+            <artifactId>arquillian-protocol-servlet</artifactId>
+            <version>${version.org.jboss.arquillian.core}</version>
+            <scope>test</scope>
+        </dependency>
+        <dependency>
+            <groupId>javax.enterprise</groupId>
+            <artifactId>cdi-api</artifactId>
+            <version>${version.javax.enterprise}</version>
+            <scope>provided</scope>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.arquillian.junit</groupId>
+            <artifactId>arquillian-junit-container</artifactId>
+            <version>${version.org.jboss.arquillian.core}</version>
+            <scope>provided</scope>
+        </dependency>
+        <dependency>
+            <groupId>javax.annotation</groupId>
+            <artifactId>javax.annotation-api</artifactId>
+            <version>${version.javax.annotation}</version>
+            <scope>provided</scope>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.spec.javax.ejb</groupId>
+            <artifactId>jboss-ejb-api_3.1_spec</artifactId>
+            <version>${version.org.jboss.spec.javax.ejb}</version>
+            <scope>provided</scope>
+        </dependency>
+    </dependencies>
+
+    <profiles>
+        <profile>
+            <id>arq</id>
+            <activation>
+                <activeByDefault>false</activeByDefault>
+            </activation>
+            <dependencies>
+                <dependency>
+                    <groupId>org.wildfly</groupId>
+                    <artifactId>wildfly-arquillian-container-managed</artifactId>
+                    <version>${jboss-as.version}</version>
+                    <scope>test</scope>
+                </dependency>
+            </dependencies>
+            <build>
+                <plugins>
+                    <plugin>
+                        <artifactId>maven-surefire-plugin</artifactId>
+                        <configuration>
+                            <skip>false</skip>
+                            <systemPropertyVariables combine.children=""append"">
+                                <!--
+                                    Used in arquillian.xml
+                                -->
+                                <server.jvm.args>${jvm.args.other} ${jvm.args.memory}</server.jvm.args>
+                                <node.address>127.0.0.1</node.address>
+                            </systemPropertyVariables>
+                            <redirectTestOutputToFile>true</redirectTestOutputToFile>
+                        </configuration>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
+        <profile>
+            <id>arqIPv6</id>
+            <activation>
+                <activeByDefault>false</activeByDefault>
+            </activation>
+            <dependencies>
+                <dependency>
+                    <groupId>org.wildfly</groupId>
+                    <artifactId>wildfly-arquillian-container-managed</artifactId>
+                    <version>${jboss-as.version}</version>
+                    <scope>test</scope>
+                </dependency>
+            </dependencies>
+            <build>
+                <plugins>
+                    <plugin>
+                        <artifactId>maven-surefire-plugin</artifactId>
+                        <configuration>
+                            <skip>false</skip>
+                            <argLine>${ipv6.server.jvm.args}</argLine>
+                            <systemPropertyVariables combine.children=""append"">
+                                <!--
+                                    Used in arquillian.xml
+                                -->
+                                <server.jvm.args>${jvm.args.other} ${jvm.args.memory} ${ipv6.server.jvm.args}</server.jvm.args>
+                                <node.address>[::1]</node.address>
+                            </systemPropertyVariables>
+                            <redirectTestOutputToFile>true</redirectTestOutputToFile>
+                        </configuration>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
+        <profile>
+            <id>arq-remote</id>
+            <activation>
+                <activeByDefault>false</activeByDefault>
+            </activation>
+            <build>
+                <plugins>
+                    <plugin>
+                        <artifactId>maven-surefire-plugin</artifactId>
+                        <configuration>
+                            <skip>false</skip>
+                        </configuration>
+                    </plugin>
+                </plugins>
+            </build>
+            <dependencies>
+                <dependency>
+                    <groupId>org.wildfly</groupId>
+                    <artifactId>wildfly-arquillian-container-remote</artifactId>
+                    <version>${jboss-as.version}</version>
+                    <scope>test</scope>
+                </dependency>
+            </dependencies>
+        </profile>
+    </profiles>
+</project>",2013-09-17T09:24:53Z,28
"@@ -0,0 +1,118 @@
+/*
+ * JBoss, Home of Professional Open Source
+ * Copyright 2013, Red Hat Inc., and individual contributors as indicated
+ * by the @authors tag. See the copyright.txt in the distribution for a
+ * full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+package org.jboss.tm;
+
+import org.jboss.arquillian.container.test.api.Deployment;
+import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.shrinkwrap.api.ShrinkWrap;
+import org.jboss.shrinkwrap.api.asset.EmptyAsset;
+import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.Assert;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+
+import javax.annotation.Resource;
+import javax.inject.Inject;
+import javax.transaction.*;
+import org.jboss.tm.TxUtils;
+
+/**
+ * Transaction SPI integration tests
+ */
+@RunWith(Arquillian.class)
+public class TestSPI {
+    @Resource(lookup = ""java:jboss/TransactionManager"")
+    private javax.transaction.TransactionManager transactionManager;
+
+    @Deployment
+    public static WebArchive createTestArchive() {
+
+        return ShrinkWrap.create(WebArchive.class, ""test.war"")
+                .addPackage(""org.jboss.tm"")
+                .addAsWebInfResource(EmptyAsset.INSTANCE, ""beans.xml"");
+    }
+
+    @Test
+    public void sanityCheck() {
+        Assert.assertTrue(Boolean.TRUE);
+    }
+
+    @Test
+    public void testTimeouts() throws Exception {
+        Transaction oldTxn = null;
+        final int SLEEP = 5;
+        final int timeout = 2;
+        final boolean[] afterCompletionViaTMTimeoutThread = {false};
+
+        try {
+            oldTxn = transactionManager.suspend();
+            transactionManager.setTransactionTimeout(timeout);
+            transactionManager.begin();
+
+            Transaction newTxn = transactionManager.getTransaction();
+
+            newTxn.registerSynchronization(new Synchronization() {
+                @Override
+                public void beforeCompletion() {
+                }
+
+                @Override
+                public void afterCompletion(int status) {
+                    System.out.printf(""afterCompletion callback. Txn Status=%d%n"", status);
+                    afterCompletionViaTMTimeoutThread[0] = TxUtils.isTransactionManagerTimeoutThread();
+                    Assert.assertTrue(""afterCompletion synchronization not called via TransactionManagerTimeoutThread"",
+                            afterCompletionViaTMTimeoutThread[0]);
+                }
+            });
+
+            Thread.sleep(SLEEP * 1000); // sleep for longer than the transaction timeout period
+            int status = transactionManager.getStatus();
+
+            Assert.assertTrue(""ERROR transaction should have timed out but its state is "" + status,
+                    status == Status.STATUS_ROLLEDBACK);
+
+            transactionManager.commit();
+
+            Assert.assertTrue(""testTimeouts synchronization was not invoked"", afterCompletionViaTMTimeoutThread[0]);
+        } catch (RollbackException e) {
+            // SUCCESS: rollback exception expected
+            // any other exception is a failure
+        } finally {
+            try {
+                if (transactionManager.getStatus() == Status.STATUS_ACTIVE)
+                    transactionManager.rollback();
+            } catch (SystemException e) {
+                System.err.printf(""testTimeouts: cleanup exception %s%n"", e.getMessage());
+            }
+            if (oldTxn != null) {
+                try {
+                    transactionManager.resume(oldTxn);
+                } catch (SystemException e) {
+                    System.err.printf(""testTimeouts: resume exception %s%n"", e.getMessage());
+                } catch (InvalidTransactionException e) {
+                    System.err.printf(""testTimeouts: resume exception %s%n"", e.getMessage());
+                }
+            }
+        }
+
+    }
+}",2013-09-17T09:24:53Z,224
"@@ -474,7 +474,7 @@
     <version.org.jboss.arquillian.core>1.0.3.Final</version.org.jboss.arquillian.core>
     <version.javax.annotation>1.2-b04</version.javax.annotation>
     <version.org.jboss.arquillian.osgi>2.0.0.CR2</version.org.jboss.arquillian.osgi>
-    <version.org.jboss.jboss-transaction-spi>7.0.1.Final</version.org.jboss.jboss-transaction-spi>
+    <version.org.jboss.jboss-transaction-spi>7.0.2.Final</version.org.jboss.jboss-transaction-spi>
 
     <!-- Maven plugin versions -->
     <version.org.eclipse.m2e.lifecycle-mapping>1.0.0</version.org.eclipse.m2e.lifecycle-mapping>",2013-09-17T09:24:53Z,39
"@@ -1,6 +1,6 @@
-call:comment_on_pull ""Started testing this pull request: %BUILD_URL%""
+call:comment_on_pull ""Started testing this pull request with BLACKTIE profile on Windows: %BUILD_URL%""
 
-call build.bat clean install ""-DskipTests"" || (call:comment_on_pull ""Narayana Failed %BUILD_URL%"" && exit -1)
+call build.bat clean install ""-DskipTests"" || (call:comment_on_pull ""BLACKTIE profile tests failed on Windows - Narayana Failed %BUILD_URL%"" && exit -1)
 
 echo ""Cloning AS""
 rmdir /S /Q jboss-as
@@ -13,11 +13,11 @@ if %ERRORLEVEL% NEQ 0 exit -1
 
 echo ""Building AS""
 set MAVEN_OPTS=""-Xmx768M""
-call build.bat clean install ""-DskipTests"" ""-Drelease=true"" || (call:comment_on_pull ""AS Failed %BUILD_URL%"" && exit -1)
+call build.bat clean install ""-DskipTests"" ""-Drelease=true"" || (call:comment_on_pull ""BLACKTIE profile tests failed on Windows - AS Failed %BUILD_URL%"" && exit -1)
 
 echo ""Building Blacktie Subsystem""
 cd ..\
-call build.bat -f blacktie\wildfly-blacktie\pom.xml clean install || (call:comment_on_pull ""Build Blacktie Subsystem Failed %BUILD_URL%"" && exit -1)
+call build.bat -f blacktie\wildfly-blacktie\pom.xml clean install || (call:comment_on_pull ""BLACKTIE profile tests failed on Windows - Build Blacktie Subsystem Failed %BUILD_URL%"" && exit -1)
 
 echo ""Building BlackTie
 cd blacktie
@@ -27,9 +27,9 @@ set JBOSS_HOME=%CD%\wildfly-%WILDFLY_MASTER_VERSION%\
 copy ..\rts\at\webservice\target\restat-web-%NARAYANA_CURRENT_VERSION%.war %JBOSS_HOME%\standalone\deployments\
 unzip wildfly-blacktie\build\target\wildfly-blacktie-build-%WILDFLY_MASTER_VERSION%-bin.zip -d %JBOSS_HOME%
 set WORKSPACE=%WORKSPACE%\blacktie 
-call scripts\hudson\blacktie-vc9x32.bat || (call:comment_on_pull ""BlackTie Failed %BUILD_URL%"" && exit -1)
+call scripts\hudson\blacktie-vc9x32.bat || (call:comment_on_pull ""BLACKTIE profile tests failed on Windows - BlackTie Failed %BUILD_URL%"" && exit -1)
 
-call:comment_on_pull ""All tests passed - Job complete %BUILD_URL%""
+call:comment_on_pull ""BLACKTIE profile tests passed on Windows - Job complete %BUILD_URL%""
 
 rem -------------------------------------------------------
 rem -                 Functions bellow                    -",2013-09-19T09:57:25Z,147
"@@ -1,5 +1,12 @@
 function fatal {
-  comment_on_pull ""Tests failed ($BUILD_URL): $1""
+  if [[ -z $PROFILE ]]; then
+      comment_on_pull ""Tests failed ($BUILD_URL): $1""
+  elif [[ $PROFILE == ""BLACKTIE"" ]]; then
+      comment_on_pull ""$PROFILE profile tests failed on Linux ($BUILD_URL): $1""
+  else
+      comment_on_pull ""$PROFILE profile tests failed ($BUILD_URL): $1""
+  fi
+
   echo ""$1""
   exit 1
 }
@@ -21,27 +28,35 @@ function init_test_options {
     PULL_DESCRIPTION=$(get_pull_description)
 
     if [[ $PROFILE == ""NO_TEST"" ]] || [[ $PULL_DESCRIPTION =~ ""NO_TEST"" ]]; then
+        export COMMENT_ON_PULL=""""
         export AS_BUILD=0 NARAYANA_BUILD=0 NARAYANA_TESTS=0 BLACKTIE=0 XTS_AS_TESTS=0 XTS_TESTS=0 TXF_TESTS=0 txbridge=0
         export RTS_AS_TESTS=0 RTS_TESTS=0 JTA_CDI_TESTS=0 QA_TESTS=0 SUN_ORB=0 JAC_ORB=0
     elif [[ $PROFILE == ""MAIN"" ]] && [[ ! $PULL_DESCRIPTION =~ ""!MAIN"" ]]; then
+        comment_on_pull ""Started testing this pull request with MAIN profile: $BUILD_URL""
         export AS_BUILD=1 NARAYANA_BUILD=1 NARAYANA_TESTS=1 BLACKTIE=0 XTS_AS_TESTS=0 XTS_TESTS=0 TXF_TESTS=0 txbridge=0
         export RTS_AS_TESTS=1 RTS_TESTS=1 JTA_CDI_TESTS=1 QA_TESTS=0 SUN_ORB=0 JAC_ORB=0
     elif [[ $PROFILE == ""XTS"" ]] && [[ ! $PULL_DESCRIPTION =~ ""!XTS"" ]]; then
+        comment_on_pull ""Started testing this pull request with XTS profile: $BUILD_URL""
         export AS_BUILD=1 NARAYANA_BUILD=1 NARAYANA_TESTS=0 BLACKTIE=0 XTS_AS_TESTS=1 XTS_TESTS=1 TXF_TESTS=1 txbridge=1
         export RTS_AS_TESTS=0 RTS_TESTS=0 JTA_CDI_TESTS=0 QA_TESTS=0 SUN_ORB=0 JAC_ORB=0
     elif [[ $PROFILE == ""QA_JTA"" ]] && [[ ! $PULL_DESCRIPTION =~ ""!QA_JTA"" ]]; then
+        comment_on_pull ""Started testing this pull request with QA_JTA profile: $BUILD_URL""
         export AS_BUILD=1 NARAYANA_BUILD=1 NARAYANA_TESTS=0 BLACKTIE=0 XTS_AS_TESTS=0 XTS_TESTS=0 TXF_TESTS=0 txbridge=0
         export RTS_AS_TESTS=0 RTS_TESTS=0 JTA_CDI_TESTS=0 QA_TESTS=1 SUN_ORB=1 JAC_ORB=0 QA_TARGET=ci-tests-nojts
     elif [[ $PROFILE == ""QA_JTS_JACORB"" ]] && [[ ! $PULL_DESCRIPTION =~ ""!QA_JTS_JACORB"" ]]; then
+        comment_on_pull ""Started testing this pull request with QA_JTS_JACORB profile: $BUILD_URL""
         export AS_BUILD=1 NARAYANA_BUILD=1 NARAYANA_TESTS=0 BLACKTIE=0 XTS_AS_TESTS=0 XTS_TESTS=0 TXF_TESTS=0 txbridge=0
         export RTS_AS_TESTS=0 RTS_TESTS=0 JTA_CDI_TESTS=0 QA_TESTS=1 SUN_ORB=0 JAC_ORB=1 QA_TARGET=ci-jts-tests
     elif [[ $PROFILE == ""QA_JTS_JDKORB"" ]] && [[ ! $PULL_DESCRIPTION =~ ""!QA_JTS_JDKORB"" ]]; then
+        comment_on_pull ""Started testing this pull request with QA_JTS_JDKORB profile: $BUILD_URL""
         export AS_BUILD=1 NARAYANA_BUILD=1  NARAYANA_TESTS=0 BLACKTIE=0 XTS_AS_TESTS=0 XTS_TESTS=0 TXF_TESTS=0 txbridge=0
         export RTS_AS_TESTS=0 RTS_TESTS=0 JTA_CDI_TESTS=0 QA_TESTS=1 SUN_ORB=1 JAC_ORB=0 QA_TARGET=ci-jts-tests
     elif [[ $PROFILE == ""BLACKTIE"" ]] && [[ ! $PULL_DESCRIPTION =~ ""!BLACKTIE"" ]]; then
+        comment_on_pull ""Started testing this pull request with BLACKTIE profile on Linux: $BUILD_URL""
         export AS_BUILD=1 NARAYANA_BUILD=1 NARAYANA_TESTS=0 BLACKTIE=1 XTS_AS_TESTS=0 XTS_TESTS=0 TXF_TESTS=0 txbridge=0
         export RTS_AS_TESTS=0 RTS_TESTS=0 JTA_CDI_TESTS=0 QA_TESTS=0 SUN_ORB=0 JAC_ORB=0
     elif [[ -z $PROFILE ]]; then
+        comment_on_pull ""Started testing this pull request: $BUILD_URL""
         # if the following env variables have not been set initialize them to their defaults
         [ $NARAYANA_TESTS ] || NARAYANA_TESTS=1	# run the narayana surefire tests
         [ $NARAYANA_BUILD ] || NARAYANA_BUILD=1 # build narayana
@@ -58,6 +73,7 @@ function init_test_options {
         [ $JAC_ORB ] || JAC_ORB=1 # Run QA test suite against JacORB
         [ $txbridge ] || txbridge=1 # bridge tests
     else
+        export COMMENT_ON_PULL=""""
         export AS_BUILD=0 NARAYANA_BUILD=0 NARAYANA_TESTS=0 BLACKTIE=0 XTS_AS_TESTS=0 XTS_TESTS=0 TXF_TESTS=0 txbridge=0
         export RTS_AS_TESTS=0 RTS_TESTS=0 JTA_CDI_TESTS=0 QA_TESTS=0 SUN_ORB=0 JAC_ORB=0
     fi
@@ -434,8 +450,6 @@ function qa_tests {
 
 check_if_pull_closed
 
-comment_on_pull ""Started testing this pull request: $BUILD_URL""
-
 init_test_options
 
 # if QA_BUILD_ARGS is unset then get the db drivers form the file system otherwise get them from the
@@ -476,5 +490,12 @@ export ANT_OPTS=""$ANT_OPTS $IPV6_OPTS""
 [ $RTS_TESTS = 1 ] && rts_tests ""$@""
 [ $QA_TESTS = 1 ] && qa_tests ""$@""
 
-comment_on_pull ""All tests passed - Job complete $BUILD_URL""
+if [[ -z $PROFILE ]]; then
+    comment_on_pull ""All tests passed - Job complete $BUILD_URL""
+elif [[ $PROFILE == ""BLACKTIE"" ]]; then
+    comment_on_pull ""$PROFILE profile tests passed on Linux - Job complete $BUILD_URL""
+else
+    comment_on_pull ""$PROFILE profile tests passed - Job complete $BUILD_URL""
+fi
+
 exit 0 # any failure would have resulted in fatal being called which exits with a value of 1",2013-09-19T09:57:25Z,10
"@@ -1,5 +1,12 @@
 function fatal {
-  comment_on_pull ""Tests failed ($BUILD_URL): $1""
+  if [[ -z $PROFILE ]]; then
+      comment_on_pull ""Tests failed ($BUILD_URL): $1""
+  elif [[ $PROFILE == ""BLACKTIE"" ]]; then
+      comment_on_pull ""$PROFILE profile tests failed on Linux ($BUILD_URL): $1""
+  else
+      comment_on_pull ""$PROFILE profile tests failed ($BUILD_URL): $1""
+  fi
+
   echo ""$1""
   exit 1
 }
@@ -21,27 +28,35 @@ function init_test_options {
     PULL_DESCRIPTION=$(get_pull_description)
 
     if [[ $PROFILE == ""NO_TEST"" ]] || [[ $PULL_DESCRIPTION =~ ""NO_TEST"" ]]; then
+        export COMMENT_ON_PULL=""""
         export AS_BUILD=0 NARAYANA_BUILD=0 NARAYANA_TESTS=0 BLACKTIE=0 XTS_AS_TESTS=0 XTS_TESTS=0 TXF_TESTS=0 txbridge=0
         export RTS_AS_TESTS=0 RTS_TESTS=0 JTA_CDI_TESTS=0 QA_TESTS=0 SUN_ORB=0 JAC_ORB=0
     elif [[ $PROFILE == ""MAIN"" ]] && [[ ! $PULL_DESCRIPTION =~ ""!MAIN"" ]]; then
+        comment_on_pull ""Started testing this pull request with MAIN profile: $BUILD_URL""
         export AS_BUILD=1 NARAYANA_BUILD=1 NARAYANA_TESTS=1 BLACKTIE=0 XTS_AS_TESTS=0 XTS_TESTS=0 TXF_TESTS=0 txbridge=0
         export RTS_AS_TESTS=1 RTS_TESTS=1 JTA_CDI_TESTS=1 QA_TESTS=0 SUN_ORB=0 JAC_ORB=0
     elif [[ $PROFILE == ""XTS"" ]] && [[ ! $PULL_DESCRIPTION =~ ""!XTS"" ]]; then
+        comment_on_pull ""Started testing this pull request with XTS profile: $BUILD_URL""
         export AS_BUILD=1 NARAYANA_BUILD=1 NARAYANA_TESTS=0 BLACKTIE=0 XTS_AS_TESTS=1 XTS_TESTS=1 TXF_TESTS=1 txbridge=1
         export RTS_AS_TESTS=0 RTS_TESTS=0 JTA_CDI_TESTS=0 QA_TESTS=0 SUN_ORB=0 JAC_ORB=0
     elif [[ $PROFILE == ""QA_JTA"" ]] && [[ ! $PULL_DESCRIPTION =~ ""!QA_JTA"" ]]; then
+        comment_on_pull ""Started testing this pull request with QA_JTA profile: $BUILD_URL""
         export AS_BUILD=1 NARAYANA_BUILD=1 NARAYANA_TESTS=0 BLACKTIE=0 XTS_AS_TESTS=0 XTS_TESTS=0 TXF_TESTS=0 txbridge=0
         export RTS_AS_TESTS=0 RTS_TESTS=0 JTA_CDI_TESTS=0 QA_TESTS=1 SUN_ORB=1 JAC_ORB=0 QA_TARGET=ci-tests-nojts
     elif [[ $PROFILE == ""QA_JTS_JACORB"" ]] && [[ ! $PULL_DESCRIPTION =~ ""!QA_JTS_JACORB"" ]]; then
+        comment_on_pull ""Started testing this pull request with QA_JTS_JACORB profile: $BUILD_URL""
         export AS_BUILD=1 NARAYANA_BUILD=1 NARAYANA_TESTS=0 BLACKTIE=0 XTS_AS_TESTS=0 XTS_TESTS=0 TXF_TESTS=0 txbridge=0
         export RTS_AS_TESTS=0 RTS_TESTS=0 JTA_CDI_TESTS=0 QA_TESTS=1 SUN_ORB=0 JAC_ORB=1 QA_TARGET=ci-jts-tests
     elif [[ $PROFILE == ""QA_JTS_JDKORB"" ]] && [[ ! $PULL_DESCRIPTION =~ ""!QA_JTS_JDKORB"" ]]; then
+        comment_on_pull ""Started testing this pull request with QA_JTS_JDKORB profile: $BUILD_URL""
         export AS_BUILD=1 NARAYANA_BUILD=1  NARAYANA_TESTS=0 BLACKTIE=0 XTS_AS_TESTS=0 XTS_TESTS=0 TXF_TESTS=0 txbridge=0
         export RTS_AS_TESTS=0 RTS_TESTS=0 JTA_CDI_TESTS=0 QA_TESTS=1 SUN_ORB=1 JAC_ORB=0 QA_TARGET=ci-jts-tests
     elif [[ $PROFILE == ""BLACKTIE"" ]] && [[ ! $PULL_DESCRIPTION =~ ""!BLACKTIE"" ]]; then
+        comment_on_pull ""Started testing this pull request with BLACKTIE profile on Linux: $BUILD_URL""
         export AS_BUILD=1 NARAYANA_BUILD=1 NARAYANA_TESTS=0 BLACKTIE=1 XTS_AS_TESTS=0 XTS_TESTS=0 TXF_TESTS=0 txbridge=0
         export RTS_AS_TESTS=0 RTS_TESTS=0 JTA_CDI_TESTS=0 QA_TESTS=0 SUN_ORB=0 JAC_ORB=0
     elif [[ -z $PROFILE ]]; then
+        comment_on_pull ""Started testing this pull request: $BUILD_URL""
         # if the following env variables have not been set initialize them to their defaults
         [ $NARAYANA_TESTS ] || NARAYANA_TESTS=1	# run the narayana surefire tests
         [ $NARAYANA_BUILD ] || NARAYANA_BUILD=1 # build narayana
@@ -58,6 +73,7 @@ function init_test_options {
         [ $JAC_ORB ] || JAC_ORB=1 # Run QA test suite against JacORB
         [ $txbridge ] || txbridge=1 # bridge tests
     else
+        export COMMENT_ON_PULL=""""
         export AS_BUILD=0 NARAYANA_BUILD=0 NARAYANA_TESTS=0 BLACKTIE=0 XTS_AS_TESTS=0 XTS_TESTS=0 TXF_TESTS=0 txbridge=0
         export RTS_AS_TESTS=0 RTS_TESTS=0 JTA_CDI_TESTS=0 QA_TESTS=0 SUN_ORB=0 JAC_ORB=0
     fi
@@ -434,8 +450,6 @@ function qa_tests {
 
 check_if_pull_closed
 
-comment_on_pull ""Started testing this pull request: $BUILD_URL""
-
 init_test_options
 
 # if QA_BUILD_ARGS is unset then get the db drivers form the file system otherwise get them from the
@@ -476,5 +490,12 @@ export ANT_OPTS=""$ANT_OPTS $IPV6_OPTS""
 [ $RTS_TESTS = 1 ] && rts_tests ""$@""
 [ $QA_TESTS = 1 ] && qa_tests ""$@""
 
-comment_on_pull ""All tests passed - Job complete $BUILD_URL""
+if [[ -z $PROFILE ]]; then
+    comment_on_pull ""All tests passed - Job complete $BUILD_URL""
+elif [[ $PROFILE == ""BLACKTIE"" ]]; then
+    comment_on_pull ""$PROFILE profile tests passed on Linux - Job complete $BUILD_URL""
+else
+    comment_on_pull ""$PROFILE profile tests passed - Job complete $BUILD_URL""
+fi
+
 exit 0 # any failure would have resulted in fatal being called which exits with a value of 1",2013-09-19T09:57:25Z,225
"@@ -0,0 +1,34 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2011, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+package org.jboss.jbossts.xts.bytemanSupport.participantReadOnly;
+
+/**
+ * @author <a href=""mailto:zfeng@redhat.com"">Amos Feng</a>
+ */
+public class ParticipantCompletionReadOnlyRules {
+
+    public static String RESOURCE_PATH= ""org/jboss/jbossts/xts/bytemanSupport/participantReadOnly/participant_completion_coordinator_readonly_rules.btm"";
+
+    public static void enableReadOnlyCheck() {
+        //Dummy method, detected by Byteman Rules
+    }
+}",2013-08-14T07:44:59Z,226
"@@ -0,0 +1,39 @@
+RULE enable readonly check
+CLASS org.jboss.jbossts.xts.bytemanSupport.participantReadOnly.ParticipantCompletionReadOnlyRules
+METHOD enableReadOnlyCheck()
+BIND NOTHING
+IF TRUE
+DO debug(""participant_completion_readonly.enable""),
+  flag(""enabled"")
+ENDRULE
+
+RULE readonly delay 3s for test
+CLASS com.arjuna.wst11.messaging.CoordinatorProcessorImpl
+METHOD readOnly(Notification, MAP, ArjunaContext)
+AT ENTRY
+IF TRUE
+DO debug(""readonly delay 3s""),
+   Thread.sleep(3000)
+ENDRULE
+
+RULE readonly called
+CLASS com.arjuna.wst11.messaging.CoordinatorProcessorImpl
+METHOD readOnly(Notification, MAP, ArjunaContext)
+AT RETURN
+BIND NOTHING
+IF (flagged(""enabled""))
+DO debug(""coordinator_processor_readonly.called.waking""),
+   signalWake(""readonly"", true),
+   debug(""coordinator_processor_readonly.called.donewake"")
+ENDRULE
+
+RULE prepare called
+CLASS com.arjuna.wst11.messaging.ParticipantProcessorImpl
+METHOD prepare(Notification, MAP, ArjunaContext)
+BIND NOTHING
+IF (flagged(""enabled""))
+DO debug(""participant_processor.prepare.waiting""),
+   waitFor(""readonly""),
+   debug(""participant_processor.prepare.woken""),
+   clear(""enabled"")
+ENDRULE",2013-08-14T07:44:59Z,227
"@@ -26,11 +26,15 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantReadOnly.ParticipantCompletionReadOnlyRules;
 import org.jboss.shrinkwrap.api.ShrinkWrap;
 import org.jboss.shrinkwrap.api.asset.EmptyAsset;
 import org.jboss.shrinkwrap.api.asset.StringAsset;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
 import org.junit.Before;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -69,6 +73,7 @@ public static WebArchive createDeployment() {
                 .addPackage(""com.jboss.transaction.wstf.webservices.sc007.server"")
                 .addPackage(""com.jboss.transaction.wstf.webservices.soapfault.client"")
                 .addPackage(""org.jboss.jbossts.xts.soapfault"")
+                .addPackage(""org.jboss.jbossts.xts.bytemanSupport.participantReadOnly"")
                 .addAsResource(""sc007/participanthandlers.xml"", ""com/jboss/transaction/wstf/webservices/sc007/sei/participanthandlers.xml"")
                 .addAsWebInfResource(""sc007/wsdl/sc007.wsdl"", ""classes/com/jboss/transaction/wstf/webservices/sc007/generated/wsdl/sc007.wsdl"")                          
                 .addAsResource(""soapfault/wsdl/soapfault.wsdl"", ""org/jboss/jbossts/xts/soapfault/soapfault.wsdl"")
@@ -82,6 +87,16 @@ public static WebArchive createDeployment() {
                 .addAsWebInfResource(EmptyAsset.INSTANCE, ""beans.xml"")
                 .addAsManifestResource(new StringAsset(""Dependencies: org.jboss.jts,org.jboss.ws.api,javax.xml.ws.api,org.jboss.xts,org.dom4j,org.jboss.ws.jaxws-client services export,org.jboss.ws.cxf.jbossws-cxf-client services export,com.sun.xml.bind services export\n""), ""MANIFEST.MF"");
     }
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionReadOnlyRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionReadOnlyRules.RESOURCE_PATH);
+    }
     
     @Before
     public void setUp() {
@@ -127,6 +142,7 @@ public void test3_3() throws Exception {
     
     @Test
     public void test3_4() throws Exception {
+        ParticipantCompletionReadOnlyRules.enableReadOnlyCheck();
         test.test3_4();
     }
     ",2013-08-14T07:44:59Z,228
"@@ -26,10 +26,14 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantReadOnly.ParticipantCompletionReadOnlyRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
 import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
+import org.junit.BeforeClass;
+import org.junit.AfterClass;
 import org.junit.runner.RunWith;
 
 import com.jboss.transaction.txinterop.proxy.ProxyConversation;
@@ -53,6 +57,16 @@ public class ATTest {
     public static WebArchive createDeployment() {
         return WarDeployment.getDeployment();
     }
+
+    @BeforeClass
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionReadOnlyRules.RESOURCE_PATH);
+    }
+
+    @AfterClass
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionReadOnlyRules.RESOURCE_PATH);
+    }
     
     @Before
     public void setUp() {
@@ -101,6 +115,7 @@ public void testAT3_3() throws Exception {
     
     @Test
     public void testAT4_1() throws Exception {
+        ParticipantCompletionReadOnlyRules.enableReadOnlyCheck();
         test.testAT4_1();
     }
     ",2013-08-14T07:44:59Z,229
"@@ -22,6 +22,7 @@
 
 package com.jboss.transaction.txinterop.interop;
 
+import org.jboss.jbossts.xts.bytemanSupport.participantReadOnly.ParticipantCompletionReadOnlyRules;
 import org.jboss.jbossts.xts.soapfault.SoapFaultPortType;
 import org.jboss.shrinkwrap.api.ShrinkWrap;
 import org.jboss.shrinkwrap.api.asset.EmptyAsset;
@@ -82,6 +83,7 @@ public static WebArchive getDeployment(){
                 .addPackage(CoordinationContextHandler.class.getPackage())
                 .addPackage(SoapFaultClient.class.getPackage())
                 .addPackage(SoapFaultPortType.class.getPackage())
+                .addPackage(ParticipantCompletionReadOnlyRules.class.getPackage())
                 .addAsResource(""interop11/participanthandlers.xml"", ""com/jboss/transaction/txinterop/webservices/atinterop/sei/participanthandlers.xml"")
                 .addAsResource(""interop11/participanthandlers.xml"", ""com/jboss/transaction/txinterop/webservices/bainterop/sei/participanthandlers.xml"")
                 .addAsWebInfResource(""interop11/wsdl/interopat.wsdl"", ""classes/com/jboss/transaction/txinterop/webservices/atinterop/generated/wsdl/interopat.wsdl"")",2013-08-14T07:44:59Z,230
"@@ -258,8 +258,13 @@ public void run() {
 			thread.start();
 		}
 		synchronized (phase2CommitAborted) {
-			if (phase2CommitAborted.getCount() < 2) {
-				phase2CommitAborted.wait();
+		    int waitedCount = 0;
+			while (phase2CommitAborted.getCount() < 2) {
+				phase2CommitAborted.wait(5000);
+				waitedCount++;
+	            if (waitedCount > 2 && phase2CommitAborted.getCount() < 2) {
+	                fail(""Servers were not aborted"");
+	            }           
 			}
 		}
 
@@ -352,8 +357,11 @@ public void run() {
 		thread.start();
 		synchronized (phase2CommitAborted) {
 			if (phase2CommitAborted.getCount() < 1) {
-				phase2CommitAborted.wait();
+				phase2CommitAborted.wait(5000);
 			}
+            if (phase2CommitAborted.getCount() < 1) {
+                fail(""Servers were not aborted"");
+            }
 		}
 
 		reboot(""1000"");
@@ -432,8 +440,11 @@ public void run() {
 		thread.start();
 		synchronized (phase2CommitAborted) {
 			if (phase2CommitAborted.getCount() < 1) {
-				phase2CommitAborted.wait();
+				phase2CommitAborted.wait(5000);
 			}
+            if (phase2CommitAborted.getCount() < 1) {
+                fail(""Servers were not aborted"");
+            }
 		}
 
 		reboot(""1000"");
@@ -518,8 +529,11 @@ public void run() {
 		thread.start();
 		synchronized (phase2CommitAborted) {
 			if (phase2CommitAborted.getCount() < 1) {
-				phase2CommitAborted.wait();
+				phase2CommitAborted.wait(5000);
 			}
+            if (phase2CommitAborted.getCount() < 1) {
+                fail(""Servers were not aborted"");
+            }
 		}
 		reboot(""1000"");
 		reboot(""2000"");
@@ -607,8 +621,11 @@ public void run() {
 		thread.start();
 		synchronized (phase2CommitAborted) {
 			if (phase2CommitAborted.getCount() < 1) {
-				phase2CommitAborted.wait();
+				phase2CommitAborted.wait(5000);
 			}
+            if (phase2CommitAborted.getCount() < 1) {
+                fail(""Servers were not aborted"");
+            }
 		}
 		reboot(""1000"");
 		assertTrue("""" + completionCounter.getCommitCount(""2000""), completionCounter.getCommitCount(""2000"") == 0);
@@ -660,8 +677,11 @@ public void run() {
 		thread.start();
 		synchronized (phase2CommitAborted) {
 			if (phase2CommitAborted.getCount() < 1) {
-				phase2CommitAborted.wait();
+				phase2CommitAborted.wait(5000);
 			}
+            if (phase2CommitAborted.getCount() < 1) {
+                fail(""Servers were not aborted"");
+            }
 		}
 
 		reboot(""1000"");",2012-02-17T17:57:07Z,231
"@@ -0,0 +1,48 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.compensationScoped;
+
+import org.jboss.narayana.compensations.api.CompensationScoped;
+
+import javax.inject.Named;
+import java.io.Serializable;
+
+/**
+ * @author paul.robinson@redhat.com 23/04/2013
+ */
+@Named(""DummyData"")
+@CompensationScoped
+public class DummyData implements Serializable {
+
+    private String value = """";
+
+    public void setValue(String value) {
+
+        this.value = value;
+    }
+
+    public String getValue() {
+
+        return value;
+    }
+}",2013-05-25T08:04:33Z,232
"@@ -0,0 +1,164 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import com.arjuna.mw.wst11.UserBusinessActivity;
+import com.arjuna.mw.wst11.UserBusinessActivityFactory;
+import com.arjuna.wst.TransactionRolledBackException;
+import junit.framework.Assert;
+import org.jboss.arquillian.container.test.api.Deployment;
+import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
+import org.jboss.narayana.compensations.functional.common.DummyCompensationHandler1;
+import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Close;
+import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Compensate;
+import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.ConfirmCompleted;
+import org.jboss.narayana.txframework.functional.common.EventLog;
+import org.jboss.narayana.txframework.functional.common.ServiceCommand;
+import org.jboss.narayana.txframework.functional.common.SomeApplicationException;
+import org.jboss.shrinkwrap.api.ArchivePaths;
+import org.jboss.shrinkwrap.api.ShrinkWrap;
+import org.jboss.shrinkwrap.api.asset.EmptyAsset;
+import org.jboss.shrinkwrap.api.asset.StringAsset;
+import org.jboss.shrinkwrap.api.spec.JavaArchive;
+import org.junit.After;
+import org.junit.AfterClass;
+import org.junit.Before;
+import org.junit.BeforeClass;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+
+import java.lang.annotation.Annotation;
+import java.util.Arrays;
+import java.util.List;
+
+@RunWith(Arquillian.class)
+public class DistributedTest {
+
+    UserBusinessActivity uba;
+    TestService client;
+
+    @Deployment()
+    public static JavaArchive createTestArchive() {
+        JavaArchive archive = ShrinkWrap.create(JavaArchive.class, ""test.jar"")
+                .addPackages(false, DistributedTest.class.getPackage())
+                .addPackage(DummyCompensationHandler1.class.getPackage())
+                .addClass(ParticipantCompletionCoordinatorRules.class)
+                .addAsManifestResource(EmptyAsset.INSTANCE, ArchivePaths.create(""beans.xml""))
+                .addAsManifestResource(""META-INF/services/javax.enterprise.inject.spi.Extension"", ""services/javax.enterprise.inject.spi.Extension"");
+
+        archive.delete(ArchivePaths.create(""META-INF/MANIFEST.MF""));
+
+        String ManifestMF = ""Manifest-Version: 1.0\n""
+                + ""Dependencies: org.jboss.narayana.txframework,org.jboss.xts\n"";
+
+        archive.setManifest(new StringAsset(ManifestMF));
+
+        return archive;
+    }
+
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @Before
+    public void setupTest() throws Exception {
+
+        uba = UserBusinessActivityFactory.userBusinessActivity();
+        client = new TestServiceClient();
+    }
+
+    @After
+    public void teardownTest() throws Exception {
+
+        client.resetHandlerFlags();
+        cancelIfActive(uba);
+    }
+
+    @Test
+    public void testSimple() throws Exception {
+
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
+        client.saveData(false);
+
+        Assert.assertEquals(true, client.wasTransactionLoggedHandlerInvoked());
+        Assert.assertEquals(true, client.wasTransactionConfirmedHandlerInvoked());
+        Assert.assertEquals(false, client.wasCompensationHandlerInvoked());
+
+    }
+
+
+
+    @Test
+    public void testClientDrivenCompensate() throws Exception {
+
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
+        uba.begin();
+        client.saveData(false);
+        uba.cancel();
+
+        Assert.assertEquals(true, client.wasTransactionLoggedHandlerInvoked());
+        Assert.assertEquals(false, client.wasTransactionConfirmedHandlerInvoked());
+        Assert.assertEquals(true, client.wasCompensationHandlerInvoked());
+    }
+
+
+    @Test
+    public void testRuntimeException() throws Exception {
+
+        try {
+            uba.begin();
+            client.saveData(true);
+            Assert.fail(""Exception should have been thrown by now"");
+        } catch (RuntimeException e) {
+            //Exception expected
+        } finally {
+            uba.cancel();
+        }
+
+        Assert.assertEquals(false, client.wasTransactionLoggedHandlerInvoked());
+        Assert.assertEquals(false, client.wasTransactionConfirmedHandlerInvoked());
+        Assert.assertEquals(false, client.wasCompensationHandlerInvoked());
+    }
+
+    public void cancelIfActive(UserBusinessActivity uba) {
+
+        try {
+            uba.cancel();
+        } catch (Throwable e) {
+            // do nothing, not active
+        }
+    }
+}",2013-05-25T08:04:33Z,114
"@@ -0,0 +1,48 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import org.jboss.narayana.compensations.api.CompensationScoped;
+
+import javax.inject.Named;
+import java.io.Serializable;
+
+/**
+ * @author paul.robinson@redhat.com 23/05/2013
+ */
+@Named(""State"")
+@CompensationScoped
+public class State implements Serializable {
+
+    private String value;
+
+    public String getValue() {
+
+        return value;
+    }
+
+    public void setValue(String value) {
+
+        this.value = value;
+    }
+}",2013-05-25T08:04:33Z,233
"@@ -0,0 +1,46 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import javax.ejb.Remote;
+import javax.jws.WebMethod;
+
+@Remote
+public interface TestService {
+
+    @WebMethod
+    public void saveData(Boolean throwException);
+
+    @WebMethod
+    public void resetHandlerFlags();
+
+    @WebMethod
+    public boolean wasCompensationHandlerInvoked();
+
+    @WebMethod
+    public boolean wasTransactionLoggedHandlerInvoked();
+
+    @WebMethod
+    public boolean wasTransactionConfirmedHandlerInvoked();
+
+}",2013-05-25T08:04:33Z,234
"@@ -0,0 +1,74 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import com.arjuna.mw.wst11.client.WSTXFeature;
+import org.jboss.narayana.compensations.api.Compensatable;
+import javax.xml.namespace.QName;
+import javax.xml.ws.Service;
+import java.net.URL;
+
+public class TestServiceClient implements TestService {
+
+    private TestService testService;
+
+    public TestServiceClient() throws Exception {
+
+        URL wsdlLocation = new URL(""http://localhost:8080/test/TestServiceService/TestService?wsdl"");
+        QName serviceName = new QName(""http://www.jboss.com/functional/compensations/distributed/"", ""TestServiceService"");
+        QName portName = new QName(""http://www.jboss.com/functional/compensations/distributed/"", ""TestServiceService"");
+
+        Service service = Service.create(wsdlLocation, serviceName);
+        testService = service.getPort(portName, TestService.class, new WSTXFeature());
+    }
+
+    @Override
+    @Compensatable
+    public void saveData(Boolean throwException) {
+        testService.saveData(throwException);
+    }
+
+    @Override
+    public void resetHandlerFlags() {
+        testService.resetHandlerFlags();
+    }
+
+    @Override
+    public boolean wasCompensationHandlerInvoked() {
+
+        return testService.wasCompensationHandlerInvoked();
+    }
+
+    @Override
+    public boolean wasTransactionLoggedHandlerInvoked() {
+
+        return testService.wasTransactionLoggedHandlerInvoked();
+    }
+
+    @Override
+    public boolean wasTransactionConfirmedHandlerInvoked() {
+
+        return testService.wasTransactionConfirmedHandlerInvoked();
+    }
+}
+",2013-05-25T08:04:33Z,235
"@@ -0,0 +1,90 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+package org.jboss.narayana.compensations.functional.distributed;
+
+import org.jboss.narayana.compensations.api.Compensatable;
+import org.jboss.narayana.compensations.api.TxCompensate;
+import org.jboss.narayana.compensations.api.TxConfirm;
+import org.jboss.narayana.compensations.api.TxLogged;
+import org.jboss.narayana.compensations.functional.common.DummyCompensationHandler1;
+import org.jboss.narayana.compensations.functional.common.DummyConfirmationHandler1;
+import org.jboss.narayana.compensations.functional.common.DummyTransactionLoggedHandler1;
+
+import javax.ejb.Stateless;
+import javax.inject.Inject;
+import javax.jws.WebMethod;
+import javax.jws.WebService;
+import javax.jws.soap.SOAPBinding;
+
+
+/**
+ * @author Paul Robinson (paul.robinson@redhat.com)
+ */
+@Stateless
+@WebService(serviceName = ""TestServiceService"", portName = ""TestServiceService"",
+        name = ""TestService"", targetNamespace = ""http://www.jboss.com/functional/compensations/distributed/"")
+@SOAPBinding(style = SOAPBinding.Style.RPC)
+public class TestServiceService implements TestService {
+
+    @Inject
+    private State state;
+
+
+    @Compensatable
+    @TxCompensate(DummyCompensationHandler1.class)
+    @TxConfirm(DummyConfirmationHandler1.class)
+    @TxLogged(DummyTransactionLoggedHandler1.class)
+    public void saveData(Boolean throwRuntimeException) {
+
+        if (throwRuntimeException) {
+            throw new RuntimeException(""Test instructed the service to throw a RuntimeException"");
+        }
+
+        state.setValue(""myValue"");
+    }
+
+    @WebMethod
+    public void resetHandlerFlags() {
+
+        DummyConfirmationHandler1.reset();
+        DummyTransactionLoggedHandler1.reset();
+        DummyCompensationHandler1.reset();
+    }
+
+    @Override
+    public boolean wasTransactionConfirmedHandlerInvoked() {
+
+        return DummyConfirmationHandler1.getCalled();
+    }
+
+    @Override
+    public boolean wasTransactionLoggedHandlerInvoked() {
+
+        return DummyTransactionLoggedHandler1.getCalled();
+    }
+
+    @Override
+    public boolean wasCompensationHandlerInvoked() {
+
+        return DummyCompensationHandler1.getCalled();
+    }
+}",2013-05-25T08:04:33Z,236
"@@ -174,6 +174,7 @@
         	  <doCheck>false</doCheck>
         	  <doUpdate>false</doUpdate>
         	  <scmBranchPropertyName>buildScmBranch</scmBranchPropertyName>
+            <revisionOnScmFailure>${project.version}-noscm</revisionOnScmFailure>
         	</configuration>
 	      </plugin>
             </plugins>",2013-07-11T14:39:04Z,237
"@@ -199,6 +199,7 @@
         	  <doCheck>false</doCheck>
         	  <doUpdate>false</doUpdate>
         	  <scmBranchPropertyName>buildScmBranch</scmBranchPropertyName>
+            <revisionOnScmFailure>${project.version}-noscm</revisionOnScmFailure>
         	</configuration>
 	      </plugin>
             </plugins>",2013-07-11T14:39:04Z,238
"@@ -187,6 +187,7 @@
         	  <doCheck>false</doCheck>
         	  <doUpdate>false</doUpdate>
         	  <scmBranchPropertyName>buildScmBranch</scmBranchPropertyName>
+            <revisionOnScmFailure>${project.version}-noscm</revisionOnScmFailure>
         	</configuration>
 	      </plugin>
             </plugins>",2013-07-11T14:39:04Z,69
"@@ -251,6 +251,7 @@
         	  <doCheck>false</doCheck>
         	  <doUpdate>false</doUpdate>
         	  <scmBranchPropertyName>buildScmBranch</scmBranchPropertyName>
+            <revisionOnScmFailure>${project.version}-noscm</revisionOnScmFailure>
         	</configuration>
 	      </plugin>
             </plugins>",2013-07-11T14:39:04Z,29
"@@ -270,6 +270,7 @@
         	  <doCheck>false</doCheck>
         	  <doUpdate>false</doUpdate>
         	  <scmBranchPropertyName>buildScmBranch</scmBranchPropertyName>
+            <revisionOnScmFailure>${project.version}-noscm</revisionOnScmFailure>
         	</configuration>
 	      </plugin>
             </plugins>",2013-07-11T14:39:04Z,30
"@@ -268,6 +268,7 @@
         	  <doCheck>false</doCheck>
         	  <doUpdate>false</doUpdate>
         	  <scmBranchPropertyName>buildScmBranch</scmBranchPropertyName>
+            <revisionOnScmFailure>${project.version}-noscm</revisionOnScmFailure>
         	</configuration>
 	      </plugin>
             </plugins>",2013-07-11T14:39:04Z,33
"@@ -20,7 +20,7 @@ cd ..\blacktie
 rmdir wildfly-%WILDFLY_MASTER_VERSION% /s /q
 unzip ..\jboss-as\dist\target\wildfly-%WILDFLY_MASTER_VERSION%.zip
 set JBOSS_HOME=%CD%\wildfly-%WILDFLY_MASTER_VERSION%\
-copy ..\rts\at\webservice\target\restat-web-%NARAYANA_CURRENT_VERSION%.war %JBOSS_HOME%\standalone\deployments\
+copy ..\rts\at\webservice\target\restat-web-5.0.0.M4-SNAPSHOT.war %JBOSS_HOME%\standalone\deployments\
 set WORKSPACE=%WORKSPACE%\blacktie 
 call scripts\hudson\blacktie-vc9x32.bat || (call:comment_on_pull ""BlackTie Failed %BUILD_URL%"" && exit -1)
 ",2013-07-23T12:53:11Z,147
"@@ -160,7 +160,7 @@ function blacktie {
   cd blacktie
   rm -rf $PWD/wildfly-${WILDFLY_MASTER_VERSION}
   unzip ../jboss-as/dist/target/wildfly-${WILDFLY_MASTER_VERSION}.zip
-  cp ../rts/at/webservice/target/restat-web-${NARAYANA_CURRENT_VERSION}.war $PWD/wildfly-${WILDFLY_MASTER_VERSION}/standalone/deployments/
+  cp ../rts/at/webservice/target/restat-web-5.0.0.M4-SNAPSHOT.war $PWD/wildfly-${WILDFLY_MASTER_VERSION}/standalone/deployments/
   WORKSPACE=$WORKSPACE/blacktie JBOSS_HOME=$PWD/wildfly-${WILDFLY_MASTER_VERSION} ./scripts/hudson/blacktie-linux.sh ""$@""
   [ $? = 0 ] || fatal ""BlackTie build failed""
   cd -
@@ -394,7 +394,6 @@ comment_on_pull ""Started testing this pull request: $BUILD_URL""
 
 [ -z ""${WORKSPACE}"" ] && fatal ""UNSET WORKSPACE""
 [ -z ""${WILDFLY_MASTER_VERSION}"" ] && fatal ""UNSET WILDFLY_MASTER_VERSION""
-[ -z ""${NARAYANA_CURRENT_VERSION}"" ] && fatal ""UNSET NARAYANA_CURRENT_VERSION""
 
 # FOR DEBUGGING SUBSEQUENT ISSUES
 free -m",2013-07-23T12:53:11Z,10
"@@ -41,8 +41,9 @@
 
 public class CompensationContext implements Context {
 
-    //TODO: garbage collect. Register a participant and remove at end?
-    private static final Map<TxContext, Map<String, Object>> localTXMap = new HashMap<TxContext, Map<String, Object>>();
+    private static final Map<TxContext, Map<String, Object>> beanStorePerTransaction = new HashMap<TxContext, Map<String, Object>>();
+
+    private static ThreadLocal<TxContext> txContextToExtend = new ThreadLocal<TxContext>();
 
     @Override
     public Class<? extends Annotation> getScope() {
@@ -82,13 +83,17 @@ public <T> T get(Contextual<T> contextual) {
     private Map getBeansForThisTransaction() {
 
         try {
-            BusinessActivityManager bam = BusinessActivityManagerFactory.businessActivityManager();
-            TxContext currentTX = bam.currentTransaction();
 
-            if (localTXMap.get(currentTX) == null) {
-                localTXMap.put(currentTX, new HashMap<String, Object>());
+            TxContext currentTX = txContextToExtend.get();
+            if (currentTX == null) {
+                BusinessActivityManager bam = BusinessActivityManagerFactory.businessActivityManager();
+                currentTX = bam.currentTransaction();
             }
-            return localTXMap.get(currentTX);
+
+            if (beanStorePerTransaction.get(currentTX) == null) {
+                beanStorePerTransaction.put(currentTX, new HashMap<String, Object>());
+            }
+            return beanStorePerTransaction.get(currentTX);
 
         } catch (SystemException e) {
             throw new CompensationTransactionRuntimeException(""Error looking up Transaction"", e);
@@ -97,6 +102,10 @@ private Map getBeansForThisTransaction() {
 
     public boolean isActive() {
 
+        if (txContextToExtend.get() != null) {
+            return true;
+        }
+
         try {
             BusinessActivityManager bam = BusinessActivityManagerFactory.businessActivityManager();
             TxContext currentTX = bam.currentTransaction();
@@ -105,5 +114,19 @@ public boolean isActive() {
             throw new CompensationTransactionRuntimeException(""Error looking up Transaction"", e);
         }
     }
+
+    public static void setTxContextToExtend(TxContext currentTX) {
+
+        txContextToExtend.set(currentTX);
+    }
+
+    /**
+     * Garbage collect the beans. Call when the context is closed and can't be used again.
+     *
+     * @param currentTX the Transaction Context associated with this context.
+     */
+    public static void close(TxContext currentTX) {
+        beanStorePerTransaction.remove(currentTX);
+    }
 }
 ",2013-08-02T12:16:51Z,118
"@@ -22,6 +22,7 @@
 
 package org.jboss.narayana.compensations.impl;
 
+import com.arjuna.mw.wst.TxContext;
 import com.arjuna.wst.BusinessAgreementWithParticipantCompletionParticipant;
 import com.arjuna.wst.FaultedException;
 import com.arjuna.wst.SystemException;
@@ -41,23 +42,25 @@
 public class Participant implements BusinessAgreementWithParticipantCompletionParticipant, ConfirmCompletedParticipant {
 
     private Class<? extends CompensationHandler> compensationHandler;
-
     private Class<? extends ConfirmationHandler> confirmationHandler;
-
     private Class<? extends TransactionLoggedHandler> transactionLoggedHandler;
 
     private BeanManager beanManager;
+    private ClassLoader applicationClassloader;
+    private TxContext currentTX;
 
     private Map txDataMapState;
 
-    public Participant(Class<? extends CompensationHandler> compensationHandlerClass, Class<? extends ConfirmationHandler> confirmationHandlerClass, Class<? extends TransactionLoggedHandler> transactionLoggedHandlerClass) {
+    public Participant(Class<? extends CompensationHandler> compensationHandlerClass, Class<? extends ConfirmationHandler> confirmationHandlerClass, Class<? extends TransactionLoggedHandler> transactionLoggedHandlerClass, TxContext currentTX) {
 
         this.compensationHandler = compensationHandlerClass;
         this.confirmationHandler = confirmationHandlerClass;
         this.transactionLoggedHandler = transactionLoggedHandlerClass;
+        this.currentTX = currentTX;
 
         beanManager = BeanManagerUtil.getBeanManager();
         txDataMapState = TXDataMapImpl.getState();
+        applicationClassloader = Thread.currentThread().getContextClassLoader();
     }
 
     private <T extends Object> T instantiate(Class<T> clazz) {
@@ -72,21 +75,35 @@ private <T extends Object> T instantiate(Class<T> clazz) {
     public void confirmCompleted(boolean confirmed) {
 
         if (transactionLoggedHandler != null) {
+
+            ClassLoader origClassLoader = Thread.currentThread().getContextClassLoader();
+            Thread.currentThread().setContextClassLoader(applicationClassloader);
+
             TXDataMapImpl.resume(txDataMapState);
             TransactionLoggedHandler handler = instantiate(transactionLoggedHandler);
             handler.transactionLogged(confirmed);
             TXDataMapImpl.suspend();
+
+            Thread.currentThread().setContextClassLoader(origClassLoader);
         }
     }
 
     @Override
     public void close() throws WrongStateException, SystemException {
 
         if (confirmationHandler != null) {
+
+            ClassLoader origClassLoader = Thread.currentThread().getContextClassLoader();
+            Thread.currentThread().setContextClassLoader(applicationClassloader);
+            CompensationContext.setTxContextToExtend(currentTX);
+
             TXDataMapImpl.resume(txDataMapState);
             ConfirmationHandler handler = instantiate(confirmationHandler);
             handler.confirm();
             TXDataMapImpl.suspend();
+
+            CompensationContext.close(currentTX);
+            Thread.currentThread().setContextClassLoader(origClassLoader);
         }
     }
 
@@ -100,10 +117,18 @@ public void compensate() throws FaultedException, WrongStateException, SystemExc
 
         try {
             if (compensationHandler != null) {
+
+                ClassLoader origClassLoader = Thread.currentThread().getContextClassLoader();
+                Thread.currentThread().setContextClassLoader(applicationClassloader);
+                CompensationContext.setTxContextToExtend(currentTX);
                 TXDataMapImpl.resume(txDataMapState);
+
                 CompensationHandler handler = instantiate(compensationHandler);
                 handler.compensate();
+
                 TXDataMapImpl.suspend();
+                CompensationContext.close(currentTX);
+                Thread.currentThread().setContextClassLoader(origClassLoader);
             }
         } catch (Exception e) {
             e.printStackTrace();",2013-08-02T12:16:51Z,119
"@@ -61,7 +61,7 @@ protected BAParticipantManager enlistParticipant(BusinessActivityManager bam, Me
         }
 
         Class<? extends CompensationHandler> compensationHandler = getCompensationHandler(method);
-        Participant compensationParticipant = new Participant(compensationHandler, null, null);
+        Participant compensationParticipant = new Participant(compensationHandler, null, null, bam.currentTransaction());
         return bam.enlistForBusinessAgreementWithParticipantCompletion(compensationParticipant, String.valueOf(UUID.randomUUID()));
     }
 ",2013-08-02T12:16:51Z,120
"@@ -61,7 +61,7 @@ protected BAParticipantManager enlistParticipant(BusinessActivityManager bam, Me
         }
 
         Class<? extends ConfirmationHandler> confirmationHandler = getConfirmationHandler(method);
-        Participant compensationParticipant = new Participant(null, confirmationHandler, null);
+        Participant compensationParticipant = new Participant(null, confirmationHandler, null, bam.currentTransaction());
         return bam.enlistForBusinessAgreementWithParticipantCompletion(compensationParticipant, String.valueOf(UUID.randomUUID()));
     }
 ",2013-08-02T12:16:51Z,121
"@@ -61,7 +61,7 @@ protected BAParticipantManager enlistParticipant(BusinessActivityManager bam, Me
         }
 
         Class<? extends TransactionLoggedHandler> transactionLogHandler = getTransactionLoggedHandler(method);
-        Participant compensationParticipant = new Participant(null, null, transactionLogHandler);
+        Participant compensationParticipant = new Participant(null, null, transactionLogHandler, bam.currentTransaction());
         return bam.enlistForBusinessAgreementWithParticipantCompletion(compensationParticipant, String.valueOf(UUID.randomUUID()));
     }
 ",2013-08-02T12:16:51Z,122
"@@ -20,50 +20,59 @@
  * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
  */
 
-package org.jboss.narayana.compensations.functional;
+package org.jboss.narayana.compensations.functional.compensationScoped;
 
 import com.arjuna.mw.wst.TxContext;
 import com.arjuna.mw.wst11.BusinessActivityManager;
 import com.arjuna.mw.wst11.BusinessActivityManagerFactory;
 import com.arjuna.mw.wst11.UserBusinessActivity;
 import com.arjuna.mw.wst11.UserBusinessActivityFactory;
-import junit.framework.Assert;
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
 import org.jboss.jbossts.xts.bytemanSupport.BMScript;
 import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
+import org.jboss.narayana.compensations.functional.common.DataCompensationHandler;
+import org.jboss.narayana.compensations.functional.common.DataConfirmationHandler;
+import org.jboss.narayana.compensations.functional.common.DataTxLoggedHandler;
 import org.jboss.narayana.compensations.functional.common.DummyData;
 import org.jboss.shrinkwrap.api.ArchivePaths;
 import org.jboss.shrinkwrap.api.ShrinkWrap;
 import org.jboss.shrinkwrap.api.asset.EmptyAsset;
 import org.jboss.shrinkwrap.api.asset.StringAsset;
 import org.jboss.shrinkwrap.api.spec.JavaArchive;
-import org.junit.After;
 import org.junit.AfterClass;
+import org.junit.Assert;
+import org.junit.Before;
 import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
 import javax.enterprise.context.ContextNotActiveException;
 import javax.inject.Inject;
 
+
 /**
  * @author paul.robinson@redhat.com 22/03/2013
  */
 @RunWith(Arquillian.class)
 public class CompensationScopedTest {
 
+    @Inject
+    Service service;
+
     @Inject
     DummyData dummyData;
 
     UserBusinessActivity uba = UserBusinessActivityFactory.userBusinessActivity();
     BusinessActivityManager bam = BusinessActivityManagerFactory.businessActivityManager();
 
+
     @Deployment
     public static JavaArchive createTestArchive() {
 
         JavaArchive archive = ShrinkWrap.create(JavaArchive.class, ""test.jar"")
                 .addPackages(true, ""org.jboss.narayana.compensations.functional"")
+                .addClass(ParticipantCompletionCoordinatorRules.class)
                 .addAsManifestResource(EmptyAsset.INSTANCE, ""beans.xml"")
                 .addAsManifestResource(""META-INF/services/javax.enterprise.inject.spi.Extension"", ""services/javax.enterprise.inject.spi.Extension"");
 
@@ -77,14 +86,30 @@ public static JavaArchive createTestArchive() {
         return archive;
     }
 
-    @After
-    public void tearDown() {
 
-        try {
-            uba.close();
-        } catch (Exception e) {
-            // do nothing
-        }
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+
+    @Before
+    public void resetParticipants() {
+
+        DataConfirmationHandler.reset();
+        DataCompensationHandler.reset();
+        DataTxLoggedHandler.reset();
+
+        MyCompensationHandler.dataAvailable = false;
+        MyConfirmationHandler.dataAvailable = false;
+        MyTransactionLoggedHandler.dataAvailable = false;
     }
 
     @Test
@@ -160,4 +185,41 @@ private void assertContextUnavailable() {
     }
 
 
-}
\ No newline at end of file
+    @Test
+    public void testCompensationHandler() throws Exception {
+
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
+        MyCompensationHandler.expectedData = ""blah"";
+        MyConfirmationHandler.expectedData = ""blah"";
+        MyTransactionLoggedHandler.expectedData = ""blah"";
+
+        uba.begin();
+        service.doWork(""blah"");
+        uba.cancel();
+
+        Assert.assertEquals(true, MyCompensationHandler.dataAvailable);
+        Assert.assertEquals(false, MyConfirmationHandler.dataAvailable);
+        Assert.assertEquals(true, MyTransactionLoggedHandler.dataAvailable);
+    }
+
+
+    @Test
+    public void testConfirmationHandler() throws Exception {
+
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
+        MyCompensationHandler.expectedData = ""blah"";
+        MyConfirmationHandler.expectedData = ""blah"";
+        MyTransactionLoggedHandler.expectedData = ""blah"";
+
+        uba.begin();
+        service.doWork(""blah"");
+        uba.close();
+
+        Assert.assertEquals(false, MyCompensationHandler.dataAvailable);
+        Assert.assertEquals(true, MyConfirmationHandler.dataAvailable);
+        Assert.assertEquals(true, MyTransactionLoggedHandler.dataAvailable);
+    }
+
+}",2013-08-02T12:16:51Z,123
"@@ -0,0 +1,48 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.compensationScoped;
+
+import org.jboss.narayana.compensations.api.CompensationScoped;
+
+import javax.inject.Named;
+import java.io.Serializable;
+
+/**
+ * @author paul.robinson@redhat.com 29/07/2013
+ */
+@CompensationScoped
+@Named
+public class DataPojo implements Serializable {
+
+    private String data;
+
+    public String getData() {
+
+        return data;
+    }
+
+    public void setData(String data) {
+
+        this.data = data;
+    }
+}",2013-08-02T12:16:51Z,124
"@@ -0,0 +1,48 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.compensationScoped;
+
+import org.jboss.narayana.compensations.api.CompensationHandler;
+
+import javax.inject.Inject;
+
+/**
+ * @author paul.robinson@redhat.com 29/07/2013
+ */
+public class MyCompensationHandler implements CompensationHandler {
+
+    @Inject
+    DataPojo myData;
+
+    public static boolean dataAvailable = false;
+
+    public static String expectedData;
+
+    @Override
+    public void compensate() {
+
+        if (myData != null && myData.getData() != null && myData.getData().equals(expectedData)) {
+            dataAvailable = true;
+        }
+    }
+}",2013-08-02T12:16:51Z,125
"@@ -0,0 +1,49 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.compensationScoped;
+
+import org.jboss.narayana.compensations.api.CompensationHandler;
+import org.jboss.narayana.compensations.api.ConfirmationHandler;
+
+import javax.inject.Inject;
+
+/**
+ * @author paul.robinson@redhat.com 29/07/2013
+ */
+public class MyConfirmationHandler implements ConfirmationHandler {
+
+    @Inject
+    DataPojo myData;
+
+    public static boolean dataAvailable = false;
+
+    public static String expectedData;
+
+    @Override
+    public void confirm() {
+
+        if (myData != null && myData.getData() != null && myData.getData().equals(expectedData)) {
+            dataAvailable = true;
+        }
+    }
+}",2013-08-02T12:16:51Z,126
"@@ -0,0 +1,49 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.compensationScoped;
+
+import org.jboss.narayana.compensations.api.ConfirmationHandler;
+import org.jboss.narayana.compensations.api.TransactionLoggedHandler;
+
+import javax.inject.Inject;
+
+/**
+ * @author paul.robinson@redhat.com 29/07/2013
+ */
+public class MyTransactionLoggedHandler implements TransactionLoggedHandler {
+
+    @Inject
+    DataPojo myData;
+
+    public static boolean dataAvailable = false;
+
+    public static String expectedData;
+
+    @Override
+    public void transactionLogged(boolean success) {
+
+        if (myData != null && myData.getData() != null && myData.getData().equals(expectedData)) {
+            dataAvailable = true;
+        }
+    }
+}",2013-08-02T12:16:51Z,127
"@@ -0,0 +1,53 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.compensationScoped;
+
+import org.jboss.narayana.compensations.api.Compensatable;
+import org.jboss.narayana.compensations.api.TxCompensate;
+import org.jboss.narayana.compensations.api.TxConfirm;
+import org.jboss.narayana.compensations.api.TxLogged;
+import org.jboss.narayana.compensations.functional.common.DataCompensationHandler;
+import org.jboss.narayana.compensations.functional.common.DataConfirmationHandler;
+import org.jboss.narayana.compensations.functional.common.DataTxLoggedHandler;
+import org.jboss.narayana.compensations.functional.common.MyRuntimeException;
+import org.jboss.narayana.txframework.api.management.TXDataMap;
+
+import javax.inject.Inject;
+
+/**
+ * @author paul.robinson@redhat.com 24/04/2013
+ */
+public class Service {
+
+    @Inject
+    DataPojo myData;
+
+    @Compensatable
+    @TxCompensate(MyCompensationHandler.class)
+    @TxLogged(MyTransactionLoggedHandler.class)
+    @TxConfirm(MyConfirmationHandler.class)
+    public void doWork(String setValue) throws MyRuntimeException {
+        myData.setData(setValue);
+    }
+
+}",2013-08-02T12:16:51Z,128
"@@ -39,8 +39,10 @@
         <configuration>
             <property name=""serverConfig"">standalone-xts.xml</property>
             <property name=""javaVmArguments"">${server.jvm.args}</property>
+            <property name=""javaVmArguments"">-Xmx512m -XX:MaxPermSize=128m
+                            -Xrunjdwp:transport=dt_socket,address=8787,server=y,suspend=n ${server.jvm.args}</property>
             <property name=""managementAddress"">${node.address}</property>
         </configuration>
     </container>
 
-</arquillian>
\ No newline at end of file
+</arquillian>",2013-08-02T12:16:51Z,129
"@@ -67,50 +67,64 @@ public boolean commit_state(Uid objUid, String typeName)
 			typeName = typeName.substring(1);
 
 		boolean result = false;
-
+		PreparedStatement pstmt = null;
+		PreparedStatement pstmt2 = null;
 		try {
 			// Delete any previously committed state
-			{
-				PreparedStatement pstmt = connection
-						.get()
-						.prepareStatement(
-								""DELETE FROM ""
-										+ tableName
-										+ "" WHERE UidString = ? AND TypeName = ? AND StateType = ?"");
+			pstmt = connection
+					.get()
+					.prepareStatement(
+							""DELETE FROM ""
+									+ tableName
+									+ "" WHERE UidString = ? AND TypeName = ? AND StateType = ?"");
 
-				pstmt.setString(1, objUid.stringForm());
-				pstmt.setString(2, typeName);
-				pstmt.setInt(3, 1);
+			pstmt.setString(1, objUid.stringForm());
+			pstmt.setString(2, typeName);
+			pstmt.setInt(3, 1);
 
-				int rowcount = pstmt.executeUpdate();
-				if (rowcount > 0) {
-					tsLogger.i18NLogger
-							.trace_JDBCImple_previouslycommitteddeleted(rowcount);
-				}
+			int rowcount = pstmt.executeUpdate();
+			if (rowcount > 0) {
+				tsLogger.i18NLogger
+						.trace_JDBCImple_previouslycommitteddeleted(rowcount);
 			}
+
 			// now do the commit itself:
-			{
-				PreparedStatement pstmt = connection
-						.get()
-						.prepareStatement(
-								""UPDATE ""
-										+ tableName
-										+ "" SET StateType = 1 WHERE UidString = ? AND TypeName = ? AND StateType = ""
-										+ StateStatus.OS_UNCOMMITTED);
+			pstmt2 = connection
+					.get()
+					.prepareStatement(
+							""UPDATE ""
+									+ tableName
+									+ "" SET StateType = 1 WHERE UidString = ? AND TypeName = ? AND StateType = ""
+									+ StateStatus.OS_UNCOMMITTED);
 
-				pstmt.setString(1, objUid.stringForm());
-				pstmt.setString(2, typeName);
+			pstmt2.setString(1, objUid.stringForm());
+			pstmt2.setString(2, typeName);
 
-				int rowcount = pstmt.executeUpdate();
-				if (rowcount > 0) {
-					result = true;
-					connection.get().commit();
-				} else {
-					connection.get().rollback();
-				}
+			int rowcount2 = pstmt2.executeUpdate();
+			if (rowcount2 > 0) {
+				result = true;
+				connection.get().commit();
+			} else {
+				connection.get().rollback();
 			}
+
 		} catch (SQLException e) {
 			tsLogger.i18NLogger.warn_objectstore_JDBCImple_writefailed(e);
+		} finally {
+			if (pstmt != null) {
+				try {
+					pstmt.close();
+				} catch (SQLException e) {
+					// Ignore
+				}
+			}
+			if (pstmt2 != null) {
+				try {
+					pstmt2.close();
+				} catch (SQLException e) {
+					// Ignore
+				}
+			}
 		}
 
 		return result;
@@ -123,8 +137,9 @@ public boolean hide_state(Uid objUid, String typeName)
 			typeName = typeName.substring(1);
 		boolean result = false;
 
+		PreparedStatement pstmt = null;
 		try {
-			PreparedStatement pstmt = connection
+			pstmt = connection
 					.get()
 					.prepareStatement(
 							""UPDATE ""
@@ -141,6 +156,14 @@ public boolean hide_state(Uid objUid, String typeName)
 			connection.get().commit();
 		} catch (SQLException e) {
 			tsLogger.i18NLogger.warn_objectstore_JDBCImple_1(e);
+		} finally {
+			if (pstmt != null) {
+				try {
+					pstmt.close();
+				} catch (SQLException e) {
+					// Ignore
+				}
+			}
 		}
 
 		return result;
@@ -153,8 +176,9 @@ public boolean reveal_state(Uid objUid, String typeName)
 			typeName = typeName.substring(1);
 		boolean result = false;
 
+		PreparedStatement pstmt = null;
 		try {
-			PreparedStatement pstmt = connection
+			pstmt = connection
 					.get()
 					.prepareStatement(
 							""UPDATE ""
@@ -171,6 +195,14 @@ public boolean reveal_state(Uid objUid, String typeName)
 			connection.get().commit();
 		} catch (SQLException e) {
 			tsLogger.i18NLogger.warn_objectstore_JDBCImple_2(e);
+		} finally {
+			if (pstmt != null) {
+				try {
+					pstmt.close();
+				} catch (SQLException e) {
+					// Ignore
+				}
+			}
 		}
 
 		return result;
@@ -189,9 +221,9 @@ public int currentState(Uid objUid, String typeName)
 		int theState = StateStatus.OS_UNKNOWN;
 		ResultSet rs = null;
 
+		PreparedStatement pstmt = null;
 		try {
-
-			PreparedStatement pstmt = connection.get().prepareStatement(
+			pstmt = connection.get().prepareStatement(
 					""SELECT StateType, Hidden FROM "" + tableName
 							+ "" WHERE UidString = ? AND TypeName = ?"");
 
@@ -247,6 +279,21 @@ public int currentState(Uid objUid, String typeName)
 		} catch (SQLException e) {
 			tsLogger.i18NLogger.warn_objectstore_JDBCImple_3(e);
 			theState = StateStatus.OS_UNKNOWN;
+		} finally {
+			if (rs != null) {
+				try {
+					rs.close();
+				} catch (SQLException e) {
+					// ignore
+				}
+			}
+			if (pstmt != null) {
+				try {
+					pstmt.close();
+				} catch (SQLException e) {
+					// Ignore
+				}
+			}
 		}
 
 		return theState;
@@ -379,9 +426,9 @@ public boolean remove_state(Uid objUid, String typeName, int stateType)
 			if ((stateType == StateStatus.OS_COMMITTED)
 					|| (stateType == StateStatus.OS_UNCOMMITTED)) {
 
+				PreparedStatement pstmt = null;
 				try {
-
-					PreparedStatement pstmt = connection
+					pstmt = connection
 							.get()
 							.prepareStatement(
 									""DELETE FROM ""
@@ -399,6 +446,14 @@ public boolean remove_state(Uid objUid, String typeName, int stateType)
 					connection.get().commit();
 				} catch (SQLException e) {
 					tsLogger.i18NLogger.warn_objectstore_JDBCImple_8(e);
+				} finally {
+					if (pstmt != null) {
+						try {
+							pstmt.close();
+						} catch (SQLException e) {
+							// Ignore
+						}
+					}
 				}
 			} else {
 				// can only remove (UN)COMMITTED objs
@@ -423,8 +478,9 @@ public InputObjectState read_state(Uid objUid, String typeName,
 				|| (stateType == StateStatus.OS_UNCOMMITTED)) {
 			ResultSet rs = null;
 
+			PreparedStatement pstmt = null;
 			try {
-				PreparedStatement pstmt = connection
+				pstmt = connection
 						.get()
 						.prepareStatement(
 								""SELECT ObjectState FROM ""
@@ -451,12 +507,20 @@ public InputObjectState read_state(Uid objUid, String typeName,
 			} catch (SQLException e) {
 				tsLogger.i18NLogger.warn_objectstore_JDBCImple_14(e);
 			} finally {
-				if (rs != null)
+				if (rs != null) {
 					try {
 						rs.close();
 					} catch (SQLException e) {
 						// Ignore
 					}
+				}
+				if (pstmt != null) {
+					try {
+						pstmt.close();
+					} catch (SQLException e) {
+						// Ignore
+					}
+				}
 			}
 		}
 
@@ -479,8 +543,10 @@ public boolean write_state(Uid objUid, String typeName,
 			byte[] b = state.buffer();
 			ResultSet rs = null;
 
+			PreparedStatement pstmt = null;
+			PreparedStatement pstmt2 = null;
 			try {
-				PreparedStatement pstmt = connection
+				pstmt = connection
 						.get()
 						.prepareStatement(
 								""SELECT ObjectState, UidString, StateType, TypeName FROM ""
@@ -501,7 +567,7 @@ public boolean write_state(Uid objUid, String typeName,
 				} else {
 					connection.get().commit();
 					// not in database, do insert:
-					PreparedStatement pstmt2 = connection
+					pstmt2 = connection
 							.get()
 							.prepareStatement(
 									""INSERT INTO ""
@@ -521,12 +587,27 @@ public boolean write_state(Uid objUid, String typeName,
 			} catch (SQLException e) {
 				tsLogger.i18NLogger.warn_objectstore_JDBCImple_writefailed(e);
 			} finally {
-				if (rs != null)
+				if (rs != null) {
 					try {
 						rs.close();
 					} catch (SQLException e) {
 						// Ignore
 					}
+				}
+				if (pstmt != null) {
+					try {
+						pstmt.close();
+					} catch (SQLException e) {
+						// Ignore
+					}
+				}
+				if (pstmt2 != null) {
+					try {
+						pstmt2.close();
+					} catch (SQLException e) {
+						// Ignore
+					}
+				}
 			}
 
 		}
@@ -575,6 +656,8 @@ protected Connection initialValue() {
 			}
 		}
 
+		stmt.close();
+
 		// This can be the case when triggering via EmptyObjectStore
 		if (!connection.get().getAutoCommit()) {
 			connection.get().commit();",2013-01-11T11:49:38Z,59
"@@ -394,7 +394,7 @@
     <jvm.args.other>-server</jvm.args.other>
     
     <!-- External dependencies versions -->
-    <jboss-as.version>8.0.0.Alpha2-SNAPSHOT</jboss-as.version>    
+    <jboss-as.version>8.0.0.Alpha3-SNAPSHOT</jboss-as.version>    
     <version.org.jboss.jbossas>1.0.4.Final</version.org.jboss.jbossas>
     <version.org.jboss>7.0.0.Final</version.org.jboss>
     <version.org.jboss.logmanager>1.4.1.Final</version.org.jboss.logmanager>",2013-07-15T10:42:32Z,39
"@@ -394,7 +394,7 @@
     <jvm.args.other>-server</jvm.args.other>
     
     <!-- External dependencies versions -->
-    <jboss-as.version>8.0.0.Alpha2-SNAPSHOT</jboss-as.version>    
+    <jboss-as.version>8.0.0.Alpha3-SNAPSHOT</jboss-as.version>    
     <version.org.jboss.jbossas>1.0.4.Final</version.org.jboss.jbossas>
     <version.org.jboss>7.0.0.Final</version.org.jboss>
     <version.org.jboss.logmanager>1.4.1.Final</version.org.jboss.logmanager>",2013-07-15T10:42:32Z,239
"@@ -402,6 +402,7 @@ public Response terminateTransaction(@PathParam(""TxId"")String txId, @QueryParam(
 
         Transaction tx = getTransaction(txId);
         String how = TxSupport.getStringValue(content, TxStatusMediaType.STATUS_PROPERTY);
+        TxStatus currentStatus = tx.getTxStatus();
         String status;
         int scRes;
 
@@ -410,7 +411,7 @@ public Response terminateTransaction(@PathParam(""TxId"")String txId, @QueryParam(
          * 276records information about transactions that have rolled back, (not necessary for presumed
          * 277rollback semantics) but at a minimum MUST return 404.
          */
-        if (!tx.isRunning())
+        if (!currentStatus.isRunning() && !currentStatus.isRollbackOnly())
             return Response.status(HttpURLConnection.HTTP_PRECON_FAILED).build();
 
 		/*",2013-06-08T18:32:11Z,240
"@@ -217,6 +217,58 @@ public void testRollback() throws Exception {
         }
     }
 
+    @Test
+    public void testRollbackOnly() throws Exception {
+        TxSupport txn = new TxSupport();
+
+        txn.startTx();
+
+        Assert.assertEquals(TxStatusMediaType.TX_ROLLBACK_ONLY, txn.markTxRollbackOnly());
+        Assert.assertEquals(TxStatusMediaType.TX_ROLLEDBACK, txn.rollbackTx());
+
+        /*
+        296... Upon termination, the resource and all associated
+        297resources are implicitly deleted. For any subsequent PUT invocation, such as due to a
+        298timeout/retry, then an implementation MAY return 410 if the implementation records information
+        299about transactions that have rolled back, (not necessary for presumed rollback semantics) but at
+        300a minimum MUST return 404. The invoker can assume this was a rollback.
+        */
+        try {
+            txn.rollbackTx();
+        } catch (HttpResponseException e) {
+            Assert.assertTrue(e.getActualResponse() == HttpURLConnection.HTTP_GONE ||
+                    e.getActualResponse() == HttpURLConnection.HTTP_NOT_FOUND);
+        }
+    }
+
+    @Test
+    public void testRollbackOnlyWithCommit() throws Exception {
+        TxSupport txn = new TxSupport();
+
+        txn.startTx();
+
+        Assert.assertEquals(TxStatusMediaType.TX_ROLLBACK_ONLY, txn.markTxRollbackOnly());
+
+        /*
+         * committing a transaction marked rollback only should automatically abort the transaction
+         */
+        Assert.assertEquals(TxStatusMediaType.TX_ROLLEDBACK, txn.commitTx());
+
+        /*
+        296... Upon termination, the resource and all associated
+        297resources are implicitly deleted. For any subsequent PUT invocation, such as due to a
+        298timeout/retry, then an implementation MAY return 410 if the implementation records information
+        299about transactions that have rolled back, (not necessary for presumed rollback semantics) but at
+        300a minimum MUST return 404. The invoker can assume this was a rollback.
+        */
+        try {
+            txn.rollbackTx();
+        } catch (HttpResponseException e) {
+            Assert.assertTrue(e.getActualResponse() == HttpURLConnection.HTTP_GONE ||
+                    e.getActualResponse() == HttpURLConnection.HTTP_NOT_FOUND);
+        }
+    }
+
     @Test
     public void testEnlistResource() throws Exception {
         TxSupport txn = new TxSupport();",2013-06-08T18:32:11Z,241
"@@ -84,6 +84,10 @@ public boolean isReadOnly() {
         return this.equals(TxStatus.TransactionReadOnly);
     }
 
+    public boolean isRollbackOnly() {
+        return this.equals(TxStatus.TransactionRollbackOnly);
+    }
+
     public boolean isRunning() {
         return this.equals(TransactionActive);
     }",2013-06-08T18:32:11Z,242
"@@ -24,6 +24,7 @@ public class TxStatusMediaType extends TxMediaType{
     public static final String TX_PREPARED = toMediaType(TxStatus.TransactionPrepared);
     public static final String TX_COMMITTED = toMediaType(TxStatus.TransactionCommitted);
     public static final String TX_ROLLEDBACK = toMediaType(TxStatus.TransactionRolledBack);
+    public static final String TX_ROLLBACK_ONLY = toMediaType(TxStatus.TransactionRollbackOnly);
     public static final String TX_COMMITTED_ONE_PHASE = toMediaType(TxStatus.TransactionCommittedOnePhase);
     public static final String TX_H_MIXED = toMediaType(TxStatus.TransactionHeuristicMixed);
     public static final String TX_H_ROLLBACK = toMediaType(TxStatus.TransactionHeuristicRollback);",2013-06-08T18:32:11Z,243
"@@ -180,6 +180,10 @@ public String rollbackTx() throws HttpResponseException {
         return httpRequest(new int[] {HttpURLConnection.HTTP_OK}, links.get(TxLinkNames.TERMINATOR), ""PUT"",
                 TxMediaType.TX_STATUS_MEDIA_TYPE, TxStatusMediaType.TX_ROLLEDBACK, null);
     }
+    public String markTxRollbackOnly() throws HttpResponseException {
+        return httpRequest(new int[] {HttpURLConnection.HTTP_OK}, links.get(TxLinkNames.TERMINATOR), ""PUT"",
+                TxMediaType.TX_STATUS_MEDIA_TYPE, TxStatusMediaType.TX_ROLLBACK_ONLY, null);
+    }
 
     /**
      * Get the status of the current transacton",2013-06-08T18:32:11Z,244
"@@ -87,8 +87,10 @@ function init_jboss_home {
 
 function xts_as_tests {
   echo ""#-1. XTS AS Integration Test""
-  mvn -f ${WORKSPACE}/jboss-as/testsuite/integration/xts/pom.xml -Pxts.integration.tests.profile ""$@"" test
+  cd ${WORKSPACE}/jboss-as
+  ./build.sh -f ./testsuite/integration/xts/pom.xml -Pxts.integration.tests.profile ""$@"" test
   [ $? = 0 ] || fatal ""XTS AS Integration Test failed""
+  cd ${WORKSPACE}
 }
 
 function txframework_tests {",2012-10-04T10:25:32Z,10
"@@ -0,0 +1,48 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.compensationScoped;
+
+import org.jboss.narayana.compensations.api.CompensationScoped;
+
+import javax.inject.Named;
+import java.io.Serializable;
+
+/**
+ * @author paul.robinson@redhat.com 23/04/2013
+ */
+@Named(""DummyData"")
+@CompensationScoped
+public class DummyData implements Serializable {
+
+    private String value = """";
+
+    public void setValue(String value) {
+
+        this.value = value;
+    }
+
+    public String getValue() {
+
+        return value;
+    }
+}",2013-05-25T08:04:33Z,232
"@@ -0,0 +1,164 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import com.arjuna.mw.wst11.UserBusinessActivity;
+import com.arjuna.mw.wst11.UserBusinessActivityFactory;
+import com.arjuna.wst.TransactionRolledBackException;
+import junit.framework.Assert;
+import org.jboss.arquillian.container.test.api.Deployment;
+import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
+import org.jboss.narayana.compensations.functional.common.DummyCompensationHandler1;
+import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Close;
+import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Compensate;
+import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.ConfirmCompleted;
+import org.jboss.narayana.txframework.functional.common.EventLog;
+import org.jboss.narayana.txframework.functional.common.ServiceCommand;
+import org.jboss.narayana.txframework.functional.common.SomeApplicationException;
+import org.jboss.shrinkwrap.api.ArchivePaths;
+import org.jboss.shrinkwrap.api.ShrinkWrap;
+import org.jboss.shrinkwrap.api.asset.EmptyAsset;
+import org.jboss.shrinkwrap.api.asset.StringAsset;
+import org.jboss.shrinkwrap.api.spec.JavaArchive;
+import org.junit.After;
+import org.junit.AfterClass;
+import org.junit.Before;
+import org.junit.BeforeClass;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+
+import java.lang.annotation.Annotation;
+import java.util.Arrays;
+import java.util.List;
+
+@RunWith(Arquillian.class)
+public class DistributedTest {
+
+    UserBusinessActivity uba;
+    TestService client;
+
+    @Deployment()
+    public static JavaArchive createTestArchive() {
+        JavaArchive archive = ShrinkWrap.create(JavaArchive.class, ""test.jar"")
+                .addPackages(false, DistributedTest.class.getPackage())
+                .addPackage(DummyCompensationHandler1.class.getPackage())
+                .addClass(ParticipantCompletionCoordinatorRules.class)
+                .addAsManifestResource(EmptyAsset.INSTANCE, ArchivePaths.create(""beans.xml""))
+                .addAsManifestResource(""META-INF/services/javax.enterprise.inject.spi.Extension"", ""services/javax.enterprise.inject.spi.Extension"");
+
+        archive.delete(ArchivePaths.create(""META-INF/MANIFEST.MF""));
+
+        String ManifestMF = ""Manifest-Version: 1.0\n""
+                + ""Dependencies: org.jboss.narayana.txframework,org.jboss.xts\n"";
+
+        archive.setManifest(new StringAsset(ManifestMF));
+
+        return archive;
+    }
+
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @Before
+    public void setupTest() throws Exception {
+
+        uba = UserBusinessActivityFactory.userBusinessActivity();
+        client = new TestServiceClient();
+    }
+
+    @After
+    public void teardownTest() throws Exception {
+
+        client.resetHandlerFlags();
+        cancelIfActive(uba);
+    }
+
+    @Test
+    public void testSimple() throws Exception {
+
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
+        client.saveData(false);
+
+        Assert.assertEquals(true, client.wasTransactionLoggedHandlerInvoked());
+        Assert.assertEquals(true, client.wasTransactionConfirmedHandlerInvoked());
+        Assert.assertEquals(false, client.wasCompensationHandlerInvoked());
+
+    }
+
+
+
+    @Test
+    public void testClientDrivenCompensate() throws Exception {
+
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
+        uba.begin();
+        client.saveData(false);
+        uba.cancel();
+
+        Assert.assertEquals(true, client.wasTransactionLoggedHandlerInvoked());
+        Assert.assertEquals(false, client.wasTransactionConfirmedHandlerInvoked());
+        Assert.assertEquals(true, client.wasCompensationHandlerInvoked());
+    }
+
+
+    @Test
+    public void testRuntimeException() throws Exception {
+
+        try {
+            uba.begin();
+            client.saveData(true);
+            Assert.fail(""Exception should have been thrown by now"");
+        } catch (RuntimeException e) {
+            //Exception expected
+        } finally {
+            uba.cancel();
+        }
+
+        Assert.assertEquals(false, client.wasTransactionLoggedHandlerInvoked());
+        Assert.assertEquals(false, client.wasTransactionConfirmedHandlerInvoked());
+        Assert.assertEquals(false, client.wasCompensationHandlerInvoked());
+    }
+
+    public void cancelIfActive(UserBusinessActivity uba) {
+
+        try {
+            uba.cancel();
+        } catch (Throwable e) {
+            // do nothing, not active
+        }
+    }
+}",2013-05-25T08:04:33Z,114
"@@ -0,0 +1,48 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import org.jboss.narayana.compensations.api.CompensationScoped;
+
+import javax.inject.Named;
+import java.io.Serializable;
+
+/**
+ * @author paul.robinson@redhat.com 23/05/2013
+ */
+@Named(""State"")
+@CompensationScoped
+public class State implements Serializable {
+
+    private String value;
+
+    public String getValue() {
+
+        return value;
+    }
+
+    public void setValue(String value) {
+
+        this.value = value;
+    }
+}",2013-05-25T08:04:33Z,233
"@@ -0,0 +1,46 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import javax.ejb.Remote;
+import javax.jws.WebMethod;
+
+@Remote
+public interface TestService {
+
+    @WebMethod
+    public void saveData(Boolean throwException);
+
+    @WebMethod
+    public void resetHandlerFlags();
+
+    @WebMethod
+    public boolean wasCompensationHandlerInvoked();
+
+    @WebMethod
+    public boolean wasTransactionLoggedHandlerInvoked();
+
+    @WebMethod
+    public boolean wasTransactionConfirmedHandlerInvoked();
+
+}",2013-05-25T08:04:33Z,234
"@@ -0,0 +1,74 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import com.arjuna.mw.wst11.client.WSTXFeature;
+import org.jboss.narayana.compensations.api.Compensatable;
+import javax.xml.namespace.QName;
+import javax.xml.ws.Service;
+import java.net.URL;
+
+public class TestServiceClient implements TestService {
+
+    private TestService testService;
+
+    public TestServiceClient() throws Exception {
+
+        URL wsdlLocation = new URL(""http://localhost:8080/test/TestServiceService/TestService?wsdl"");
+        QName serviceName = new QName(""http://www.jboss.com/functional/compensations/distributed/"", ""TestServiceService"");
+        QName portName = new QName(""http://www.jboss.com/functional/compensations/distributed/"", ""TestServiceService"");
+
+        Service service = Service.create(wsdlLocation, serviceName);
+        testService = service.getPort(portName, TestService.class, new WSTXFeature());
+    }
+
+    @Override
+    @Compensatable
+    public void saveData(Boolean throwException) {
+        testService.saveData(throwException);
+    }
+
+    @Override
+    public void resetHandlerFlags() {
+        testService.resetHandlerFlags();
+    }
+
+    @Override
+    public boolean wasCompensationHandlerInvoked() {
+
+        return testService.wasCompensationHandlerInvoked();
+    }
+
+    @Override
+    public boolean wasTransactionLoggedHandlerInvoked() {
+
+        return testService.wasTransactionLoggedHandlerInvoked();
+    }
+
+    @Override
+    public boolean wasTransactionConfirmedHandlerInvoked() {
+
+        return testService.wasTransactionConfirmedHandlerInvoked();
+    }
+}
+",2013-05-25T08:04:33Z,235
"@@ -0,0 +1,90 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+package org.jboss.narayana.compensations.functional.distributed;
+
+import org.jboss.narayana.compensations.api.Compensatable;
+import org.jboss.narayana.compensations.api.TxCompensate;
+import org.jboss.narayana.compensations.api.TxConfirm;
+import org.jboss.narayana.compensations.api.TxLogged;
+import org.jboss.narayana.compensations.functional.common.DummyCompensationHandler1;
+import org.jboss.narayana.compensations.functional.common.DummyConfirmationHandler1;
+import org.jboss.narayana.compensations.functional.common.DummyTransactionLoggedHandler1;
+
+import javax.ejb.Stateless;
+import javax.inject.Inject;
+import javax.jws.WebMethod;
+import javax.jws.WebService;
+import javax.jws.soap.SOAPBinding;
+
+
+/**
+ * @author Paul Robinson (paul.robinson@redhat.com)
+ */
+@Stateless
+@WebService(serviceName = ""TestServiceService"", portName = ""TestServiceService"",
+        name = ""TestService"", targetNamespace = ""http://www.jboss.com/functional/compensations/distributed/"")
+@SOAPBinding(style = SOAPBinding.Style.RPC)
+public class TestServiceService implements TestService {
+
+    @Inject
+    private State state;
+
+
+    @Compensatable
+    @TxCompensate(DummyCompensationHandler1.class)
+    @TxConfirm(DummyConfirmationHandler1.class)
+    @TxLogged(DummyTransactionLoggedHandler1.class)
+    public void saveData(Boolean throwRuntimeException) {
+
+        if (throwRuntimeException) {
+            throw new RuntimeException(""Test instructed the service to throw a RuntimeException"");
+        }
+
+        state.setValue(""myValue"");
+    }
+
+    @WebMethod
+    public void resetHandlerFlags() {
+
+        DummyConfirmationHandler1.reset();
+        DummyTransactionLoggedHandler1.reset();
+        DummyCompensationHandler1.reset();
+    }
+
+    @Override
+    public boolean wasTransactionConfirmedHandlerInvoked() {
+
+        return DummyConfirmationHandler1.getCalled();
+    }
+
+    @Override
+    public boolean wasTransactionLoggedHandlerInvoked() {
+
+        return DummyTransactionLoggedHandler1.getCalled();
+    }
+
+    @Override
+    public boolean wasCompensationHandlerInvoked() {
+
+        return DummyCompensationHandler1.getCalled();
+    }
+}",2013-05-25T08:04:33Z,236
"@@ -16,7 +16,7 @@
     <properties>
         <narayana.version>4.16.1.Final</narayana.version>
         <arquillian.version>1.0.0.CR7</arquillian.version>
-        <jboss.version>7.1.0.Final-SNAPSHOT</jboss.version>
+        <jboss.version>7.1.1.Final-SNAPSHOT</jboss.version>
     </properties>
 
     <build>
@@ -29,6 +29,13 @@
                     <target>1.6</target>
                 </configuration>
             </plugin>
+            <plugin>
+                <artifactId>maven-surefire-plugin</artifactId>
+                <version>2.7.2</version>
+                <configuration>
+                    <skip>true</skip>
+                </configuration>
+            </plugin>
         </plugins>
     </build>
 
@@ -110,7 +117,21 @@
         <dependency>
             <groupId>org.hibernate.javax.persistence</groupId>
             <artifactId>hibernate-jpa-2.0-api</artifactId>
-            <version>1.0.1.Final</version>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.spec.javax.ejb</groupId>
+            <artifactId>jboss-ejb-api_3.1_spec</artifactId>
+            <scope>provided</scope>
+        </dependency>
+        <dependency>
+            <groupId>org.apache.cxf</groupId>
+            <artifactId>cxf-rt-frontend-jaxws</artifactId>
+            <version>2.4.6</version>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.ws</groupId>
+            <artifactId>jbossws-spi</artifactId>
+            <version>2.0.2.GA</version>
         </dependency>
         <dependency>
             <groupId>org.jboss.spec.javax.ejb</groupId>
@@ -121,9 +142,9 @@
 
     <profiles>
         <profile>
-            <id>default</id>
+            <id>arq</id>
             <activation>
-                <activeByDefault>true</activeByDefault>
+                <activeByDefault>false</activeByDefault>
             </activation>
             <build>
                 <plugins>",2012-03-05T10:33:58Z,245
"@@ -17,10 +17,18 @@ public Object intercept(InvocationContext ic) throws Throwable
     {
         Method serviceMethod = ic.getMethod();
         Object serviceImpl = ic.getTarget();
-
         ProtocolHandler protocolHandler = HandlerFactory.createInstance(serviceImpl, serviceMethod);
 
-        return protocolHandler.proceed(ic);
+        Object result = null;
+        try {
+            result = protocolHandler.proceed(ic);
+            protocolHandler.notifySuccess();
+        } catch (Exception e) {
+            protocolHandler.notifyFailure();
+            throw e;
+        }
+
+        return result;
     }
 
 }",2012-03-05T10:33:58Z,246
"@@ -0,0 +1,139 @@
+package org.jboss.narayana.txframework.impl;
+
+import javax.ejb.Stateless;
+import javax.xml.namespace.QName;
+import javax.xml.ws.handler.MessageContext;
+import javax.xml.ws.handler.soap.SOAPHandler;
+import javax.xml.ws.handler.soap.SOAPMessageContext;
+import java.lang.reflect.Method;
+import java.util.HashSet;
+import java.util.Set;
+
+import org.apache.cxf.frontend.MethodDispatcher;
+import org.apache.cxf.jaxws.context.WrappedMessageContext;
+import org.apache.cxf.message.Exchange;
+import org.apache.cxf.service.Service;
+import org.apache.cxf.service.model.BindingOperationInfo;
+import org.jboss.narayana.txframework.api.annotation.service.ServiceRequest;
+import org.jboss.narayana.txframework.api.exception.TXFrameworkException;
+import org.jboss.narayana.txframework.impl.handlers.HandlerFactory;
+import org.jboss.narayana.txframework.impl.handlers.ProtocolHandler;
+import org.jboss.wsf.spi.deployment.Endpoint;
+import org.jboss.wsf.spi.deployment.Reference;
+
+public class ServiceRequestSoapHandler implements SOAPHandler<SOAPMessageContext> {
+
+    private ProtocolHandler interceptor;
+
+    private boolean shouldIntercept = false;
+
+    public Set<QName> getHeaders() {
+
+        System.out.println(""ServiceRequestSoapHandler.getHeaders()"");
+        return new HashSet<QName>();
+    }
+
+    public boolean handleMessage(SOAPMessageContext soapMessageContext) {
+
+        Boolean outbound = (Boolean) soapMessageContext.get(MessageContext.MESSAGE_OUTBOUND_PROPERTY);
+
+        if (outbound) {
+            return handleOutboundMessage(soapMessageContext);
+        } else {
+            return handleInboundMessage(soapMessageContext);
+        }
+    }
+
+    private boolean handleInboundMessage(SOAPMessageContext soapMessageContext) {
+        System.out.println(""ServiceRequestSoapHandler.handleInboundMessage()"");
+
+        Object instance = getInstance(soapMessageContext);
+        Method method = getMethod(soapMessageContext);
+
+        shouldIntercept = !isEJB(instance) && isServiceRequestMethod(method);
+
+        if (shouldIntercept) {
+            try {
+                interceptor= HandlerFactory.createInstance(instance, method);
+            } catch (TXFrameworkException e) {
+                //todo: use logger
+                e.printStackTrace();
+                return false;
+            }
+        }
+
+        return true;
+    }
+
+
+    private boolean isServiceRequestMethod(Method method)
+    {
+        try {
+            ServiceRequest serviceRequest = method.getAnnotation(ServiceRequest.class);
+            return serviceRequest != null;
+        } catch (Throwable e) {
+            e.printStackTrace();
+            return false;
+        }
+    }
+
+    private boolean isEJB(Object instance)
+    {
+        try {
+            Stateless stateless = instance.getClass().getAnnotation(Stateless.class);
+            return stateless != null;
+        } catch (Throwable e) {
+            e.printStackTrace();
+            return false;
+        }
+    }
+
+    private boolean handleOutboundMessage(SOAPMessageContext soapMessageContext) {
+        System.out.println(""ServiceRequestSoapHandler.handleOutboundMessage()"");
+
+        if (shouldIntercept) {
+            try {
+                interceptor.notifySuccess();
+            } catch (TXFrameworkException e) {
+                //todo: use logger
+                e.printStackTrace();
+                return false;
+            }
+        }
+        return true;
+    }
+
+    public boolean handleFault(SOAPMessageContext soapMessageContext) {
+        System.out.println(""ServiceRequestSoapHandler.handleFault()"");
+
+        if (shouldIntercept) {
+            try {
+                interceptor.notifyFailure();
+            } catch (TXFrameworkException e) {
+                //todo: use logger
+                e.printStackTrace();
+                return false;
+            }
+        }
+        return true;
+    }
+
+    public void close(MessageContext messageContext) {
+        System.out.println(""ServiceRequestSoapHandler.close()"");
+    }
+
+    private Object getInstance(MessageContext ctx) {
+
+        Endpoint endpoint = ((WrappedMessageContext) ctx).getWrappedMessage().getExchange().get(Endpoint.class);
+        Reference ref = endpoint.getInstanceProvider().getInstance(endpoint.getTargetBeanName());
+        return ref.getValue();
+    }
+
+    private Method getMethod(MessageContext ctx) {
+
+        Exchange exchange = ((WrappedMessageContext) ctx).getWrappedMessage().getExchange();
+        BindingOperationInfo bop = exchange.get(BindingOperationInfo.class);
+        MethodDispatcher md = (MethodDispatcher) exchange.get(Service.class).get(MethodDispatcher.class.getName());
+        return md.getMethod(bop);
+    }
+}",2012-03-05T10:33:58Z,247
"@@ -1,14 +1,17 @@
 package org.jboss.narayana.txframework.impl.as;
 
+import org.jboss.narayana.txframework.api.management.DataControl;
 import org.jboss.narayana.txframework.impl.DataControlImpl;
 import org.jboss.narayana.txframework.impl.ServiceRequestInterceptor;
+import org.jboss.narayana.txframework.impl.handlers.wsat.ATTxControlImpl;
 
 import javax.enterprise.event.Observes;
 import javax.enterprise.inject.spi.AnnotatedType;
 import javax.enterprise.inject.spi.BeanManager;
 import javax.enterprise.inject.spi.BeforeBeanDiscovery;
 import javax.enterprise.inject.spi.Extension;
 
+
 /**
  * @author paul.robinson@redhat.com, 2012-02-13
  */
@@ -24,6 +27,12 @@ public void register(@Observes BeforeBeanDiscovery bbd, BeanManager bm) {
         final AnnotatedType<DataControlImpl> dataControlImpl = bm.createAnnotatedType(DataControlImpl.class);
         bbd.addAnnotatedType(dataControlImpl);
 
+        final AnnotatedType<DataControl> dataControl = bm.createAnnotatedType(DataControl.class);
+        bbd.addAnnotatedType(dataControl);
+
+        final AnnotatedType<ATTxControlImpl> atTxControlImpl = bm.createAnnotatedType(ATTxControlImpl.class);
+        bbd.addAnnotatedType(atTxControlImpl);
+
         final AnnotatedType<ServiceRequestInterceptor> serviceRequestInterceptor = bm.createAnnotatedType(ServiceRequestInterceptor.class);
         bbd.addAnnotatedType(serviceRequestInterceptor);
 ",2012-03-05T10:33:58Z,248
"@@ -1,8 +1,14 @@
 package org.jboss.narayana.txframework.impl.handlers;
 
+import org.jboss.narayana.txframework.api.exception.TXFrameworkException;
+
 import javax.interceptor.InvocationContext;
 
 public interface ProtocolHandler
 {
     public Object proceed(InvocationContext ic) throws Exception;
+
+    public void notifySuccess() throws TXFrameworkException;
+
+    public void notifyFailure() throws TXFrameworkException;
 }",2012-03-05T10:33:58Z,249
"@@ -1,10 +1,15 @@
 package org.jboss.narayana.txframework.impl.handlers.wsat;
 
 import com.arjuna.mw.wst.TxContext;
+import com.arjuna.ats.arjuna.common.Uid;
 import com.arjuna.mw.wst11.TransactionManager;
 import com.arjuna.mw.wst11.TransactionManagerFactory;
 import com.arjuna.mw.wst11.UserTransactionFactory;
-import com.arjuna.wst.*;
+import com.arjuna.wst.Durable2PCParticipant;
+import com.arjuna.wst.SystemException;
+import com.arjuna.wst.UnknownTransactionException;
+import com.arjuna.wst.Volatile2PCParticipant;
+import com.arjuna.wst.WrongStateException;
 import org.jboss.narayana.txframework.api.annotation.management.TxManagement;
 import org.jboss.narayana.txframework.api.exception.TXFrameworkException;
 import org.jboss.narayana.txframework.api.management.ATTxControl;
@@ -59,18 +64,20 @@ private void injectTxManagement(ATTxControl atTxControl) throws TXFrameworkExcep
         //didn't find an injection point. No problem as this is optional
     }
 
+    @Override
     public Object proceed(InvocationContext ic) throws Exception
     {
-        try
-        {
-            return ic.proceed();
-        }
-        //todo: Should this not be throwable?
-        catch (Exception e)
-        {
-            //todo: Something went wrong, so ensure TX rollback
-            throw e;
-        }
+        return ic.proceed();
+    }
+
+    @Override
+    public void notifySuccess() {
+        //do nothing
+    }
+
+    @Override
+    public void notifyFailure() {
+        //Todo: ensure transaction rolled back
     }
 
     private void registerParticipants(Object participant, String idPrefix) throws ParticipantRegistrationException",2012-03-05T10:33:58Z,250
"@@ -1,8 +1,5 @@
 package org.jboss.narayana.txframework.impl.handlers.wsba;
 
-import com.arjuna.ats.arjuna.common.Uid;
-import com.arjuna.mw.wst11.BusinessActivityManager;
-import com.arjuna.mw.wst11.BusinessActivityManagerFactory;
 import com.arjuna.wst.SystemException;
 import com.arjuna.wst.UnknownTransactionException;
 import com.arjuna.wst.WrongStateException;
@@ -16,9 +13,6 @@
 import javax.interceptor.InvocationContext;
 import java.lang.reflect.Field;
 import java.lang.reflect.Method;
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
 
 public abstract class WSBAHandler implements ProtocolHandler
 {
@@ -65,25 +59,39 @@ private void injectTxManagement(WSBATxControl wsbaTxControl) throws TXFrameworkE
 
     public Object proceed(InvocationContext ic) throws Exception
     {
-        try
+        return ic.proceed();
+    }
+
+    @Override
+    public void notifySuccess() throws TXFrameworkException{
+        //todo: find a better way of getting the current status of the TX
+        if (shouldComplete(serviceMethod) && !((WSBATxControlImpl) wsbaTxControl).isCannotComplete())
         {
-            Object result = ic.proceed();
-            //todo: find a better way of getting the current status of the TX
-            if (shouldComplete(serviceMethod) && !((WSBATxControlImpl) wsbaTxControl).isCannotComplete())
-            {
+            try {
                 participantManager.completed();
+            } catch (WrongStateException e) {
+                throw new TXFrameworkException(""Error notifying completion on participant manager."", e);
+            } catch (UnknownTransactionException e) {
+                throw new TXFrameworkException(""Error notifying completion on participant manager."", e);
+            } catch (SystemException e) {
+                throw new TXFrameworkException(""Error notifying completion on participant manager."", e);
             }
-            return result;
-        }
-        //todo: Should this not be throwable?
-        catch (Exception e)
-        {
-            //Something went wrong, so notify cannot completed
-            participantManager.cannotComplete();
-            throw e;
         }
     }
 
+    @Override
+    public void notifyFailure() throws TXFrameworkException {
+        try {
+                participantManager.cannotComplete();
+            } catch (WrongStateException e) {
+                throw new TXFrameworkException(""Error notifying cannotComplete on participant manager."", e);
+            } catch (UnknownTransactionException e) {
+                throw new TXFrameworkException(""Error notifying cannotComplete on participant manager."", e);
+            } catch (SystemException e) {
+                throw new TXFrameworkException(""Error notifying cannotComplete on participant manager."", e);
+            }
+    }
+
     private boolean shouldComplete(Method serviceMethod)
     {
         Completes completes = serviceMethod.getAnnotation(Completes.class);",2012-03-05T10:33:58Z,251
"@@ -21,7 +21,7 @@ public WSBAInternalParticipant() throws ParticipantRegistrationException
         }
         catch (SystemException e)
         {
-            throw new ParticipantRegistrationException(""Unable to lookup current tranaction id"", e);
+            throw new ParticipantRegistrationException(""Unable to lookup current transaction id"", e);
         }
     }
 ",2012-03-05T10:33:58Z,252
"@@ -6,6 +6,7 @@
 import org.jboss.narayana.txframework.api.annotation.lifecycle.wsat.*;
 import org.jboss.narayana.txframework.functional.clients.ATClient;
 import org.jboss.narayana.txframework.functional.common.ServiceCommand;
+import org.jboss.narayana.txframework.functional.common.SomeApplicationException;
 import org.jboss.narayana.txframework.functional.interfaces.AT;
 import org.jboss.shrinkwrap.api.asset.Asset;
 import org.junit.After;
@@ -22,7 +23,7 @@
 import static org.jboss.narayana.txframework.functional.common.ServiceCommand.*;
 
 @RunWith(Arquillian.class)
-public class ATTest extends BaseFunctionalTest
+public class ATTest extends BaseFunctionalTestWar
 {
     private UserTransaction ut;
     private AT client;
@@ -101,9 +102,8 @@ public void testApplicationException() throws Exception
             client.invoke(THROW_APPLICATION_EXCEPTION);
             Assert.fail(""Exception should have been thrown by now"");
         }
-        catch (SOAPFaultException e)
+        catch (SomeApplicationException e)
         {
-            //todo: can we pass application exceptions over SOAP when using an EJB exposed as a JAX-WS ws?
             System.out.println(""Caught exception"");
         }
         finally",2012-03-05T10:33:58Z,253
"@@ -0,0 +1,54 @@
+package org.jboss.narayana.txframework.functional;
+
+import com.arjuna.mw.wst11.UserBusinessActivity;
+import com.arjuna.mw.wst11.UserTransaction;
+import org.jboss.arquillian.container.test.api.Deployment;
+import org.jboss.narayana.txframework.functional.clients.ATClient;
+import org.jboss.narayana.txframework.functional.common.EventLog;
+import org.jboss.narayana.txframework.functional.common.ServiceCommand;
+import org.jboss.narayana.txframework.functional.common.SomeApplicationException;
+import org.jboss.narayana.txframework.functional.interfaces.AT;
+import org.jboss.narayana.txframework.functional.services.ATService;
+import org.jboss.shrinkwrap.api.ArchivePaths;
+import org.jboss.shrinkwrap.api.ShrinkWrap;
+import org.jboss.shrinkwrap.api.asset.ByteArrayAsset;
+import org.jboss.shrinkwrap.api.asset.EmptyAsset;
+import org.jboss.shrinkwrap.api.asset.StringAsset;
+import org.jboss.shrinkwrap.api.spec.WebArchive;
+
+public class BaseFunctionalTestWar {
+
+    @Deployment
+    public static WebArchive createTestArchive() {
+        //todo: Does the application developer have to specify the interceptor?
+        WebArchive archive = ShrinkWrap.create(WebArchive.class, ""echo_service.war"")
+                .addClasses(ATClient.class, AT.class, ATService.class, SomeApplicationException.class, EventLog.class, BaseFunctionalTestWar.class, ServiceCommand.class)
+                .addAsWebInfResource(EmptyAsset.INSTANCE, ArchivePaths.create(""beans.xml""))
+                .addAsWebInfResource(""web.xml"", ""web.xml"");
+
+        archive.delete(ArchivePaths.create(""META-INF/MANIFEST.MF""));
+
+        String ManifestMF = ""Manifest-Version: 1.0\n""
+                + ""Dependencies: org.jboss.narayana.txframework,org.jboss.as.xts,org.jboss.xts,org.jboss.modules,deployment.arquillian-service,org.jboss.msc,org.jboss.jts\n"";
+        archive.setManifest(new StringAsset(ManifestMF));
+
+        return archive;
+    }
+
+    public void rollbackIfActive(UserTransaction ut) {
+        try {
+            ut.rollback();
+        } catch (Throwable th2) {
+            // do nothing, not active
+        }
+    }
+
+    public void cancelIfActive(UserBusinessActivity uba) {
+        try {
+            uba.cancel();
+        } catch (Throwable e) {
+            // do nothing, not active
+        }
+    }
+
+}",2012-03-05T10:33:58Z,254
"@@ -33,7 +33,7 @@ public class ATClient
 {
     public static AT newInstance() throws Exception
     {
-        URL wsdlLocation = new URL(""http://localhost:8080/test/ATService/AT?wsdl"");
+        URL wsdlLocation = new URL(""http://localhost:8080/echo_service/ATService?wsdl"");
         QName serviceName = new QName(""http://www.jboss.com/functional/at/"", ""ATService"");
         QName portName = new QName(""http://www.jboss.com/functional/at/"", ""AT"");
 ",2012-03-05T10:33:58Z,255
"@@ -3,10 +3,9 @@
 import org.jboss.narayana.txframework.functional.common.SomeApplicationException;
 import org.jboss.narayana.txframework.functional.common.EventLog;
 import org.jboss.narayana.txframework.functional.common.ServiceCommand;
-import javax.ejb.Remote;
+
 import javax.jws.WebMethod;
 
-@Remote
 public interface AT
 {
     @WebMethod",2012-03-05T10:33:58Z,256
"@@ -32,12 +32,8 @@
 import org.jboss.narayana.txframework.functional.common.SomeApplicationException;
 import org.jboss.narayana.txframework.functional.common.EventLog;
 import org.jboss.narayana.txframework.functional.common.ServiceCommand;
-import org.jboss.narayana.txframework.functional.interfaces.AT;
 import org.jboss.narayana.txframework.impl.TXControlException;
-import javax.ejb.Remote;
-import javax.ejb.Stateless;
 import javax.inject.Inject;
-import javax.jws.HandlerChain;
 import javax.jws.WebMethod;
 import javax.jws.WebService;
 import javax.jws.soap.SOAPBinding;
@@ -46,12 +42,10 @@
 /**
  * @author Paul Robinson (paul.robinson@redhat.com)
  */
-@Remote(AT.class)
 @WSAT(bridgeType = BridgeType.NONE)
-@Stateless
 @WebService(serviceName = ""ATService"", portName = ""AT"", name = ""AT"", targetNamespace = ""http://www.jboss.com/functional/at/"")
 @SOAPBinding(style = SOAPBinding.Style.RPC)
-public class ATService implements AT
+public class ATService
 {
     @Inject
     DataControl dataControl;",2012-03-05T10:33:58Z,257
"@@ -0,0 +1,38 @@
+<!--
+  JBoss, Home of Professional Open Source
+  Copyright 2006, Red Hat Middleware LLC, and individual contributors
+  as indicated by the @author tags.
+  See the copyright.txt in the distribution for a full listing
+  of individual contributors.
+  This copyrighted material is made available to anyone wishing to use,
+  modify, copy, or redistribute it subject to the terms and conditions
+  of the GNU Lesser General Public License, v. 2.1.
+  This program is distributed in the hope that it will be useful, but WITHOUT A
+  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+  PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.
+  You should have received a copy of the GNU Lesser General Public License,
+  v.2.1 along with this distribution; if not, write to the Free Software
+  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
+  MA  02110-1301, USA.
+
+
+  (C) 2005-2006,
+  @author JBoss Inc.
+-->
+<web-app xmlns=""http://java.sun.com/xml/ns/j2ee""
+         xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
+         xsi:schemaLocation=""http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd""
+         version=""2.4"">
+
+    <servlet>
+        <servlet-name>ATService</servlet-name>
+        <servlet-class>org.jboss.narayana.txframework.functional.services.ATService</servlet-class>
+    </servlet>
+
+    <servlet-mapping>
+        <servlet-name>ATService</servlet-name>
+        <url-pattern>/ATService</url-pattern>
+    </servlet-mapping>
+
+
+</web-app>
\ No newline at end of file",2012-03-05T10:33:58Z,258
"@@ -22,7 +22,11 @@
 
 package org.jboss.narayana.txframework.functional.rest.at.simpleEJB;
 
+import java.lang.annotation.Annotation;
+import java.util.Arrays;
+
 import junit.framework.Assert;
+
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.at.Commit;
@@ -43,9 +47,6 @@
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
-import java.lang.annotation.Annotation;
-import java.util.Arrays;
-
 /**
  * @author paul.robinson@redhat.com 06/04/2012
  */",2013-03-01T12:27:52Z,200
"@@ -22,16 +22,12 @@
 
 package org.jboss.narayana.txframework.functional.ws.at.bridged;
 
-import com.arjuna.mw.wst11.client.JaxWSHeaderContextProcessor;
-import org.jboss.narayana.txframework.functional.ws.at.bridged.ATBridge;
+import java.net.URL;
 
 import javax.xml.namespace.QName;
-import javax.xml.ws.BindingProvider;
 import javax.xml.ws.Service;
-import javax.xml.ws.handler.Handler;
-import java.net.URL;
-import java.util.ArrayList;
-import java.util.List;
+
+import com.arjuna.mw.wst11.client.WSTXFeature;
 
 public class ATBridgeClient {
 
@@ -42,15 +38,7 @@ public static ATBridge newInstance() throws Exception {
         QName portName = new QName(""http://www.jboss.com/functional/at/bridge"", ""ATBridge"");
 
         Service service = Service.create(wsdlLocation, serviceName);
-        ATBridge client = service.getPort(portName, ATBridge.class);
-
-        /*
-           Add client handler chain
-        */
-        BindingProvider bindingProvider = (BindingProvider) client;
-        List<Handler> handlers = new ArrayList<Handler>();
-        handlers.add(new JaxWSHeaderContextProcessor());
-        bindingProvider.getBinding().setHandlerChain(handlers);
+        ATBridge client = service.getPort(portName, ATBridge.class, new WSTXFeature());
 
         return client;
     }",2013-03-01T12:27:52Z,259
"@@ -22,15 +22,17 @@
 
 package org.jboss.narayana.txframework.functional.ws.ba.bridged;
 
-import com.arjuna.mw.wst11.client.JaxWSHeaderContextProcessor;
+import java.net.URL;
+import java.util.ArrayList;
+import java.util.List;
 
 import javax.xml.namespace.QName;
 import javax.xml.ws.BindingProvider;
 import javax.xml.ws.Service;
 import javax.xml.ws.handler.Handler;
-import java.net.URL;
-import java.util.ArrayList;
-import java.util.List;
+
+import com.arjuna.mw.wst11.client.JaxWSHeaderContextProcessor;
+import com.arjuna.mw.wst11.client.WSTXFeature;
 
 public class BABridgedClient {
 
@@ -41,15 +43,7 @@ public static BABridged newInstance() throws Exception {
         QName portName = new QName(""http://www.jboss.com/functional/ba/bridged/"", ""BABridgedService"");
 
         Service service = Service.create(wsdlLocation, serviceName);
-        BABridged client = service.getPort(portName, BABridged.class);
-
-        /*
-           Add client handler chain
-        */
-        BindingProvider bindingProvider = (BindingProvider) client;
-        List<Handler> handlers = new ArrayList<Handler>(1);
-        handlers.add(new JaxWSHeaderContextProcessor());
-        bindingProvider.getBinding().setHandlerChain(handlers);
+        BABridged client = service.getPort(portName, BABridged.class, new WSTXFeature());
 
         return client;
     }",2013-03-01T12:27:52Z,260
"@@ -22,16 +22,12 @@
 
 package org.jboss.narayana.txframework.functional.ws.ba.coordinatorCompletion;
 
-import com.arjuna.mw.wst11.client.JaxWSHeaderContextProcessor;
-import org.jboss.narayana.txframework.functional.ws.ba.coordinatorCompletion.BACoordinatorCompletion;
+import java.net.URL;
 
 import javax.xml.namespace.QName;
-import javax.xml.ws.BindingProvider;
 import javax.xml.ws.Service;
-import javax.xml.ws.handler.Handler;
-import java.net.URL;
-import java.util.ArrayList;
-import java.util.List;
+
+import com.arjuna.mw.wst11.client.WSTXFeature;
 
 public class BACoordinatorCompletionClient {
 
@@ -42,15 +38,7 @@ public static BACoordinatorCompletion newInstance() throws Exception {
         QName portName = new QName(""http://www.jboss.com/functional/ba/coordinatorcompletion/"", ""BACoordinatorCompletionService"");
 
         Service service = Service.create(wsdlLocation, serviceName);
-        BACoordinatorCompletion client = service.getPort(portName, BACoordinatorCompletion.class);
-
-        /*
-           Add client handler chain
-        */
-        BindingProvider bindingProvider = (BindingProvider) client;
-        List<Handler> handlers = new ArrayList<Handler>(1);
-        handlers.add(new JaxWSHeaderContextProcessor());
-        bindingProvider.getBinding().setHandlerChain(handlers);
+        BACoordinatorCompletion client = service.getPort(portName, BACoordinatorCompletion.class, new WSTXFeature());
 
         return client;
     }",2013-03-01T12:27:52Z,261
"@@ -22,16 +22,12 @@
 
 package org.jboss.narayana.txframework.functional.ws.ba.participantCompletion;
 
-import com.arjuna.mw.wst11.client.JaxWSHeaderContextProcessor;
-import org.jboss.narayana.txframework.functional.ws.ba.participantCompletion.BAParticipantCompletion;
+import java.net.URL;
 
 import javax.xml.namespace.QName;
-import javax.xml.ws.BindingProvider;
 import javax.xml.ws.Service;
-import javax.xml.ws.handler.Handler;
-import java.net.URL;
-import java.util.ArrayList;
-import java.util.List;
+
+import com.arjuna.mw.wst11.client.WSTXFeature;
 
 public class BAParticipantCompletionClient {
 
@@ -42,15 +38,7 @@ public static BAParticipantCompletion newInstance() throws Exception {
         QName portName = new QName(""http://www.jboss.com/functional/ba/participantcompletion/"", ""BAParticipantCompletionService"");
 
         Service service = Service.create(wsdlLocation, serviceName);
-        BAParticipantCompletion client = service.getPort(portName, BAParticipantCompletion.class);
-
-        /*
-           Add client handler chain
-        */
-        BindingProvider bindingProvider = (BindingProvider) client;
-        List<Handler> handlers = new ArrayList<Handler>(1);
-        handlers.add(new JaxWSHeaderContextProcessor());
-        bindingProvider.getBinding().setHandlerChain(handlers);
+        BAParticipantCompletion client = service.getPort(portName, BAParticipantCompletion.class, new WSTXFeature());
 
         return client;
     }",2013-03-01T12:27:52Z,262
"@@ -0,0 +1,48 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.compensationScoped;
+
+import org.jboss.narayana.compensations.api.CompensationScoped;
+
+import javax.inject.Named;
+import java.io.Serializable;
+
+/**
+ * @author paul.robinson@redhat.com 23/04/2013
+ */
+@Named(""DummyData"")
+@CompensationScoped
+public class DummyData implements Serializable {
+
+    private String value = """";
+
+    public void setValue(String value) {
+
+        this.value = value;
+    }
+
+    public String getValue() {
+
+        return value;
+    }
+}",2013-05-25T08:04:33Z,232
"@@ -0,0 +1,164 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import com.arjuna.mw.wst11.UserBusinessActivity;
+import com.arjuna.mw.wst11.UserBusinessActivityFactory;
+import com.arjuna.wst.TransactionRolledBackException;
+import junit.framework.Assert;
+import org.jboss.arquillian.container.test.api.Deployment;
+import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
+import org.jboss.narayana.compensations.functional.common.DummyCompensationHandler1;
+import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Close;
+import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Compensate;
+import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.ConfirmCompleted;
+import org.jboss.narayana.txframework.functional.common.EventLog;
+import org.jboss.narayana.txframework.functional.common.ServiceCommand;
+import org.jboss.narayana.txframework.functional.common.SomeApplicationException;
+import org.jboss.shrinkwrap.api.ArchivePaths;
+import org.jboss.shrinkwrap.api.ShrinkWrap;
+import org.jboss.shrinkwrap.api.asset.EmptyAsset;
+import org.jboss.shrinkwrap.api.asset.StringAsset;
+import org.jboss.shrinkwrap.api.spec.JavaArchive;
+import org.junit.After;
+import org.junit.AfterClass;
+import org.junit.Before;
+import org.junit.BeforeClass;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+
+import java.lang.annotation.Annotation;
+import java.util.Arrays;
+import java.util.List;
+
+@RunWith(Arquillian.class)
+public class DistributedTest {
+
+    UserBusinessActivity uba;
+    TestService client;
+
+    @Deployment()
+    public static JavaArchive createTestArchive() {
+        JavaArchive archive = ShrinkWrap.create(JavaArchive.class, ""test.jar"")
+                .addPackages(false, DistributedTest.class.getPackage())
+                .addPackage(DummyCompensationHandler1.class.getPackage())
+                .addClass(ParticipantCompletionCoordinatorRules.class)
+                .addAsManifestResource(EmptyAsset.INSTANCE, ArchivePaths.create(""beans.xml""))
+                .addAsManifestResource(""META-INF/services/javax.enterprise.inject.spi.Extension"", ""services/javax.enterprise.inject.spi.Extension"");
+
+        archive.delete(ArchivePaths.create(""META-INF/MANIFEST.MF""));
+
+        String ManifestMF = ""Manifest-Version: 1.0\n""
+                + ""Dependencies: org.jboss.narayana.txframework,org.jboss.xts\n"";
+
+        archive.setManifest(new StringAsset(ManifestMF));
+
+        return archive;
+    }
+
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @Before
+    public void setupTest() throws Exception {
+
+        uba = UserBusinessActivityFactory.userBusinessActivity();
+        client = new TestServiceClient();
+    }
+
+    @After
+    public void teardownTest() throws Exception {
+
+        client.resetHandlerFlags();
+        cancelIfActive(uba);
+    }
+
+    @Test
+    public void testSimple() throws Exception {
+
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
+        client.saveData(false);
+
+        Assert.assertEquals(true, client.wasTransactionLoggedHandlerInvoked());
+        Assert.assertEquals(true, client.wasTransactionConfirmedHandlerInvoked());
+        Assert.assertEquals(false, client.wasCompensationHandlerInvoked());
+
+    }
+
+
+
+    @Test
+    public void testClientDrivenCompensate() throws Exception {
+
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
+        uba.begin();
+        client.saveData(false);
+        uba.cancel();
+
+        Assert.assertEquals(true, client.wasTransactionLoggedHandlerInvoked());
+        Assert.assertEquals(false, client.wasTransactionConfirmedHandlerInvoked());
+        Assert.assertEquals(true, client.wasCompensationHandlerInvoked());
+    }
+
+
+    @Test
+    public void testRuntimeException() throws Exception {
+
+        try {
+            uba.begin();
+            client.saveData(true);
+            Assert.fail(""Exception should have been thrown by now"");
+        } catch (RuntimeException e) {
+            //Exception expected
+        } finally {
+            uba.cancel();
+        }
+
+        Assert.assertEquals(false, client.wasTransactionLoggedHandlerInvoked());
+        Assert.assertEquals(false, client.wasTransactionConfirmedHandlerInvoked());
+        Assert.assertEquals(false, client.wasCompensationHandlerInvoked());
+    }
+
+    public void cancelIfActive(UserBusinessActivity uba) {
+
+        try {
+            uba.cancel();
+        } catch (Throwable e) {
+            // do nothing, not active
+        }
+    }
+}",2013-05-25T08:04:33Z,114
"@@ -0,0 +1,48 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import org.jboss.narayana.compensations.api.CompensationScoped;
+
+import javax.inject.Named;
+import java.io.Serializable;
+
+/**
+ * @author paul.robinson@redhat.com 23/05/2013
+ */
+@Named(""State"")
+@CompensationScoped
+public class State implements Serializable {
+
+    private String value;
+
+    public String getValue() {
+
+        return value;
+    }
+
+    public void setValue(String value) {
+
+        this.value = value;
+    }
+}",2013-05-25T08:04:33Z,233
"@@ -0,0 +1,46 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import javax.ejb.Remote;
+import javax.jws.WebMethod;
+
+@Remote
+public interface TestService {
+
+    @WebMethod
+    public void saveData(Boolean throwException);
+
+    @WebMethod
+    public void resetHandlerFlags();
+
+    @WebMethod
+    public boolean wasCompensationHandlerInvoked();
+
+    @WebMethod
+    public boolean wasTransactionLoggedHandlerInvoked();
+
+    @WebMethod
+    public boolean wasTransactionConfirmedHandlerInvoked();
+
+}",2013-05-25T08:04:33Z,234
"@@ -0,0 +1,74 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import com.arjuna.mw.wst11.client.WSTXFeature;
+import org.jboss.narayana.compensations.api.Compensatable;
+import javax.xml.namespace.QName;
+import javax.xml.ws.Service;
+import java.net.URL;
+
+public class TestServiceClient implements TestService {
+
+    private TestService testService;
+
+    public TestServiceClient() throws Exception {
+
+        URL wsdlLocation = new URL(""http://localhost:8080/test/TestServiceService/TestService?wsdl"");
+        QName serviceName = new QName(""http://www.jboss.com/functional/compensations/distributed/"", ""TestServiceService"");
+        QName portName = new QName(""http://www.jboss.com/functional/compensations/distributed/"", ""TestServiceService"");
+
+        Service service = Service.create(wsdlLocation, serviceName);
+        testService = service.getPort(portName, TestService.class, new WSTXFeature());
+    }
+
+    @Override
+    @Compensatable
+    public void saveData(Boolean throwException) {
+        testService.saveData(throwException);
+    }
+
+    @Override
+    public void resetHandlerFlags() {
+        testService.resetHandlerFlags();
+    }
+
+    @Override
+    public boolean wasCompensationHandlerInvoked() {
+
+        return testService.wasCompensationHandlerInvoked();
+    }
+
+    @Override
+    public boolean wasTransactionLoggedHandlerInvoked() {
+
+        return testService.wasTransactionLoggedHandlerInvoked();
+    }
+
+    @Override
+    public boolean wasTransactionConfirmedHandlerInvoked() {
+
+        return testService.wasTransactionConfirmedHandlerInvoked();
+    }
+}
+",2013-05-25T08:04:33Z,235
"@@ -0,0 +1,90 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+package org.jboss.narayana.compensations.functional.distributed;
+
+import org.jboss.narayana.compensations.api.Compensatable;
+import org.jboss.narayana.compensations.api.TxCompensate;
+import org.jboss.narayana.compensations.api.TxConfirm;
+import org.jboss.narayana.compensations.api.TxLogged;
+import org.jboss.narayana.compensations.functional.common.DummyCompensationHandler1;
+import org.jboss.narayana.compensations.functional.common.DummyConfirmationHandler1;
+import org.jboss.narayana.compensations.functional.common.DummyTransactionLoggedHandler1;
+
+import javax.ejb.Stateless;
+import javax.inject.Inject;
+import javax.jws.WebMethod;
+import javax.jws.WebService;
+import javax.jws.soap.SOAPBinding;
+
+
+/**
+ * @author Paul Robinson (paul.robinson@redhat.com)
+ */
+@Stateless
+@WebService(serviceName = ""TestServiceService"", portName = ""TestServiceService"",
+        name = ""TestService"", targetNamespace = ""http://www.jboss.com/functional/compensations/distributed/"")
+@SOAPBinding(style = SOAPBinding.Style.RPC)
+public class TestServiceService implements TestService {
+
+    @Inject
+    private State state;
+
+
+    @Compensatable
+    @TxCompensate(DummyCompensationHandler1.class)
+    @TxConfirm(DummyConfirmationHandler1.class)
+    @TxLogged(DummyTransactionLoggedHandler1.class)
+    public void saveData(Boolean throwRuntimeException) {
+
+        if (throwRuntimeException) {
+            throw new RuntimeException(""Test instructed the service to throw a RuntimeException"");
+        }
+
+        state.setValue(""myValue"");
+    }
+
+    @WebMethod
+    public void resetHandlerFlags() {
+
+        DummyConfirmationHandler1.reset();
+        DummyTransactionLoggedHandler1.reset();
+        DummyCompensationHandler1.reset();
+    }
+
+    @Override
+    public boolean wasTransactionConfirmedHandlerInvoked() {
+
+        return DummyConfirmationHandler1.getCalled();
+    }
+
+    @Override
+    public boolean wasTransactionLoggedHandlerInvoked() {
+
+        return DummyTransactionLoggedHandler1.getCalled();
+    }
+
+    @Override
+    public boolean wasCompensationHandlerInvoked() {
+
+        return DummyCompensationHandler1.getCalled();
+    }
+}",2013-05-25T08:04:33Z,236
"@@ -0,0 +1,40 @@
+package org.jboss.narayana.compensations.impl;
+
+import javax.enterprise.context.spi.CreationalContext;
+import javax.enterprise.inject.spi.Bean;
+import javax.enterprise.inject.spi.BeanManager;
+import javax.naming.InitialContext;
+import javax.naming.NamingException;
+import java.lang.reflect.Type;
+import java.util.Iterator;
+
+public class BeanManagerUtil {
+
+
+    public static BeanManager getBeanManager() {
+
+        try {
+            return InitialContext.doLookup(""java:comp/BeanManager"");
+        } catch (NamingException e) {
+            //Do nothing, and move onto alternative
+        }
+
+        try {
+            return InitialContext.doLookup(""java:comp/env/BeanManager"");
+        } catch (NamingException e) {
+            throw new RuntimeException(""BeanManager not available in JNDI"");
+        }
+    }
+
+    public static <T> T createBeanInstance(Class<T> clazz, BeanManager bm) {
+
+        Iterator<Bean<?>> iter = bm.getBeans(clazz).iterator();
+        if (!iter.hasNext()) {
+            throw new IllegalStateException(""CDI BeanManager cannot find an instance of requested type "" + clazz.getName());
+        }
+        Bean<T> bean = (Bean<T>) iter.next();
+        CreationalContext<T> ctx = bm.createCreationalContext(bean);
+        return(T) bm.getReference(bean, clazz, ctx);
+    }
+
+}
\ No newline at end of file",2013-05-25T08:04:33Z,263
"@@ -28,7 +28,6 @@
 import com.arjuna.wst.WrongStateException;
 import com.arjuna.wst11.ConfirmCompletedParticipant;
 import org.jboss.narayana.compensations.api.CompensationHandler;
-import org.jboss.narayana.compensations.api.CompensationTransactionRuntimeException;
 import org.jboss.narayana.compensations.api.ConfirmationHandler;
 import org.jboss.narayana.compensations.api.TransactionLoggedHandler;
 import org.jboss.weld.bootstrap.api.SingletonProvider;
@@ -48,10 +47,6 @@ public class Participant implements BusinessAgreementWithParticipantCompletionPa
 
     private Class<? extends TransactionLoggedHandler> transactionLoggedHandler;
 
-    private Map<String, Object> rememberedBeans;
-
-    private SingletonProvider singletonProvider;
-
     private BeanManager beanManager;
 
     public Participant(Class<? extends CompensationHandler> compensationHandlerClass, Class<? extends ConfirmationHandler> confirmationHandlerClass, Class<? extends TransactionLoggedHandler> transactionLoggedHandlerClass) {
@@ -60,17 +55,15 @@ public Participant(Class<? extends CompensationHandler> compensationHandlerClass
         this.confirmationHandler = confirmationHandlerClass;
         this.transactionLoggedHandler = transactionLoggedHandlerClass;
 
-        rememberedBeans = CompensationContext.getBeansForThisTransaction();
-        beanManager = BeanManagerLookup.getBeanManager();
-        singletonProvider = TCCLSingletonProvider.instance();
+        beanManager = BeanManagerUtil.getBeanManager();
     }
 
     private <T extends Object> T instantiate(Class<T> clazz) {
 
         if (clazz == null) {
             return null;
         }
-        return (T) ProgrammaticBeanLookup.lookup(clazz, beanManager);
+        return BeanManagerUtil.createBeanInstance(clazz, beanManager);
     }
 
     @Override
@@ -85,12 +78,10 @@ public void confirmCompleted(boolean confirmed) {
     @Override
     public void close() throws WrongStateException, SystemException {
 
-        CompensationContext.rememberForAfterTransaction(rememberedBeans);
         if (confirmationHandler != null) {
             ConfirmationHandler handler = instantiate(confirmationHandler);
             handler.confirm();
         }
-        CompensationContext.forgetAfterTransactionBeans();
     }
 
     @Override
@@ -102,14 +93,10 @@ public void cancel() throws FaultedException, WrongStateException, SystemExcepti
     public void compensate() throws FaultedException, WrongStateException, SystemException {
 
         try {
-            CompensationContext.rememberForAfterTransaction(rememberedBeans);
-            TCCLSingletonProvider.reset();
-            TCCLSingletonProvider.initialize(singletonProvider);
             if (compensationHandler != null) {
                 CompensationHandler handler = instantiate(compensationHandler);
                 handler.compensate();
             }
-            CompensationContext.forgetAfterTransactionBeans();
         } catch (Exception e) {
             e.printStackTrace();
         }",2013-05-25T08:04:33Z,119
"@@ -1,48 +0,0 @@
-/*
- * JBoss, Home of Professional Open Source.
- * Copyright 2013, Red Hat, Inc., and individual contributors
- * as indicated by the @author tags. See the copyright.txt file in the
- * distribution for a full listing of individual contributors.
- *
- * This is free software; you can redistribute it and/or modify it
- * under the terms of the GNU Lesser General Public License as
- * published by the Free Software Foundation; either version 2.1 of
- * the License, or (at your option) any later version.
- *
- * This software is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
- * Lesser General Public License for more details.
- *
- * You should have received a copy of the GNU Lesser General Public
- * License along with this software; if not, write to the Free
- * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
- * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
- */
-
-package org.jboss.narayana.compensations.functional.compensationScoped;
-
-import org.jboss.narayana.compensations.api.CompensationScoped;
-
-import javax.inject.Named;
-import java.io.Serializable;
-
-/**
- * @author paul.robinson@redhat.com 23/04/2013
- */
-@Named(""DummyData"")
-@CompensationScoped
-public class DummyData implements Serializable {
-
-    private String value = """";
-
-    public void setValue(String value) {
-
-        this.value = value;
-    }
-
-    public String getValue() {
-
-        return value;
-    }
-}",2013-05-25T08:04:33Z,232
"@@ -0,0 +1,48 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.compensationScoped;
+
+import org.jboss.narayana.compensations.api.CompensationScoped;
+
+import javax.inject.Named;
+import java.io.Serializable;
+
+/**
+ * @author paul.robinson@redhat.com 23/04/2013
+ */
+@Named(""DummyData"")
+@CompensationScoped
+public class DummyData implements Serializable {
+
+    private String value = """";
+
+    public void setValue(String value) {
+
+        this.value = value;
+    }
+
+    public String getValue() {
+
+        return value;
+    }
+}",2013-05-25T08:04:33Z,232
"@@ -0,0 +1,164 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import com.arjuna.mw.wst11.UserBusinessActivity;
+import com.arjuna.mw.wst11.UserBusinessActivityFactory;
+import com.arjuna.wst.TransactionRolledBackException;
+import junit.framework.Assert;
+import org.jboss.arquillian.container.test.api.Deployment;
+import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
+import org.jboss.narayana.compensations.functional.common.DummyCompensationHandler1;
+import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Close;
+import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Compensate;
+import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.ConfirmCompleted;
+import org.jboss.narayana.txframework.functional.common.EventLog;
+import org.jboss.narayana.txframework.functional.common.ServiceCommand;
+import org.jboss.narayana.txframework.functional.common.SomeApplicationException;
+import org.jboss.shrinkwrap.api.ArchivePaths;
+import org.jboss.shrinkwrap.api.ShrinkWrap;
+import org.jboss.shrinkwrap.api.asset.EmptyAsset;
+import org.jboss.shrinkwrap.api.asset.StringAsset;
+import org.jboss.shrinkwrap.api.spec.JavaArchive;
+import org.junit.After;
+import org.junit.AfterClass;
+import org.junit.Before;
+import org.junit.BeforeClass;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+
+import java.lang.annotation.Annotation;
+import java.util.Arrays;
+import java.util.List;
+
+@RunWith(Arquillian.class)
+public class DistributedTest {
+
+    UserBusinessActivity uba;
+    TestService client;
+
+    @Deployment()
+    public static JavaArchive createTestArchive() {
+        JavaArchive archive = ShrinkWrap.create(JavaArchive.class, ""test.jar"")
+                .addPackages(false, DistributedTest.class.getPackage())
+                .addPackage(DummyCompensationHandler1.class.getPackage())
+                .addClass(ParticipantCompletionCoordinatorRules.class)
+                .addAsManifestResource(EmptyAsset.INSTANCE, ArchivePaths.create(""beans.xml""))
+                .addAsManifestResource(""META-INF/services/javax.enterprise.inject.spi.Extension"", ""services/javax.enterprise.inject.spi.Extension"");
+
+        archive.delete(ArchivePaths.create(""META-INF/MANIFEST.MF""));
+
+        String ManifestMF = ""Manifest-Version: 1.0\n""
+                + ""Dependencies: org.jboss.narayana.txframework,org.jboss.xts\n"";
+
+        archive.setManifest(new StringAsset(ManifestMF));
+
+        return archive;
+    }
+
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @Before
+    public void setupTest() throws Exception {
+
+        uba = UserBusinessActivityFactory.userBusinessActivity();
+        client = new TestServiceClient();
+    }
+
+    @After
+    public void teardownTest() throws Exception {
+
+        client.resetHandlerFlags();
+        cancelIfActive(uba);
+    }
+
+    @Test
+    public void testSimple() throws Exception {
+
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
+        client.saveData(false);
+
+        Assert.assertEquals(true, client.wasTransactionLoggedHandlerInvoked());
+        Assert.assertEquals(true, client.wasTransactionConfirmedHandlerInvoked());
+        Assert.assertEquals(false, client.wasCompensationHandlerInvoked());
+
+    }
+
+
+
+    @Test
+    public void testClientDrivenCompensate() throws Exception {
+
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
+        uba.begin();
+        client.saveData(false);
+        uba.cancel();
+
+        Assert.assertEquals(true, client.wasTransactionLoggedHandlerInvoked());
+        Assert.assertEquals(false, client.wasTransactionConfirmedHandlerInvoked());
+        Assert.assertEquals(true, client.wasCompensationHandlerInvoked());
+    }
+
+
+    @Test
+    public void testRuntimeException() throws Exception {
+
+        try {
+            uba.begin();
+            client.saveData(true);
+            Assert.fail(""Exception should have been thrown by now"");
+        } catch (RuntimeException e) {
+            //Exception expected
+        } finally {
+            uba.cancel();
+        }
+
+        Assert.assertEquals(false, client.wasTransactionLoggedHandlerInvoked());
+        Assert.assertEquals(false, client.wasTransactionConfirmedHandlerInvoked());
+        Assert.assertEquals(false, client.wasCompensationHandlerInvoked());
+    }
+
+    public void cancelIfActive(UserBusinessActivity uba) {
+
+        try {
+            uba.cancel();
+        } catch (Throwable e) {
+            // do nothing, not active
+        }
+    }
+}",2013-05-25T08:04:33Z,114
"@@ -0,0 +1,48 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import org.jboss.narayana.compensations.api.CompensationScoped;
+
+import javax.inject.Named;
+import java.io.Serializable;
+
+/**
+ * @author paul.robinson@redhat.com 23/05/2013
+ */
+@Named(""State"")
+@CompensationScoped
+public class State implements Serializable {
+
+    private String value;
+
+    public String getValue() {
+
+        return value;
+    }
+
+    public void setValue(String value) {
+
+        this.value = value;
+    }
+}",2013-05-25T08:04:33Z,233
"@@ -0,0 +1,46 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import javax.ejb.Remote;
+import javax.jws.WebMethod;
+
+@Remote
+public interface TestService {
+
+    @WebMethod
+    public void saveData(Boolean throwException);
+
+    @WebMethod
+    public void resetHandlerFlags();
+
+    @WebMethod
+    public boolean wasCompensationHandlerInvoked();
+
+    @WebMethod
+    public boolean wasTransactionLoggedHandlerInvoked();
+
+    @WebMethod
+    public boolean wasTransactionConfirmedHandlerInvoked();
+
+}",2013-05-25T08:04:33Z,234
"@@ -0,0 +1,74 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+package org.jboss.narayana.compensations.functional.distributed;
+
+import com.arjuna.mw.wst11.client.WSTXFeature;
+import org.jboss.narayana.compensations.api.Compensatable;
+import javax.xml.namespace.QName;
+import javax.xml.ws.Service;
+import java.net.URL;
+
+public class TestServiceClient implements TestService {
+
+    private TestService testService;
+
+    public TestServiceClient() throws Exception {
+
+        URL wsdlLocation = new URL(""http://localhost:8080/test/TestServiceService/TestService?wsdl"");
+        QName serviceName = new QName(""http://www.jboss.com/functional/compensations/distributed/"", ""TestServiceService"");
+        QName portName = new QName(""http://www.jboss.com/functional/compensations/distributed/"", ""TestServiceService"");
+
+        Service service = Service.create(wsdlLocation, serviceName);
+        testService = service.getPort(portName, TestService.class, new WSTXFeature());
+    }
+
+    @Override
+    @Compensatable
+    public void saveData(Boolean throwException) {
+        testService.saveData(throwException);
+    }
+
+    @Override
+    public void resetHandlerFlags() {
+        testService.resetHandlerFlags();
+    }
+
+    @Override
+    public boolean wasCompensationHandlerInvoked() {
+
+        return testService.wasCompensationHandlerInvoked();
+    }
+
+    @Override
+    public boolean wasTransactionLoggedHandlerInvoked() {
+
+        return testService.wasTransactionLoggedHandlerInvoked();
+    }
+
+    @Override
+    public boolean wasTransactionConfirmedHandlerInvoked() {
+
+        return testService.wasTransactionConfirmedHandlerInvoked();
+    }
+}
+",2013-05-25T08:04:33Z,235
"@@ -0,0 +1,90 @@
+/*
+ * JBoss, Home of Professional Open Source.
+ * Copyright 2013, Red Hat, Inc., and individual contributors
+ * as indicated by the @author tags. See the copyright.txt file in the
+ * distribution for a full listing of individual contributors.
+ *
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ *
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+package org.jboss.narayana.compensations.functional.distributed;
+
+import org.jboss.narayana.compensations.api.Compensatable;
+import org.jboss.narayana.compensations.api.TxCompensate;
+import org.jboss.narayana.compensations.api.TxConfirm;
+import org.jboss.narayana.compensations.api.TxLogged;
+import org.jboss.narayana.compensations.functional.common.DummyCompensationHandler1;
+import org.jboss.narayana.compensations.functional.common.DummyConfirmationHandler1;
+import org.jboss.narayana.compensations.functional.common.DummyTransactionLoggedHandler1;
+
+import javax.ejb.Stateless;
+import javax.inject.Inject;
+import javax.jws.WebMethod;
+import javax.jws.WebService;
+import javax.jws.soap.SOAPBinding;
+
+
+/**
+ * @author Paul Robinson (paul.robinson@redhat.com)
+ */
+@Stateless
+@WebService(serviceName = ""TestServiceService"", portName = ""TestServiceService"",
+        name = ""TestService"", targetNamespace = ""http://www.jboss.com/functional/compensations/distributed/"")
+@SOAPBinding(style = SOAPBinding.Style.RPC)
+public class TestServiceService implements TestService {
+
+    @Inject
+    private State state;
+
+
+    @Compensatable
+    @TxCompensate(DummyCompensationHandler1.class)
+    @TxConfirm(DummyConfirmationHandler1.class)
+    @TxLogged(DummyTransactionLoggedHandler1.class)
+    public void saveData(Boolean throwRuntimeException) {
+
+        if (throwRuntimeException) {
+            throw new RuntimeException(""Test instructed the service to throw a RuntimeException"");
+        }
+
+        state.setValue(""myValue"");
+    }
+
+    @WebMethod
+    public void resetHandlerFlags() {
+
+        DummyConfirmationHandler1.reset();
+        DummyTransactionLoggedHandler1.reset();
+        DummyCompensationHandler1.reset();
+    }
+
+    @Override
+    public boolean wasTransactionConfirmedHandlerInvoked() {
+
+        return DummyConfirmationHandler1.getCalled();
+    }
+
+    @Override
+    public boolean wasTransactionLoggedHandlerInvoked() {
+
+        return DummyTransactionLoggedHandler1.getCalled();
+    }
+
+    @Override
+    public boolean wasCompensationHandlerInvoked() {
+
+        return DummyCompensationHandler1.getCalled();
+    }
+}",2013-05-25T08:04:33Z,236
"@@ -1,6 +1,8 @@
 package org.jboss.narayana.txframework.impl;
 
 import org.jboss.narayana.txframework.api.management.DataControl;
+
+import javax.inject.Named;
 import java.util.HashMap;
 import java.util.Map;
 ",2012-02-13T15:44:12Z,264
"@@ -0,0 +1,31 @@
+package org.jboss.narayana.txframework.impl.as;
+
+import org.jboss.narayana.txframework.impl.DataControlImpl;
+import org.jboss.narayana.txframework.impl.ServiceRequestInterceptor;
+
+import javax.enterprise.event.Observes;
+import javax.enterprise.inject.spi.AnnotatedType;
+import javax.enterprise.inject.spi.BeanManager;
+import javax.enterprise.inject.spi.BeforeBeanDiscovery;
+import javax.enterprise.inject.spi.Extension;
+
+/**
+ * @author paul.robinson@redhat.com, 2012-02-13
+ */
+public class TXFrameworkCDIExtension implements Extension {
+
+    /**
+     * Register all admin CDI beans.
+     *
+     * @param bbd the bbd event
+     * @param bm  the bean manager
+     */
+    public void register(@Observes BeforeBeanDiscovery bbd, BeanManager bm) {
+        final AnnotatedType<DataControlImpl> dataControlImpl = bm.createAnnotatedType(DataControlImpl.class);
+        bbd.addAnnotatedType(dataControlImpl);
+
+        final AnnotatedType<ServiceRequestInterceptor> serviceRequestInterceptor = bm.createAnnotatedType(ServiceRequestInterceptor.class);
+        bbd.addAnnotatedType(serviceRequestInterceptor);
+
+    }
+}",2012-02-13T15:44:12Z,248
"@@ -14,7 +14,7 @@ public static JavaArchive createTestArchive()
     {
         //todo: Does the application developer have to specify the interceptor?
         JavaArchive archive = ShrinkWrap.create(JavaArchive.class, ""test.jar"")
-                .addPackages(true, ""org.jboss.narayana.txframework"")
+                .addPackages(true, ""org.jboss.narayana.txframework.functional"")
                 .addAsResource(""jaxws-handlers-jaxws-service.xml"")
                 .addAsManifestResource(""persistence.xml"")
                 .addAsManifestResource(new ByteArrayAsset(""<interceptors><class>org.jboss.narayana.txframework.impl.ServiceRequestInterceptor</class></interceptors>"".getBytes()),
@@ -23,7 +23,7 @@ public static JavaArchive createTestArchive()
         archive.delete(ArchivePaths.create(""META-INF/MANIFEST.MF""));
 
         String ManifestMF = ""Manifest-Version: 1.0\n""
-                + ""Dependencies: org.jboss.as.xts,org.jboss.xts,org.jboss.modules,deployment.arquillian-service,org.jboss.msc,org.jboss.jts\n"";
+                + ""Dependencies: org.jboss.narayana.txframework,org.jboss.as.xts,org.jboss.xts,org.jboss.modules,deployment.arquillian-service,org.jboss.msc,org.jboss.jts\n"";
         archive.setManifest(new StringAsset(ManifestMF));
 
         return archive;",2012-02-13T15:44:12Z,265
"@@ -24,10 +24,12 @@
 package org.jboss.narayana.txframework.functional.services;
 
 
+import com.arjuna.ats.jta.UserTransaction;
 import org.jboss.narayana.txframework.api.annotation.transaction.WSAT;
 import org.jboss.narayana.txframework.functional.interfaces.ATBridge;
 
 import javax.ejb.*;
+import javax.inject.Inject;
 import javax.persistence.*;
 import javax.jws.WebService;
 import javax.jws.WebMethod;",2012-02-13T15:44:12Z,266
"@@ -965,7 +965,10 @@
     <emma.jar.location>${project.basedir}/ext/emma.jar</emma.jar.location>
     <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
     <findbugs.skip>true</findbugs.skip>
+<!--
     <jboss-as.version>7.1.2.Final-SNAPSHOT</jboss-as.version>
+-->
+    <jboss-as.version>7.2.0.Alpha1-SNAPSHOT</jboss-as.version>
         <version.org.jboss.arquillian.core>1.0.0.Final</version.org.jboss.arquillian.core>
         <version.org.jboss.arquillian.osgi>1.0.2.Final</version.org.jboss.arquillian.osgi>
   </properties>",2012-06-18T12:41:58Z,39
"@@ -0,0 +1,2 @@
+export UPSTREAM_AS_BRANCH=master
+export ORIGIN_AS_BRANCH=5_BRANCH
\ No newline at end of file",2013-02-08T16:09:11Z,267
"@@ -0,0 +1,36 @@
+function fatal {
+  echo ""Failed: $1""
+  exit 1
+}
+
+. branch-names.sh
+
+echo ""Rebaseing origin/$ORIGIN_AS_BRANCH with upstream/$UPSTREAM_AS_BRANCH""
+
+GIT_URL=""git@github.com:jbosstm/jboss-as.git""
+UPSTREAM_GIT_URL=""https://github.com/jbossas/jboss-as.git""
+TEMPORARY_REBASE_LOCATION=/tmp/rebase-jbossas-branch
+
+rm -rf $TEMPORARY_REBASE_LOCATION || fatal
+mkdir $TEMPORARY_REBASE_LOCATION || fatal
+cd $TEMPORARY_REBASE_LOCATION || fatal
+
+git clone $GIT_URL || fatal
+cd jboss-as
+git checkout -t origin/$ORIGIN_AS_BRANCH || fatal
+
+git remote add upstream $UPSTREAM_GIT_URL
+git pull --rebase --ff-only upstream $UPSTREAM_AS_BRANCH
+
+while [ $? != 0 ]
+do
+ for i in `git status -s | sed ""s/UU \(.*\)/\1/g""`
+ do
+    awk '/^<+ HEAD$/,/^=+$/{next} /^>+ /{next} 1' $i > $i.bak; mv $i.bak $i; git add $i
+ done
+ git rebase --continue
+done
+[ $? = 0 ] || fatal ""git rebase failed""
+
+git push origin $ORIGIN_AS_BRANCH -f
+rm -rf $TEMPORARY_REBASE_LOCATION",2013-02-08T16:09:11Z,268
"@@ -69,13 +69,12 @@
     <property name=""version"" value=""5.0.0.M2-SNAPSHOT""/>
 -->
   <!-- a working directory for the process. Can contain output from previous releases if you like to keep them archived locally. -->
-  <!--property name=""workdir"" location=""/tmp/narayana_releases""/-->
+  <property name=""workdir"" location=""/tmp/narayana_releases""/>
   <!-- where to get the source -->
-  <property name=""svnbase"" value=""https://svn.jboss.org/repos/labs/labs/jbosstm/tags""/>
+  <property name=""gitbase"" value=""https://github.com/jbosstm""/>
   <!-- The tag as it appears under svnbase -->
-  <property name=""tag"" value=""5_0_0_M1""/>
-  <!-- The file name base for the user downloadable files. Derive it from the tag -->
-  <property name=""version"" value=""5.0.0.M1""/>
+  <property name=""pageName"" value=""4_17_0_Final""/>
+  <property name=""tag"" value=""4.17.0.Final""/>
   <!-- which uber jar to use -->
   <property name=""orb"" value=""jacorb""/>
   <!-- the location the JBossTS web site content is copied to -->
@@ -100,40 +99,116 @@
         </not>
       </condition>
     </fail>
-    <fail message=""You must not already have a local maven cached repository to do a release build"">
-      <condition>
-        <available file=""repository"" type=""dir""/>
-      </condition>
-    </fail>
     <fail message=""You cannot perform a build without cleaning the old version out"">
       <condition>
         <available file=""${workdir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <mkdir dir=""${workdir}""/>
-    <!-- pull the source code from svn -->
-    <exec executable=""svn"" dir=""${workdir}"">
+    <!-- pull the source code from git -->
+    <exec executable=""git"" dir=""${workdir}"">
+      <arg value=""clone""/>
+      <arg value=""${gitbase}/narayana.git""/>
+      <arg value=""${tag}""/>
+    </exec>
+    <exec executable=""git"" dir=""${workdir}/${tag}"">
       <arg value=""checkout""/>
-      <arg value=""${svnbase}/${tag}""/>
+      <arg value=""${tag}""/>
     </exec>
   </target>
   <target name=""dist"" depends=""dist-init"" description=""build the end-user release bundles (src and binary)"">
     <!-- build the binary releases -->
     <exec dir=""${workdir}/${tag}"" executable=""tools/maven/bin/mvn"" failonerror=""true"">
       <arg line=""clean -gs tools/maven/conf/settings.xml -Demma.jar.location=${user.dir}/ext/emma.jar -Dorson.jar.location=${user.dir}/ext/orson-0.5.0.jar""/>
     </exec>
-    <!-- package the JTA only src tree (no JTS, XTS, txbridge, RTS) -->
-    <delete file=""${workdir}/narayana-jta-${version}-src.zip""/>
-    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-jta-${version}-src.zip"" includes=""${tag}/**"" excludes=""${tag}/ArjunaJTS/**, ${tag}/XTS/** ${tag}/txbridge/**, ${tag}/rest-tx/**, ${tag}/repository/**""/>
     <!-- package the full source release (all src tree) -->
-    <delete file=""${workdir}/narayana-full-${version}-src.zip""/>
-    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-full-${version}-src.zip"" includes=""${tag}/**"" excludes=""${tag}/repository/**""/>
+    <delete file=""${workdir}/narayana-full-${tag}-src.zip""/>
+    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-full-${tag}-src.zip"" includes=""${tag}/**""/>
     <!-- build the binary releases -->
     <exec dir=""${workdir}/${tag}"" executable=""tools/maven/bin/mvn"" failonerror=""true"">
       <arg line=""deploy -DskipTests -gs tools/maven/conf/settings.xml -Demma.jar.location=${user.dir}/ext/emma.jar -Dorson.jar.location=${user.dir}/ext/orson-0.5.0.jar""/>
     </exec>
   </target>
   <!-- copy the release into the downloads dir tree (http://www.jboss.org/jbosstm web site content) -->
+  <target name=""docs"">
+    <fail>
+      <condition>
+        <not>
+          <available file=""${downloads.dir}"" type=""dir""/>
+        </not>
+      </condition>
+    </fail>
+    <fail>
+      <condition>
+        <not>
+          <available file=""${docs.dir}"" type=""dir""/>
+        </not>
+      </condition>
+    </fail>
+
+    <exec executable=""git"" dir=""${workdir}"">
+      <arg value=""clone""/>
+      <arg value=""${gitbase}/documentation.git""/>
+      <arg value=""${tag}-docs""/>
+    </exec>
+    <exec executable=""git"" dir=""${workdir}/${tag}-docs"">
+      <arg value=""checkout""/>
+      <arg value=""${tag}""/>
+    </exec>
+    <exec dir=""${workdir}/${tag}-docs"" executable=""mvn"" failonerror=""true"">
+      <arg line=""install""/>
+    </exec>
+    <delete dir=""tmp-docs-dir-docs""/>
+    <mkdir dir=""tmp-docs-dir-docs""/>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-orbportability_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/orbportability_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-quick_start_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/quick_start_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-administration_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/administration_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/arjunacore-failure_recovery_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaCore/docs/failure_recovery_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/arjunacore-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaCore/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-quick_start_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/quick_start_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-installation_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/installation_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-administration_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/administration_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/xts-administration_and_development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/XTS/docs/administration_and_development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/failure_recovery_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/failure_recovery_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/transactions_overview_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/transactions_overview_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/txbridge_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/txbridge_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <move todir=""${docs.dir}/${tag}"" verbose=""true"">
+      <fileset dir=""tmp-docs-dir-docs""/>
+    </move>
+  </target> 
   <target name=""downloads"" description=""copy release bundles to JBossTS web site content"">
     <fail>
       <condition>
@@ -144,7 +219,7 @@
     </fail>
     <fail>
       <condition>
-        <available file=""${downloads.dir}/${version}"" type=""dir""/>
+        <available file=""${downloads.dir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <fail>
@@ -156,7 +231,7 @@
     </fail>
     <fail>
       <condition>
-        <available file=""${docs.dir}/${version}"" type=""dir""/>
+        <available file=""${docs.dir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <delete dir=""tmp-downloads-dir""/>
@@ -167,91 +242,37 @@
     <delete dir=""tmp-docs-dir""/>
     <mkdir dir=""tmp-docs-dir""/>
     <copy todir=""tmp-downloads-dir/src"">
-      <fileset dir=""${workdir}"" includes=""narayana-*-${version}-src.zip""/>
+      <fileset dir=""${workdir}"" includes=""narayana-*-${tag}-src.zip""/>
     </copy>
     <copy todir=""tmp-downloads-dir/binary"">
-      <fileset dir=""${workdir}/${tag}/narayana-full/target/"" includes=""narayana-full-${version}-bin.zip""/>
+      <fileset dir=""${workdir}/${tag}/narayana-full/target/"" includes=""narayana-full-${tag}-bin.zip""/>
     </copy>
     <copy todir=""tmp-downloads-dir/idl"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/jts/idl/arjuna"">
+      <fileset dir=""${workdir}/${tag}/ArjunaJTS/idl/src/main/idl/arjuna"">
         <include name=""ArjunaOTS.idl""/>
       </fileset>
     </copy>
     <copy todir=""tmp-downloads-dir/idl"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/jts/idl/omg"">
+      <fileset dir=""${workdir}/${tag}/ArjunaJTS/idl/src/main/idl/omg"">
         <include name=""CosTransactions.idl""/>
         <include name=""XA.idl""/>
       </fileset>
     </copy>
-    <copy file=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/narayana-jts-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/jta""/>
-    <copy file=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/jts""/>
-    <copy file=""${workdir}/${tag}/rest-tx/tx/target/rest-tx-api-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/rts""/>
-    <copy file=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/xts""/>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-orbportability_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/orbportability_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-quick_start_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/quick_start_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-administration_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/administration_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/arjunacore-failure_recovery_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaCore/docs/failure_recovery_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/arjunacore-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaCore/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-quick_start_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/quick_start_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-installation_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/installation_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-administration_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/administration_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/xts-administration_and_development_guide"">
-      <fileset dir=""${workdir}/${tag}/XTS/docs/administration_and_development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/failure_recovery_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/failure_recovery_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/release_notes"">
-      <fileset dir=""${workdir}/${tag}/docs/release_notes/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/development_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/transactions_overview_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/transactions_overview_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/txbridge_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/txbridge_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <unzip src=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/narayana-jts-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/jts""/>
-    <unzip src=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/jta""/>
-    <unzip src=""${workdir}/${tag}/rest-tx/tx/target/rest-tx-api-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/rts""/>
-    <unzip src=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/xts""/>
-    <move todir=""${downloads.dir}/${version}"" verbose=""true"">
+    <copy file=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/jbossjts-jacorb-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/jts""/>
+    <copy file=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/jta""/>
+    <copy file=""${workdir}/${tag}/rest-tx/tx/target/restat-api-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/rts""/>
+    <copy file=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/xts""/>
+    <unzip src=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/jbossjts-jacorb-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/jts""/>
+    <unzip src=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/jta""/>
+    <unzip src=""${workdir}/${tag}/rest-tx/tx/target/restat-api-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/rts""/>
+    <unzip src=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/xts""/>
+    <move todir=""${downloads.dir}/${tag}"" verbose=""true"">
       <fileset dir=""tmp-downloads-dir""/>
     </move>
-    <move todir=""${docs.dir}/${version}"" verbose=""true"">
+    <move todir=""${docs.dir}/${tag}"" verbose=""true"">
       <fileset dir=""tmp-docs-dir""/>
     </move>
   </target>
-  <!-- copy the release artifacts to the maven repository -->
-  <target name=""mvn-repository"" description=""copy the release artifacts to the maven repository"">
-    <!-- xts -->
-    <mvn-artifact.macro artifact=""jbossxts-tests"" packaging=""zip"" dir=""${workdir}/build/${tag}/xts/tests""/>
-    <mvn-artifact.macro artifact=""jbossxts-interop-tests"" packaging=""zip"" dir=""${workdir}/build/${tag}/xts/interop-tests""/>
-  </target>
   <!-- magnolia (the cms that sits behind jboss.org/jbosstm pages) is a pain. This target generates
      xml for /downloads/somerelease.xml pages to ease some of the pain in publishing an upload
       right click jbosstm/downloads node, import from xml, then right click new node and activate.
@@ -261,20 +282,24 @@
     <exec executable=""date"" outputproperty=""date"">
       <arg line=""+'%FT%H:%M:%S.000Z'""/>
     </exec>
-    <length property=""jta-src-length"" file=""${workdir}/jbossts-jta-${version}-src.zip""/>
-    <length property=""full-src-length"" file=""${workdir}/jbossts-full-${version}-src.zip""/>
-    <length property=""jta-bin-length"" file=""${workdir}/jbossts-jta-${version}.zip""/>
-    <length property=""full-bin-length"" file=""${workdir}/jbossts-full-${version}.zip""/>
-    <copy file=""magnolia-release-download-page-template.xml"" tofile=""${workdir}/website.jbosstm.downloads.${version}.xml"" filtering=""true"" overwrite=""true"">
+    <length property=""full-src-length"" file=""${workdir}/narayana-full-${tag}-src.zip""/>
+    <length property=""full-bin-length"" file=""${workdir}/${tag}/narayana-full/target/narayana-full-${tag}-bin.zip""/>
+    <copy file=""magnolia-release-download-page-template.xml"" tofile=""${workdir}/website.jbosstm.downloads.${pageName}.xml"" filtering=""true"" overwrite=""true"">
       <filterset>
+        <filter token=""pageName"" value=""${pageName}""/>
         <filter token=""tag"" value=""${tag}""/>
-        <filter token=""version"" value=""${version}""/>
+        <filter token=""version"" value=""${tag}""/>
         <filter token=""date"" value=""${date}""/>
-        <filter token=""jta-src-length"" value=""${jta-src-length}""/>
         <filter token=""full-src-length"" value=""${full-src-length}""/>
-        <filter token=""jta-bin-length"" value=""${jta-bin-length}""/>
         <filter token=""full-bin-length"" value=""${full-bin-length}""/>
       </filterset>
     </copy>
+    <copy file=""magnolia-release-documentation-page-template.xml"" tofile=""${workdir}/website.jbosstm.documentation.${pageName}.xml"" filtering=""true"" overwrite=""true"">
+      <filterset>
+        <filter token=""pageName"" value=""${pageName}""/>
+        <filter token=""tag"" value=""${tag}""/>
+        <filter token=""date"" value=""${date}""/>
+      </filterset>
+    </copy>
   </target>
 </project>",2012-09-25T19:52:29Z,269
"@@ -0,0 +1,237 @@
+<?xml version=""1.0"" encoding=""UTF-8""?>
+<sv:node sv:name=""@pageName@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
+  <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+    <sv:value>mgnl:content</sv:value>
+  </sv:property>
+  <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+    <sv:value>mix:lockable</sv:value>
+  </sv:property>
+  <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+    <sv:value>14f62a08-1dfe-41b3-bdce-61ce87b8129d</sv:value>
+  </sv:property>
+  <sv:property sv:name=""enableRSS"" sv:type=""String"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""hideInNav"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""menubar"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaCache"" sv:type=""String"">
+    <sv:value>disable</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaExpire"" sv:type=""String"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaRobots"" sv:type=""String"">
+    <sv:value>all</sv:value>
+  </sv:property>
+  <sv:property sv:name=""redirectWindow"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""title"" sv:type=""String"">
+    <sv:value>Narayana Documentation @tag@</sv:value>
+  </sv:property>
+  <sv:property sv:name=""useTitle"" sv:type=""Boolean"">
+    <sv:value>true</sv:value>
+  </sv:property>
+  <sv:node sv:name=""MetaData"">
+    <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+      <sv:value>mgnl:metaData</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+      <sv:value>true</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+      <sv:value>superuser</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+      <sv:value>tm</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:comment"" sv:type=""String"">
+      <sv:value>Made references to git and subversion</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+      <sv:value>2009-12-10T11:47:09.824-05:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+      <sv:value>2012-04-27T05:09:36.605-04:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+      <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:template"" sv:type=""String"">
+      <sv:value>jbossorgProjectSubPage</sv:value>
+    </sv:property>
+  </sv:node>
+  <sv:node sv:name=""mainColumnParagraphs"">
+    <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+      <sv:value>mgnl:contentNode</sv:value>
+    </sv:property>
+    <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+      <sv:value>mix:lockable</sv:value>
+    </sv:property>
+    <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+      <sv:value>43dab693-c6e7-4eda-869e-5b1d9ad358d5</sv:value>
+    </sv:property>
+    <sv:node sv:name=""MetaData"">
+      <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+        <sv:value>mgnl:metaData</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+        <sv:value>true</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+        <sv:value>superuser</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+        <sv:value>tm</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+        <sv:value>2009-12-10T11:47:46.060-05:00</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+        <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+        <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+      </sv:property>
+    </sv:node>
+    <sv:node sv:name=""0"">
+      <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+        <sv:value>mgnl:contentNode</sv:value>
+      </sv:property>
+      <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+        <sv:value>mix:lockable</sv:value>
+      </sv:property>
+      <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+        <sv:value>6aec081e-5217-4adf-b06c-8c5bf92a886b</sv:value>
+      </sv:property>
+      <sv:property sv:name=""flow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""headerSize"" sv:type=""String"">
+        <sv:value>h3</sv:value>
+      </sv:property>
+      <sv:property sv:name=""imageLinkNewWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""imageLocation"" sv:type=""String"">
+        <sv:value>left</sv:value>
+      </sv:property>
+      <sv:property sv:name=""inherit"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""lineAbove"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkImage"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkText"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkTitle"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkWindowMenubar"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""spacer"" sv:type=""Long"">
+        <sv:value>0</sv:value>
+      </sv:property>
+      <sv:property sv:name=""text"" sv:type=""String"">
+        <sv:value>&lt;h1&gt;JBoss Narayana Documentation Library&lt;/h1&gt; &lt;p&gt; &lt;table cellspacing=""5"" class=""infotable"" style=""margin: 2px; padding: 2px; font-size: 90%;""&gt;     &lt;tbody&gt;         &lt;tr&gt;             &lt;th width=""220"" class=""grey""&gt;JBoss Narayana Document&lt;/th&gt;             &lt;th width=""80"" class=""grey""&gt;Version&lt;/th&gt;             &lt;th width=""80"" class=""grey""&gt;Released&lt;/th&gt;             &lt;th class=""blank""&gt;&amp;nbsp;&lt;/th&gt;             &lt;th class=""blank""&gt;&amp;nbsp;&lt;/th&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ORB Portability Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-orbportability_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;NarayanaJTS Quick Start Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-quick_start_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTS Administration Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-administration_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTS Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ArjunaCore Failure Recovery Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/arjunacore-failure_recovery_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ArjunaCore Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/arjunacore-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Quick Start Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-quick_start/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Installation Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-installation_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Administration Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-administration_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;XTS Administration and Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/xts-administration_and_development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Failure Recovery Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/failure_recovery_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Release Notes&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/release_notes/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Transactions Overview Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/transactions_overview_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;TXBridge Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/txbridge_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/jts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/jts/jbossjts-jacorb-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTA API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/jta/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/jta/narayana-jta-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;RTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/rts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/rts/restat-api-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;XTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/xts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/xts/jbossxts-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - ArjunaOTS&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/ArjunaOTS.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - CosTransactions.idl&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/CosTransactions.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - XA&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/XA.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;     &lt;/tbody&gt; &lt;/table&gt; &lt;/p&gt;</sv:value>
+      </sv:property>
+      <sv:property sv:name=""titleLinkNewWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:node sv:name=""MetaData"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:metaData</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+          <sv:value>true</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+          <sv:value>superuser</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+          <sv:value>tm</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+          <sv:value>2009-12-10T11:47:46.061-05:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+          <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+          <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:template"" sv:type=""String"">
+          <sv:value>richTextHtml</sv:value>
+        </sv:property>
+      </sv:node>
+      <sv:node sv:name=""text_files"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:contentNode</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+          <sv:value>mix:lockable</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+          <sv:value>41f11088-5628-42b3-8c36-51b7a4199eaf</sv:value>
+        </sv:property>
+        <sv:node sv:name=""MetaData"">
+          <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+            <sv:value>mgnl:metaData</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+            <sv:value>true</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+            <sv:value>superuser</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+            <sv:value>2009-12-10T11:47:46.061-05:00</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+            <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+          </sv:property>
+        </sv:node>
+      </sv:node>
+      <sv:node sv:name=""imageFooter_files"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:contentNode</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+          <sv:value>mix:lockable</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+          <sv:value>6b6abc15-1022-44a0-917e-29a9691832e4</sv:value>
+        </sv:property>
+        <sv:node sv:name=""MetaData"">
+          <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+            <sv:value>mgnl:metaData</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+            <sv:value>true</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+            <sv:value>superuser</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+            <sv:value>2009-12-10T11:47:46.064-05:00</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+            <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+          </sv:property>
+        </sv:node>
+      </sv:node>
+    </sv:node>
+  </sv:node>
+</sv:node>",2012-09-25T19:52:29Z,270
"@@ -1,5 +1,5 @@
 <?xml version=""1.0"" encoding=""UTF-8""?>
-<sv:node sv:name=""@tag@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
+<sv:node sv:name=""@pageName@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
   <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
     <sv:value>mgnl:content</sv:value>
   </sv:property>
@@ -31,7 +31,7 @@
     <sv:value>false</sv:value>
   </sv:property>
   <sv:property sv:name=""title"" sv:type=""String"">
-    <sv:value>JBossTS @filename@ release</sv:value>
+    <sv:value>JBossTS @tag@ release</sv:value>
   </sv:property>
   <sv:property sv:name=""useTitle"" sv:type=""String"">
     <sv:value>true</sv:value>
@@ -99,12 +99,6 @@
       <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
         <sv:value>00bd1847-65cd-4ff1-b7ce-20b8084be52b</sv:value>
       </sv:property>
-      <sv:property sv:name=""desc21"" sv:type=""String"">
-        <sv:value>The JBoss Transactions JTA @filename@ Source</sv:value>
-      </sv:property>
-      <sv:property sv:name=""desc22"" sv:type=""String"">
-        <sv:value>JBoss Transactions JTA @filename@ Binary</sv:value>
-      </sv:property>
       <sv:property sv:name=""desc23"" sv:type=""String"">
         <sv:value>JBoss Transactions JTS (and JTA) and WS-T Source Code</sv:value>
       </sv:property>
@@ -123,17 +117,11 @@
       <sv:property sv:name=""license24"" sv:type=""String"">
         <sv:value>LGPL</sv:value>
       </sv:property>
-      <sv:property sv:name=""name21"" sv:type=""String"">
-        <sv:value>jbossts-jta-@filename@-src.zip</sv:value>
-      </sv:property>
-      <sv:property sv:name=""name22"" sv:type=""String"">
-        <sv:value>jbossts-jta-@filename@.zip</sv:value>
-      </sv:property>
       <sv:property sv:name=""name23"" sv:type=""String"">
-        <sv:value>jbossts-full-@filename@-src.zip</sv:value>
+        <sv:value>narayana-full-@tag@-src.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""name24"" sv:type=""String"">
-        <sv:value>jbossts-full-@filename@.zip</sv:value>
+        <sv:value>narayana-full-@tag@-bin.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""popup"" sv:type=""String"">
         <sv:value>true</sv:value>
@@ -168,20 +156,14 @@
       <sv:property sv:name=""showVersion"" sv:type=""String"">
         <sv:value>false</sv:value>
       </sv:property>
-      <sv:property sv:name=""size21"" sv:type=""String"">
-        <sv:value>@jta-src-length@</sv:value>
-      </sv:property>
-      <sv:property sv:name=""size22"" sv:type=""String"">
-        <sv:value>@full-src-length@</sv:value>
-      </sv:property>
       <sv:property sv:name=""size23"" sv:type=""String"">
-        <sv:value>@jta-bin-length@</sv:value>
+        <sv:value>@full-src-length@</sv:value>
       </sv:property>
       <sv:property sv:name=""size24"" sv:type=""String"">
         <sv:value>@full-bin-length@</sv:value>
       </sv:property>
       <sv:property sv:name=""tableTitle"" sv:type=""String"">
-        <sv:value>JBossTS @filename@ release</sv:value>
+        <sv:value>JBossTS @tag@ release</sv:value>
       </sv:property>
       <sv:property sv:name=""text21"" sv:type=""String"">
         <sv:value>Download</sv:value>
@@ -195,17 +177,11 @@
       <sv:property sv:name=""text24"" sv:type=""String"">
         <sv:value>Download</sv:value>
       </sv:property>
-      <sv:property sv:name=""url21"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/src/jbossts-jta-@filename@-src.zip</sv:value>
-      </sv:property>
-      <sv:property sv:name=""url22"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/binary/jbossts-jta-@filename@.zip</sv:value>
-      </sv:property>
       <sv:property sv:name=""url23"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/src/jbossts-full-@filename@-src.zip</sv:value>
+        <sv:value>http://www.jboss.org/jbosstm/downloads/@tag@/src/narayana-full-@tag@-src.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""url24"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/binary/jbossts-full-@filename@.zip</sv:value>
+        <sv:value>http://www.jboss.org/jbosstm/downloads/@tag@/binary/narayana-full-@tag@-bin.zip</sv:value>
       </sv:property>
       <sv:node sv:name=""MetaData"">
         <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">",2012-09-25T19:52:29Z,271
"@@ -890,9 +890,6 @@ public interface wstI18NLogger {
 	@LogMessage(level = WARN)
 	public void warn_recovery_participant_ba_BAParticipantRecoveryRecord_saveState_3(String arg0, @Cause() Throwable arg1);
 
-    @Message(id = 43228, value = ""Delay of {0} ms reached before changing state from {1} to something else"", format = MESSAGE_FORMAT)
-   	@LogMessage(level = WARN)
-   	public void warn_state_change_timeout(String arg0, String arg1);
 
     /*
         Allocate new messages directly above this notice.",2013-01-15T16:13:39Z,272
"@@ -526,7 +526,6 @@ private State waitForState(final State origState, final long delay)
                 final long remaining = end - System.currentTimeMillis() ;
                 if (remaining <= 0)
                 {
-                    WSTLogger.i18NLogger.warn_state_change_timeout(String.valueOf(delay), origState.toString());
                     break ;
                 }
                 try",2013-01-15T16:13:39Z,72
"@@ -183,7 +183,7 @@
                                 <!--
                                     Used in arquillian.xml
                                 -->
-                                <server.jvm.args>${jvm.args.byteman} ${jvm.args.memory} -Dorg.jboss.jbossts.xts.transport.transportTimeout=60000</server.jvm.args>
+                                <server.jvm.args>${jvm.args.byteman} ${jvm.args.memory}</server.jvm.args>
                             </systemPropertyVariables>
                         </configuration>
                     </plugin>",2013-01-15T16:13:39Z,41
"@@ -15,15 +15,18 @@ if [ """" == ""$JBOSS_BUILD_HOME"" ]; then
 fi
 
 if [ ""$2"" == ""--clean"" ] || [ ""$3"" == ""--clean"" ]; then
+    echo ""Cleaning""
     CLEAN=clean
 fi
 
 if [ ""$2"" == ""--xts"" ] || [ ""$3"" == ""--xts"" ]; then
+    echo ""Rebuilding XTS""
     cd ..
     ./build.sh -f ./XTS/pom.xml $CLEAN install -DskipTests || fail
     cd -
 fi
 
+
 mvn $CLEAN install || fail
 kill-jboss
 $JBOSS_BUILD_HOME/build.sh $CLEAN install -f $JBOSS_BUILD_HOME/xts/pom.xml -DskipTests || fail",2013-01-15T16:13:39Z,198
"@@ -55,7 +55,7 @@ public class ATBridgeImpl implements ATBridge {
     public void incrementCounter(int how_many) {
 
         SimpleEntity entity = getSimpleEntity();
-        entity.incrimentCounter(how_many);
+        entity.incrementCounter(how_many);
         em.merge(entity);
     }
 
@@ -81,7 +81,7 @@ private SimpleEntity getSimpleEntity() {
 
         SimpleEntity entity = em.find(SimpleEntity.class, ENTITY_ID);
         if (entity == null) {
-            entity = new SimpleEntity();
+            entity = new SimpleEntity(ENTITY_ID, 0);
             em.persist(entity);
         }
 ",2013-01-15T16:13:39Z,273
"@@ -1,6 +1,6 @@
 /*
  * JBoss, Home of Professional Open Source.
- * Copyright 2012, Red Hat, Inc., and individual contributors
+ * Copyright 2013, Red Hat, Inc., and individual contributors
  * as indicated by the @author tags. See the copyright.txt file in the
  * distribution for a full listing of individual contributors.
  *",2013-01-15T16:13:39Z,201
"@@ -22,7 +22,6 @@
 package org.jboss.narayana.txframework.functional.ws.at.bridged;
 
 import javax.persistence.Entity;
-import javax.persistence.GeneratedValue;
 import javax.persistence.Id;
 import java.io.Serializable;
 
@@ -41,8 +40,13 @@ public SimpleEntity() {
 
     }
 
+    public SimpleEntity(int id, int initialCounterValue) {
+
+        this.id = id;
+        this.bookingCount = initialCounterValue;
+    }
+
     @Id
-    @GeneratedValue
     public int getId() {
 
         return id;
@@ -63,8 +67,8 @@ public void setCounter(int counter) {
         this.bookingCount = counter;
     }
 
-    public void incrimentCounter(int how_many) {
+    public void incrementCounter(int howMany) {
 
-        setCounter(getCounter() + how_many);
+        setCounter(getCounter() + howMany);
     }
 }",2013-01-15T16:13:39Z,274
"@@ -87,26 +87,6 @@
                     <target>1.6</target>
                 </configuration>
             </plugin>
-            <plugin>
-                <groupId>org.apache.maven.plugins</groupId>
-                <artifactId>maven-surefire-plugin</artifactId>
-                <configuration>
-                    <skip>true</skip>
-                    <!-- Prevent test and server output appearing in console. -->
-                    <redirectTestOutputToFile>true</redirectTestOutputToFile>
-                    <enableAssertions>true</enableAssertions>
-                    <!-- Tests to execute. -->
-                    <includes>
-                        <include>**/*Tests.java</include>
-                    </includes>
-                    <!-- System properties passed to test cases -->
-                    <systemPropertyVariables>
-                        <!-- Used in arquillian.xml - arguments for all JBoss AS instances. -->
-                        <server.jvm.args>${general.server.jvm.args} ${byteman.server.jvm.args} ${jpda.server.jvm.args}</server.jvm.args>
-                        <java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
-                    </systemPropertyVariables>
-                </configuration>
-            </plugin>
         </plugins>
         <pluginManagement>
         	<plugins>
@@ -233,4 +213,58 @@
         </dependency>
 
     </dependencies>
+	<profiles>
+		<profile>
+			<id>default</id>
+			<activation>
+				<activeByDefault>true</activeByDefault>
+			</activation>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-surefire-plugin</artifactId>
+						<configuration>
+							<skip>true</skip>
+						</configuration>
+					</plugin>
+				</plugins>
+			</build>
+		</profile>
+		<profile>
+			<id>arq</id>
+			<activation>
+				<activeByDefault>false</activeByDefault>
+			</activation>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-surefire-plugin</artifactId>
+						<configuration>
+							<!-- Prevent test and server output appearing in console. -->
+							<redirectTestOutputToFile>true</redirectTestOutputToFile>
+							<enableAssertions>true</enableAssertions>
+							<!-- Tests to execute. -->
+							<includes>
+								<include>**/*Tests.java</include>
+							</includes>
+							<!-- System properties passed to test cases -->
+							<systemPropertyVariables>
+								<!-- Used in arquillian.xml - arguments for all JBoss AS instances. -->
+								<server.jvm.args>${general.server.jvm.args} ${byteman.server.jvm.args} ${jpda.server.jvm.args}</server.jvm.args>
+								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
+							</systemPropertyVariables>
+						</configuration>
+					</plugin>
+				</plugins>
+			</build>
+			<dependencies>
+				<dependency>
+					<groupId>org.jboss.as</groupId>
+					<artifactId>jboss-as-arquillian-container-managed</artifactId>
+					<version>${jboss-as.version}</version>
+					<scope>test</scope>
+				</dependency>
+			</dependencies>
+		</profile>
+	</profiles>
 </project>",2012-05-07T06:29:32Z,162
"@@ -0,0 +1,30 @@
+<?xml version=""1.0"" encoding=""UTF-8""?>
+<!-- JBoss, Home of Professional Open Source Copyright 2008, Red Hat Middleware LLC, and others contributors as indicated by the @authors tag. All rights reserved. See the copyright.txt in the distribution 
+	for a full listing of individual contributors. This copyrighted material is made available to anyone wishing to use, modify, copy, or redistribute it subject to the terms and conditions of the GNU Lesser 
+	General Public License, v. 2.1. This program is distributed in the hope that it will be useful, but WITHOUT A WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR 
+	PURPOSE. See the GNU Lesser General Public License for more details. You should have received a copy of the GNU Lesser General Public License, v.2.1 along with this distribution; if not, write to the Free 
+	Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA. -->
+<project xmlns=""http://maven.apache.org/POM/4.0.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
+         xsi:schemaLocation=""http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"">
+    <parent>
+        <groupId>org.jboss.narayana.xts</groupId>
+        <artifactId>xts-all</artifactId>
+        <version>5.0.0.M2-SNAPSHOT</version>
+        <relativePath>../pom.xml</relativePath>
+    </parent>
+    <modelVersion>4.0.0</modelVersion>
+    <artifactId>byteman_support</artifactId>
+    <packaging>jar</packaging>
+    <name>Reusable Byteman rules for xts</name>
+    
+    <dependencies>
+        <dependency>
+            <groupId>org.jboss.byteman</groupId>
+            <artifactId>byteman</artifactId>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.byteman</groupId>
+            <artifactId>byteman-submit</artifactId>
+        </dependency>
+    </dependencies>
+</project>",2012-12-07T10:03:43Z,275
"@@ -0,0 +1,53 @@
+package org.jboss.jbossts.xts.bytemanSupport;
+
+import org.jboss.byteman.agent.submit.Submit;
+
+import java.io.IOException;
+import java.io.InputStream;
+import java.net.URL;
+import java.util.ArrayList;
+import java.util.List;
+
+/**
+ * @Author paul.robinson@redhat.com 22/11/2012
+ */
+public class BMScript {
+
+    private static final Submit submit = new Submit();
+
+    public static void submit(String scriptResourcePath) {
+
+        try {
+            List<InputStream> streams = getScriptFromResource(scriptResourcePath);
+            submit.addRulesFromResources(streams);
+        } catch (Exception e) {
+            throw new RuntimeException(""Failed to submit Byteman script"", e);
+        }
+    }
+
+    public static void remove(String scriptResourcePath) {
+
+        try {
+            List<InputStream> streams = getScriptFromResource(scriptResourcePath);
+            submit.deleteRulesFromResources(streams);
+        } catch (Exception e) {
+            throw new RuntimeException(""Failed to remove Byteman script"", e);
+        }
+    }
+
+    private static List<InputStream> getScriptFromResource(String scriptResourcePath) {
+        URL resource = Thread.currentThread().getContextClassLoader().getResource(scriptResourcePath);
+        if (resource == null) {
+            throw new RuntimeException(""'"" + scriptResourcePath + ""' can't be found on the classpath"");
+        }
+
+        List<InputStream> streams = new ArrayList<InputStream>();
+        try {
+            streams.add(resource.openStream());
+        } catch (IOException e) {
+            throw new RuntimeException(""Unable to open stream at url location: "" + resource.toString());
+        }
+        return streams;
+    }
+
+}",2012-12-07T10:03:43Z,276
"@@ -0,0 +1,13 @@
+package org.jboss.jbossts.xts.bytemanSupport.participantCompletion;
+
+/**
+ * @Author paul.robinson@redhat.com 26/11/2012
+ */
+public class ParticipantCompletionCoordinatorRules {
+
+    public static String RESOURCE_PATH= ""org/jboss/jbossts/xts/bytemanSupport/participantCompletion/participant_completion_coordinator_rules.btm"";
+
+    public static void setParticipantCount(Integer participantCount) {
+        //Dummy method, detected by Byteman Rules
+    }
+}",2012-12-07T10:03:43Z,277
"@@ -0,0 +1,40 @@
+RULE create counter
+CLASS org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules
+METHOD setParticipantCount(Integer)
+BIND counter:Integer=$1
+IF TRUE
+DO debug(""participant_completion.counter.create: "" + counter),
+  deleteCounter(""completes""),
+  createCounter(""completes"", counter)
+ENDRULE
+
+RULE complete called
+CLASS com.arjuna.webservices11.wsba.sei.BusinessAgreementWithParticipantCompletionCoordinatorPortTypeImpl
+METHOD completedOperation(NotificationType)
+AT RETURN
+BIND NOTHING
+IF (debug(""participant_completion.counter.decrement"") AND decrementCounter(""completes"") == 0)
+DO debug(""participant_completion.called.waking""),
+   signalWake(""complete"", true),
+   debug(""participant_completion.called.donewake"")
+ENDRULE
+
+RULE close called
+CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
+METHOD closeOperation(NotificationType)
+BIND NOTHING
+IF TRUE
+DO debug(""participant_completion.close.waiting""),
+   waitFor(""complete""),
+   debug(""participant_completion.close.woken"")
+ENDRULE
+
+RULE cancel called
+CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
+METHOD cancelOperation(NotificationType)
+BIND NOTHING
+IF TRUE
+DO debug(""participant_completion.cancel.waiting""),
+   waitFor(""complete""),
+   debug(""participant_completion.cancel.woken"")
+ENDRULE
\ No newline at end of file",2012-12-07T10:03:43Z,278
"@@ -67,8 +67,6 @@ public void testClose()
             throw eouter;
         }
 
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
 
 	    assertTrue(p.passed());",2012-12-07T10:03:43Z,279
"@@ -68,8 +68,6 @@ public void testExit()
             throw eouter;
         }
 
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
 
 	    assertTrue(p.passed());",2012-12-07T10:03:43Z,280
"@@ -73,8 +73,6 @@ public void testMultiClose()
             }
             throw eouter;
         }
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
         assertTrue(p.passed());
     }",2012-12-07T10:03:43Z,281
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -20,11 +24,23 @@ public class CloseTest {
 	public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				Close.class,
-				DemoBusinessParticipant.class);
+				DemoBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
 		test.testClose();
 	}
 }",2012-12-07T10:03:43Z,282
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -20,11 +24,23 @@ public class CompensateTest {
 	public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				Compensate.class,
-				DemoBusinessParticipant.class);
+				DemoBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
 		test.testCompensate();
 	}
 }",2012-12-07T10:03:43Z,283
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -14,6 +18,7 @@
 
 @RunWith(Arquillian.class)
 public class MultiCloseTest {
+    
 	@Inject
 	MultiClose test;
 	
@@ -22,11 +27,23 @@ public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				MultiClose.class,
 				DemoBusinessParticipant.class,
-				FailureBusinessParticipant.class);
+				FailureBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
-	
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(2);
 		test.testMultiClose();
 	}
 }",2012-12-07T10:03:43Z,281
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -22,11 +26,23 @@ public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				MultiCompensate.class,
 				DemoBusinessParticipant.class,
-				FailureBusinessParticipant.class);
+				FailureBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(2);
 		test.testMultiCompensate();
 	}
 }",2012-12-07T10:03:43Z,284
"@@ -18,18 +18,51 @@
 	<description>localjunit tests for xts</description>
         <properties>
             <buildType>11</buildType>
-            <general.server.jvm.args>-Xms64m -Xmx1024m -XX:MaxPermSize=512m</general.server.jvm.args>
+            <general.server.jvm.args>-Xms64m -Xmx1024m -XX:MaxPermSize=512m
+                                     -Dorg.jboss.byteman.verbose
+                                    -Djboss.modules.system.pkgs=org.jboss.byteman
+                                    -Dorg.jboss.byteman.transform.all
+                                    -javaagent:${project.build.directory}/lib/byteman.jar=listener:true
+            </general.server.jvm.args>
             <ipv4.server.jvm.args></ipv4.server.jvm.args>
             <ipv6.server.jvm.args>-Djboss.bind.address=[::1] -Djboss.bind.address.management=[::1] -Djboss.bind.address.unsecure=[::1] -Djava.net.preferIPv4Stack=false -Djava.net.preferIPv6Addresses=true</ipv6.server.jvm.args>
             <server.debug.args>Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5006</server.debug.args>
         </properties>
 
+    <build>
+        <plugins>
+                <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                      <artifactId>maven-dependency-plugin</artifactId>
+                      <executions>
+                        <execution>
+                          <id>copy-dependencies</id>
+                          <phase>test-compile</phase>
+                          <goals>
+                            <goal>copy-dependencies</goal>
+                          </goals>
+                          <configuration>
+                              <stripVersion>true</stripVersion>
+                              <includeGroupIds>org.jboss.byteman</includeGroupIds>
+                            <outputDirectory>${project.build.directory}/lib</outputDirectory>
+                          </configuration>
+                        </execution>
+                      </executions>
+                </plugin>
+        </plugins>
+    </build>
+
 	<dependencies>
 		<dependency>
 			<groupId>org.jboss.narayana.xts</groupId>
 			<artifactId>jbossxts</artifactId>
 			<scope>provided</scope>
 		</dependency>
+		<dependency>
+			<groupId>org.jboss.narayana.xts</groupId>
+			<artifactId>byteman_support</artifactId>
+            <scope>test</scope>
+		</dependency>
 		<dependency>
 			<groupId>junit</groupId>
 			<artifactId>junit</artifactId>
@@ -67,6 +100,37 @@
 				</plugins>
 			</build>
 		</profile>
+        <profile>
+      			<id>arq-remote</id>
+      			<activation>
+      				<activeByDefault>false</activeByDefault>
+      			</activation>
+      			<build>
+      				<plugins>
+      					<plugin>
+      						<artifactId>maven-surefire-plugin</artifactId>
+      						<configuration>
+      							<forkMode>once</forkMode>
+      							<systemPropertyVariables combine.children=""append"">
+      							<!--
+      							  Used in arquillian.xml
+      							-->
+      							  <server.jvm.args>${general.server.jvm.args} ${ipv4.server.jvm.args}</server.jvm.args>
+                                    <node.address>127.0.0.1</node.address>
+      							</systemPropertyVariables>
+      						</configuration>
+      					</plugin>
+      				</plugins>
+      			</build>
+      			<dependencies>
+      				<dependency>
+      					<groupId>org.jboss.as</groupId>
+      					<artifactId>jboss-as-arquillian-container-remote</artifactId>
+      					<version>${jboss-as.version}</version>
+      					<scope>test</scope>
+      				</dependency>
+      			</dependencies>
+      		</profile>
 		<profile>
 			<id>arq</id>
 			<activation>
@@ -83,7 +147,7 @@
 							  Used in arquillian.xml
 							-->
 							  <server.jvm.args>${general.server.jvm.args} ${ipv4.server.jvm.args}</server.jvm.args>
-                                                          <node.address>127.0.0.1</node.address>
+                              <node.address>127.0.0.1</node.address>
 							</systemPropertyVariables>
 						</configuration>
 					</plugin>",2012-12-07T10:03:43Z,34
"@@ -37,6 +37,7 @@
     </plugins>
   </build>
   <modules>
+    <module>byteman_support</module>
     <module>WSAS</module>
     <module>WSAS/xts-test-servlet</module>
     <module>WS-C</module>",2012-12-07T10:03:43Z,285
"@@ -52,6 +52,14 @@
     </plugins>
   </build>
   <dependencies>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman-submit</artifactId>
+    </dependency>
     <!-- START TEST -->
     <dependency>
       <groupId>junit</groupId>",2012-12-07T10:03:43Z,286
"@@ -942,6 +942,11 @@
         <artifactId>service</artifactId>
         <version>${project.version}</version>
       </dependency>
+      <dependency>
+	<groupId>org.jboss.narayana.xts</groupId>
+	<artifactId>byteman_support</artifactId>
+        <version>${project.version}</version>
+      </dependency>
       <dependency>
         <groupId>org.jboss.narayana.rts</groupId>
         <artifactId>restat-web</artifactId>
@@ -973,27 +978,27 @@
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-install</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-submit</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-bmunit</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-dtest</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
   </dependencies>
   </dependencyManagement>",2012-12-07T10:03:43Z,39
"@@ -37,6 +37,24 @@
                     <skip>true</skip>
                 </configuration>
             </plugin>
+            <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-dependency-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>copy-dependencies</id>
+                      <phase>test-compile</phase>
+                      <goals>
+                        <goal>copy-dependencies</goal>
+                      </goals>
+                      <configuration>
+                          <stripVersion>true</stripVersion>
+                          <includeGroupIds>org.jboss.byteman</includeGroupIds>
+                        <outputDirectory>${project.build.directory}/lib</outputDirectory>
+                      </configuration>
+                    </execution>
+                  </executions>
+            </plugin>
         </plugins>
     </build>
 
@@ -112,6 +130,11 @@
                 </exclusion>
             </exclusions>
         </dependency>
+	<dependency>
+	   <groupId>org.jboss.narayana.xts</groupId>
+	   <artifactId>byteman_support</artifactId>
+           <scope>test</scope>
+	</dependency>
         <dependency>
             <groupId>org.jboss.narayana.rts</groupId>
             <artifactId>restat-util</artifactId>",2012-12-07T10:03:43Z,41
"@@ -5,6 +5,8 @@
 import com.arjuna.wst.TransactionRolledBackException;
 import junit.framework.Assert;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Close;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Compensate;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.ConfirmCompleted;
@@ -13,7 +15,9 @@
 import org.jboss.narayana.txframework.functional.common.SomeApplicationException;
 import org.jboss.narayana.txframework.functional.interfaces.BAParticipantCompletion;
 import org.junit.After;
+import org.junit.AfterClass;
 import org.junit.Before;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -27,6 +31,17 @@ public class BAParticipantCompletionTest extends BaseFunctionalTest
     UserBusinessActivity uba;
     BAParticipantCompletion client;
 
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
     @Before
     public void setupTest() throws Exception
     {
@@ -45,9 +60,10 @@ public void teardownTest() throws Exception
     @Test
     public void testAutoComplete() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+        
         uba.begin();
         client.saveDataAutoComplete();
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -57,9 +73,10 @@ public void testAutoComplete() throws Exception
     @Test
     public void testManualComplete() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
         uba.begin();
         client.saveDataManualComplete(ServiceCommand.COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -68,10 +85,11 @@ public void testManualComplete() throws Exception
     @Test
     public void testMultiInvoke() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+        
         uba.begin();
         client.saveDataManualComplete();
         client.saveDataManualComplete(ServiceCommand.COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -80,9 +98,10 @@ public void testMultiInvoke() throws Exception
     @Test
     public void testClientDrivenCompensate() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
         uba.begin();
         client.saveDataAutoComplete();
-        Thread.sleep(10000); //JBTM-1203
         uba.cancel();
 
         assertOrder(ConfirmCompleted.class, Compensate.class);
@@ -113,8 +132,8 @@ public void testCannotComplete() throws Exception
     {
         uba.begin();
         client.saveDataAutoComplete(ServiceCommand.CANNOT_COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
+        
         assertOrder();
     }
 ",2012-12-07T10:03:43Z,287
"@@ -16,6 +16,11 @@
       <!-- If you want to use the JBOSS_HOME environment variable, just delete the jbossHome property -->
       <configuration>
 			<property name=""serverConfig"">standalone-xts.xml</property>
+            <property name=""javaVmArguments"">-Dorg.jboss.byteman.verbose
+                                    -Djboss.modules.system.pkgs=org.jboss.byteman
+                                    -Dorg.jboss.byteman.transform.all
+                                    -javaagent:../lib/byteman.jar=listener:true
+            </property>
       </configuration>
    </container>
 ",2012-12-07T10:03:43Z,129
"@@ -144,6 +144,17 @@
         <id>release</id>
         <build>
           <plugins>
+              <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                <artifactId>maven-install-plugin</artifactId>
+                <executions>
+                  <execution>
+                    <id>default-install</id>
+                    <phase>install</phase>
+                  </execution>
+                </executions>
+                <inherited>false</inherited>
+              </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,237
"@@ -42,4 +42,24 @@
     <module>txoj</module>
     <module>arjunacore</module>
   </modules>
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,288
"@@ -114,4 +114,24 @@
       <scope>test</scope>
     </dependency>
   </dependencies>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,289
"@@ -160,6 +160,17 @@
         <id>release</id>
         <build>
           <plugins>
+              <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                <artifactId>maven-install-plugin</artifactId>
+                <executions>
+                  <execution>
+                    <id>default-install</id>
+                    <phase>install</phase>
+                  </execution>
+                </executions>
+                <inherited>false</inherited>
+              </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,238
"@@ -41,4 +41,24 @@
     <module>jdbc</module>
     <module>narayana-jta</module>
   </modules>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,223
"@@ -61,18 +61,22 @@
     <dependency>
       <groupId>org.jboss.narayana.jta</groupId>
       <artifactId>jta</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss</groupId>
@@ -146,6 +150,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,69
"@@ -167,10 +167,22 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
@@ -179,6 +191,12 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>tanukisoft</groupId>
@@ -201,6 +219,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,29
"@@ -167,14 +167,32 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>tanukisoft</groupId>
@@ -221,6 +239,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,30
"@@ -45,4 +45,24 @@
     <module>narayana-jts-idlj</module>
     <module>integration</module>
   </modules>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,290
"@@ -27,4 +27,24 @@
             <artifactId>byteman-submit</artifactId>
         </dependency>
     </dependencies>
+    <profiles>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                    <plugin>
+                        <groupId>org.apache.maven.plugins</groupId>
+                        <artifactId>maven-install-plugin</artifactId>
+                        <executions>
+                            <execution>
+                                <id>default-install</id>
+                                <phase>install</phase>
+                            </execution>
+                        </executions>
+                        <inherited>false</inherited>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,275
"@@ -215,6 +215,17 @@
         <id>release</id>
         <build>
           <plugins>
+            <plugin>
+              <groupId>org.apache.maven.plugins</groupId>
+              <artifactId>maven-install-plugin</artifactId>
+              <executions>
+                <execution>
+                  <id>default-install</id>
+                  <phase>install</phase>
+                </execution>
+              </executions>
+              <inherited>false</inherited>
+            </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,33
"@@ -29,6 +29,16 @@
     </properties>
 
     <build>
+        <pluginManagement>
+            <plugins>
+                <plugin>
+                    <artifactId>maven-surefire-plugin</artifactId>
+                    <configuration>
+                        <skip>true</skip>
+                    </configuration>
+                </plugin>
+            </plugins>
+        </pluginManagement>
         <plugins>
             <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
@@ -94,26 +104,6 @@
         </dependency>
     </dependencies>
     <profiles>
-        <!-- The default profile skips all tests, though you can tune it
-            to run just unit tests based on a custom pattern -->
-        <!-- Seperate profiles are provided for running all tests, including
-            Arquillian tests that execute in the specified container -->
-        <profile>
-            <id>default</id>
-            <activation>
-                <activeByDefault>true</activeByDefault>
-            </activation>
-            <build>
-                <plugins>
-                    <plugin>
-                        <artifactId>maven-surefire-plugin</artifactId>
-                        <configuration>
-                            <skip>true</skip>
-                        </configuration>
-                    </plugin>
-                </plugins>
-            </build>
-        </profile>
         <profile>
             <id>arq-remote</id>
             <activation>
@@ -132,6 +122,7 @@
                                 <server.jvm.args>${jvm.args.memory} ${ipv4.server.jvm.args}</server.jvm.args>
                                 <node.address>127.0.0.1</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>
@@ -165,6 +156,7 @@
                                 </server.jvm.args>
                                 <node.address>127.0.0.1</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>
@@ -199,6 +191,7 @@
                                 </server.jvm.args>
                                 <node.address>[::1]</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>",2013-01-22T15:55:37Z,34
"@@ -50,4 +50,24 @@
     <module>jbossxts</module>
     <module>localjunit</module>
   </modules>
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,285
"@@ -69,4 +69,25 @@
     </dependency>
     <!-- END TEST -->
   </dependencies>
+
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,286
"@@ -1099,5 +1099,37 @@
         <module>STM</module>
       </modules>
     </profile>
+    <profile>
+      <id>release</id>
+      <build>
+          <pluginManagement>
+              <plugins>
+                  <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                    <artifactId>maven-install-plugin</artifactId>
+                    <executions>
+                      <execution>
+                        <id>default-install</id>
+                        <phase>none</phase>
+                      </execution>
+                    </executions>
+                  </plugin>
+              </plugins>
+          </pluginManagement>
+          <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
+          </plugins>
+      </build>
+    </profile>
   </profiles>
 </project>",2013-01-22T15:55:37Z,39
"@@ -51,4 +51,24 @@ Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
   <properties>
     <version.org.jboss.resteasy>2.0.0.GA</version.org.jboss.resteasy>
   </properties>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,291
"@@ -171,4 +171,24 @@
       </plugin>
     </plugins>
   </build>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                  <plugin>
+                      <groupId>org.apache.maven.plugins</groupId>
+                      <artifactId>maven-install-plugin</artifactId>
+                      <executions>
+                          <execution>
+                              <id>default-install</id>
+                              <phase>install</phase>
+                          </execution>
+                      </executions>
+                      <inherited>false</inherited>
+                  </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,292
"@@ -94,6 +94,13 @@
                     <target>1.6</target>
                 </configuration>
             </plugin>
+            <plugin>
+                <artifactId>maven-surefire-plugin</artifactId>
+                <version>2.11</version>
+                <configuration>
+                    <skip>true</skip>
+                </configuration>
+            </plugin>
         </plugins>
         <pluginManagement>
         	<plugins>
@@ -221,23 +228,6 @@
 
     </dependencies>
 	<profiles>
-		<profile>
-			<id>default</id>
-			<activation>
-				<activeByDefault>true</activeByDefault>
-			</activation>
-			<build>
-				<plugins>
-					<plugin>
-						<artifactId>maven-surefire-plugin</artifactId>
-						<version>2.11</version>
-						<configuration>
-							<skip>true</skip>
-						</configuration>
-					</plugin>
-				</plugins>
-			</build>
-		</profile>
 		<profile>
 			<id>arq</id>
 			<activation>
@@ -263,6 +253,7 @@
 								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
 								<node.address>localhost</node.address>
 							</systemPropertyVariables>
+                            <skip>false</skip>
 						</configuration>
 					</plugin>
 				</plugins>
@@ -305,6 +296,7 @@
 								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
 								<node.address>[::1]</node.address>
 							</systemPropertyVariables>
+                            <skip>false</skip>
 						</configuration>
 					</plugin>
 				</plugins>
@@ -333,5 +325,23 @@
 				</dependency>
 			</dependencies>
 		</profile>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                  <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                    <artifactId>maven-install-plugin</artifactId>
+                    <executions>
+                      <execution>
+                        <id>default-install</id>
+                        <phase>install</phase>
+                      </execution>
+                    </executions>
+                    <inherited>false</inherited>
+                  </plugin>
+                </plugins>
+            </build>
+        </profile>
 	</profiles>
 </project>",2013-01-22T15:55:37Z,162
"@@ -214,6 +214,24 @@
                 </dependency>
             </dependencies>
         </profile>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                    <plugin>
+                        <groupId>org.apache.maven.plugins</groupId>
+                        <artifactId>maven-install-plugin</artifactId>
+                        <executions>
+                            <execution>
+                                <id>default-install</id>
+                                <phase>install</phase>
+                            </execution>
+                        </executions>
+                        <inherited>false</inherited>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
     </profiles>
 
 </project>",2013-01-22T15:55:37Z,41
"@@ -0,0 +1,2 @@
+export UPSTREAM_AS_BRANCH=master
+export ORIGIN_AS_BRANCH=5_BRANCH
\ No newline at end of file",2013-02-08T16:09:11Z,267
"@@ -0,0 +1,36 @@
+function fatal {
+  echo ""Failed: $1""
+  exit 1
+}
+
+. branch-names.sh
+
+echo ""Rebaseing origin/$ORIGIN_AS_BRANCH with upstream/$UPSTREAM_AS_BRANCH""
+
+GIT_URL=""git@github.com:jbosstm/jboss-as.git""
+UPSTREAM_GIT_URL=""https://github.com/jbossas/jboss-as.git""
+TEMPORARY_REBASE_LOCATION=/tmp/rebase-jbossas-branch
+
+rm -rf $TEMPORARY_REBASE_LOCATION || fatal
+mkdir $TEMPORARY_REBASE_LOCATION || fatal
+cd $TEMPORARY_REBASE_LOCATION || fatal
+
+git clone $GIT_URL || fatal
+cd jboss-as
+git checkout -t origin/$ORIGIN_AS_BRANCH || fatal
+
+git remote add upstream $UPSTREAM_GIT_URL
+git pull --rebase --ff-only upstream $UPSTREAM_AS_BRANCH
+
+while [ $? != 0 ]
+do
+ for i in `git status -s | sed ""s/UU \(.*\)/\1/g""`
+ do
+    awk '/^<+ HEAD$/,/^=+$/{next} /^>+ /{next} 1' $i > $i.bak; mv $i.bak $i; git add $i
+ done
+ git rebase --continue
+done
+[ $? = 0 ] || fatal ""git rebase failed""
+
+git push origin $ORIGIN_AS_BRANCH -f
+rm -rf $TEMPORARY_REBASE_LOCATION",2013-02-08T16:09:11Z,268
"@@ -69,13 +69,12 @@
     <property name=""version"" value=""5.0.0.M2-SNAPSHOT""/>
 -->
   <!-- a working directory for the process. Can contain output from previous releases if you like to keep them archived locally. -->
-  <!--property name=""workdir"" location=""/tmp/narayana_releases""/-->
+  <property name=""workdir"" location=""/tmp/narayana_releases""/>
   <!-- where to get the source -->
-  <property name=""svnbase"" value=""https://svn.jboss.org/repos/labs/labs/jbosstm/tags""/>
+  <property name=""gitbase"" value=""https://github.com/jbosstm""/>
   <!-- The tag as it appears under svnbase -->
-  <property name=""tag"" value=""5_0_0_M1""/>
-  <!-- The file name base for the user downloadable files. Derive it from the tag -->
-  <property name=""version"" value=""5.0.0.M1""/>
+  <property name=""pageName"" value=""4_17_0_Final""/>
+  <property name=""tag"" value=""4.17.0.Final""/>
   <!-- which uber jar to use -->
   <property name=""orb"" value=""jacorb""/>
   <!-- the location the JBossTS web site content is copied to -->
@@ -100,40 +99,116 @@
         </not>
       </condition>
     </fail>
-    <fail message=""You must not already have a local maven cached repository to do a release build"">
-      <condition>
-        <available file=""repository"" type=""dir""/>
-      </condition>
-    </fail>
     <fail message=""You cannot perform a build without cleaning the old version out"">
       <condition>
         <available file=""${workdir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <mkdir dir=""${workdir}""/>
-    <!-- pull the source code from svn -->
-    <exec executable=""svn"" dir=""${workdir}"">
+    <!-- pull the source code from git -->
+    <exec executable=""git"" dir=""${workdir}"">
+      <arg value=""clone""/>
+      <arg value=""${gitbase}/narayana.git""/>
+      <arg value=""${tag}""/>
+    </exec>
+    <exec executable=""git"" dir=""${workdir}/${tag}"">
       <arg value=""checkout""/>
-      <arg value=""${svnbase}/${tag}""/>
+      <arg value=""${tag}""/>
     </exec>
   </target>
   <target name=""dist"" depends=""dist-init"" description=""build the end-user release bundles (src and binary)"">
     <!-- build the binary releases -->
     <exec dir=""${workdir}/${tag}"" executable=""tools/maven/bin/mvn"" failonerror=""true"">
       <arg line=""clean -gs tools/maven/conf/settings.xml -Demma.jar.location=${user.dir}/ext/emma.jar -Dorson.jar.location=${user.dir}/ext/orson-0.5.0.jar""/>
     </exec>
-    <!-- package the JTA only src tree (no JTS, XTS, txbridge, RTS) -->
-    <delete file=""${workdir}/narayana-jta-${version}-src.zip""/>
-    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-jta-${version}-src.zip"" includes=""${tag}/**"" excludes=""${tag}/ArjunaJTS/**, ${tag}/XTS/** ${tag}/txbridge/**, ${tag}/rest-tx/**, ${tag}/repository/**""/>
     <!-- package the full source release (all src tree) -->
-    <delete file=""${workdir}/narayana-full-${version}-src.zip""/>
-    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-full-${version}-src.zip"" includes=""${tag}/**"" excludes=""${tag}/repository/**""/>
+    <delete file=""${workdir}/narayana-full-${tag}-src.zip""/>
+    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-full-${tag}-src.zip"" includes=""${tag}/**""/>
     <!-- build the binary releases -->
     <exec dir=""${workdir}/${tag}"" executable=""tools/maven/bin/mvn"" failonerror=""true"">
       <arg line=""deploy -DskipTests -gs tools/maven/conf/settings.xml -Demma.jar.location=${user.dir}/ext/emma.jar -Dorson.jar.location=${user.dir}/ext/orson-0.5.0.jar""/>
     </exec>
   </target>
   <!-- copy the release into the downloads dir tree (http://www.jboss.org/jbosstm web site content) -->
+  <target name=""docs"">
+    <fail>
+      <condition>
+        <not>
+          <available file=""${downloads.dir}"" type=""dir""/>
+        </not>
+      </condition>
+    </fail>
+    <fail>
+      <condition>
+        <not>
+          <available file=""${docs.dir}"" type=""dir""/>
+        </not>
+      </condition>
+    </fail>
+
+    <exec executable=""git"" dir=""${workdir}"">
+      <arg value=""clone""/>
+      <arg value=""${gitbase}/documentation.git""/>
+      <arg value=""${tag}-docs""/>
+    </exec>
+    <exec executable=""git"" dir=""${workdir}/${tag}-docs"">
+      <arg value=""checkout""/>
+      <arg value=""${tag}""/>
+    </exec>
+    <exec dir=""${workdir}/${tag}-docs"" executable=""mvn"" failonerror=""true"">
+      <arg line=""install""/>
+    </exec>
+    <delete dir=""tmp-docs-dir-docs""/>
+    <mkdir dir=""tmp-docs-dir-docs""/>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-orbportability_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/orbportability_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-quick_start_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/quick_start_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-administration_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/administration_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/arjunacore-failure_recovery_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaCore/docs/failure_recovery_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/arjunacore-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaCore/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-quick_start_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/quick_start_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-installation_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/installation_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-administration_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/administration_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/xts-administration_and_development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/XTS/docs/administration_and_development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/failure_recovery_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/failure_recovery_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/transactions_overview_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/transactions_overview_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/txbridge_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/txbridge_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <move todir=""${docs.dir}/${tag}"" verbose=""true"">
+      <fileset dir=""tmp-docs-dir-docs""/>
+    </move>
+  </target> 
   <target name=""downloads"" description=""copy release bundles to JBossTS web site content"">
     <fail>
       <condition>
@@ -144,7 +219,7 @@
     </fail>
     <fail>
       <condition>
-        <available file=""${downloads.dir}/${version}"" type=""dir""/>
+        <available file=""${downloads.dir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <fail>
@@ -156,7 +231,7 @@
     </fail>
     <fail>
       <condition>
-        <available file=""${docs.dir}/${version}"" type=""dir""/>
+        <available file=""${docs.dir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <delete dir=""tmp-downloads-dir""/>
@@ -167,91 +242,37 @@
     <delete dir=""tmp-docs-dir""/>
     <mkdir dir=""tmp-docs-dir""/>
     <copy todir=""tmp-downloads-dir/src"">
-      <fileset dir=""${workdir}"" includes=""narayana-*-${version}-src.zip""/>
+      <fileset dir=""${workdir}"" includes=""narayana-*-${tag}-src.zip""/>
     </copy>
     <copy todir=""tmp-downloads-dir/binary"">
-      <fileset dir=""${workdir}/${tag}/narayana-full/target/"" includes=""narayana-full-${version}-bin.zip""/>
+      <fileset dir=""${workdir}/${tag}/narayana-full/target/"" includes=""narayana-full-${tag}-bin.zip""/>
     </copy>
     <copy todir=""tmp-downloads-dir/idl"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/jts/idl/arjuna"">
+      <fileset dir=""${workdir}/${tag}/ArjunaJTS/idl/src/main/idl/arjuna"">
         <include name=""ArjunaOTS.idl""/>
       </fileset>
     </copy>
     <copy todir=""tmp-downloads-dir/idl"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/jts/idl/omg"">
+      <fileset dir=""${workdir}/${tag}/ArjunaJTS/idl/src/main/idl/omg"">
         <include name=""CosTransactions.idl""/>
         <include name=""XA.idl""/>
       </fileset>
     </copy>
-    <copy file=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/narayana-jts-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/jta""/>
-    <copy file=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/jts""/>
-    <copy file=""${workdir}/${tag}/rest-tx/tx/target/rest-tx-api-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/rts""/>
-    <copy file=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/xts""/>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-orbportability_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/orbportability_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-quick_start_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/quick_start_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-administration_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/administration_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/arjunacore-failure_recovery_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaCore/docs/failure_recovery_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/arjunacore-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaCore/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-quick_start_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/quick_start_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-installation_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/installation_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-administration_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/administration_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/xts-administration_and_development_guide"">
-      <fileset dir=""${workdir}/${tag}/XTS/docs/administration_and_development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/failure_recovery_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/failure_recovery_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/release_notes"">
-      <fileset dir=""${workdir}/${tag}/docs/release_notes/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/development_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/transactions_overview_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/transactions_overview_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/txbridge_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/txbridge_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <unzip src=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/narayana-jts-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/jts""/>
-    <unzip src=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/jta""/>
-    <unzip src=""${workdir}/${tag}/rest-tx/tx/target/rest-tx-api-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/rts""/>
-    <unzip src=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/xts""/>
-    <move todir=""${downloads.dir}/${version}"" verbose=""true"">
+    <copy file=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/jbossjts-jacorb-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/jts""/>
+    <copy file=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/jta""/>
+    <copy file=""${workdir}/${tag}/rest-tx/tx/target/restat-api-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/rts""/>
+    <copy file=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/xts""/>
+    <unzip src=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/jbossjts-jacorb-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/jts""/>
+    <unzip src=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/jta""/>
+    <unzip src=""${workdir}/${tag}/rest-tx/tx/target/restat-api-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/rts""/>
+    <unzip src=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/xts""/>
+    <move todir=""${downloads.dir}/${tag}"" verbose=""true"">
       <fileset dir=""tmp-downloads-dir""/>
     </move>
-    <move todir=""${docs.dir}/${version}"" verbose=""true"">
+    <move todir=""${docs.dir}/${tag}"" verbose=""true"">
       <fileset dir=""tmp-docs-dir""/>
     </move>
   </target>
-  <!-- copy the release artifacts to the maven repository -->
-  <target name=""mvn-repository"" description=""copy the release artifacts to the maven repository"">
-    <!-- xts -->
-    <mvn-artifact.macro artifact=""jbossxts-tests"" packaging=""zip"" dir=""${workdir}/build/${tag}/xts/tests""/>
-    <mvn-artifact.macro artifact=""jbossxts-interop-tests"" packaging=""zip"" dir=""${workdir}/build/${tag}/xts/interop-tests""/>
-  </target>
   <!-- magnolia (the cms that sits behind jboss.org/jbosstm pages) is a pain. This target generates
      xml for /downloads/somerelease.xml pages to ease some of the pain in publishing an upload
       right click jbosstm/downloads node, import from xml, then right click new node and activate.
@@ -261,20 +282,24 @@
     <exec executable=""date"" outputproperty=""date"">
       <arg line=""+'%FT%H:%M:%S.000Z'""/>
     </exec>
-    <length property=""jta-src-length"" file=""${workdir}/jbossts-jta-${version}-src.zip""/>
-    <length property=""full-src-length"" file=""${workdir}/jbossts-full-${version}-src.zip""/>
-    <length property=""jta-bin-length"" file=""${workdir}/jbossts-jta-${version}.zip""/>
-    <length property=""full-bin-length"" file=""${workdir}/jbossts-full-${version}.zip""/>
-    <copy file=""magnolia-release-download-page-template.xml"" tofile=""${workdir}/website.jbosstm.downloads.${version}.xml"" filtering=""true"" overwrite=""true"">
+    <length property=""full-src-length"" file=""${workdir}/narayana-full-${tag}-src.zip""/>
+    <length property=""full-bin-length"" file=""${workdir}/${tag}/narayana-full/target/narayana-full-${tag}-bin.zip""/>
+    <copy file=""magnolia-release-download-page-template.xml"" tofile=""${workdir}/website.jbosstm.downloads.${pageName}.xml"" filtering=""true"" overwrite=""true"">
       <filterset>
+        <filter token=""pageName"" value=""${pageName}""/>
         <filter token=""tag"" value=""${tag}""/>
-        <filter token=""version"" value=""${version}""/>
+        <filter token=""version"" value=""${tag}""/>
         <filter token=""date"" value=""${date}""/>
-        <filter token=""jta-src-length"" value=""${jta-src-length}""/>
         <filter token=""full-src-length"" value=""${full-src-length}""/>
-        <filter token=""jta-bin-length"" value=""${jta-bin-length}""/>
         <filter token=""full-bin-length"" value=""${full-bin-length}""/>
       </filterset>
     </copy>
+    <copy file=""magnolia-release-documentation-page-template.xml"" tofile=""${workdir}/website.jbosstm.documentation.${pageName}.xml"" filtering=""true"" overwrite=""true"">
+      <filterset>
+        <filter token=""pageName"" value=""${pageName}""/>
+        <filter token=""tag"" value=""${tag}""/>
+        <filter token=""date"" value=""${date}""/>
+      </filterset>
+    </copy>
   </target>
 </project>",2012-09-25T19:52:29Z,269
"@@ -0,0 +1,237 @@
+<?xml version=""1.0"" encoding=""UTF-8""?>
+<sv:node sv:name=""@pageName@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
+  <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+    <sv:value>mgnl:content</sv:value>
+  </sv:property>
+  <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+    <sv:value>mix:lockable</sv:value>
+  </sv:property>
+  <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+    <sv:value>14f62a08-1dfe-41b3-bdce-61ce87b8129d</sv:value>
+  </sv:property>
+  <sv:property sv:name=""enableRSS"" sv:type=""String"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""hideInNav"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""menubar"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaCache"" sv:type=""String"">
+    <sv:value>disable</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaExpire"" sv:type=""String"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaRobots"" sv:type=""String"">
+    <sv:value>all</sv:value>
+  </sv:property>
+  <sv:property sv:name=""redirectWindow"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""title"" sv:type=""String"">
+    <sv:value>Narayana Documentation @tag@</sv:value>
+  </sv:property>
+  <sv:property sv:name=""useTitle"" sv:type=""Boolean"">
+    <sv:value>true</sv:value>
+  </sv:property>
+  <sv:node sv:name=""MetaData"">
+    <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+      <sv:value>mgnl:metaData</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+      <sv:value>true</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+      <sv:value>superuser</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+      <sv:value>tm</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:comment"" sv:type=""String"">
+      <sv:value>Made references to git and subversion</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+      <sv:value>2009-12-10T11:47:09.824-05:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+      <sv:value>2012-04-27T05:09:36.605-04:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+      <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:template"" sv:type=""String"">
+      <sv:value>jbossorgProjectSubPage</sv:value>
+    </sv:property>
+  </sv:node>
+  <sv:node sv:name=""mainColumnParagraphs"">
+    <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+      <sv:value>mgnl:contentNode</sv:value>
+    </sv:property>
+    <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+      <sv:value>mix:lockable</sv:value>
+    </sv:property>
+    <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+      <sv:value>43dab693-c6e7-4eda-869e-5b1d9ad358d5</sv:value>
+    </sv:property>
+    <sv:node sv:name=""MetaData"">
+      <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+        <sv:value>mgnl:metaData</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+        <sv:value>true</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+        <sv:value>superuser</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+        <sv:value>tm</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+        <sv:value>2009-12-10T11:47:46.060-05:00</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+        <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+        <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+      </sv:property>
+    </sv:node>
+    <sv:node sv:name=""0"">
+      <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+        <sv:value>mgnl:contentNode</sv:value>
+      </sv:property>
+      <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+        <sv:value>mix:lockable</sv:value>
+      </sv:property>
+      <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+        <sv:value>6aec081e-5217-4adf-b06c-8c5bf92a886b</sv:value>
+      </sv:property>
+      <sv:property sv:name=""flow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""headerSize"" sv:type=""String"">
+        <sv:value>h3</sv:value>
+      </sv:property>
+      <sv:property sv:name=""imageLinkNewWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""imageLocation"" sv:type=""String"">
+        <sv:value>left</sv:value>
+      </sv:property>
+      <sv:property sv:name=""inherit"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""lineAbove"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkImage"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkText"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkTitle"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkWindowMenubar"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""spacer"" sv:type=""Long"">
+        <sv:value>0</sv:value>
+      </sv:property>
+      <sv:property sv:name=""text"" sv:type=""String"">
+        <sv:value>&lt;h1&gt;JBoss Narayana Documentation Library&lt;/h1&gt; &lt;p&gt; &lt;table cellspacing=""5"" class=""infotable"" style=""margin: 2px; padding: 2px; font-size: 90%;""&gt;     &lt;tbody&gt;         &lt;tr&gt;             &lt;th width=""220"" class=""grey""&gt;JBoss Narayana Document&lt;/th&gt;             &lt;th width=""80"" class=""grey""&gt;Version&lt;/th&gt;             &lt;th width=""80"" class=""grey""&gt;Released&lt;/th&gt;             &lt;th class=""blank""&gt;&amp;nbsp;&lt;/th&gt;             &lt;th class=""blank""&gt;&amp;nbsp;&lt;/th&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ORB Portability Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-orbportability_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;NarayanaJTS Quick Start Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-quick_start_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTS Administration Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-administration_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTS Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ArjunaCore Failure Recovery Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/arjunacore-failure_recovery_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ArjunaCore Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/arjunacore-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Quick Start Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-quick_start/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Installation Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-installation_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Administration Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-administration_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;XTS Administration and Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/xts-administration_and_development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Failure Recovery Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/failure_recovery_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Release Notes&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/release_notes/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Transactions Overview Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/transactions_overview_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;TXBridge Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/txbridge_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/jts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/jts/jbossjts-jacorb-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTA API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/jta/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/jta/narayana-jta-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;RTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/rts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/rts/restat-api-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;XTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/xts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/xts/jbossxts-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - ArjunaOTS&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/ArjunaOTS.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - CosTransactions.idl&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/CosTransactions.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - XA&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/XA.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;     &lt;/tbody&gt; &lt;/table&gt; &lt;/p&gt;</sv:value>
+      </sv:property>
+      <sv:property sv:name=""titleLinkNewWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:node sv:name=""MetaData"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:metaData</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+          <sv:value>true</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+          <sv:value>superuser</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+          <sv:value>tm</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+          <sv:value>2009-12-10T11:47:46.061-05:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+          <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+          <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:template"" sv:type=""String"">
+          <sv:value>richTextHtml</sv:value>
+        </sv:property>
+      </sv:node>
+      <sv:node sv:name=""text_files"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:contentNode</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+          <sv:value>mix:lockable</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+          <sv:value>41f11088-5628-42b3-8c36-51b7a4199eaf</sv:value>
+        </sv:property>
+        <sv:node sv:name=""MetaData"">
+          <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+            <sv:value>mgnl:metaData</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+            <sv:value>true</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+            <sv:value>superuser</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+            <sv:value>2009-12-10T11:47:46.061-05:00</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+            <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+          </sv:property>
+        </sv:node>
+      </sv:node>
+      <sv:node sv:name=""imageFooter_files"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:contentNode</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+          <sv:value>mix:lockable</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+          <sv:value>6b6abc15-1022-44a0-917e-29a9691832e4</sv:value>
+        </sv:property>
+        <sv:node sv:name=""MetaData"">
+          <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+            <sv:value>mgnl:metaData</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+            <sv:value>true</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+            <sv:value>superuser</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+            <sv:value>2009-12-10T11:47:46.064-05:00</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+            <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+          </sv:property>
+        </sv:node>
+      </sv:node>
+    </sv:node>
+  </sv:node>
+</sv:node>",2012-09-25T19:52:29Z,270
"@@ -1,5 +1,5 @@
 <?xml version=""1.0"" encoding=""UTF-8""?>
-<sv:node sv:name=""@tag@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
+<sv:node sv:name=""@pageName@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
   <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
     <sv:value>mgnl:content</sv:value>
   </sv:property>
@@ -31,7 +31,7 @@
     <sv:value>false</sv:value>
   </sv:property>
   <sv:property sv:name=""title"" sv:type=""String"">
-    <sv:value>JBossTS @filename@ release</sv:value>
+    <sv:value>JBossTS @tag@ release</sv:value>
   </sv:property>
   <sv:property sv:name=""useTitle"" sv:type=""String"">
     <sv:value>true</sv:value>
@@ -99,12 +99,6 @@
       <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
         <sv:value>00bd1847-65cd-4ff1-b7ce-20b8084be52b</sv:value>
       </sv:property>
-      <sv:property sv:name=""desc21"" sv:type=""String"">
-        <sv:value>The JBoss Transactions JTA @filename@ Source</sv:value>
-      </sv:property>
-      <sv:property sv:name=""desc22"" sv:type=""String"">
-        <sv:value>JBoss Transactions JTA @filename@ Binary</sv:value>
-      </sv:property>
       <sv:property sv:name=""desc23"" sv:type=""String"">
         <sv:value>JBoss Transactions JTS (and JTA) and WS-T Source Code</sv:value>
       </sv:property>
@@ -123,17 +117,11 @@
       <sv:property sv:name=""license24"" sv:type=""String"">
         <sv:value>LGPL</sv:value>
       </sv:property>
-      <sv:property sv:name=""name21"" sv:type=""String"">
-        <sv:value>jbossts-jta-@filename@-src.zip</sv:value>
-      </sv:property>
-      <sv:property sv:name=""name22"" sv:type=""String"">
-        <sv:value>jbossts-jta-@filename@.zip</sv:value>
-      </sv:property>
       <sv:property sv:name=""name23"" sv:type=""String"">
-        <sv:value>jbossts-full-@filename@-src.zip</sv:value>
+        <sv:value>narayana-full-@tag@-src.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""name24"" sv:type=""String"">
-        <sv:value>jbossts-full-@filename@.zip</sv:value>
+        <sv:value>narayana-full-@tag@-bin.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""popup"" sv:type=""String"">
         <sv:value>true</sv:value>
@@ -168,20 +156,14 @@
       <sv:property sv:name=""showVersion"" sv:type=""String"">
         <sv:value>false</sv:value>
       </sv:property>
-      <sv:property sv:name=""size21"" sv:type=""String"">
-        <sv:value>@jta-src-length@</sv:value>
-      </sv:property>
-      <sv:property sv:name=""size22"" sv:type=""String"">
-        <sv:value>@full-src-length@</sv:value>
-      </sv:property>
       <sv:property sv:name=""size23"" sv:type=""String"">
-        <sv:value>@jta-bin-length@</sv:value>
+        <sv:value>@full-src-length@</sv:value>
       </sv:property>
       <sv:property sv:name=""size24"" sv:type=""String"">
         <sv:value>@full-bin-length@</sv:value>
       </sv:property>
       <sv:property sv:name=""tableTitle"" sv:type=""String"">
-        <sv:value>JBossTS @filename@ release</sv:value>
+        <sv:value>JBossTS @tag@ release</sv:value>
       </sv:property>
       <sv:property sv:name=""text21"" sv:type=""String"">
         <sv:value>Download</sv:value>
@@ -195,17 +177,11 @@
       <sv:property sv:name=""text24"" sv:type=""String"">
         <sv:value>Download</sv:value>
       </sv:property>
-      <sv:property sv:name=""url21"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/src/jbossts-jta-@filename@-src.zip</sv:value>
-      </sv:property>
-      <sv:property sv:name=""url22"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/binary/jbossts-jta-@filename@.zip</sv:value>
-      </sv:property>
       <sv:property sv:name=""url23"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/src/jbossts-full-@filename@-src.zip</sv:value>
+        <sv:value>http://www.jboss.org/jbosstm/downloads/@tag@/src/narayana-full-@tag@-src.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""url24"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/binary/jbossts-full-@filename@.zip</sv:value>
+        <sv:value>http://www.jboss.org/jbosstm/downloads/@tag@/binary/narayana-full-@tag@-bin.zip</sv:value>
       </sv:property>
       <sv:node sv:name=""MetaData"">
         <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">",2012-09-25T19:52:29Z,271
"@@ -890,9 +890,6 @@ public interface wstI18NLogger {
 	@LogMessage(level = WARN)
 	public void warn_recovery_participant_ba_BAParticipantRecoveryRecord_saveState_3(String arg0, @Cause() Throwable arg1);
 
-    @Message(id = 43228, value = ""Delay of {0} ms reached before changing state from {1} to something else"", format = MESSAGE_FORMAT)
-   	@LogMessage(level = WARN)
-   	public void warn_state_change_timeout(String arg0, String arg1);
 
     /*
         Allocate new messages directly above this notice.",2013-01-15T16:13:39Z,272
"@@ -526,7 +526,6 @@ private State waitForState(final State origState, final long delay)
                 final long remaining = end - System.currentTimeMillis() ;
                 if (remaining <= 0)
                 {
-                    WSTLogger.i18NLogger.warn_state_change_timeout(String.valueOf(delay), origState.toString());
                     break ;
                 }
                 try",2013-01-15T16:13:39Z,72
"@@ -183,7 +183,7 @@
                                 <!--
                                     Used in arquillian.xml
                                 -->
-                                <server.jvm.args>${jvm.args.byteman} ${jvm.args.memory} -Dorg.jboss.jbossts.xts.transport.transportTimeout=60000</server.jvm.args>
+                                <server.jvm.args>${jvm.args.byteman} ${jvm.args.memory}</server.jvm.args>
                             </systemPropertyVariables>
                         </configuration>
                     </plugin>",2013-01-15T16:13:39Z,41
"@@ -15,15 +15,18 @@ if [ """" == ""$JBOSS_BUILD_HOME"" ]; then
 fi
 
 if [ ""$2"" == ""--clean"" ] || [ ""$3"" == ""--clean"" ]; then
+    echo ""Cleaning""
     CLEAN=clean
 fi
 
 if [ ""$2"" == ""--xts"" ] || [ ""$3"" == ""--xts"" ]; then
+    echo ""Rebuilding XTS""
     cd ..
     ./build.sh -f ./XTS/pom.xml $CLEAN install -DskipTests || fail
     cd -
 fi
 
+
 mvn $CLEAN install || fail
 kill-jboss
 $JBOSS_BUILD_HOME/build.sh $CLEAN install -f $JBOSS_BUILD_HOME/xts/pom.xml -DskipTests || fail",2013-01-15T16:13:39Z,198
"@@ -55,7 +55,7 @@ public class ATBridgeImpl implements ATBridge {
     public void incrementCounter(int how_many) {
 
         SimpleEntity entity = getSimpleEntity();
-        entity.incrimentCounter(how_many);
+        entity.incrementCounter(how_many);
         em.merge(entity);
     }
 
@@ -81,7 +81,7 @@ private SimpleEntity getSimpleEntity() {
 
         SimpleEntity entity = em.find(SimpleEntity.class, ENTITY_ID);
         if (entity == null) {
-            entity = new SimpleEntity();
+            entity = new SimpleEntity(ENTITY_ID, 0);
             em.persist(entity);
         }
 ",2013-01-15T16:13:39Z,273
"@@ -1,6 +1,6 @@
 /*
  * JBoss, Home of Professional Open Source.
- * Copyright 2012, Red Hat, Inc., and individual contributors
+ * Copyright 2013, Red Hat, Inc., and individual contributors
  * as indicated by the @author tags. See the copyright.txt file in the
  * distribution for a full listing of individual contributors.
  *",2013-01-15T16:13:39Z,201
"@@ -22,7 +22,6 @@
 package org.jboss.narayana.txframework.functional.ws.at.bridged;
 
 import javax.persistence.Entity;
-import javax.persistence.GeneratedValue;
 import javax.persistence.Id;
 import java.io.Serializable;
 
@@ -41,8 +40,13 @@ public SimpleEntity() {
 
     }
 
+    public SimpleEntity(int id, int initialCounterValue) {
+
+        this.id = id;
+        this.bookingCount = initialCounterValue;
+    }
+
     @Id
-    @GeneratedValue
     public int getId() {
 
         return id;
@@ -63,8 +67,8 @@ public void setCounter(int counter) {
         this.bookingCount = counter;
     }
 
-    public void incrimentCounter(int how_many) {
+    public void incrementCounter(int howMany) {
 
-        setCounter(getCounter() + how_many);
+        setCounter(getCounter() + howMany);
     }
 }",2013-01-15T16:13:39Z,274
"@@ -87,26 +87,6 @@
                     <target>1.6</target>
                 </configuration>
             </plugin>
-            <plugin>
-                <groupId>org.apache.maven.plugins</groupId>
-                <artifactId>maven-surefire-plugin</artifactId>
-                <configuration>
-                    <skip>true</skip>
-                    <!-- Prevent test and server output appearing in console. -->
-                    <redirectTestOutputToFile>true</redirectTestOutputToFile>
-                    <enableAssertions>true</enableAssertions>
-                    <!-- Tests to execute. -->
-                    <includes>
-                        <include>**/*Tests.java</include>
-                    </includes>
-                    <!-- System properties passed to test cases -->
-                    <systemPropertyVariables>
-                        <!-- Used in arquillian.xml - arguments for all JBoss AS instances. -->
-                        <server.jvm.args>${general.server.jvm.args} ${byteman.server.jvm.args} ${jpda.server.jvm.args}</server.jvm.args>
-                        <java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
-                    </systemPropertyVariables>
-                </configuration>
-            </plugin>
         </plugins>
         <pluginManagement>
         	<plugins>
@@ -233,4 +213,58 @@
         </dependency>
 
     </dependencies>
+	<profiles>
+		<profile>
+			<id>default</id>
+			<activation>
+				<activeByDefault>true</activeByDefault>
+			</activation>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-surefire-plugin</artifactId>
+						<configuration>
+							<skip>true</skip>
+						</configuration>
+					</plugin>
+				</plugins>
+			</build>
+		</profile>
+		<profile>
+			<id>arq</id>
+			<activation>
+				<activeByDefault>false</activeByDefault>
+			</activation>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-surefire-plugin</artifactId>
+						<configuration>
+							<!-- Prevent test and server output appearing in console. -->
+							<redirectTestOutputToFile>true</redirectTestOutputToFile>
+							<enableAssertions>true</enableAssertions>
+							<!-- Tests to execute. -->
+							<includes>
+								<include>**/*Tests.java</include>
+							</includes>
+							<!-- System properties passed to test cases -->
+							<systemPropertyVariables>
+								<!-- Used in arquillian.xml - arguments for all JBoss AS instances. -->
+								<server.jvm.args>${general.server.jvm.args} ${byteman.server.jvm.args} ${jpda.server.jvm.args}</server.jvm.args>
+								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
+							</systemPropertyVariables>
+						</configuration>
+					</plugin>
+				</plugins>
+			</build>
+			<dependencies>
+				<dependency>
+					<groupId>org.jboss.as</groupId>
+					<artifactId>jboss-as-arquillian-container-managed</artifactId>
+					<version>${jboss-as.version}</version>
+					<scope>test</scope>
+				</dependency>
+			</dependencies>
+		</profile>
+	</profiles>
 </project>",2012-05-07T06:29:32Z,162
"@@ -0,0 +1,30 @@
+<?xml version=""1.0"" encoding=""UTF-8""?>
+<!-- JBoss, Home of Professional Open Source Copyright 2008, Red Hat Middleware LLC, and others contributors as indicated by the @authors tag. All rights reserved. See the copyright.txt in the distribution 
+	for a full listing of individual contributors. This copyrighted material is made available to anyone wishing to use, modify, copy, or redistribute it subject to the terms and conditions of the GNU Lesser 
+	General Public License, v. 2.1. This program is distributed in the hope that it will be useful, but WITHOUT A WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR 
+	PURPOSE. See the GNU Lesser General Public License for more details. You should have received a copy of the GNU Lesser General Public License, v.2.1 along with this distribution; if not, write to the Free 
+	Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA. -->
+<project xmlns=""http://maven.apache.org/POM/4.0.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
+         xsi:schemaLocation=""http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"">
+    <parent>
+        <groupId>org.jboss.narayana.xts</groupId>
+        <artifactId>xts-all</artifactId>
+        <version>5.0.0.M2-SNAPSHOT</version>
+        <relativePath>../pom.xml</relativePath>
+    </parent>
+    <modelVersion>4.0.0</modelVersion>
+    <artifactId>byteman_support</artifactId>
+    <packaging>jar</packaging>
+    <name>Reusable Byteman rules for xts</name>
+    
+    <dependencies>
+        <dependency>
+            <groupId>org.jboss.byteman</groupId>
+            <artifactId>byteman</artifactId>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.byteman</groupId>
+            <artifactId>byteman-submit</artifactId>
+        </dependency>
+    </dependencies>
+</project>",2012-12-07T10:03:43Z,275
"@@ -0,0 +1,53 @@
+package org.jboss.jbossts.xts.bytemanSupport;
+
+import org.jboss.byteman.agent.submit.Submit;
+
+import java.io.IOException;
+import java.io.InputStream;
+import java.net.URL;
+import java.util.ArrayList;
+import java.util.List;
+
+/**
+ * @Author paul.robinson@redhat.com 22/11/2012
+ */
+public class BMScript {
+
+    private static final Submit submit = new Submit();
+
+    public static void submit(String scriptResourcePath) {
+
+        try {
+            List<InputStream> streams = getScriptFromResource(scriptResourcePath);
+            submit.addRulesFromResources(streams);
+        } catch (Exception e) {
+            throw new RuntimeException(""Failed to submit Byteman script"", e);
+        }
+    }
+
+    public static void remove(String scriptResourcePath) {
+
+        try {
+            List<InputStream> streams = getScriptFromResource(scriptResourcePath);
+            submit.deleteRulesFromResources(streams);
+        } catch (Exception e) {
+            throw new RuntimeException(""Failed to remove Byteman script"", e);
+        }
+    }
+
+    private static List<InputStream> getScriptFromResource(String scriptResourcePath) {
+        URL resource = Thread.currentThread().getContextClassLoader().getResource(scriptResourcePath);
+        if (resource == null) {
+            throw new RuntimeException(""'"" + scriptResourcePath + ""' can't be found on the classpath"");
+        }
+
+        List<InputStream> streams = new ArrayList<InputStream>();
+        try {
+            streams.add(resource.openStream());
+        } catch (IOException e) {
+            throw new RuntimeException(""Unable to open stream at url location: "" + resource.toString());
+        }
+        return streams;
+    }
+
+}",2012-12-07T10:03:43Z,276
"@@ -0,0 +1,13 @@
+package org.jboss.jbossts.xts.bytemanSupport.participantCompletion;
+
+/**
+ * @Author paul.robinson@redhat.com 26/11/2012
+ */
+public class ParticipantCompletionCoordinatorRules {
+
+    public static String RESOURCE_PATH= ""org/jboss/jbossts/xts/bytemanSupport/participantCompletion/participant_completion_coordinator_rules.btm"";
+
+    public static void setParticipantCount(Integer participantCount) {
+        //Dummy method, detected by Byteman Rules
+    }
+}",2012-12-07T10:03:43Z,277
"@@ -0,0 +1,40 @@
+RULE create counter
+CLASS org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules
+METHOD setParticipantCount(Integer)
+BIND counter:Integer=$1
+IF TRUE
+DO debug(""participant_completion.counter.create: "" + counter),
+  deleteCounter(""completes""),
+  createCounter(""completes"", counter)
+ENDRULE
+
+RULE complete called
+CLASS com.arjuna.webservices11.wsba.sei.BusinessAgreementWithParticipantCompletionCoordinatorPortTypeImpl
+METHOD completedOperation(NotificationType)
+AT RETURN
+BIND NOTHING
+IF (debug(""participant_completion.counter.decrement"") AND decrementCounter(""completes"") == 0)
+DO debug(""participant_completion.called.waking""),
+   signalWake(""complete"", true),
+   debug(""participant_completion.called.donewake"")
+ENDRULE
+
+RULE close called
+CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
+METHOD closeOperation(NotificationType)
+BIND NOTHING
+IF TRUE
+DO debug(""participant_completion.close.waiting""),
+   waitFor(""complete""),
+   debug(""participant_completion.close.woken"")
+ENDRULE
+
+RULE cancel called
+CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
+METHOD cancelOperation(NotificationType)
+BIND NOTHING
+IF TRUE
+DO debug(""participant_completion.cancel.waiting""),
+   waitFor(""complete""),
+   debug(""participant_completion.cancel.woken"")
+ENDRULE
\ No newline at end of file",2012-12-07T10:03:43Z,278
"@@ -67,8 +67,6 @@ public void testClose()
             throw eouter;
         }
 
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
 
 	    assertTrue(p.passed());",2012-12-07T10:03:43Z,279
"@@ -68,8 +68,6 @@ public void testExit()
             throw eouter;
         }
 
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
 
 	    assertTrue(p.passed());",2012-12-07T10:03:43Z,280
"@@ -73,8 +73,6 @@ public void testMultiClose()
             }
             throw eouter;
         }
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
         assertTrue(p.passed());
     }",2012-12-07T10:03:43Z,281
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -20,11 +24,23 @@ public class CloseTest {
 	public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				Close.class,
-				DemoBusinessParticipant.class);
+				DemoBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
 		test.testClose();
 	}
 }",2012-12-07T10:03:43Z,282
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -20,11 +24,23 @@ public class CompensateTest {
 	public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				Compensate.class,
-				DemoBusinessParticipant.class);
+				DemoBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
 		test.testCompensate();
 	}
 }",2012-12-07T10:03:43Z,283
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -14,6 +18,7 @@
 
 @RunWith(Arquillian.class)
 public class MultiCloseTest {
+    
 	@Inject
 	MultiClose test;
 	
@@ -22,11 +27,23 @@ public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				MultiClose.class,
 				DemoBusinessParticipant.class,
-				FailureBusinessParticipant.class);
+				FailureBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
-	
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(2);
 		test.testMultiClose();
 	}
 }",2012-12-07T10:03:43Z,281
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -22,11 +26,23 @@ public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				MultiCompensate.class,
 				DemoBusinessParticipant.class,
-				FailureBusinessParticipant.class);
+				FailureBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(2);
 		test.testMultiCompensate();
 	}
 }",2012-12-07T10:03:43Z,284
"@@ -18,18 +18,51 @@
 	<description>localjunit tests for xts</description>
         <properties>
             <buildType>11</buildType>
-            <general.server.jvm.args>-Xms64m -Xmx1024m -XX:MaxPermSize=512m</general.server.jvm.args>
+            <general.server.jvm.args>-Xms64m -Xmx1024m -XX:MaxPermSize=512m
+                                     -Dorg.jboss.byteman.verbose
+                                    -Djboss.modules.system.pkgs=org.jboss.byteman
+                                    -Dorg.jboss.byteman.transform.all
+                                    -javaagent:${project.build.directory}/lib/byteman.jar=listener:true
+            </general.server.jvm.args>
             <ipv4.server.jvm.args></ipv4.server.jvm.args>
             <ipv6.server.jvm.args>-Djboss.bind.address=[::1] -Djboss.bind.address.management=[::1] -Djboss.bind.address.unsecure=[::1] -Djava.net.preferIPv4Stack=false -Djava.net.preferIPv6Addresses=true</ipv6.server.jvm.args>
             <server.debug.args>Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5006</server.debug.args>
         </properties>
 
+    <build>
+        <plugins>
+                <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                      <artifactId>maven-dependency-plugin</artifactId>
+                      <executions>
+                        <execution>
+                          <id>copy-dependencies</id>
+                          <phase>test-compile</phase>
+                          <goals>
+                            <goal>copy-dependencies</goal>
+                          </goals>
+                          <configuration>
+                              <stripVersion>true</stripVersion>
+                              <includeGroupIds>org.jboss.byteman</includeGroupIds>
+                            <outputDirectory>${project.build.directory}/lib</outputDirectory>
+                          </configuration>
+                        </execution>
+                      </executions>
+                </plugin>
+        </plugins>
+    </build>
+
 	<dependencies>
 		<dependency>
 			<groupId>org.jboss.narayana.xts</groupId>
 			<artifactId>jbossxts</artifactId>
 			<scope>provided</scope>
 		</dependency>
+		<dependency>
+			<groupId>org.jboss.narayana.xts</groupId>
+			<artifactId>byteman_support</artifactId>
+            <scope>test</scope>
+		</dependency>
 		<dependency>
 			<groupId>junit</groupId>
 			<artifactId>junit</artifactId>
@@ -67,6 +100,37 @@
 				</plugins>
 			</build>
 		</profile>
+        <profile>
+      			<id>arq-remote</id>
+      			<activation>
+      				<activeByDefault>false</activeByDefault>
+      			</activation>
+      			<build>
+      				<plugins>
+      					<plugin>
+      						<artifactId>maven-surefire-plugin</artifactId>
+      						<configuration>
+      							<forkMode>once</forkMode>
+      							<systemPropertyVariables combine.children=""append"">
+      							<!--
+      							  Used in arquillian.xml
+      							-->
+      							  <server.jvm.args>${general.server.jvm.args} ${ipv4.server.jvm.args}</server.jvm.args>
+                                    <node.address>127.0.0.1</node.address>
+      							</systemPropertyVariables>
+      						</configuration>
+      					</plugin>
+      				</plugins>
+      			</build>
+      			<dependencies>
+      				<dependency>
+      					<groupId>org.jboss.as</groupId>
+      					<artifactId>jboss-as-arquillian-container-remote</artifactId>
+      					<version>${jboss-as.version}</version>
+      					<scope>test</scope>
+      				</dependency>
+      			</dependencies>
+      		</profile>
 		<profile>
 			<id>arq</id>
 			<activation>
@@ -83,7 +147,7 @@
 							  Used in arquillian.xml
 							-->
 							  <server.jvm.args>${general.server.jvm.args} ${ipv4.server.jvm.args}</server.jvm.args>
-                                                          <node.address>127.0.0.1</node.address>
+                              <node.address>127.0.0.1</node.address>
 							</systemPropertyVariables>
 						</configuration>
 					</plugin>",2012-12-07T10:03:43Z,34
"@@ -37,6 +37,7 @@
     </plugins>
   </build>
   <modules>
+    <module>byteman_support</module>
     <module>WSAS</module>
     <module>WSAS/xts-test-servlet</module>
     <module>WS-C</module>",2012-12-07T10:03:43Z,285
"@@ -52,6 +52,14 @@
     </plugins>
   </build>
   <dependencies>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman-submit</artifactId>
+    </dependency>
     <!-- START TEST -->
     <dependency>
       <groupId>junit</groupId>",2012-12-07T10:03:43Z,286
"@@ -942,6 +942,11 @@
         <artifactId>service</artifactId>
         <version>${project.version}</version>
       </dependency>
+      <dependency>
+	<groupId>org.jboss.narayana.xts</groupId>
+	<artifactId>byteman_support</artifactId>
+        <version>${project.version}</version>
+      </dependency>
       <dependency>
         <groupId>org.jboss.narayana.rts</groupId>
         <artifactId>restat-web</artifactId>
@@ -973,27 +978,27 @@
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-install</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-submit</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-bmunit</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-dtest</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
   </dependencies>
   </dependencyManagement>",2012-12-07T10:03:43Z,39
"@@ -37,6 +37,24 @@
                     <skip>true</skip>
                 </configuration>
             </plugin>
+            <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-dependency-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>copy-dependencies</id>
+                      <phase>test-compile</phase>
+                      <goals>
+                        <goal>copy-dependencies</goal>
+                      </goals>
+                      <configuration>
+                          <stripVersion>true</stripVersion>
+                          <includeGroupIds>org.jboss.byteman</includeGroupIds>
+                        <outputDirectory>${project.build.directory}/lib</outputDirectory>
+                      </configuration>
+                    </execution>
+                  </executions>
+            </plugin>
         </plugins>
     </build>
 
@@ -112,6 +130,11 @@
                 </exclusion>
             </exclusions>
         </dependency>
+	<dependency>
+	   <groupId>org.jboss.narayana.xts</groupId>
+	   <artifactId>byteman_support</artifactId>
+           <scope>test</scope>
+	</dependency>
         <dependency>
             <groupId>org.jboss.narayana.rts</groupId>
             <artifactId>restat-util</artifactId>",2012-12-07T10:03:43Z,41
"@@ -5,6 +5,8 @@
 import com.arjuna.wst.TransactionRolledBackException;
 import junit.framework.Assert;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Close;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Compensate;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.ConfirmCompleted;
@@ -13,7 +15,9 @@
 import org.jboss.narayana.txframework.functional.common.SomeApplicationException;
 import org.jboss.narayana.txframework.functional.interfaces.BAParticipantCompletion;
 import org.junit.After;
+import org.junit.AfterClass;
 import org.junit.Before;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -27,6 +31,17 @@ public class BAParticipantCompletionTest extends BaseFunctionalTest
     UserBusinessActivity uba;
     BAParticipantCompletion client;
 
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
     @Before
     public void setupTest() throws Exception
     {
@@ -45,9 +60,10 @@ public void teardownTest() throws Exception
     @Test
     public void testAutoComplete() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+        
         uba.begin();
         client.saveDataAutoComplete();
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -57,9 +73,10 @@ public void testAutoComplete() throws Exception
     @Test
     public void testManualComplete() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
         uba.begin();
         client.saveDataManualComplete(ServiceCommand.COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -68,10 +85,11 @@ public void testManualComplete() throws Exception
     @Test
     public void testMultiInvoke() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+        
         uba.begin();
         client.saveDataManualComplete();
         client.saveDataManualComplete(ServiceCommand.COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -80,9 +98,10 @@ public void testMultiInvoke() throws Exception
     @Test
     public void testClientDrivenCompensate() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
         uba.begin();
         client.saveDataAutoComplete();
-        Thread.sleep(10000); //JBTM-1203
         uba.cancel();
 
         assertOrder(ConfirmCompleted.class, Compensate.class);
@@ -113,8 +132,8 @@ public void testCannotComplete() throws Exception
     {
         uba.begin();
         client.saveDataAutoComplete(ServiceCommand.CANNOT_COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
+        
         assertOrder();
     }
 ",2012-12-07T10:03:43Z,287
"@@ -16,6 +16,11 @@
       <!-- If you want to use the JBOSS_HOME environment variable, just delete the jbossHome property -->
       <configuration>
 			<property name=""serverConfig"">standalone-xts.xml</property>
+            <property name=""javaVmArguments"">-Dorg.jboss.byteman.verbose
+                                    -Djboss.modules.system.pkgs=org.jboss.byteman
+                                    -Dorg.jboss.byteman.transform.all
+                                    -javaagent:../lib/byteman.jar=listener:true
+            </property>
       </configuration>
    </container>
 ",2012-12-07T10:03:43Z,129
"@@ -144,6 +144,17 @@
         <id>release</id>
         <build>
           <plugins>
+              <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                <artifactId>maven-install-plugin</artifactId>
+                <executions>
+                  <execution>
+                    <id>default-install</id>
+                    <phase>install</phase>
+                  </execution>
+                </executions>
+                <inherited>false</inherited>
+              </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,237
"@@ -42,4 +42,24 @@
     <module>txoj</module>
     <module>arjunacore</module>
   </modules>
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,288
"@@ -114,4 +114,24 @@
       <scope>test</scope>
     </dependency>
   </dependencies>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,289
"@@ -160,6 +160,17 @@
         <id>release</id>
         <build>
           <plugins>
+              <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                <artifactId>maven-install-plugin</artifactId>
+                <executions>
+                  <execution>
+                    <id>default-install</id>
+                    <phase>install</phase>
+                  </execution>
+                </executions>
+                <inherited>false</inherited>
+              </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,238
"@@ -41,4 +41,24 @@
     <module>jdbc</module>
     <module>narayana-jta</module>
   </modules>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,223
"@@ -61,18 +61,22 @@
     <dependency>
       <groupId>org.jboss.narayana.jta</groupId>
       <artifactId>jta</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss</groupId>
@@ -146,6 +150,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,69
"@@ -167,10 +167,22 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
@@ -179,6 +191,12 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>tanukisoft</groupId>
@@ -201,6 +219,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,29
"@@ -167,14 +167,32 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>tanukisoft</groupId>
@@ -221,6 +239,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,30
"@@ -45,4 +45,24 @@
     <module>narayana-jts-idlj</module>
     <module>integration</module>
   </modules>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,290
"@@ -27,4 +27,24 @@
             <artifactId>byteman-submit</artifactId>
         </dependency>
     </dependencies>
+    <profiles>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                    <plugin>
+                        <groupId>org.apache.maven.plugins</groupId>
+                        <artifactId>maven-install-plugin</artifactId>
+                        <executions>
+                            <execution>
+                                <id>default-install</id>
+                                <phase>install</phase>
+                            </execution>
+                        </executions>
+                        <inherited>false</inherited>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,275
"@@ -215,6 +215,17 @@
         <id>release</id>
         <build>
           <plugins>
+            <plugin>
+              <groupId>org.apache.maven.plugins</groupId>
+              <artifactId>maven-install-plugin</artifactId>
+              <executions>
+                <execution>
+                  <id>default-install</id>
+                  <phase>install</phase>
+                </execution>
+              </executions>
+              <inherited>false</inherited>
+            </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,33
"@@ -29,6 +29,16 @@
     </properties>
 
     <build>
+        <pluginManagement>
+            <plugins>
+                <plugin>
+                    <artifactId>maven-surefire-plugin</artifactId>
+                    <configuration>
+                        <skip>true</skip>
+                    </configuration>
+                </plugin>
+            </plugins>
+        </pluginManagement>
         <plugins>
             <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
@@ -94,26 +104,6 @@
         </dependency>
     </dependencies>
     <profiles>
-        <!-- The default profile skips all tests, though you can tune it
-            to run just unit tests based on a custom pattern -->
-        <!-- Seperate profiles are provided for running all tests, including
-            Arquillian tests that execute in the specified container -->
-        <profile>
-            <id>default</id>
-            <activation>
-                <activeByDefault>true</activeByDefault>
-            </activation>
-            <build>
-                <plugins>
-                    <plugin>
-                        <artifactId>maven-surefire-plugin</artifactId>
-                        <configuration>
-                            <skip>true</skip>
-                        </configuration>
-                    </plugin>
-                </plugins>
-            </build>
-        </profile>
         <profile>
             <id>arq-remote</id>
             <activation>
@@ -132,6 +122,7 @@
                                 <server.jvm.args>${jvm.args.memory} ${ipv4.server.jvm.args}</server.jvm.args>
                                 <node.address>127.0.0.1</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>
@@ -165,6 +156,7 @@
                                 </server.jvm.args>
                                 <node.address>127.0.0.1</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>
@@ -199,6 +191,7 @@
                                 </server.jvm.args>
                                 <node.address>[::1]</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>",2013-01-22T15:55:37Z,34
"@@ -50,4 +50,24 @@
     <module>jbossxts</module>
     <module>localjunit</module>
   </modules>
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,285
"@@ -69,4 +69,25 @@
     </dependency>
     <!-- END TEST -->
   </dependencies>
+
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,286
"@@ -1099,5 +1099,37 @@
         <module>STM</module>
       </modules>
     </profile>
+    <profile>
+      <id>release</id>
+      <build>
+          <pluginManagement>
+              <plugins>
+                  <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                    <artifactId>maven-install-plugin</artifactId>
+                    <executions>
+                      <execution>
+                        <id>default-install</id>
+                        <phase>none</phase>
+                      </execution>
+                    </executions>
+                  </plugin>
+              </plugins>
+          </pluginManagement>
+          <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
+          </plugins>
+      </build>
+    </profile>
   </profiles>
 </project>",2013-01-22T15:55:37Z,39
"@@ -51,4 +51,24 @@ Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
   <properties>
     <version.org.jboss.resteasy>2.0.0.GA</version.org.jboss.resteasy>
   </properties>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,291
"@@ -171,4 +171,24 @@
       </plugin>
     </plugins>
   </build>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                  <plugin>
+                      <groupId>org.apache.maven.plugins</groupId>
+                      <artifactId>maven-install-plugin</artifactId>
+                      <executions>
+                          <execution>
+                              <id>default-install</id>
+                              <phase>install</phase>
+                          </execution>
+                      </executions>
+                      <inherited>false</inherited>
+                  </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,292
"@@ -94,6 +94,13 @@
                     <target>1.6</target>
                 </configuration>
             </plugin>
+            <plugin>
+                <artifactId>maven-surefire-plugin</artifactId>
+                <version>2.11</version>
+                <configuration>
+                    <skip>true</skip>
+                </configuration>
+            </plugin>
         </plugins>
         <pluginManagement>
         	<plugins>
@@ -221,23 +228,6 @@
 
     </dependencies>
 	<profiles>
-		<profile>
-			<id>default</id>
-			<activation>
-				<activeByDefault>true</activeByDefault>
-			</activation>
-			<build>
-				<plugins>
-					<plugin>
-						<artifactId>maven-surefire-plugin</artifactId>
-						<version>2.11</version>
-						<configuration>
-							<skip>true</skip>
-						</configuration>
-					</plugin>
-				</plugins>
-			</build>
-		</profile>
 		<profile>
 			<id>arq</id>
 			<activation>
@@ -263,6 +253,7 @@
 								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
 								<node.address>localhost</node.address>
 							</systemPropertyVariables>
+                            <skip>false</skip>
 						</configuration>
 					</plugin>
 				</plugins>
@@ -305,6 +296,7 @@
 								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
 								<node.address>[::1]</node.address>
 							</systemPropertyVariables>
+                            <skip>false</skip>
 						</configuration>
 					</plugin>
 				</plugins>
@@ -333,5 +325,23 @@
 				</dependency>
 			</dependencies>
 		</profile>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                  <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                    <artifactId>maven-install-plugin</artifactId>
+                    <executions>
+                      <execution>
+                        <id>default-install</id>
+                        <phase>install</phase>
+                      </execution>
+                    </executions>
+                    <inherited>false</inherited>
+                  </plugin>
+                </plugins>
+            </build>
+        </profile>
 	</profiles>
 </project>",2013-01-22T15:55:37Z,162
"@@ -214,6 +214,24 @@
                 </dependency>
             </dependencies>
         </profile>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                    <plugin>
+                        <groupId>org.apache.maven.plugins</groupId>
+                        <artifactId>maven-install-plugin</artifactId>
+                        <executions>
+                            <execution>
+                                <id>default-install</id>
+                                <phase>install</phase>
+                            </execution>
+                        </executions>
+                        <inherited>false</inherited>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
     </profiles>
 
 </project>",2013-01-22T15:55:37Z,41
"@@ -0,0 +1,2 @@
+export UPSTREAM_AS_BRANCH=master
+export ORIGIN_AS_BRANCH=5_BRANCH
\ No newline at end of file",2013-02-08T16:09:11Z,267
"@@ -0,0 +1,36 @@
+function fatal {
+  echo ""Failed: $1""
+  exit 1
+}
+
+. branch-names.sh
+
+echo ""Rebaseing origin/$ORIGIN_AS_BRANCH with upstream/$UPSTREAM_AS_BRANCH""
+
+GIT_URL=""git@github.com:jbosstm/jboss-as.git""
+UPSTREAM_GIT_URL=""https://github.com/jbossas/jboss-as.git""
+TEMPORARY_REBASE_LOCATION=/tmp/rebase-jbossas-branch
+
+rm -rf $TEMPORARY_REBASE_LOCATION || fatal
+mkdir $TEMPORARY_REBASE_LOCATION || fatal
+cd $TEMPORARY_REBASE_LOCATION || fatal
+
+git clone $GIT_URL || fatal
+cd jboss-as
+git checkout -t origin/$ORIGIN_AS_BRANCH || fatal
+
+git remote add upstream $UPSTREAM_GIT_URL
+git pull --rebase --ff-only upstream $UPSTREAM_AS_BRANCH
+
+while [ $? != 0 ]
+do
+ for i in `git status -s | sed ""s/UU \(.*\)/\1/g""`
+ do
+    awk '/^<+ HEAD$/,/^=+$/{next} /^>+ /{next} 1' $i > $i.bak; mv $i.bak $i; git add $i
+ done
+ git rebase --continue
+done
+[ $? = 0 ] || fatal ""git rebase failed""
+
+git push origin $ORIGIN_AS_BRANCH -f
+rm -rf $TEMPORARY_REBASE_LOCATION",2013-02-08T16:09:11Z,268
"@@ -69,13 +69,12 @@
     <property name=""version"" value=""5.0.0.M2-SNAPSHOT""/>
 -->
   <!-- a working directory for the process. Can contain output from previous releases if you like to keep them archived locally. -->
-  <!--property name=""workdir"" location=""/tmp/narayana_releases""/-->
+  <property name=""workdir"" location=""/tmp/narayana_releases""/>
   <!-- where to get the source -->
-  <property name=""svnbase"" value=""https://svn.jboss.org/repos/labs/labs/jbosstm/tags""/>
+  <property name=""gitbase"" value=""https://github.com/jbosstm""/>
   <!-- The tag as it appears under svnbase -->
-  <property name=""tag"" value=""5_0_0_M1""/>
-  <!-- The file name base for the user downloadable files. Derive it from the tag -->
-  <property name=""version"" value=""5.0.0.M1""/>
+  <property name=""pageName"" value=""4_17_0_Final""/>
+  <property name=""tag"" value=""4.17.0.Final""/>
   <!-- which uber jar to use -->
   <property name=""orb"" value=""jacorb""/>
   <!-- the location the JBossTS web site content is copied to -->
@@ -100,40 +99,116 @@
         </not>
       </condition>
     </fail>
-    <fail message=""You must not already have a local maven cached repository to do a release build"">
-      <condition>
-        <available file=""repository"" type=""dir""/>
-      </condition>
-    </fail>
     <fail message=""You cannot perform a build without cleaning the old version out"">
       <condition>
         <available file=""${workdir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <mkdir dir=""${workdir}""/>
-    <!-- pull the source code from svn -->
-    <exec executable=""svn"" dir=""${workdir}"">
+    <!-- pull the source code from git -->
+    <exec executable=""git"" dir=""${workdir}"">
+      <arg value=""clone""/>
+      <arg value=""${gitbase}/narayana.git""/>
+      <arg value=""${tag}""/>
+    </exec>
+    <exec executable=""git"" dir=""${workdir}/${tag}"">
       <arg value=""checkout""/>
-      <arg value=""${svnbase}/${tag}""/>
+      <arg value=""${tag}""/>
     </exec>
   </target>
   <target name=""dist"" depends=""dist-init"" description=""build the end-user release bundles (src and binary)"">
     <!-- build the binary releases -->
     <exec dir=""${workdir}/${tag}"" executable=""tools/maven/bin/mvn"" failonerror=""true"">
       <arg line=""clean -gs tools/maven/conf/settings.xml -Demma.jar.location=${user.dir}/ext/emma.jar -Dorson.jar.location=${user.dir}/ext/orson-0.5.0.jar""/>
     </exec>
-    <!-- package the JTA only src tree (no JTS, XTS, txbridge, RTS) -->
-    <delete file=""${workdir}/narayana-jta-${version}-src.zip""/>
-    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-jta-${version}-src.zip"" includes=""${tag}/**"" excludes=""${tag}/ArjunaJTS/**, ${tag}/XTS/** ${tag}/txbridge/**, ${tag}/rest-tx/**, ${tag}/repository/**""/>
     <!-- package the full source release (all src tree) -->
-    <delete file=""${workdir}/narayana-full-${version}-src.zip""/>
-    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-full-${version}-src.zip"" includes=""${tag}/**"" excludes=""${tag}/repository/**""/>
+    <delete file=""${workdir}/narayana-full-${tag}-src.zip""/>
+    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-full-${tag}-src.zip"" includes=""${tag}/**""/>
     <!-- build the binary releases -->
     <exec dir=""${workdir}/${tag}"" executable=""tools/maven/bin/mvn"" failonerror=""true"">
       <arg line=""deploy -DskipTests -gs tools/maven/conf/settings.xml -Demma.jar.location=${user.dir}/ext/emma.jar -Dorson.jar.location=${user.dir}/ext/orson-0.5.0.jar""/>
     </exec>
   </target>
   <!-- copy the release into the downloads dir tree (http://www.jboss.org/jbosstm web site content) -->
+  <target name=""docs"">
+    <fail>
+      <condition>
+        <not>
+          <available file=""${downloads.dir}"" type=""dir""/>
+        </not>
+      </condition>
+    </fail>
+    <fail>
+      <condition>
+        <not>
+          <available file=""${docs.dir}"" type=""dir""/>
+        </not>
+      </condition>
+    </fail>
+
+    <exec executable=""git"" dir=""${workdir}"">
+      <arg value=""clone""/>
+      <arg value=""${gitbase}/documentation.git""/>
+      <arg value=""${tag}-docs""/>
+    </exec>
+    <exec executable=""git"" dir=""${workdir}/${tag}-docs"">
+      <arg value=""checkout""/>
+      <arg value=""${tag}""/>
+    </exec>
+    <exec dir=""${workdir}/${tag}-docs"" executable=""mvn"" failonerror=""true"">
+      <arg line=""install""/>
+    </exec>
+    <delete dir=""tmp-docs-dir-docs""/>
+    <mkdir dir=""tmp-docs-dir-docs""/>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-orbportability_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/orbportability_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-quick_start_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/quick_start_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-administration_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/administration_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/arjunacore-failure_recovery_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaCore/docs/failure_recovery_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/arjunacore-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaCore/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-quick_start_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/quick_start_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-installation_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/installation_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-administration_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/administration_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/xts-administration_and_development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/XTS/docs/administration_and_development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/failure_recovery_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/failure_recovery_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/transactions_overview_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/transactions_overview_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/txbridge_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/txbridge_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <move todir=""${docs.dir}/${tag}"" verbose=""true"">
+      <fileset dir=""tmp-docs-dir-docs""/>
+    </move>
+  </target> 
   <target name=""downloads"" description=""copy release bundles to JBossTS web site content"">
     <fail>
       <condition>
@@ -144,7 +219,7 @@
     </fail>
     <fail>
       <condition>
-        <available file=""${downloads.dir}/${version}"" type=""dir""/>
+        <available file=""${downloads.dir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <fail>
@@ -156,7 +231,7 @@
     </fail>
     <fail>
       <condition>
-        <available file=""${docs.dir}/${version}"" type=""dir""/>
+        <available file=""${docs.dir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <delete dir=""tmp-downloads-dir""/>
@@ -167,91 +242,37 @@
     <delete dir=""tmp-docs-dir""/>
     <mkdir dir=""tmp-docs-dir""/>
     <copy todir=""tmp-downloads-dir/src"">
-      <fileset dir=""${workdir}"" includes=""narayana-*-${version}-src.zip""/>
+      <fileset dir=""${workdir}"" includes=""narayana-*-${tag}-src.zip""/>
     </copy>
     <copy todir=""tmp-downloads-dir/binary"">
-      <fileset dir=""${workdir}/${tag}/narayana-full/target/"" includes=""narayana-full-${version}-bin.zip""/>
+      <fileset dir=""${workdir}/${tag}/narayana-full/target/"" includes=""narayana-full-${tag}-bin.zip""/>
     </copy>
     <copy todir=""tmp-downloads-dir/idl"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/jts/idl/arjuna"">
+      <fileset dir=""${workdir}/${tag}/ArjunaJTS/idl/src/main/idl/arjuna"">
         <include name=""ArjunaOTS.idl""/>
       </fileset>
     </copy>
     <copy todir=""tmp-downloads-dir/idl"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/jts/idl/omg"">
+      <fileset dir=""${workdir}/${tag}/ArjunaJTS/idl/src/main/idl/omg"">
         <include name=""CosTransactions.idl""/>
         <include name=""XA.idl""/>
       </fileset>
     </copy>
-    <copy file=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/narayana-jts-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/jta""/>
-    <copy file=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/jts""/>
-    <copy file=""${workdir}/${tag}/rest-tx/tx/target/rest-tx-api-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/rts""/>
-    <copy file=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/xts""/>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-orbportability_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/orbportability_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-quick_start_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/quick_start_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-administration_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/administration_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/arjunacore-failure_recovery_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaCore/docs/failure_recovery_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/arjunacore-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaCore/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-quick_start_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/quick_start_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-installation_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/installation_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-administration_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/administration_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/xts-administration_and_development_guide"">
-      <fileset dir=""${workdir}/${tag}/XTS/docs/administration_and_development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/failure_recovery_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/failure_recovery_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/release_notes"">
-      <fileset dir=""${workdir}/${tag}/docs/release_notes/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/development_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/transactions_overview_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/transactions_overview_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/txbridge_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/txbridge_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <unzip src=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/narayana-jts-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/jts""/>
-    <unzip src=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/jta""/>
-    <unzip src=""${workdir}/${tag}/rest-tx/tx/target/rest-tx-api-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/rts""/>
-    <unzip src=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/xts""/>
-    <move todir=""${downloads.dir}/${version}"" verbose=""true"">
+    <copy file=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/jbossjts-jacorb-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/jts""/>
+    <copy file=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/jta""/>
+    <copy file=""${workdir}/${tag}/rest-tx/tx/target/restat-api-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/rts""/>
+    <copy file=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/xts""/>
+    <unzip src=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/jbossjts-jacorb-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/jts""/>
+    <unzip src=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/jta""/>
+    <unzip src=""${workdir}/${tag}/rest-tx/tx/target/restat-api-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/rts""/>
+    <unzip src=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/xts""/>
+    <move todir=""${downloads.dir}/${tag}"" verbose=""true"">
       <fileset dir=""tmp-downloads-dir""/>
     </move>
-    <move todir=""${docs.dir}/${version}"" verbose=""true"">
+    <move todir=""${docs.dir}/${tag}"" verbose=""true"">
       <fileset dir=""tmp-docs-dir""/>
     </move>
   </target>
-  <!-- copy the release artifacts to the maven repository -->
-  <target name=""mvn-repository"" description=""copy the release artifacts to the maven repository"">
-    <!-- xts -->
-    <mvn-artifact.macro artifact=""jbossxts-tests"" packaging=""zip"" dir=""${workdir}/build/${tag}/xts/tests""/>
-    <mvn-artifact.macro artifact=""jbossxts-interop-tests"" packaging=""zip"" dir=""${workdir}/build/${tag}/xts/interop-tests""/>
-  </target>
   <!-- magnolia (the cms that sits behind jboss.org/jbosstm pages) is a pain. This target generates
      xml for /downloads/somerelease.xml pages to ease some of the pain in publishing an upload
       right click jbosstm/downloads node, import from xml, then right click new node and activate.
@@ -261,20 +282,24 @@
     <exec executable=""date"" outputproperty=""date"">
       <arg line=""+'%FT%H:%M:%S.000Z'""/>
     </exec>
-    <length property=""jta-src-length"" file=""${workdir}/jbossts-jta-${version}-src.zip""/>
-    <length property=""full-src-length"" file=""${workdir}/jbossts-full-${version}-src.zip""/>
-    <length property=""jta-bin-length"" file=""${workdir}/jbossts-jta-${version}.zip""/>
-    <length property=""full-bin-length"" file=""${workdir}/jbossts-full-${version}.zip""/>
-    <copy file=""magnolia-release-download-page-template.xml"" tofile=""${workdir}/website.jbosstm.downloads.${version}.xml"" filtering=""true"" overwrite=""true"">
+    <length property=""full-src-length"" file=""${workdir}/narayana-full-${tag}-src.zip""/>
+    <length property=""full-bin-length"" file=""${workdir}/${tag}/narayana-full/target/narayana-full-${tag}-bin.zip""/>
+    <copy file=""magnolia-release-download-page-template.xml"" tofile=""${workdir}/website.jbosstm.downloads.${pageName}.xml"" filtering=""true"" overwrite=""true"">
       <filterset>
+        <filter token=""pageName"" value=""${pageName}""/>
         <filter token=""tag"" value=""${tag}""/>
-        <filter token=""version"" value=""${version}""/>
+        <filter token=""version"" value=""${tag}""/>
         <filter token=""date"" value=""${date}""/>
-        <filter token=""jta-src-length"" value=""${jta-src-length}""/>
         <filter token=""full-src-length"" value=""${full-src-length}""/>
-        <filter token=""jta-bin-length"" value=""${jta-bin-length}""/>
         <filter token=""full-bin-length"" value=""${full-bin-length}""/>
       </filterset>
     </copy>
+    <copy file=""magnolia-release-documentation-page-template.xml"" tofile=""${workdir}/website.jbosstm.documentation.${pageName}.xml"" filtering=""true"" overwrite=""true"">
+      <filterset>
+        <filter token=""pageName"" value=""${pageName}""/>
+        <filter token=""tag"" value=""${tag}""/>
+        <filter token=""date"" value=""${date}""/>
+      </filterset>
+    </copy>
   </target>
 </project>",2012-09-25T19:52:29Z,269
"@@ -0,0 +1,237 @@
+<?xml version=""1.0"" encoding=""UTF-8""?>
+<sv:node sv:name=""@pageName@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
+  <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+    <sv:value>mgnl:content</sv:value>
+  </sv:property>
+  <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+    <sv:value>mix:lockable</sv:value>
+  </sv:property>
+  <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+    <sv:value>14f62a08-1dfe-41b3-bdce-61ce87b8129d</sv:value>
+  </sv:property>
+  <sv:property sv:name=""enableRSS"" sv:type=""String"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""hideInNav"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""menubar"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaCache"" sv:type=""String"">
+    <sv:value>disable</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaExpire"" sv:type=""String"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaRobots"" sv:type=""String"">
+    <sv:value>all</sv:value>
+  </sv:property>
+  <sv:property sv:name=""redirectWindow"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""title"" sv:type=""String"">
+    <sv:value>Narayana Documentation @tag@</sv:value>
+  </sv:property>
+  <sv:property sv:name=""useTitle"" sv:type=""Boolean"">
+    <sv:value>true</sv:value>
+  </sv:property>
+  <sv:node sv:name=""MetaData"">
+    <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+      <sv:value>mgnl:metaData</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+      <sv:value>true</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+      <sv:value>superuser</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+      <sv:value>tm</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:comment"" sv:type=""String"">
+      <sv:value>Made references to git and subversion</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+      <sv:value>2009-12-10T11:47:09.824-05:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+      <sv:value>2012-04-27T05:09:36.605-04:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+      <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:template"" sv:type=""String"">
+      <sv:value>jbossorgProjectSubPage</sv:value>
+    </sv:property>
+  </sv:node>
+  <sv:node sv:name=""mainColumnParagraphs"">
+    <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+      <sv:value>mgnl:contentNode</sv:value>
+    </sv:property>
+    <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+      <sv:value>mix:lockable</sv:value>
+    </sv:property>
+    <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+      <sv:value>43dab693-c6e7-4eda-869e-5b1d9ad358d5</sv:value>
+    </sv:property>
+    <sv:node sv:name=""MetaData"">
+      <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+        <sv:value>mgnl:metaData</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+        <sv:value>true</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+        <sv:value>superuser</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+        <sv:value>tm</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+        <sv:value>2009-12-10T11:47:46.060-05:00</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+        <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+        <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+      </sv:property>
+    </sv:node>
+    <sv:node sv:name=""0"">
+      <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+        <sv:value>mgnl:contentNode</sv:value>
+      </sv:property>
+      <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+        <sv:value>mix:lockable</sv:value>
+      </sv:property>
+      <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+        <sv:value>6aec081e-5217-4adf-b06c-8c5bf92a886b</sv:value>
+      </sv:property>
+      <sv:property sv:name=""flow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""headerSize"" sv:type=""String"">
+        <sv:value>h3</sv:value>
+      </sv:property>
+      <sv:property sv:name=""imageLinkNewWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""imageLocation"" sv:type=""String"">
+        <sv:value>left</sv:value>
+      </sv:property>
+      <sv:property sv:name=""inherit"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""lineAbove"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkImage"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkText"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkTitle"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkWindowMenubar"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""spacer"" sv:type=""Long"">
+        <sv:value>0</sv:value>
+      </sv:property>
+      <sv:property sv:name=""text"" sv:type=""String"">
+        <sv:value>&lt;h1&gt;JBoss Narayana Documentation Library&lt;/h1&gt; &lt;p&gt; &lt;table cellspacing=""5"" class=""infotable"" style=""margin: 2px; padding: 2px; font-size: 90%;""&gt;     &lt;tbody&gt;         &lt;tr&gt;             &lt;th width=""220"" class=""grey""&gt;JBoss Narayana Document&lt;/th&gt;             &lt;th width=""80"" class=""grey""&gt;Version&lt;/th&gt;             &lt;th width=""80"" class=""grey""&gt;Released&lt;/th&gt;             &lt;th class=""blank""&gt;&amp;nbsp;&lt;/th&gt;             &lt;th class=""blank""&gt;&amp;nbsp;&lt;/th&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ORB Portability Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-orbportability_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;NarayanaJTS Quick Start Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-quick_start_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTS Administration Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-administration_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTS Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ArjunaCore Failure Recovery Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/arjunacore-failure_recovery_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ArjunaCore Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/arjunacore-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Quick Start Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-quick_start/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Installation Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-installation_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Administration Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-administration_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;XTS Administration and Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/xts-administration_and_development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Failure Recovery Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/failure_recovery_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Release Notes&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/release_notes/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Transactions Overview Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/transactions_overview_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;TXBridge Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/txbridge_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/jts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/jts/jbossjts-jacorb-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTA API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/jta/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/jta/narayana-jta-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;RTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/rts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/rts/restat-api-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;XTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/xts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/xts/jbossxts-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - ArjunaOTS&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/ArjunaOTS.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - CosTransactions.idl&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/CosTransactions.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - XA&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/XA.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;     &lt;/tbody&gt; &lt;/table&gt; &lt;/p&gt;</sv:value>
+      </sv:property>
+      <sv:property sv:name=""titleLinkNewWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:node sv:name=""MetaData"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:metaData</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+          <sv:value>true</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+          <sv:value>superuser</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+          <sv:value>tm</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+          <sv:value>2009-12-10T11:47:46.061-05:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+          <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+          <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:template"" sv:type=""String"">
+          <sv:value>richTextHtml</sv:value>
+        </sv:property>
+      </sv:node>
+      <sv:node sv:name=""text_files"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:contentNode</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+          <sv:value>mix:lockable</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+          <sv:value>41f11088-5628-42b3-8c36-51b7a4199eaf</sv:value>
+        </sv:property>
+        <sv:node sv:name=""MetaData"">
+          <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+            <sv:value>mgnl:metaData</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+            <sv:value>true</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+            <sv:value>superuser</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+            <sv:value>2009-12-10T11:47:46.061-05:00</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+            <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+          </sv:property>
+        </sv:node>
+      </sv:node>
+      <sv:node sv:name=""imageFooter_files"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:contentNode</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+          <sv:value>mix:lockable</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+          <sv:value>6b6abc15-1022-44a0-917e-29a9691832e4</sv:value>
+        </sv:property>
+        <sv:node sv:name=""MetaData"">
+          <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+            <sv:value>mgnl:metaData</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+            <sv:value>true</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+            <sv:value>superuser</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+            <sv:value>2009-12-10T11:47:46.064-05:00</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+            <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+          </sv:property>
+        </sv:node>
+      </sv:node>
+    </sv:node>
+  </sv:node>
+</sv:node>",2012-09-25T19:52:29Z,270
"@@ -1,5 +1,5 @@
 <?xml version=""1.0"" encoding=""UTF-8""?>
-<sv:node sv:name=""@tag@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
+<sv:node sv:name=""@pageName@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
   <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
     <sv:value>mgnl:content</sv:value>
   </sv:property>
@@ -31,7 +31,7 @@
     <sv:value>false</sv:value>
   </sv:property>
   <sv:property sv:name=""title"" sv:type=""String"">
-    <sv:value>JBossTS @filename@ release</sv:value>
+    <sv:value>JBossTS @tag@ release</sv:value>
   </sv:property>
   <sv:property sv:name=""useTitle"" sv:type=""String"">
     <sv:value>true</sv:value>
@@ -99,12 +99,6 @@
       <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
         <sv:value>00bd1847-65cd-4ff1-b7ce-20b8084be52b</sv:value>
       </sv:property>
-      <sv:property sv:name=""desc21"" sv:type=""String"">
-        <sv:value>The JBoss Transactions JTA @filename@ Source</sv:value>
-      </sv:property>
-      <sv:property sv:name=""desc22"" sv:type=""String"">
-        <sv:value>JBoss Transactions JTA @filename@ Binary</sv:value>
-      </sv:property>
       <sv:property sv:name=""desc23"" sv:type=""String"">
         <sv:value>JBoss Transactions JTS (and JTA) and WS-T Source Code</sv:value>
       </sv:property>
@@ -123,17 +117,11 @@
       <sv:property sv:name=""license24"" sv:type=""String"">
         <sv:value>LGPL</sv:value>
       </sv:property>
-      <sv:property sv:name=""name21"" sv:type=""String"">
-        <sv:value>jbossts-jta-@filename@-src.zip</sv:value>
-      </sv:property>
-      <sv:property sv:name=""name22"" sv:type=""String"">
-        <sv:value>jbossts-jta-@filename@.zip</sv:value>
-      </sv:property>
       <sv:property sv:name=""name23"" sv:type=""String"">
-        <sv:value>jbossts-full-@filename@-src.zip</sv:value>
+        <sv:value>narayana-full-@tag@-src.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""name24"" sv:type=""String"">
-        <sv:value>jbossts-full-@filename@.zip</sv:value>
+        <sv:value>narayana-full-@tag@-bin.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""popup"" sv:type=""String"">
         <sv:value>true</sv:value>
@@ -168,20 +156,14 @@
       <sv:property sv:name=""showVersion"" sv:type=""String"">
         <sv:value>false</sv:value>
       </sv:property>
-      <sv:property sv:name=""size21"" sv:type=""String"">
-        <sv:value>@jta-src-length@</sv:value>
-      </sv:property>
-      <sv:property sv:name=""size22"" sv:type=""String"">
-        <sv:value>@full-src-length@</sv:value>
-      </sv:property>
       <sv:property sv:name=""size23"" sv:type=""String"">
-        <sv:value>@jta-bin-length@</sv:value>
+        <sv:value>@full-src-length@</sv:value>
       </sv:property>
       <sv:property sv:name=""size24"" sv:type=""String"">
         <sv:value>@full-bin-length@</sv:value>
       </sv:property>
       <sv:property sv:name=""tableTitle"" sv:type=""String"">
-        <sv:value>JBossTS @filename@ release</sv:value>
+        <sv:value>JBossTS @tag@ release</sv:value>
       </sv:property>
       <sv:property sv:name=""text21"" sv:type=""String"">
         <sv:value>Download</sv:value>
@@ -195,17 +177,11 @@
       <sv:property sv:name=""text24"" sv:type=""String"">
         <sv:value>Download</sv:value>
       </sv:property>
-      <sv:property sv:name=""url21"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/src/jbossts-jta-@filename@-src.zip</sv:value>
-      </sv:property>
-      <sv:property sv:name=""url22"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/binary/jbossts-jta-@filename@.zip</sv:value>
-      </sv:property>
       <sv:property sv:name=""url23"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/src/jbossts-full-@filename@-src.zip</sv:value>
+        <sv:value>http://www.jboss.org/jbosstm/downloads/@tag@/src/narayana-full-@tag@-src.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""url24"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/binary/jbossts-full-@filename@.zip</sv:value>
+        <sv:value>http://www.jboss.org/jbosstm/downloads/@tag@/binary/narayana-full-@tag@-bin.zip</sv:value>
       </sv:property>
       <sv:node sv:name=""MetaData"">
         <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">",2012-09-25T19:52:29Z,271
"@@ -890,9 +890,6 @@ public interface wstI18NLogger {
 	@LogMessage(level = WARN)
 	public void warn_recovery_participant_ba_BAParticipantRecoveryRecord_saveState_3(String arg0, @Cause() Throwable arg1);
 
-    @Message(id = 43228, value = ""Delay of {0} ms reached before changing state from {1} to something else"", format = MESSAGE_FORMAT)
-   	@LogMessage(level = WARN)
-   	public void warn_state_change_timeout(String arg0, String arg1);
 
     /*
         Allocate new messages directly above this notice.",2013-01-15T16:13:39Z,272
"@@ -526,7 +526,6 @@ private State waitForState(final State origState, final long delay)
                 final long remaining = end - System.currentTimeMillis() ;
                 if (remaining <= 0)
                 {
-                    WSTLogger.i18NLogger.warn_state_change_timeout(String.valueOf(delay), origState.toString());
                     break ;
                 }
                 try",2013-01-15T16:13:39Z,72
"@@ -183,7 +183,7 @@
                                 <!--
                                     Used in arquillian.xml
                                 -->
-                                <server.jvm.args>${jvm.args.byteman} ${jvm.args.memory} -Dorg.jboss.jbossts.xts.transport.transportTimeout=60000</server.jvm.args>
+                                <server.jvm.args>${jvm.args.byteman} ${jvm.args.memory}</server.jvm.args>
                             </systemPropertyVariables>
                         </configuration>
                     </plugin>",2013-01-15T16:13:39Z,41
"@@ -15,15 +15,18 @@ if [ """" == ""$JBOSS_BUILD_HOME"" ]; then
 fi
 
 if [ ""$2"" == ""--clean"" ] || [ ""$3"" == ""--clean"" ]; then
+    echo ""Cleaning""
     CLEAN=clean
 fi
 
 if [ ""$2"" == ""--xts"" ] || [ ""$3"" == ""--xts"" ]; then
+    echo ""Rebuilding XTS""
     cd ..
     ./build.sh -f ./XTS/pom.xml $CLEAN install -DskipTests || fail
     cd -
 fi
 
+
 mvn $CLEAN install || fail
 kill-jboss
 $JBOSS_BUILD_HOME/build.sh $CLEAN install -f $JBOSS_BUILD_HOME/xts/pom.xml -DskipTests || fail",2013-01-15T16:13:39Z,198
"@@ -55,7 +55,7 @@ public class ATBridgeImpl implements ATBridge {
     public void incrementCounter(int how_many) {
 
         SimpleEntity entity = getSimpleEntity();
-        entity.incrimentCounter(how_many);
+        entity.incrementCounter(how_many);
         em.merge(entity);
     }
 
@@ -81,7 +81,7 @@ private SimpleEntity getSimpleEntity() {
 
         SimpleEntity entity = em.find(SimpleEntity.class, ENTITY_ID);
         if (entity == null) {
-            entity = new SimpleEntity();
+            entity = new SimpleEntity(ENTITY_ID, 0);
             em.persist(entity);
         }
 ",2013-01-15T16:13:39Z,273
"@@ -1,6 +1,6 @@
 /*
  * JBoss, Home of Professional Open Source.
- * Copyright 2012, Red Hat, Inc., and individual contributors
+ * Copyright 2013, Red Hat, Inc., and individual contributors
  * as indicated by the @author tags. See the copyright.txt file in the
  * distribution for a full listing of individual contributors.
  *",2013-01-15T16:13:39Z,201
"@@ -22,7 +22,6 @@
 package org.jboss.narayana.txframework.functional.ws.at.bridged;
 
 import javax.persistence.Entity;
-import javax.persistence.GeneratedValue;
 import javax.persistence.Id;
 import java.io.Serializable;
 
@@ -41,8 +40,13 @@ public SimpleEntity() {
 
     }
 
+    public SimpleEntity(int id, int initialCounterValue) {
+
+        this.id = id;
+        this.bookingCount = initialCounterValue;
+    }
+
     @Id
-    @GeneratedValue
     public int getId() {
 
         return id;
@@ -63,8 +67,8 @@ public void setCounter(int counter) {
         this.bookingCount = counter;
     }
 
-    public void incrimentCounter(int how_many) {
+    public void incrementCounter(int howMany) {
 
-        setCounter(getCounter() + how_many);
+        setCounter(getCounter() + howMany);
     }
 }",2013-01-15T16:13:39Z,274
"@@ -87,26 +87,6 @@
                     <target>1.6</target>
                 </configuration>
             </plugin>
-            <plugin>
-                <groupId>org.apache.maven.plugins</groupId>
-                <artifactId>maven-surefire-plugin</artifactId>
-                <configuration>
-                    <skip>true</skip>
-                    <!-- Prevent test and server output appearing in console. -->
-                    <redirectTestOutputToFile>true</redirectTestOutputToFile>
-                    <enableAssertions>true</enableAssertions>
-                    <!-- Tests to execute. -->
-                    <includes>
-                        <include>**/*Tests.java</include>
-                    </includes>
-                    <!-- System properties passed to test cases -->
-                    <systemPropertyVariables>
-                        <!-- Used in arquillian.xml - arguments for all JBoss AS instances. -->
-                        <server.jvm.args>${general.server.jvm.args} ${byteman.server.jvm.args} ${jpda.server.jvm.args}</server.jvm.args>
-                        <java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
-                    </systemPropertyVariables>
-                </configuration>
-            </plugin>
         </plugins>
         <pluginManagement>
         	<plugins>
@@ -233,4 +213,58 @@
         </dependency>
 
     </dependencies>
+	<profiles>
+		<profile>
+			<id>default</id>
+			<activation>
+				<activeByDefault>true</activeByDefault>
+			</activation>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-surefire-plugin</artifactId>
+						<configuration>
+							<skip>true</skip>
+						</configuration>
+					</plugin>
+				</plugins>
+			</build>
+		</profile>
+		<profile>
+			<id>arq</id>
+			<activation>
+				<activeByDefault>false</activeByDefault>
+			</activation>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-surefire-plugin</artifactId>
+						<configuration>
+							<!-- Prevent test and server output appearing in console. -->
+							<redirectTestOutputToFile>true</redirectTestOutputToFile>
+							<enableAssertions>true</enableAssertions>
+							<!-- Tests to execute. -->
+							<includes>
+								<include>**/*Tests.java</include>
+							</includes>
+							<!-- System properties passed to test cases -->
+							<systemPropertyVariables>
+								<!-- Used in arquillian.xml - arguments for all JBoss AS instances. -->
+								<server.jvm.args>${general.server.jvm.args} ${byteman.server.jvm.args} ${jpda.server.jvm.args}</server.jvm.args>
+								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
+							</systemPropertyVariables>
+						</configuration>
+					</plugin>
+				</plugins>
+			</build>
+			<dependencies>
+				<dependency>
+					<groupId>org.jboss.as</groupId>
+					<artifactId>jboss-as-arquillian-container-managed</artifactId>
+					<version>${jboss-as.version}</version>
+					<scope>test</scope>
+				</dependency>
+			</dependencies>
+		</profile>
+	</profiles>
 </project>",2012-05-07T06:29:32Z,162
"@@ -0,0 +1,30 @@
+<?xml version=""1.0"" encoding=""UTF-8""?>
+<!-- JBoss, Home of Professional Open Source Copyright 2008, Red Hat Middleware LLC, and others contributors as indicated by the @authors tag. All rights reserved. See the copyright.txt in the distribution 
+	for a full listing of individual contributors. This copyrighted material is made available to anyone wishing to use, modify, copy, or redistribute it subject to the terms and conditions of the GNU Lesser 
+	General Public License, v. 2.1. This program is distributed in the hope that it will be useful, but WITHOUT A WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR 
+	PURPOSE. See the GNU Lesser General Public License for more details. You should have received a copy of the GNU Lesser General Public License, v.2.1 along with this distribution; if not, write to the Free 
+	Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA. -->
+<project xmlns=""http://maven.apache.org/POM/4.0.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
+         xsi:schemaLocation=""http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"">
+    <parent>
+        <groupId>org.jboss.narayana.xts</groupId>
+        <artifactId>xts-all</artifactId>
+        <version>5.0.0.M2-SNAPSHOT</version>
+        <relativePath>../pom.xml</relativePath>
+    </parent>
+    <modelVersion>4.0.0</modelVersion>
+    <artifactId>byteman_support</artifactId>
+    <packaging>jar</packaging>
+    <name>Reusable Byteman rules for xts</name>
+    
+    <dependencies>
+        <dependency>
+            <groupId>org.jboss.byteman</groupId>
+            <artifactId>byteman</artifactId>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.byteman</groupId>
+            <artifactId>byteman-submit</artifactId>
+        </dependency>
+    </dependencies>
+</project>",2012-12-07T10:03:43Z,275
"@@ -0,0 +1,53 @@
+package org.jboss.jbossts.xts.bytemanSupport;
+
+import org.jboss.byteman.agent.submit.Submit;
+
+import java.io.IOException;
+import java.io.InputStream;
+import java.net.URL;
+import java.util.ArrayList;
+import java.util.List;
+
+/**
+ * @Author paul.robinson@redhat.com 22/11/2012
+ */
+public class BMScript {
+
+    private static final Submit submit = new Submit();
+
+    public static void submit(String scriptResourcePath) {
+
+        try {
+            List<InputStream> streams = getScriptFromResource(scriptResourcePath);
+            submit.addRulesFromResources(streams);
+        } catch (Exception e) {
+            throw new RuntimeException(""Failed to submit Byteman script"", e);
+        }
+    }
+
+    public static void remove(String scriptResourcePath) {
+
+        try {
+            List<InputStream> streams = getScriptFromResource(scriptResourcePath);
+            submit.deleteRulesFromResources(streams);
+        } catch (Exception e) {
+            throw new RuntimeException(""Failed to remove Byteman script"", e);
+        }
+    }
+
+    private static List<InputStream> getScriptFromResource(String scriptResourcePath) {
+        URL resource = Thread.currentThread().getContextClassLoader().getResource(scriptResourcePath);
+        if (resource == null) {
+            throw new RuntimeException(""'"" + scriptResourcePath + ""' can't be found on the classpath"");
+        }
+
+        List<InputStream> streams = new ArrayList<InputStream>();
+        try {
+            streams.add(resource.openStream());
+        } catch (IOException e) {
+            throw new RuntimeException(""Unable to open stream at url location: "" + resource.toString());
+        }
+        return streams;
+    }
+
+}",2012-12-07T10:03:43Z,276
"@@ -0,0 +1,13 @@
+package org.jboss.jbossts.xts.bytemanSupport.participantCompletion;
+
+/**
+ * @Author paul.robinson@redhat.com 26/11/2012
+ */
+public class ParticipantCompletionCoordinatorRules {
+
+    public static String RESOURCE_PATH= ""org/jboss/jbossts/xts/bytemanSupport/participantCompletion/participant_completion_coordinator_rules.btm"";
+
+    public static void setParticipantCount(Integer participantCount) {
+        //Dummy method, detected by Byteman Rules
+    }
+}",2012-12-07T10:03:43Z,277
"@@ -0,0 +1,40 @@
+RULE create counter
+CLASS org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules
+METHOD setParticipantCount(Integer)
+BIND counter:Integer=$1
+IF TRUE
+DO debug(""participant_completion.counter.create: "" + counter),
+  deleteCounter(""completes""),
+  createCounter(""completes"", counter)
+ENDRULE
+
+RULE complete called
+CLASS com.arjuna.webservices11.wsba.sei.BusinessAgreementWithParticipantCompletionCoordinatorPortTypeImpl
+METHOD completedOperation(NotificationType)
+AT RETURN
+BIND NOTHING
+IF (debug(""participant_completion.counter.decrement"") AND decrementCounter(""completes"") == 0)
+DO debug(""participant_completion.called.waking""),
+   signalWake(""complete"", true),
+   debug(""participant_completion.called.donewake"")
+ENDRULE
+
+RULE close called
+CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
+METHOD closeOperation(NotificationType)
+BIND NOTHING
+IF TRUE
+DO debug(""participant_completion.close.waiting""),
+   waitFor(""complete""),
+   debug(""participant_completion.close.woken"")
+ENDRULE
+
+RULE cancel called
+CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
+METHOD cancelOperation(NotificationType)
+BIND NOTHING
+IF TRUE
+DO debug(""participant_completion.cancel.waiting""),
+   waitFor(""complete""),
+   debug(""participant_completion.cancel.woken"")
+ENDRULE
\ No newline at end of file",2012-12-07T10:03:43Z,278
"@@ -67,8 +67,6 @@ public void testClose()
             throw eouter;
         }
 
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
 
 	    assertTrue(p.passed());",2012-12-07T10:03:43Z,279
"@@ -68,8 +68,6 @@ public void testExit()
             throw eouter;
         }
 
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
 
 	    assertTrue(p.passed());",2012-12-07T10:03:43Z,280
"@@ -73,8 +73,6 @@ public void testMultiClose()
             }
             throw eouter;
         }
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
         assertTrue(p.passed());
     }",2012-12-07T10:03:43Z,281
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -20,11 +24,23 @@ public class CloseTest {
 	public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				Close.class,
-				DemoBusinessParticipant.class);
+				DemoBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
 		test.testClose();
 	}
 }",2012-12-07T10:03:43Z,282
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -20,11 +24,23 @@ public class CompensateTest {
 	public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				Compensate.class,
-				DemoBusinessParticipant.class);
+				DemoBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
 		test.testCompensate();
 	}
 }",2012-12-07T10:03:43Z,283
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -14,6 +18,7 @@
 
 @RunWith(Arquillian.class)
 public class MultiCloseTest {
+    
 	@Inject
 	MultiClose test;
 	
@@ -22,11 +27,23 @@ public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				MultiClose.class,
 				DemoBusinessParticipant.class,
-				FailureBusinessParticipant.class);
+				FailureBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
-	
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(2);
 		test.testMultiClose();
 	}
 }",2012-12-07T10:03:43Z,281
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -22,11 +26,23 @@ public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				MultiCompensate.class,
 				DemoBusinessParticipant.class,
-				FailureBusinessParticipant.class);
+				FailureBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(2);
 		test.testMultiCompensate();
 	}
 }",2012-12-07T10:03:43Z,284
"@@ -18,18 +18,51 @@
 	<description>localjunit tests for xts</description>
         <properties>
             <buildType>11</buildType>
-            <general.server.jvm.args>-Xms64m -Xmx1024m -XX:MaxPermSize=512m</general.server.jvm.args>
+            <general.server.jvm.args>-Xms64m -Xmx1024m -XX:MaxPermSize=512m
+                                     -Dorg.jboss.byteman.verbose
+                                    -Djboss.modules.system.pkgs=org.jboss.byteman
+                                    -Dorg.jboss.byteman.transform.all
+                                    -javaagent:${project.build.directory}/lib/byteman.jar=listener:true
+            </general.server.jvm.args>
             <ipv4.server.jvm.args></ipv4.server.jvm.args>
             <ipv6.server.jvm.args>-Djboss.bind.address=[::1] -Djboss.bind.address.management=[::1] -Djboss.bind.address.unsecure=[::1] -Djava.net.preferIPv4Stack=false -Djava.net.preferIPv6Addresses=true</ipv6.server.jvm.args>
             <server.debug.args>Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5006</server.debug.args>
         </properties>
 
+    <build>
+        <plugins>
+                <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                      <artifactId>maven-dependency-plugin</artifactId>
+                      <executions>
+                        <execution>
+                          <id>copy-dependencies</id>
+                          <phase>test-compile</phase>
+                          <goals>
+                            <goal>copy-dependencies</goal>
+                          </goals>
+                          <configuration>
+                              <stripVersion>true</stripVersion>
+                              <includeGroupIds>org.jboss.byteman</includeGroupIds>
+                            <outputDirectory>${project.build.directory}/lib</outputDirectory>
+                          </configuration>
+                        </execution>
+                      </executions>
+                </plugin>
+        </plugins>
+    </build>
+
 	<dependencies>
 		<dependency>
 			<groupId>org.jboss.narayana.xts</groupId>
 			<artifactId>jbossxts</artifactId>
 			<scope>provided</scope>
 		</dependency>
+		<dependency>
+			<groupId>org.jboss.narayana.xts</groupId>
+			<artifactId>byteman_support</artifactId>
+            <scope>test</scope>
+		</dependency>
 		<dependency>
 			<groupId>junit</groupId>
 			<artifactId>junit</artifactId>
@@ -67,6 +100,37 @@
 				</plugins>
 			</build>
 		</profile>
+        <profile>
+      			<id>arq-remote</id>
+      			<activation>
+      				<activeByDefault>false</activeByDefault>
+      			</activation>
+      			<build>
+      				<plugins>
+      					<plugin>
+      						<artifactId>maven-surefire-plugin</artifactId>
+      						<configuration>
+      							<forkMode>once</forkMode>
+      							<systemPropertyVariables combine.children=""append"">
+      							<!--
+      							  Used in arquillian.xml
+      							-->
+      							  <server.jvm.args>${general.server.jvm.args} ${ipv4.server.jvm.args}</server.jvm.args>
+                                    <node.address>127.0.0.1</node.address>
+      							</systemPropertyVariables>
+      						</configuration>
+      					</plugin>
+      				</plugins>
+      			</build>
+      			<dependencies>
+      				<dependency>
+      					<groupId>org.jboss.as</groupId>
+      					<artifactId>jboss-as-arquillian-container-remote</artifactId>
+      					<version>${jboss-as.version}</version>
+      					<scope>test</scope>
+      				</dependency>
+      			</dependencies>
+      		</profile>
 		<profile>
 			<id>arq</id>
 			<activation>
@@ -83,7 +147,7 @@
 							  Used in arquillian.xml
 							-->
 							  <server.jvm.args>${general.server.jvm.args} ${ipv4.server.jvm.args}</server.jvm.args>
-                                                          <node.address>127.0.0.1</node.address>
+                              <node.address>127.0.0.1</node.address>
 							</systemPropertyVariables>
 						</configuration>
 					</plugin>",2012-12-07T10:03:43Z,34
"@@ -37,6 +37,7 @@
     </plugins>
   </build>
   <modules>
+    <module>byteman_support</module>
     <module>WSAS</module>
     <module>WSAS/xts-test-servlet</module>
     <module>WS-C</module>",2012-12-07T10:03:43Z,285
"@@ -52,6 +52,14 @@
     </plugins>
   </build>
   <dependencies>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman-submit</artifactId>
+    </dependency>
     <!-- START TEST -->
     <dependency>
       <groupId>junit</groupId>",2012-12-07T10:03:43Z,286
"@@ -942,6 +942,11 @@
         <artifactId>service</artifactId>
         <version>${project.version}</version>
       </dependency>
+      <dependency>
+	<groupId>org.jboss.narayana.xts</groupId>
+	<artifactId>byteman_support</artifactId>
+        <version>${project.version}</version>
+      </dependency>
       <dependency>
         <groupId>org.jboss.narayana.rts</groupId>
         <artifactId>restat-web</artifactId>
@@ -973,27 +978,27 @@
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-install</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-submit</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-bmunit</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-dtest</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
   </dependencies>
   </dependencyManagement>",2012-12-07T10:03:43Z,39
"@@ -37,6 +37,24 @@
                     <skip>true</skip>
                 </configuration>
             </plugin>
+            <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-dependency-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>copy-dependencies</id>
+                      <phase>test-compile</phase>
+                      <goals>
+                        <goal>copy-dependencies</goal>
+                      </goals>
+                      <configuration>
+                          <stripVersion>true</stripVersion>
+                          <includeGroupIds>org.jboss.byteman</includeGroupIds>
+                        <outputDirectory>${project.build.directory}/lib</outputDirectory>
+                      </configuration>
+                    </execution>
+                  </executions>
+            </plugin>
         </plugins>
     </build>
 
@@ -112,6 +130,11 @@
                 </exclusion>
             </exclusions>
         </dependency>
+	<dependency>
+	   <groupId>org.jboss.narayana.xts</groupId>
+	   <artifactId>byteman_support</artifactId>
+           <scope>test</scope>
+	</dependency>
         <dependency>
             <groupId>org.jboss.narayana.rts</groupId>
             <artifactId>restat-util</artifactId>",2012-12-07T10:03:43Z,41
"@@ -5,6 +5,8 @@
 import com.arjuna.wst.TransactionRolledBackException;
 import junit.framework.Assert;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Close;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Compensate;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.ConfirmCompleted;
@@ -13,7 +15,9 @@
 import org.jboss.narayana.txframework.functional.common.SomeApplicationException;
 import org.jboss.narayana.txframework.functional.interfaces.BAParticipantCompletion;
 import org.junit.After;
+import org.junit.AfterClass;
 import org.junit.Before;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -27,6 +31,17 @@ public class BAParticipantCompletionTest extends BaseFunctionalTest
     UserBusinessActivity uba;
     BAParticipantCompletion client;
 
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
     @Before
     public void setupTest() throws Exception
     {
@@ -45,9 +60,10 @@ public void teardownTest() throws Exception
     @Test
     public void testAutoComplete() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+        
         uba.begin();
         client.saveDataAutoComplete();
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -57,9 +73,10 @@ public void testAutoComplete() throws Exception
     @Test
     public void testManualComplete() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
         uba.begin();
         client.saveDataManualComplete(ServiceCommand.COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -68,10 +85,11 @@ public void testManualComplete() throws Exception
     @Test
     public void testMultiInvoke() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+        
         uba.begin();
         client.saveDataManualComplete();
         client.saveDataManualComplete(ServiceCommand.COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -80,9 +98,10 @@ public void testMultiInvoke() throws Exception
     @Test
     public void testClientDrivenCompensate() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
         uba.begin();
         client.saveDataAutoComplete();
-        Thread.sleep(10000); //JBTM-1203
         uba.cancel();
 
         assertOrder(ConfirmCompleted.class, Compensate.class);
@@ -113,8 +132,8 @@ public void testCannotComplete() throws Exception
     {
         uba.begin();
         client.saveDataAutoComplete(ServiceCommand.CANNOT_COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
+        
         assertOrder();
     }
 ",2012-12-07T10:03:43Z,287
"@@ -16,6 +16,11 @@
       <!-- If you want to use the JBOSS_HOME environment variable, just delete the jbossHome property -->
       <configuration>
 			<property name=""serverConfig"">standalone-xts.xml</property>
+            <property name=""javaVmArguments"">-Dorg.jboss.byteman.verbose
+                                    -Djboss.modules.system.pkgs=org.jboss.byteman
+                                    -Dorg.jboss.byteman.transform.all
+                                    -javaagent:../lib/byteman.jar=listener:true
+            </property>
       </configuration>
    </container>
 ",2012-12-07T10:03:43Z,129
"@@ -144,6 +144,17 @@
         <id>release</id>
         <build>
           <plugins>
+              <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                <artifactId>maven-install-plugin</artifactId>
+                <executions>
+                  <execution>
+                    <id>default-install</id>
+                    <phase>install</phase>
+                  </execution>
+                </executions>
+                <inherited>false</inherited>
+              </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,237
"@@ -42,4 +42,24 @@
     <module>txoj</module>
     <module>arjunacore</module>
   </modules>
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,288
"@@ -114,4 +114,24 @@
       <scope>test</scope>
     </dependency>
   </dependencies>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,289
"@@ -160,6 +160,17 @@
         <id>release</id>
         <build>
           <plugins>
+              <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                <artifactId>maven-install-plugin</artifactId>
+                <executions>
+                  <execution>
+                    <id>default-install</id>
+                    <phase>install</phase>
+                  </execution>
+                </executions>
+                <inherited>false</inherited>
+              </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,238
"@@ -41,4 +41,24 @@
     <module>jdbc</module>
     <module>narayana-jta</module>
   </modules>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,223
"@@ -61,18 +61,22 @@
     <dependency>
       <groupId>org.jboss.narayana.jta</groupId>
       <artifactId>jta</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss</groupId>
@@ -146,6 +150,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,69
"@@ -167,10 +167,22 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
@@ -179,6 +191,12 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>tanukisoft</groupId>
@@ -201,6 +219,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,29
"@@ -167,14 +167,32 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>tanukisoft</groupId>
@@ -221,6 +239,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,30
"@@ -45,4 +45,24 @@
     <module>narayana-jts-idlj</module>
     <module>integration</module>
   </modules>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,290
"@@ -27,4 +27,24 @@
             <artifactId>byteman-submit</artifactId>
         </dependency>
     </dependencies>
+    <profiles>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                    <plugin>
+                        <groupId>org.apache.maven.plugins</groupId>
+                        <artifactId>maven-install-plugin</artifactId>
+                        <executions>
+                            <execution>
+                                <id>default-install</id>
+                                <phase>install</phase>
+                            </execution>
+                        </executions>
+                        <inherited>false</inherited>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,275
"@@ -215,6 +215,17 @@
         <id>release</id>
         <build>
           <plugins>
+            <plugin>
+              <groupId>org.apache.maven.plugins</groupId>
+              <artifactId>maven-install-plugin</artifactId>
+              <executions>
+                <execution>
+                  <id>default-install</id>
+                  <phase>install</phase>
+                </execution>
+              </executions>
+              <inherited>false</inherited>
+            </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,33
"@@ -29,6 +29,16 @@
     </properties>
 
     <build>
+        <pluginManagement>
+            <plugins>
+                <plugin>
+                    <artifactId>maven-surefire-plugin</artifactId>
+                    <configuration>
+                        <skip>true</skip>
+                    </configuration>
+                </plugin>
+            </plugins>
+        </pluginManagement>
         <plugins>
             <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
@@ -94,26 +104,6 @@
         </dependency>
     </dependencies>
     <profiles>
-        <!-- The default profile skips all tests, though you can tune it
-            to run just unit tests based on a custom pattern -->
-        <!-- Seperate profiles are provided for running all tests, including
-            Arquillian tests that execute in the specified container -->
-        <profile>
-            <id>default</id>
-            <activation>
-                <activeByDefault>true</activeByDefault>
-            </activation>
-            <build>
-                <plugins>
-                    <plugin>
-                        <artifactId>maven-surefire-plugin</artifactId>
-                        <configuration>
-                            <skip>true</skip>
-                        </configuration>
-                    </plugin>
-                </plugins>
-            </build>
-        </profile>
         <profile>
             <id>arq-remote</id>
             <activation>
@@ -132,6 +122,7 @@
                                 <server.jvm.args>${jvm.args.memory} ${ipv4.server.jvm.args}</server.jvm.args>
                                 <node.address>127.0.0.1</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>
@@ -165,6 +156,7 @@
                                 </server.jvm.args>
                                 <node.address>127.0.0.1</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>
@@ -199,6 +191,7 @@
                                 </server.jvm.args>
                                 <node.address>[::1]</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>",2013-01-22T15:55:37Z,34
"@@ -50,4 +50,24 @@
     <module>jbossxts</module>
     <module>localjunit</module>
   </modules>
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,285
"@@ -69,4 +69,25 @@
     </dependency>
     <!-- END TEST -->
   </dependencies>
+
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,286
"@@ -1099,5 +1099,37 @@
         <module>STM</module>
       </modules>
     </profile>
+    <profile>
+      <id>release</id>
+      <build>
+          <pluginManagement>
+              <plugins>
+                  <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                    <artifactId>maven-install-plugin</artifactId>
+                    <executions>
+                      <execution>
+                        <id>default-install</id>
+                        <phase>none</phase>
+                      </execution>
+                    </executions>
+                  </plugin>
+              </plugins>
+          </pluginManagement>
+          <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
+          </plugins>
+      </build>
+    </profile>
   </profiles>
 </project>",2013-01-22T15:55:37Z,39
"@@ -51,4 +51,24 @@ Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
   <properties>
     <version.org.jboss.resteasy>2.0.0.GA</version.org.jboss.resteasy>
   </properties>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,291
"@@ -171,4 +171,24 @@
       </plugin>
     </plugins>
   </build>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                  <plugin>
+                      <groupId>org.apache.maven.plugins</groupId>
+                      <artifactId>maven-install-plugin</artifactId>
+                      <executions>
+                          <execution>
+                              <id>default-install</id>
+                              <phase>install</phase>
+                          </execution>
+                      </executions>
+                      <inherited>false</inherited>
+                  </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,292
"@@ -94,6 +94,13 @@
                     <target>1.6</target>
                 </configuration>
             </plugin>
+            <plugin>
+                <artifactId>maven-surefire-plugin</artifactId>
+                <version>2.11</version>
+                <configuration>
+                    <skip>true</skip>
+                </configuration>
+            </plugin>
         </plugins>
         <pluginManagement>
         	<plugins>
@@ -221,23 +228,6 @@
 
     </dependencies>
 	<profiles>
-		<profile>
-			<id>default</id>
-			<activation>
-				<activeByDefault>true</activeByDefault>
-			</activation>
-			<build>
-				<plugins>
-					<plugin>
-						<artifactId>maven-surefire-plugin</artifactId>
-						<version>2.11</version>
-						<configuration>
-							<skip>true</skip>
-						</configuration>
-					</plugin>
-				</plugins>
-			</build>
-		</profile>
 		<profile>
 			<id>arq</id>
 			<activation>
@@ -263,6 +253,7 @@
 								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
 								<node.address>localhost</node.address>
 							</systemPropertyVariables>
+                            <skip>false</skip>
 						</configuration>
 					</plugin>
 				</plugins>
@@ -305,6 +296,7 @@
 								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
 								<node.address>[::1]</node.address>
 							</systemPropertyVariables>
+                            <skip>false</skip>
 						</configuration>
 					</plugin>
 				</plugins>
@@ -333,5 +325,23 @@
 				</dependency>
 			</dependencies>
 		</profile>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                  <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                    <artifactId>maven-install-plugin</artifactId>
+                    <executions>
+                      <execution>
+                        <id>default-install</id>
+                        <phase>install</phase>
+                      </execution>
+                    </executions>
+                    <inherited>false</inherited>
+                  </plugin>
+                </plugins>
+            </build>
+        </profile>
 	</profiles>
 </project>",2013-01-22T15:55:37Z,162
"@@ -214,6 +214,24 @@
                 </dependency>
             </dependencies>
         </profile>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                    <plugin>
+                        <groupId>org.apache.maven.plugins</groupId>
+                        <artifactId>maven-install-plugin</artifactId>
+                        <executions>
+                            <execution>
+                                <id>default-install</id>
+                                <phase>install</phase>
+                            </execution>
+                        </executions>
+                        <inherited>false</inherited>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
     </profiles>
 
 </project>",2013-01-22T15:55:37Z,41
"@@ -0,0 +1,2 @@
+export UPSTREAM_AS_BRANCH=master
+export ORIGIN_AS_BRANCH=5_BRANCH
\ No newline at end of file",2013-02-08T16:09:11Z,267
"@@ -0,0 +1,36 @@
+function fatal {
+  echo ""Failed: $1""
+  exit 1
+}
+
+. branch-names.sh
+
+echo ""Rebaseing origin/$ORIGIN_AS_BRANCH with upstream/$UPSTREAM_AS_BRANCH""
+
+GIT_URL=""git@github.com:jbosstm/jboss-as.git""
+UPSTREAM_GIT_URL=""https://github.com/jbossas/jboss-as.git""
+TEMPORARY_REBASE_LOCATION=/tmp/rebase-jbossas-branch
+
+rm -rf $TEMPORARY_REBASE_LOCATION || fatal
+mkdir $TEMPORARY_REBASE_LOCATION || fatal
+cd $TEMPORARY_REBASE_LOCATION || fatal
+
+git clone $GIT_URL || fatal
+cd jboss-as
+git checkout -t origin/$ORIGIN_AS_BRANCH || fatal
+
+git remote add upstream $UPSTREAM_GIT_URL
+git pull --rebase --ff-only upstream $UPSTREAM_AS_BRANCH
+
+while [ $? != 0 ]
+do
+ for i in `git status -s | sed ""s/UU \(.*\)/\1/g""`
+ do
+    awk '/^<+ HEAD$/,/^=+$/{next} /^>+ /{next} 1' $i > $i.bak; mv $i.bak $i; git add $i
+ done
+ git rebase --continue
+done
+[ $? = 0 ] || fatal ""git rebase failed""
+
+git push origin $ORIGIN_AS_BRANCH -f
+rm -rf $TEMPORARY_REBASE_LOCATION",2013-02-08T16:09:11Z,268
"@@ -69,13 +69,12 @@
     <property name=""version"" value=""5.0.0.M2-SNAPSHOT""/>
 -->
   <!-- a working directory for the process. Can contain output from previous releases if you like to keep them archived locally. -->
-  <!--property name=""workdir"" location=""/tmp/narayana_releases""/-->
+  <property name=""workdir"" location=""/tmp/narayana_releases""/>
   <!-- where to get the source -->
-  <property name=""svnbase"" value=""https://svn.jboss.org/repos/labs/labs/jbosstm/tags""/>
+  <property name=""gitbase"" value=""https://github.com/jbosstm""/>
   <!-- The tag as it appears under svnbase -->
-  <property name=""tag"" value=""5_0_0_M1""/>
-  <!-- The file name base for the user downloadable files. Derive it from the tag -->
-  <property name=""version"" value=""5.0.0.M1""/>
+  <property name=""pageName"" value=""4_17_0_Final""/>
+  <property name=""tag"" value=""4.17.0.Final""/>
   <!-- which uber jar to use -->
   <property name=""orb"" value=""jacorb""/>
   <!-- the location the JBossTS web site content is copied to -->
@@ -100,40 +99,116 @@
         </not>
       </condition>
     </fail>
-    <fail message=""You must not already have a local maven cached repository to do a release build"">
-      <condition>
-        <available file=""repository"" type=""dir""/>
-      </condition>
-    </fail>
     <fail message=""You cannot perform a build without cleaning the old version out"">
       <condition>
         <available file=""${workdir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <mkdir dir=""${workdir}""/>
-    <!-- pull the source code from svn -->
-    <exec executable=""svn"" dir=""${workdir}"">
+    <!-- pull the source code from git -->
+    <exec executable=""git"" dir=""${workdir}"">
+      <arg value=""clone""/>
+      <arg value=""${gitbase}/narayana.git""/>
+      <arg value=""${tag}""/>
+    </exec>
+    <exec executable=""git"" dir=""${workdir}/${tag}"">
       <arg value=""checkout""/>
-      <arg value=""${svnbase}/${tag}""/>
+      <arg value=""${tag}""/>
     </exec>
   </target>
   <target name=""dist"" depends=""dist-init"" description=""build the end-user release bundles (src and binary)"">
     <!-- build the binary releases -->
     <exec dir=""${workdir}/${tag}"" executable=""tools/maven/bin/mvn"" failonerror=""true"">
       <arg line=""clean -gs tools/maven/conf/settings.xml -Demma.jar.location=${user.dir}/ext/emma.jar -Dorson.jar.location=${user.dir}/ext/orson-0.5.0.jar""/>
     </exec>
-    <!-- package the JTA only src tree (no JTS, XTS, txbridge, RTS) -->
-    <delete file=""${workdir}/narayana-jta-${version}-src.zip""/>
-    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-jta-${version}-src.zip"" includes=""${tag}/**"" excludes=""${tag}/ArjunaJTS/**, ${tag}/XTS/** ${tag}/txbridge/**, ${tag}/rest-tx/**, ${tag}/repository/**""/>
     <!-- package the full source release (all src tree) -->
-    <delete file=""${workdir}/narayana-full-${version}-src.zip""/>
-    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-full-${version}-src.zip"" includes=""${tag}/**"" excludes=""${tag}/repository/**""/>
+    <delete file=""${workdir}/narayana-full-${tag}-src.zip""/>
+    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-full-${tag}-src.zip"" includes=""${tag}/**""/>
     <!-- build the binary releases -->
     <exec dir=""${workdir}/${tag}"" executable=""tools/maven/bin/mvn"" failonerror=""true"">
       <arg line=""deploy -DskipTests -gs tools/maven/conf/settings.xml -Demma.jar.location=${user.dir}/ext/emma.jar -Dorson.jar.location=${user.dir}/ext/orson-0.5.0.jar""/>
     </exec>
   </target>
   <!-- copy the release into the downloads dir tree (http://www.jboss.org/jbosstm web site content) -->
+  <target name=""docs"">
+    <fail>
+      <condition>
+        <not>
+          <available file=""${downloads.dir}"" type=""dir""/>
+        </not>
+      </condition>
+    </fail>
+    <fail>
+      <condition>
+        <not>
+          <available file=""${docs.dir}"" type=""dir""/>
+        </not>
+      </condition>
+    </fail>
+
+    <exec executable=""git"" dir=""${workdir}"">
+      <arg value=""clone""/>
+      <arg value=""${gitbase}/documentation.git""/>
+      <arg value=""${tag}-docs""/>
+    </exec>
+    <exec executable=""git"" dir=""${workdir}/${tag}-docs"">
+      <arg value=""checkout""/>
+      <arg value=""${tag}""/>
+    </exec>
+    <exec dir=""${workdir}/${tag}-docs"" executable=""mvn"" failonerror=""true"">
+      <arg line=""install""/>
+    </exec>
+    <delete dir=""tmp-docs-dir-docs""/>
+    <mkdir dir=""tmp-docs-dir-docs""/>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-orbportability_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/orbportability_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-quick_start_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/quick_start_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-administration_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/administration_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/arjunacore-failure_recovery_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaCore/docs/failure_recovery_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/arjunacore-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaCore/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-quick_start_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/quick_start_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-installation_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/installation_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-administration_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/administration_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/xts-administration_and_development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/XTS/docs/administration_and_development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/failure_recovery_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/failure_recovery_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/transactions_overview_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/transactions_overview_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/txbridge_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/txbridge_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <move todir=""${docs.dir}/${tag}"" verbose=""true"">
+      <fileset dir=""tmp-docs-dir-docs""/>
+    </move>
+  </target> 
   <target name=""downloads"" description=""copy release bundles to JBossTS web site content"">
     <fail>
       <condition>
@@ -144,7 +219,7 @@
     </fail>
     <fail>
       <condition>
-        <available file=""${downloads.dir}/${version}"" type=""dir""/>
+        <available file=""${downloads.dir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <fail>
@@ -156,7 +231,7 @@
     </fail>
     <fail>
       <condition>
-        <available file=""${docs.dir}/${version}"" type=""dir""/>
+        <available file=""${docs.dir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <delete dir=""tmp-downloads-dir""/>
@@ -167,91 +242,37 @@
     <delete dir=""tmp-docs-dir""/>
     <mkdir dir=""tmp-docs-dir""/>
     <copy todir=""tmp-downloads-dir/src"">
-      <fileset dir=""${workdir}"" includes=""narayana-*-${version}-src.zip""/>
+      <fileset dir=""${workdir}"" includes=""narayana-*-${tag}-src.zip""/>
     </copy>
     <copy todir=""tmp-downloads-dir/binary"">
-      <fileset dir=""${workdir}/${tag}/narayana-full/target/"" includes=""narayana-full-${version}-bin.zip""/>
+      <fileset dir=""${workdir}/${tag}/narayana-full/target/"" includes=""narayana-full-${tag}-bin.zip""/>
     </copy>
     <copy todir=""tmp-downloads-dir/idl"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/jts/idl/arjuna"">
+      <fileset dir=""${workdir}/${tag}/ArjunaJTS/idl/src/main/idl/arjuna"">
         <include name=""ArjunaOTS.idl""/>
       </fileset>
     </copy>
     <copy todir=""tmp-downloads-dir/idl"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/jts/idl/omg"">
+      <fileset dir=""${workdir}/${tag}/ArjunaJTS/idl/src/main/idl/omg"">
         <include name=""CosTransactions.idl""/>
         <include name=""XA.idl""/>
       </fileset>
     </copy>
-    <copy file=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/narayana-jts-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/jta""/>
-    <copy file=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/jts""/>
-    <copy file=""${workdir}/${tag}/rest-tx/tx/target/rest-tx-api-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/rts""/>
-    <copy file=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/xts""/>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-orbportability_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/orbportability_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-quick_start_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/quick_start_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-administration_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/administration_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/arjunacore-failure_recovery_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaCore/docs/failure_recovery_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/arjunacore-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaCore/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-quick_start_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/quick_start_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-installation_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/installation_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-administration_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/administration_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/xts-administration_and_development_guide"">
-      <fileset dir=""${workdir}/${tag}/XTS/docs/administration_and_development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/failure_recovery_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/failure_recovery_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/release_notes"">
-      <fileset dir=""${workdir}/${tag}/docs/release_notes/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/development_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/transactions_overview_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/transactions_overview_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/txbridge_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/txbridge_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <unzip src=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/narayana-jts-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/jts""/>
-    <unzip src=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/jta""/>
-    <unzip src=""${workdir}/${tag}/rest-tx/tx/target/rest-tx-api-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/rts""/>
-    <unzip src=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/xts""/>
-    <move todir=""${downloads.dir}/${version}"" verbose=""true"">
+    <copy file=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/jbossjts-jacorb-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/jts""/>
+    <copy file=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/jta""/>
+    <copy file=""${workdir}/${tag}/rest-tx/tx/target/restat-api-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/rts""/>
+    <copy file=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/xts""/>
+    <unzip src=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/jbossjts-jacorb-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/jts""/>
+    <unzip src=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/jta""/>
+    <unzip src=""${workdir}/${tag}/rest-tx/tx/target/restat-api-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/rts""/>
+    <unzip src=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/xts""/>
+    <move todir=""${downloads.dir}/${tag}"" verbose=""true"">
       <fileset dir=""tmp-downloads-dir""/>
     </move>
-    <move todir=""${docs.dir}/${version}"" verbose=""true"">
+    <move todir=""${docs.dir}/${tag}"" verbose=""true"">
       <fileset dir=""tmp-docs-dir""/>
     </move>
   </target>
-  <!-- copy the release artifacts to the maven repository -->
-  <target name=""mvn-repository"" description=""copy the release artifacts to the maven repository"">
-    <!-- xts -->
-    <mvn-artifact.macro artifact=""jbossxts-tests"" packaging=""zip"" dir=""${workdir}/build/${tag}/xts/tests""/>
-    <mvn-artifact.macro artifact=""jbossxts-interop-tests"" packaging=""zip"" dir=""${workdir}/build/${tag}/xts/interop-tests""/>
-  </target>
   <!-- magnolia (the cms that sits behind jboss.org/jbosstm pages) is a pain. This target generates
      xml for /downloads/somerelease.xml pages to ease some of the pain in publishing an upload
       right click jbosstm/downloads node, import from xml, then right click new node and activate.
@@ -261,20 +282,24 @@
     <exec executable=""date"" outputproperty=""date"">
       <arg line=""+'%FT%H:%M:%S.000Z'""/>
     </exec>
-    <length property=""jta-src-length"" file=""${workdir}/jbossts-jta-${version}-src.zip""/>
-    <length property=""full-src-length"" file=""${workdir}/jbossts-full-${version}-src.zip""/>
-    <length property=""jta-bin-length"" file=""${workdir}/jbossts-jta-${version}.zip""/>
-    <length property=""full-bin-length"" file=""${workdir}/jbossts-full-${version}.zip""/>
-    <copy file=""magnolia-release-download-page-template.xml"" tofile=""${workdir}/website.jbosstm.downloads.${version}.xml"" filtering=""true"" overwrite=""true"">
+    <length property=""full-src-length"" file=""${workdir}/narayana-full-${tag}-src.zip""/>
+    <length property=""full-bin-length"" file=""${workdir}/${tag}/narayana-full/target/narayana-full-${tag}-bin.zip""/>
+    <copy file=""magnolia-release-download-page-template.xml"" tofile=""${workdir}/website.jbosstm.downloads.${pageName}.xml"" filtering=""true"" overwrite=""true"">
       <filterset>
+        <filter token=""pageName"" value=""${pageName}""/>
         <filter token=""tag"" value=""${tag}""/>
-        <filter token=""version"" value=""${version}""/>
+        <filter token=""version"" value=""${tag}""/>
         <filter token=""date"" value=""${date}""/>
-        <filter token=""jta-src-length"" value=""${jta-src-length}""/>
         <filter token=""full-src-length"" value=""${full-src-length}""/>
-        <filter token=""jta-bin-length"" value=""${jta-bin-length}""/>
         <filter token=""full-bin-length"" value=""${full-bin-length}""/>
       </filterset>
     </copy>
+    <copy file=""magnolia-release-documentation-page-template.xml"" tofile=""${workdir}/website.jbosstm.documentation.${pageName}.xml"" filtering=""true"" overwrite=""true"">
+      <filterset>
+        <filter token=""pageName"" value=""${pageName}""/>
+        <filter token=""tag"" value=""${tag}""/>
+        <filter token=""date"" value=""${date}""/>
+      </filterset>
+    </copy>
   </target>
 </project>",2012-09-25T19:52:29Z,269
"@@ -0,0 +1,237 @@
+<?xml version=""1.0"" encoding=""UTF-8""?>
+<sv:node sv:name=""@pageName@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
+  <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+    <sv:value>mgnl:content</sv:value>
+  </sv:property>
+  <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+    <sv:value>mix:lockable</sv:value>
+  </sv:property>
+  <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+    <sv:value>14f62a08-1dfe-41b3-bdce-61ce87b8129d</sv:value>
+  </sv:property>
+  <sv:property sv:name=""enableRSS"" sv:type=""String"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""hideInNav"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""menubar"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaCache"" sv:type=""String"">
+    <sv:value>disable</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaExpire"" sv:type=""String"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaRobots"" sv:type=""String"">
+    <sv:value>all</sv:value>
+  </sv:property>
+  <sv:property sv:name=""redirectWindow"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""title"" sv:type=""String"">
+    <sv:value>Narayana Documentation @tag@</sv:value>
+  </sv:property>
+  <sv:property sv:name=""useTitle"" sv:type=""Boolean"">
+    <sv:value>true</sv:value>
+  </sv:property>
+  <sv:node sv:name=""MetaData"">
+    <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+      <sv:value>mgnl:metaData</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+      <sv:value>true</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+      <sv:value>superuser</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+      <sv:value>tm</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:comment"" sv:type=""String"">
+      <sv:value>Made references to git and subversion</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+      <sv:value>2009-12-10T11:47:09.824-05:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+      <sv:value>2012-04-27T05:09:36.605-04:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+      <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:template"" sv:type=""String"">
+      <sv:value>jbossorgProjectSubPage</sv:value>
+    </sv:property>
+  </sv:node>
+  <sv:node sv:name=""mainColumnParagraphs"">
+    <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+      <sv:value>mgnl:contentNode</sv:value>
+    </sv:property>
+    <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+      <sv:value>mix:lockable</sv:value>
+    </sv:property>
+    <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+      <sv:value>43dab693-c6e7-4eda-869e-5b1d9ad358d5</sv:value>
+    </sv:property>
+    <sv:node sv:name=""MetaData"">
+      <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+        <sv:value>mgnl:metaData</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+        <sv:value>true</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+        <sv:value>superuser</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+        <sv:value>tm</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+        <sv:value>2009-12-10T11:47:46.060-05:00</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+        <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+        <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+      </sv:property>
+    </sv:node>
+    <sv:node sv:name=""0"">
+      <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+        <sv:value>mgnl:contentNode</sv:value>
+      </sv:property>
+      <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+        <sv:value>mix:lockable</sv:value>
+      </sv:property>
+      <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+        <sv:value>6aec081e-5217-4adf-b06c-8c5bf92a886b</sv:value>
+      </sv:property>
+      <sv:property sv:name=""flow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""headerSize"" sv:type=""String"">
+        <sv:value>h3</sv:value>
+      </sv:property>
+      <sv:property sv:name=""imageLinkNewWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""imageLocation"" sv:type=""String"">
+        <sv:value>left</sv:value>
+      </sv:property>
+      <sv:property sv:name=""inherit"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""lineAbove"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkImage"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkText"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkTitle"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkWindowMenubar"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""spacer"" sv:type=""Long"">
+        <sv:value>0</sv:value>
+      </sv:property>
+      <sv:property sv:name=""text"" sv:type=""String"">
+        <sv:value>&lt;h1&gt;JBoss Narayana Documentation Library&lt;/h1&gt; &lt;p&gt; &lt;table cellspacing=""5"" class=""infotable"" style=""margin: 2px; padding: 2px; font-size: 90%;""&gt;     &lt;tbody&gt;         &lt;tr&gt;             &lt;th width=""220"" class=""grey""&gt;JBoss Narayana Document&lt;/th&gt;             &lt;th width=""80"" class=""grey""&gt;Version&lt;/th&gt;             &lt;th width=""80"" class=""grey""&gt;Released&lt;/th&gt;             &lt;th class=""blank""&gt;&amp;nbsp;&lt;/th&gt;             &lt;th class=""blank""&gt;&amp;nbsp;&lt;/th&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ORB Portability Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-orbportability_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;NarayanaJTS Quick Start Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-quick_start_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTS Administration Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-administration_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTS Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ArjunaCore Failure Recovery Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/arjunacore-failure_recovery_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ArjunaCore Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/arjunacore-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Quick Start Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-quick_start/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Installation Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-installation_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Administration Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-administration_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;XTS Administration and Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/xts-administration_and_development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Failure Recovery Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/failure_recovery_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Release Notes&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/release_notes/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Transactions Overview Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/transactions_overview_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;TXBridge Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/txbridge_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/jts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/jts/jbossjts-jacorb-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTA API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/jta/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/jta/narayana-jta-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;RTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/rts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/rts/restat-api-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;XTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/xts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/xts/jbossxts-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - ArjunaOTS&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/ArjunaOTS.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - CosTransactions.idl&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/CosTransactions.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - XA&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/XA.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;     &lt;/tbody&gt; &lt;/table&gt; &lt;/p&gt;</sv:value>
+      </sv:property>
+      <sv:property sv:name=""titleLinkNewWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:node sv:name=""MetaData"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:metaData</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+          <sv:value>true</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+          <sv:value>superuser</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+          <sv:value>tm</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+          <sv:value>2009-12-10T11:47:46.061-05:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+          <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+          <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:template"" sv:type=""String"">
+          <sv:value>richTextHtml</sv:value>
+        </sv:property>
+      </sv:node>
+      <sv:node sv:name=""text_files"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:contentNode</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+          <sv:value>mix:lockable</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+          <sv:value>41f11088-5628-42b3-8c36-51b7a4199eaf</sv:value>
+        </sv:property>
+        <sv:node sv:name=""MetaData"">
+          <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+            <sv:value>mgnl:metaData</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+            <sv:value>true</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+            <sv:value>superuser</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+            <sv:value>2009-12-10T11:47:46.061-05:00</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+            <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+          </sv:property>
+        </sv:node>
+      </sv:node>
+      <sv:node sv:name=""imageFooter_files"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:contentNode</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+          <sv:value>mix:lockable</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+          <sv:value>6b6abc15-1022-44a0-917e-29a9691832e4</sv:value>
+        </sv:property>
+        <sv:node sv:name=""MetaData"">
+          <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+            <sv:value>mgnl:metaData</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+            <sv:value>true</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+            <sv:value>superuser</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+            <sv:value>2009-12-10T11:47:46.064-05:00</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+            <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+          </sv:property>
+        </sv:node>
+      </sv:node>
+    </sv:node>
+  </sv:node>
+</sv:node>",2012-09-25T19:52:29Z,270
"@@ -1,5 +1,5 @@
 <?xml version=""1.0"" encoding=""UTF-8""?>
-<sv:node sv:name=""@tag@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
+<sv:node sv:name=""@pageName@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
   <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
     <sv:value>mgnl:content</sv:value>
   </sv:property>
@@ -31,7 +31,7 @@
     <sv:value>false</sv:value>
   </sv:property>
   <sv:property sv:name=""title"" sv:type=""String"">
-    <sv:value>JBossTS @filename@ release</sv:value>
+    <sv:value>JBossTS @tag@ release</sv:value>
   </sv:property>
   <sv:property sv:name=""useTitle"" sv:type=""String"">
     <sv:value>true</sv:value>
@@ -99,12 +99,6 @@
       <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
         <sv:value>00bd1847-65cd-4ff1-b7ce-20b8084be52b</sv:value>
       </sv:property>
-      <sv:property sv:name=""desc21"" sv:type=""String"">
-        <sv:value>The JBoss Transactions JTA @filename@ Source</sv:value>
-      </sv:property>
-      <sv:property sv:name=""desc22"" sv:type=""String"">
-        <sv:value>JBoss Transactions JTA @filename@ Binary</sv:value>
-      </sv:property>
       <sv:property sv:name=""desc23"" sv:type=""String"">
         <sv:value>JBoss Transactions JTS (and JTA) and WS-T Source Code</sv:value>
       </sv:property>
@@ -123,17 +117,11 @@
       <sv:property sv:name=""license24"" sv:type=""String"">
         <sv:value>LGPL</sv:value>
       </sv:property>
-      <sv:property sv:name=""name21"" sv:type=""String"">
-        <sv:value>jbossts-jta-@filename@-src.zip</sv:value>
-      </sv:property>
-      <sv:property sv:name=""name22"" sv:type=""String"">
-        <sv:value>jbossts-jta-@filename@.zip</sv:value>
-      </sv:property>
       <sv:property sv:name=""name23"" sv:type=""String"">
-        <sv:value>jbossts-full-@filename@-src.zip</sv:value>
+        <sv:value>narayana-full-@tag@-src.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""name24"" sv:type=""String"">
-        <sv:value>jbossts-full-@filename@.zip</sv:value>
+        <sv:value>narayana-full-@tag@-bin.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""popup"" sv:type=""String"">
         <sv:value>true</sv:value>
@@ -168,20 +156,14 @@
       <sv:property sv:name=""showVersion"" sv:type=""String"">
         <sv:value>false</sv:value>
       </sv:property>
-      <sv:property sv:name=""size21"" sv:type=""String"">
-        <sv:value>@jta-src-length@</sv:value>
-      </sv:property>
-      <sv:property sv:name=""size22"" sv:type=""String"">
-        <sv:value>@full-src-length@</sv:value>
-      </sv:property>
       <sv:property sv:name=""size23"" sv:type=""String"">
-        <sv:value>@jta-bin-length@</sv:value>
+        <sv:value>@full-src-length@</sv:value>
       </sv:property>
       <sv:property sv:name=""size24"" sv:type=""String"">
         <sv:value>@full-bin-length@</sv:value>
       </sv:property>
       <sv:property sv:name=""tableTitle"" sv:type=""String"">
-        <sv:value>JBossTS @filename@ release</sv:value>
+        <sv:value>JBossTS @tag@ release</sv:value>
       </sv:property>
       <sv:property sv:name=""text21"" sv:type=""String"">
         <sv:value>Download</sv:value>
@@ -195,17 +177,11 @@
       <sv:property sv:name=""text24"" sv:type=""String"">
         <sv:value>Download</sv:value>
       </sv:property>
-      <sv:property sv:name=""url21"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/src/jbossts-jta-@filename@-src.zip</sv:value>
-      </sv:property>
-      <sv:property sv:name=""url22"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/binary/jbossts-jta-@filename@.zip</sv:value>
-      </sv:property>
       <sv:property sv:name=""url23"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/src/jbossts-full-@filename@-src.zip</sv:value>
+        <sv:value>http://www.jboss.org/jbosstm/downloads/@tag@/src/narayana-full-@tag@-src.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""url24"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/binary/jbossts-full-@filename@.zip</sv:value>
+        <sv:value>http://www.jboss.org/jbosstm/downloads/@tag@/binary/narayana-full-@tag@-bin.zip</sv:value>
       </sv:property>
       <sv:node sv:name=""MetaData"">
         <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">",2012-09-25T19:52:29Z,271
"@@ -890,9 +890,6 @@ public interface wstI18NLogger {
 	@LogMessage(level = WARN)
 	public void warn_recovery_participant_ba_BAParticipantRecoveryRecord_saveState_3(String arg0, @Cause() Throwable arg1);
 
-    @Message(id = 43228, value = ""Delay of {0} ms reached before changing state from {1} to something else"", format = MESSAGE_FORMAT)
-   	@LogMessage(level = WARN)
-   	public void warn_state_change_timeout(String arg0, String arg1);
 
     /*
         Allocate new messages directly above this notice.",2013-01-15T16:13:39Z,272
"@@ -526,7 +526,6 @@ private State waitForState(final State origState, final long delay)
                 final long remaining = end - System.currentTimeMillis() ;
                 if (remaining <= 0)
                 {
-                    WSTLogger.i18NLogger.warn_state_change_timeout(String.valueOf(delay), origState.toString());
                     break ;
                 }
                 try",2013-01-15T16:13:39Z,72
"@@ -183,7 +183,7 @@
                                 <!--
                                     Used in arquillian.xml
                                 -->
-                                <server.jvm.args>${jvm.args.byteman} ${jvm.args.memory} -Dorg.jboss.jbossts.xts.transport.transportTimeout=60000</server.jvm.args>
+                                <server.jvm.args>${jvm.args.byteman} ${jvm.args.memory}</server.jvm.args>
                             </systemPropertyVariables>
                         </configuration>
                     </plugin>",2013-01-15T16:13:39Z,41
"@@ -15,15 +15,18 @@ if [ """" == ""$JBOSS_BUILD_HOME"" ]; then
 fi
 
 if [ ""$2"" == ""--clean"" ] || [ ""$3"" == ""--clean"" ]; then
+    echo ""Cleaning""
     CLEAN=clean
 fi
 
 if [ ""$2"" == ""--xts"" ] || [ ""$3"" == ""--xts"" ]; then
+    echo ""Rebuilding XTS""
     cd ..
     ./build.sh -f ./XTS/pom.xml $CLEAN install -DskipTests || fail
     cd -
 fi
 
+
 mvn $CLEAN install || fail
 kill-jboss
 $JBOSS_BUILD_HOME/build.sh $CLEAN install -f $JBOSS_BUILD_HOME/xts/pom.xml -DskipTests || fail",2013-01-15T16:13:39Z,198
"@@ -55,7 +55,7 @@ public class ATBridgeImpl implements ATBridge {
     public void incrementCounter(int how_many) {
 
         SimpleEntity entity = getSimpleEntity();
-        entity.incrimentCounter(how_many);
+        entity.incrementCounter(how_many);
         em.merge(entity);
     }
 
@@ -81,7 +81,7 @@ private SimpleEntity getSimpleEntity() {
 
         SimpleEntity entity = em.find(SimpleEntity.class, ENTITY_ID);
         if (entity == null) {
-            entity = new SimpleEntity();
+            entity = new SimpleEntity(ENTITY_ID, 0);
             em.persist(entity);
         }
 ",2013-01-15T16:13:39Z,273
"@@ -1,6 +1,6 @@
 /*
  * JBoss, Home of Professional Open Source.
- * Copyright 2012, Red Hat, Inc., and individual contributors
+ * Copyright 2013, Red Hat, Inc., and individual contributors
  * as indicated by the @author tags. See the copyright.txt file in the
  * distribution for a full listing of individual contributors.
  *",2013-01-15T16:13:39Z,201
"@@ -22,7 +22,6 @@
 package org.jboss.narayana.txframework.functional.ws.at.bridged;
 
 import javax.persistence.Entity;
-import javax.persistence.GeneratedValue;
 import javax.persistence.Id;
 import java.io.Serializable;
 
@@ -41,8 +40,13 @@ public SimpleEntity() {
 
     }
 
+    public SimpleEntity(int id, int initialCounterValue) {
+
+        this.id = id;
+        this.bookingCount = initialCounterValue;
+    }
+
     @Id
-    @GeneratedValue
     public int getId() {
 
         return id;
@@ -63,8 +67,8 @@ public void setCounter(int counter) {
         this.bookingCount = counter;
     }
 
-    public void incrimentCounter(int how_many) {
+    public void incrementCounter(int howMany) {
 
-        setCounter(getCounter() + how_many);
+        setCounter(getCounter() + howMany);
     }
 }",2013-01-15T16:13:39Z,274
"@@ -87,26 +87,6 @@
                     <target>1.6</target>
                 </configuration>
             </plugin>
-            <plugin>
-                <groupId>org.apache.maven.plugins</groupId>
-                <artifactId>maven-surefire-plugin</artifactId>
-                <configuration>
-                    <skip>true</skip>
-                    <!-- Prevent test and server output appearing in console. -->
-                    <redirectTestOutputToFile>true</redirectTestOutputToFile>
-                    <enableAssertions>true</enableAssertions>
-                    <!-- Tests to execute. -->
-                    <includes>
-                        <include>**/*Tests.java</include>
-                    </includes>
-                    <!-- System properties passed to test cases -->
-                    <systemPropertyVariables>
-                        <!-- Used in arquillian.xml - arguments for all JBoss AS instances. -->
-                        <server.jvm.args>${general.server.jvm.args} ${byteman.server.jvm.args} ${jpda.server.jvm.args}</server.jvm.args>
-                        <java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
-                    </systemPropertyVariables>
-                </configuration>
-            </plugin>
         </plugins>
         <pluginManagement>
         	<plugins>
@@ -233,4 +213,58 @@
         </dependency>
 
     </dependencies>
+	<profiles>
+		<profile>
+			<id>default</id>
+			<activation>
+				<activeByDefault>true</activeByDefault>
+			</activation>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-surefire-plugin</artifactId>
+						<configuration>
+							<skip>true</skip>
+						</configuration>
+					</plugin>
+				</plugins>
+			</build>
+		</profile>
+		<profile>
+			<id>arq</id>
+			<activation>
+				<activeByDefault>false</activeByDefault>
+			</activation>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-surefire-plugin</artifactId>
+						<configuration>
+							<!-- Prevent test and server output appearing in console. -->
+							<redirectTestOutputToFile>true</redirectTestOutputToFile>
+							<enableAssertions>true</enableAssertions>
+							<!-- Tests to execute. -->
+							<includes>
+								<include>**/*Tests.java</include>
+							</includes>
+							<!-- System properties passed to test cases -->
+							<systemPropertyVariables>
+								<!-- Used in arquillian.xml - arguments for all JBoss AS instances. -->
+								<server.jvm.args>${general.server.jvm.args} ${byteman.server.jvm.args} ${jpda.server.jvm.args}</server.jvm.args>
+								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
+							</systemPropertyVariables>
+						</configuration>
+					</plugin>
+				</plugins>
+			</build>
+			<dependencies>
+				<dependency>
+					<groupId>org.jboss.as</groupId>
+					<artifactId>jboss-as-arquillian-container-managed</artifactId>
+					<version>${jboss-as.version}</version>
+					<scope>test</scope>
+				</dependency>
+			</dependencies>
+		</profile>
+	</profiles>
 </project>",2012-05-07T06:29:32Z,162
"@@ -0,0 +1,30 @@
+<?xml version=""1.0"" encoding=""UTF-8""?>
+<!-- JBoss, Home of Professional Open Source Copyright 2008, Red Hat Middleware LLC, and others contributors as indicated by the @authors tag. All rights reserved. See the copyright.txt in the distribution 
+	for a full listing of individual contributors. This copyrighted material is made available to anyone wishing to use, modify, copy, or redistribute it subject to the terms and conditions of the GNU Lesser 
+	General Public License, v. 2.1. This program is distributed in the hope that it will be useful, but WITHOUT A WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR 
+	PURPOSE. See the GNU Lesser General Public License for more details. You should have received a copy of the GNU Lesser General Public License, v.2.1 along with this distribution; if not, write to the Free 
+	Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA. -->
+<project xmlns=""http://maven.apache.org/POM/4.0.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
+         xsi:schemaLocation=""http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"">
+    <parent>
+        <groupId>org.jboss.narayana.xts</groupId>
+        <artifactId>xts-all</artifactId>
+        <version>5.0.0.M2-SNAPSHOT</version>
+        <relativePath>../pom.xml</relativePath>
+    </parent>
+    <modelVersion>4.0.0</modelVersion>
+    <artifactId>byteman_support</artifactId>
+    <packaging>jar</packaging>
+    <name>Reusable Byteman rules for xts</name>
+    
+    <dependencies>
+        <dependency>
+            <groupId>org.jboss.byteman</groupId>
+            <artifactId>byteman</artifactId>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.byteman</groupId>
+            <artifactId>byteman-submit</artifactId>
+        </dependency>
+    </dependencies>
+</project>",2012-12-07T10:03:43Z,275
"@@ -0,0 +1,53 @@
+package org.jboss.jbossts.xts.bytemanSupport;
+
+import org.jboss.byteman.agent.submit.Submit;
+
+import java.io.IOException;
+import java.io.InputStream;
+import java.net.URL;
+import java.util.ArrayList;
+import java.util.List;
+
+/**
+ * @Author paul.robinson@redhat.com 22/11/2012
+ */
+public class BMScript {
+
+    private static final Submit submit = new Submit();
+
+    public static void submit(String scriptResourcePath) {
+
+        try {
+            List<InputStream> streams = getScriptFromResource(scriptResourcePath);
+            submit.addRulesFromResources(streams);
+        } catch (Exception e) {
+            throw new RuntimeException(""Failed to submit Byteman script"", e);
+        }
+    }
+
+    public static void remove(String scriptResourcePath) {
+
+        try {
+            List<InputStream> streams = getScriptFromResource(scriptResourcePath);
+            submit.deleteRulesFromResources(streams);
+        } catch (Exception e) {
+            throw new RuntimeException(""Failed to remove Byteman script"", e);
+        }
+    }
+
+    private static List<InputStream> getScriptFromResource(String scriptResourcePath) {
+        URL resource = Thread.currentThread().getContextClassLoader().getResource(scriptResourcePath);
+        if (resource == null) {
+            throw new RuntimeException(""'"" + scriptResourcePath + ""' can't be found on the classpath"");
+        }
+
+        List<InputStream> streams = new ArrayList<InputStream>();
+        try {
+            streams.add(resource.openStream());
+        } catch (IOException e) {
+            throw new RuntimeException(""Unable to open stream at url location: "" + resource.toString());
+        }
+        return streams;
+    }
+
+}",2012-12-07T10:03:43Z,276
"@@ -0,0 +1,13 @@
+package org.jboss.jbossts.xts.bytemanSupport.participantCompletion;
+
+/**
+ * @Author paul.robinson@redhat.com 26/11/2012
+ */
+public class ParticipantCompletionCoordinatorRules {
+
+    public static String RESOURCE_PATH= ""org/jboss/jbossts/xts/bytemanSupport/participantCompletion/participant_completion_coordinator_rules.btm"";
+
+    public static void setParticipantCount(Integer participantCount) {
+        //Dummy method, detected by Byteman Rules
+    }
+}",2012-12-07T10:03:43Z,277
"@@ -0,0 +1,40 @@
+RULE create counter
+CLASS org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules
+METHOD setParticipantCount(Integer)
+BIND counter:Integer=$1
+IF TRUE
+DO debug(""participant_completion.counter.create: "" + counter),
+  deleteCounter(""completes""),
+  createCounter(""completes"", counter)
+ENDRULE
+
+RULE complete called
+CLASS com.arjuna.webservices11.wsba.sei.BusinessAgreementWithParticipantCompletionCoordinatorPortTypeImpl
+METHOD completedOperation(NotificationType)
+AT RETURN
+BIND NOTHING
+IF (debug(""participant_completion.counter.decrement"") AND decrementCounter(""completes"") == 0)
+DO debug(""participant_completion.called.waking""),
+   signalWake(""complete"", true),
+   debug(""participant_completion.called.donewake"")
+ENDRULE
+
+RULE close called
+CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
+METHOD closeOperation(NotificationType)
+BIND NOTHING
+IF TRUE
+DO debug(""participant_completion.close.waiting""),
+   waitFor(""complete""),
+   debug(""participant_completion.close.woken"")
+ENDRULE
+
+RULE cancel called
+CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
+METHOD cancelOperation(NotificationType)
+BIND NOTHING
+IF TRUE
+DO debug(""participant_completion.cancel.waiting""),
+   waitFor(""complete""),
+   debug(""participant_completion.cancel.woken"")
+ENDRULE
\ No newline at end of file",2012-12-07T10:03:43Z,278
"@@ -67,8 +67,6 @@ public void testClose()
             throw eouter;
         }
 
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
 
 	    assertTrue(p.passed());",2012-12-07T10:03:43Z,279
"@@ -68,8 +68,6 @@ public void testExit()
             throw eouter;
         }
 
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
 
 	    assertTrue(p.passed());",2012-12-07T10:03:43Z,280
"@@ -73,8 +73,6 @@ public void testMultiClose()
             }
             throw eouter;
         }
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
         assertTrue(p.passed());
     }",2012-12-07T10:03:43Z,281
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -20,11 +24,23 @@ public class CloseTest {
 	public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				Close.class,
-				DemoBusinessParticipant.class);
+				DemoBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
 		test.testClose();
 	}
 }",2012-12-07T10:03:43Z,282
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -20,11 +24,23 @@ public class CompensateTest {
 	public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				Compensate.class,
-				DemoBusinessParticipant.class);
+				DemoBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
 		test.testCompensate();
 	}
 }",2012-12-07T10:03:43Z,283
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -14,6 +18,7 @@
 
 @RunWith(Arquillian.class)
 public class MultiCloseTest {
+    
 	@Inject
 	MultiClose test;
 	
@@ -22,11 +27,23 @@ public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				MultiClose.class,
 				DemoBusinessParticipant.class,
-				FailureBusinessParticipant.class);
+				FailureBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
-	
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(2);
 		test.testMultiClose();
 	}
 }",2012-12-07T10:03:43Z,281
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -22,11 +26,23 @@ public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				MultiCompensate.class,
 				DemoBusinessParticipant.class,
-				FailureBusinessParticipant.class);
+				FailureBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(2);
 		test.testMultiCompensate();
 	}
 }",2012-12-07T10:03:43Z,284
"@@ -18,18 +18,51 @@
 	<description>localjunit tests for xts</description>
         <properties>
             <buildType>11</buildType>
-            <general.server.jvm.args>-Xms64m -Xmx1024m -XX:MaxPermSize=512m</general.server.jvm.args>
+            <general.server.jvm.args>-Xms64m -Xmx1024m -XX:MaxPermSize=512m
+                                     -Dorg.jboss.byteman.verbose
+                                    -Djboss.modules.system.pkgs=org.jboss.byteman
+                                    -Dorg.jboss.byteman.transform.all
+                                    -javaagent:${project.build.directory}/lib/byteman.jar=listener:true
+            </general.server.jvm.args>
             <ipv4.server.jvm.args></ipv4.server.jvm.args>
             <ipv6.server.jvm.args>-Djboss.bind.address=[::1] -Djboss.bind.address.management=[::1] -Djboss.bind.address.unsecure=[::1] -Djava.net.preferIPv4Stack=false -Djava.net.preferIPv6Addresses=true</ipv6.server.jvm.args>
             <server.debug.args>Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5006</server.debug.args>
         </properties>
 
+    <build>
+        <plugins>
+                <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                      <artifactId>maven-dependency-plugin</artifactId>
+                      <executions>
+                        <execution>
+                          <id>copy-dependencies</id>
+                          <phase>test-compile</phase>
+                          <goals>
+                            <goal>copy-dependencies</goal>
+                          </goals>
+                          <configuration>
+                              <stripVersion>true</stripVersion>
+                              <includeGroupIds>org.jboss.byteman</includeGroupIds>
+                            <outputDirectory>${project.build.directory}/lib</outputDirectory>
+                          </configuration>
+                        </execution>
+                      </executions>
+                </plugin>
+        </plugins>
+    </build>
+
 	<dependencies>
 		<dependency>
 			<groupId>org.jboss.narayana.xts</groupId>
 			<artifactId>jbossxts</artifactId>
 			<scope>provided</scope>
 		</dependency>
+		<dependency>
+			<groupId>org.jboss.narayana.xts</groupId>
+			<artifactId>byteman_support</artifactId>
+            <scope>test</scope>
+		</dependency>
 		<dependency>
 			<groupId>junit</groupId>
 			<artifactId>junit</artifactId>
@@ -67,6 +100,37 @@
 				</plugins>
 			</build>
 		</profile>
+        <profile>
+      			<id>arq-remote</id>
+      			<activation>
+      				<activeByDefault>false</activeByDefault>
+      			</activation>
+      			<build>
+      				<plugins>
+      					<plugin>
+      						<artifactId>maven-surefire-plugin</artifactId>
+      						<configuration>
+      							<forkMode>once</forkMode>
+      							<systemPropertyVariables combine.children=""append"">
+      							<!--
+      							  Used in arquillian.xml
+      							-->
+      							  <server.jvm.args>${general.server.jvm.args} ${ipv4.server.jvm.args}</server.jvm.args>
+                                    <node.address>127.0.0.1</node.address>
+      							</systemPropertyVariables>
+      						</configuration>
+      					</plugin>
+      				</plugins>
+      			</build>
+      			<dependencies>
+      				<dependency>
+      					<groupId>org.jboss.as</groupId>
+      					<artifactId>jboss-as-arquillian-container-remote</artifactId>
+      					<version>${jboss-as.version}</version>
+      					<scope>test</scope>
+      				</dependency>
+      			</dependencies>
+      		</profile>
 		<profile>
 			<id>arq</id>
 			<activation>
@@ -83,7 +147,7 @@
 							  Used in arquillian.xml
 							-->
 							  <server.jvm.args>${general.server.jvm.args} ${ipv4.server.jvm.args}</server.jvm.args>
-                                                          <node.address>127.0.0.1</node.address>
+                              <node.address>127.0.0.1</node.address>
 							</systemPropertyVariables>
 						</configuration>
 					</plugin>",2012-12-07T10:03:43Z,34
"@@ -37,6 +37,7 @@
     </plugins>
   </build>
   <modules>
+    <module>byteman_support</module>
     <module>WSAS</module>
     <module>WSAS/xts-test-servlet</module>
     <module>WS-C</module>",2012-12-07T10:03:43Z,285
"@@ -52,6 +52,14 @@
     </plugins>
   </build>
   <dependencies>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman-submit</artifactId>
+    </dependency>
     <!-- START TEST -->
     <dependency>
       <groupId>junit</groupId>",2012-12-07T10:03:43Z,286
"@@ -942,6 +942,11 @@
         <artifactId>service</artifactId>
         <version>${project.version}</version>
       </dependency>
+      <dependency>
+	<groupId>org.jboss.narayana.xts</groupId>
+	<artifactId>byteman_support</artifactId>
+        <version>${project.version}</version>
+      </dependency>
       <dependency>
         <groupId>org.jboss.narayana.rts</groupId>
         <artifactId>restat-web</artifactId>
@@ -973,27 +978,27 @@
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-install</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-submit</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-bmunit</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-dtest</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
   </dependencies>
   </dependencyManagement>",2012-12-07T10:03:43Z,39
"@@ -37,6 +37,24 @@
                     <skip>true</skip>
                 </configuration>
             </plugin>
+            <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-dependency-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>copy-dependencies</id>
+                      <phase>test-compile</phase>
+                      <goals>
+                        <goal>copy-dependencies</goal>
+                      </goals>
+                      <configuration>
+                          <stripVersion>true</stripVersion>
+                          <includeGroupIds>org.jboss.byteman</includeGroupIds>
+                        <outputDirectory>${project.build.directory}/lib</outputDirectory>
+                      </configuration>
+                    </execution>
+                  </executions>
+            </plugin>
         </plugins>
     </build>
 
@@ -112,6 +130,11 @@
                 </exclusion>
             </exclusions>
         </dependency>
+	<dependency>
+	   <groupId>org.jboss.narayana.xts</groupId>
+	   <artifactId>byteman_support</artifactId>
+           <scope>test</scope>
+	</dependency>
         <dependency>
             <groupId>org.jboss.narayana.rts</groupId>
             <artifactId>restat-util</artifactId>",2012-12-07T10:03:43Z,41
"@@ -5,6 +5,8 @@
 import com.arjuna.wst.TransactionRolledBackException;
 import junit.framework.Assert;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Close;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Compensate;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.ConfirmCompleted;
@@ -13,7 +15,9 @@
 import org.jboss.narayana.txframework.functional.common.SomeApplicationException;
 import org.jboss.narayana.txframework.functional.interfaces.BAParticipantCompletion;
 import org.junit.After;
+import org.junit.AfterClass;
 import org.junit.Before;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -27,6 +31,17 @@ public class BAParticipantCompletionTest extends BaseFunctionalTest
     UserBusinessActivity uba;
     BAParticipantCompletion client;
 
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
     @Before
     public void setupTest() throws Exception
     {
@@ -45,9 +60,10 @@ public void teardownTest() throws Exception
     @Test
     public void testAutoComplete() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+        
         uba.begin();
         client.saveDataAutoComplete();
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -57,9 +73,10 @@ public void testAutoComplete() throws Exception
     @Test
     public void testManualComplete() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
         uba.begin();
         client.saveDataManualComplete(ServiceCommand.COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -68,10 +85,11 @@ public void testManualComplete() throws Exception
     @Test
     public void testMultiInvoke() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+        
         uba.begin();
         client.saveDataManualComplete();
         client.saveDataManualComplete(ServiceCommand.COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -80,9 +98,10 @@ public void testMultiInvoke() throws Exception
     @Test
     public void testClientDrivenCompensate() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
         uba.begin();
         client.saveDataAutoComplete();
-        Thread.sleep(10000); //JBTM-1203
         uba.cancel();
 
         assertOrder(ConfirmCompleted.class, Compensate.class);
@@ -113,8 +132,8 @@ public void testCannotComplete() throws Exception
     {
         uba.begin();
         client.saveDataAutoComplete(ServiceCommand.CANNOT_COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
+        
         assertOrder();
     }
 ",2012-12-07T10:03:43Z,287
"@@ -16,6 +16,11 @@
       <!-- If you want to use the JBOSS_HOME environment variable, just delete the jbossHome property -->
       <configuration>
 			<property name=""serverConfig"">standalone-xts.xml</property>
+            <property name=""javaVmArguments"">-Dorg.jboss.byteman.verbose
+                                    -Djboss.modules.system.pkgs=org.jboss.byteman
+                                    -Dorg.jboss.byteman.transform.all
+                                    -javaagent:../lib/byteman.jar=listener:true
+            </property>
       </configuration>
    </container>
 ",2012-12-07T10:03:43Z,129
"@@ -144,6 +144,17 @@
         <id>release</id>
         <build>
           <plugins>
+              <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                <artifactId>maven-install-plugin</artifactId>
+                <executions>
+                  <execution>
+                    <id>default-install</id>
+                    <phase>install</phase>
+                  </execution>
+                </executions>
+                <inherited>false</inherited>
+              </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,237
"@@ -42,4 +42,24 @@
     <module>txoj</module>
     <module>arjunacore</module>
   </modules>
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,288
"@@ -114,4 +114,24 @@
       <scope>test</scope>
     </dependency>
   </dependencies>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,289
"@@ -160,6 +160,17 @@
         <id>release</id>
         <build>
           <plugins>
+              <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                <artifactId>maven-install-plugin</artifactId>
+                <executions>
+                  <execution>
+                    <id>default-install</id>
+                    <phase>install</phase>
+                  </execution>
+                </executions>
+                <inherited>false</inherited>
+              </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,238
"@@ -41,4 +41,24 @@
     <module>jdbc</module>
     <module>narayana-jta</module>
   </modules>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,223
"@@ -61,18 +61,22 @@
     <dependency>
       <groupId>org.jboss.narayana.jta</groupId>
       <artifactId>jta</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss</groupId>
@@ -146,6 +150,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,69
"@@ -167,10 +167,22 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
@@ -179,6 +191,12 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>tanukisoft</groupId>
@@ -201,6 +219,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,29
"@@ -167,14 +167,32 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>tanukisoft</groupId>
@@ -221,6 +239,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,30
"@@ -45,4 +45,24 @@
     <module>narayana-jts-idlj</module>
     <module>integration</module>
   </modules>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,290
"@@ -27,4 +27,24 @@
             <artifactId>byteman-submit</artifactId>
         </dependency>
     </dependencies>
+    <profiles>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                    <plugin>
+                        <groupId>org.apache.maven.plugins</groupId>
+                        <artifactId>maven-install-plugin</artifactId>
+                        <executions>
+                            <execution>
+                                <id>default-install</id>
+                                <phase>install</phase>
+                            </execution>
+                        </executions>
+                        <inherited>false</inherited>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,275
"@@ -215,6 +215,17 @@
         <id>release</id>
         <build>
           <plugins>
+            <plugin>
+              <groupId>org.apache.maven.plugins</groupId>
+              <artifactId>maven-install-plugin</artifactId>
+              <executions>
+                <execution>
+                  <id>default-install</id>
+                  <phase>install</phase>
+                </execution>
+              </executions>
+              <inherited>false</inherited>
+            </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,33
"@@ -29,6 +29,16 @@
     </properties>
 
     <build>
+        <pluginManagement>
+            <plugins>
+                <plugin>
+                    <artifactId>maven-surefire-plugin</artifactId>
+                    <configuration>
+                        <skip>true</skip>
+                    </configuration>
+                </plugin>
+            </plugins>
+        </pluginManagement>
         <plugins>
             <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
@@ -94,26 +104,6 @@
         </dependency>
     </dependencies>
     <profiles>
-        <!-- The default profile skips all tests, though you can tune it
-            to run just unit tests based on a custom pattern -->
-        <!-- Seperate profiles are provided for running all tests, including
-            Arquillian tests that execute in the specified container -->
-        <profile>
-            <id>default</id>
-            <activation>
-                <activeByDefault>true</activeByDefault>
-            </activation>
-            <build>
-                <plugins>
-                    <plugin>
-                        <artifactId>maven-surefire-plugin</artifactId>
-                        <configuration>
-                            <skip>true</skip>
-                        </configuration>
-                    </plugin>
-                </plugins>
-            </build>
-        </profile>
         <profile>
             <id>arq-remote</id>
             <activation>
@@ -132,6 +122,7 @@
                                 <server.jvm.args>${jvm.args.memory} ${ipv4.server.jvm.args}</server.jvm.args>
                                 <node.address>127.0.0.1</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>
@@ -165,6 +156,7 @@
                                 </server.jvm.args>
                                 <node.address>127.0.0.1</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>
@@ -199,6 +191,7 @@
                                 </server.jvm.args>
                                 <node.address>[::1]</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>",2013-01-22T15:55:37Z,34
"@@ -50,4 +50,24 @@
     <module>jbossxts</module>
     <module>localjunit</module>
   </modules>
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,285
"@@ -69,4 +69,25 @@
     </dependency>
     <!-- END TEST -->
   </dependencies>
+
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,286
"@@ -1099,5 +1099,37 @@
         <module>STM</module>
       </modules>
     </profile>
+    <profile>
+      <id>release</id>
+      <build>
+          <pluginManagement>
+              <plugins>
+                  <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                    <artifactId>maven-install-plugin</artifactId>
+                    <executions>
+                      <execution>
+                        <id>default-install</id>
+                        <phase>none</phase>
+                      </execution>
+                    </executions>
+                  </plugin>
+              </plugins>
+          </pluginManagement>
+          <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
+          </plugins>
+      </build>
+    </profile>
   </profiles>
 </project>",2013-01-22T15:55:37Z,39
"@@ -51,4 +51,24 @@ Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
   <properties>
     <version.org.jboss.resteasy>2.0.0.GA</version.org.jboss.resteasy>
   </properties>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,291
"@@ -171,4 +171,24 @@
       </plugin>
     </plugins>
   </build>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                  <plugin>
+                      <groupId>org.apache.maven.plugins</groupId>
+                      <artifactId>maven-install-plugin</artifactId>
+                      <executions>
+                          <execution>
+                              <id>default-install</id>
+                              <phase>install</phase>
+                          </execution>
+                      </executions>
+                      <inherited>false</inherited>
+                  </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,292
"@@ -94,6 +94,13 @@
                     <target>1.6</target>
                 </configuration>
             </plugin>
+            <plugin>
+                <artifactId>maven-surefire-plugin</artifactId>
+                <version>2.11</version>
+                <configuration>
+                    <skip>true</skip>
+                </configuration>
+            </plugin>
         </plugins>
         <pluginManagement>
         	<plugins>
@@ -221,23 +228,6 @@
 
     </dependencies>
 	<profiles>
-		<profile>
-			<id>default</id>
-			<activation>
-				<activeByDefault>true</activeByDefault>
-			</activation>
-			<build>
-				<plugins>
-					<plugin>
-						<artifactId>maven-surefire-plugin</artifactId>
-						<version>2.11</version>
-						<configuration>
-							<skip>true</skip>
-						</configuration>
-					</plugin>
-				</plugins>
-			</build>
-		</profile>
 		<profile>
 			<id>arq</id>
 			<activation>
@@ -263,6 +253,7 @@
 								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
 								<node.address>localhost</node.address>
 							</systemPropertyVariables>
+                            <skip>false</skip>
 						</configuration>
 					</plugin>
 				</plugins>
@@ -305,6 +296,7 @@
 								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
 								<node.address>[::1]</node.address>
 							</systemPropertyVariables>
+                            <skip>false</skip>
 						</configuration>
 					</plugin>
 				</plugins>
@@ -333,5 +325,23 @@
 				</dependency>
 			</dependencies>
 		</profile>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                  <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                    <artifactId>maven-install-plugin</artifactId>
+                    <executions>
+                      <execution>
+                        <id>default-install</id>
+                        <phase>install</phase>
+                      </execution>
+                    </executions>
+                    <inherited>false</inherited>
+                  </plugin>
+                </plugins>
+            </build>
+        </profile>
 	</profiles>
 </project>",2013-01-22T15:55:37Z,162
"@@ -214,6 +214,24 @@
                 </dependency>
             </dependencies>
         </profile>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                    <plugin>
+                        <groupId>org.apache.maven.plugins</groupId>
+                        <artifactId>maven-install-plugin</artifactId>
+                        <executions>
+                            <execution>
+                                <id>default-install</id>
+                                <phase>install</phase>
+                            </execution>
+                        </executions>
+                        <inherited>false</inherited>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
     </profiles>
 
 </project>",2013-01-22T15:55:37Z,41
"@@ -0,0 +1,2 @@
+export UPSTREAM_AS_BRANCH=master
+export ORIGIN_AS_BRANCH=5_BRANCH
\ No newline at end of file",2013-02-08T16:09:11Z,267
"@@ -0,0 +1,36 @@
+function fatal {
+  echo ""Failed: $1""
+  exit 1
+}
+
+. branch-names.sh
+
+echo ""Rebaseing origin/$ORIGIN_AS_BRANCH with upstream/$UPSTREAM_AS_BRANCH""
+
+GIT_URL=""git@github.com:jbosstm/jboss-as.git""
+UPSTREAM_GIT_URL=""https://github.com/jbossas/jboss-as.git""
+TEMPORARY_REBASE_LOCATION=/tmp/rebase-jbossas-branch
+
+rm -rf $TEMPORARY_REBASE_LOCATION || fatal
+mkdir $TEMPORARY_REBASE_LOCATION || fatal
+cd $TEMPORARY_REBASE_LOCATION || fatal
+
+git clone $GIT_URL || fatal
+cd jboss-as
+git checkout -t origin/$ORIGIN_AS_BRANCH || fatal
+
+git remote add upstream $UPSTREAM_GIT_URL
+git pull --rebase --ff-only upstream $UPSTREAM_AS_BRANCH
+
+while [ $? != 0 ]
+do
+ for i in `git status -s | sed ""s/UU \(.*\)/\1/g""`
+ do
+    awk '/^<+ HEAD$/,/^=+$/{next} /^>+ /{next} 1' $i > $i.bak; mv $i.bak $i; git add $i
+ done
+ git rebase --continue
+done
+[ $? = 0 ] || fatal ""git rebase failed""
+
+git push origin $ORIGIN_AS_BRANCH -f
+rm -rf $TEMPORARY_REBASE_LOCATION",2013-02-08T16:09:11Z,268
"@@ -69,13 +69,12 @@
     <property name=""version"" value=""5.0.0.M2-SNAPSHOT""/>
 -->
   <!-- a working directory for the process. Can contain output from previous releases if you like to keep them archived locally. -->
-  <!--property name=""workdir"" location=""/tmp/narayana_releases""/-->
+  <property name=""workdir"" location=""/tmp/narayana_releases""/>
   <!-- where to get the source -->
-  <property name=""svnbase"" value=""https://svn.jboss.org/repos/labs/labs/jbosstm/tags""/>
+  <property name=""gitbase"" value=""https://github.com/jbosstm""/>
   <!-- The tag as it appears under svnbase -->
-  <property name=""tag"" value=""5_0_0_M1""/>
-  <!-- The file name base for the user downloadable files. Derive it from the tag -->
-  <property name=""version"" value=""5.0.0.M1""/>
+  <property name=""pageName"" value=""4_17_0_Final""/>
+  <property name=""tag"" value=""4.17.0.Final""/>
   <!-- which uber jar to use -->
   <property name=""orb"" value=""jacorb""/>
   <!-- the location the JBossTS web site content is copied to -->
@@ -100,40 +99,116 @@
         </not>
       </condition>
     </fail>
-    <fail message=""You must not already have a local maven cached repository to do a release build"">
-      <condition>
-        <available file=""repository"" type=""dir""/>
-      </condition>
-    </fail>
     <fail message=""You cannot perform a build without cleaning the old version out"">
       <condition>
         <available file=""${workdir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <mkdir dir=""${workdir}""/>
-    <!-- pull the source code from svn -->
-    <exec executable=""svn"" dir=""${workdir}"">
+    <!-- pull the source code from git -->
+    <exec executable=""git"" dir=""${workdir}"">
+      <arg value=""clone""/>
+      <arg value=""${gitbase}/narayana.git""/>
+      <arg value=""${tag}""/>
+    </exec>
+    <exec executable=""git"" dir=""${workdir}/${tag}"">
       <arg value=""checkout""/>
-      <arg value=""${svnbase}/${tag}""/>
+      <arg value=""${tag}""/>
     </exec>
   </target>
   <target name=""dist"" depends=""dist-init"" description=""build the end-user release bundles (src and binary)"">
     <!-- build the binary releases -->
     <exec dir=""${workdir}/${tag}"" executable=""tools/maven/bin/mvn"" failonerror=""true"">
       <arg line=""clean -gs tools/maven/conf/settings.xml -Demma.jar.location=${user.dir}/ext/emma.jar -Dorson.jar.location=${user.dir}/ext/orson-0.5.0.jar""/>
     </exec>
-    <!-- package the JTA only src tree (no JTS, XTS, txbridge, RTS) -->
-    <delete file=""${workdir}/narayana-jta-${version}-src.zip""/>
-    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-jta-${version}-src.zip"" includes=""${tag}/**"" excludes=""${tag}/ArjunaJTS/**, ${tag}/XTS/** ${tag}/txbridge/**, ${tag}/rest-tx/**, ${tag}/repository/**""/>
     <!-- package the full source release (all src tree) -->
-    <delete file=""${workdir}/narayana-full-${version}-src.zip""/>
-    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-full-${version}-src.zip"" includes=""${tag}/**"" excludes=""${tag}/repository/**""/>
+    <delete file=""${workdir}/narayana-full-${tag}-src.zip""/>
+    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-full-${tag}-src.zip"" includes=""${tag}/**""/>
     <!-- build the binary releases -->
     <exec dir=""${workdir}/${tag}"" executable=""tools/maven/bin/mvn"" failonerror=""true"">
       <arg line=""deploy -DskipTests -gs tools/maven/conf/settings.xml -Demma.jar.location=${user.dir}/ext/emma.jar -Dorson.jar.location=${user.dir}/ext/orson-0.5.0.jar""/>
     </exec>
   </target>
   <!-- copy the release into the downloads dir tree (http://www.jboss.org/jbosstm web site content) -->
+  <target name=""docs"">
+    <fail>
+      <condition>
+        <not>
+          <available file=""${downloads.dir}"" type=""dir""/>
+        </not>
+      </condition>
+    </fail>
+    <fail>
+      <condition>
+        <not>
+          <available file=""${docs.dir}"" type=""dir""/>
+        </not>
+      </condition>
+    </fail>
+
+    <exec executable=""git"" dir=""${workdir}"">
+      <arg value=""clone""/>
+      <arg value=""${gitbase}/documentation.git""/>
+      <arg value=""${tag}-docs""/>
+    </exec>
+    <exec executable=""git"" dir=""${workdir}/${tag}-docs"">
+      <arg value=""checkout""/>
+      <arg value=""${tag}""/>
+    </exec>
+    <exec dir=""${workdir}/${tag}-docs"" executable=""mvn"" failonerror=""true"">
+      <arg line=""install""/>
+    </exec>
+    <delete dir=""tmp-docs-dir-docs""/>
+    <mkdir dir=""tmp-docs-dir-docs""/>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-orbportability_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/orbportability_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-quick_start_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/quick_start_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-administration_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/administration_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/arjunacore-failure_recovery_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaCore/docs/failure_recovery_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/arjunacore-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaCore/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-quick_start_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/quick_start_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-installation_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/installation_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-administration_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/administration_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/xts-administration_and_development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/XTS/docs/administration_and_development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/failure_recovery_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/failure_recovery_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/transactions_overview_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/transactions_overview_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/txbridge_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/txbridge_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <move todir=""${docs.dir}/${tag}"" verbose=""true"">
+      <fileset dir=""tmp-docs-dir-docs""/>
+    </move>
+  </target> 
   <target name=""downloads"" description=""copy release bundles to JBossTS web site content"">
     <fail>
       <condition>
@@ -144,7 +219,7 @@
     </fail>
     <fail>
       <condition>
-        <available file=""${downloads.dir}/${version}"" type=""dir""/>
+        <available file=""${downloads.dir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <fail>
@@ -156,7 +231,7 @@
     </fail>
     <fail>
       <condition>
-        <available file=""${docs.dir}/${version}"" type=""dir""/>
+        <available file=""${docs.dir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <delete dir=""tmp-downloads-dir""/>
@@ -167,91 +242,37 @@
     <delete dir=""tmp-docs-dir""/>
     <mkdir dir=""tmp-docs-dir""/>
     <copy todir=""tmp-downloads-dir/src"">
-      <fileset dir=""${workdir}"" includes=""narayana-*-${version}-src.zip""/>
+      <fileset dir=""${workdir}"" includes=""narayana-*-${tag}-src.zip""/>
     </copy>
     <copy todir=""tmp-downloads-dir/binary"">
-      <fileset dir=""${workdir}/${tag}/narayana-full/target/"" includes=""narayana-full-${version}-bin.zip""/>
+      <fileset dir=""${workdir}/${tag}/narayana-full/target/"" includes=""narayana-full-${tag}-bin.zip""/>
     </copy>
     <copy todir=""tmp-downloads-dir/idl"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/jts/idl/arjuna"">
+      <fileset dir=""${workdir}/${tag}/ArjunaJTS/idl/src/main/idl/arjuna"">
         <include name=""ArjunaOTS.idl""/>
       </fileset>
     </copy>
     <copy todir=""tmp-downloads-dir/idl"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/jts/idl/omg"">
+      <fileset dir=""${workdir}/${tag}/ArjunaJTS/idl/src/main/idl/omg"">
         <include name=""CosTransactions.idl""/>
         <include name=""XA.idl""/>
       </fileset>
     </copy>
-    <copy file=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/narayana-jts-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/jta""/>
-    <copy file=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/jts""/>
-    <copy file=""${workdir}/${tag}/rest-tx/tx/target/rest-tx-api-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/rts""/>
-    <copy file=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/xts""/>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-orbportability_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/orbportability_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-quick_start_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/quick_start_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-administration_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/administration_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/arjunacore-failure_recovery_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaCore/docs/failure_recovery_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/arjunacore-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaCore/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-quick_start_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/quick_start_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-installation_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/installation_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-administration_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/administration_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/xts-administration_and_development_guide"">
-      <fileset dir=""${workdir}/${tag}/XTS/docs/administration_and_development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/failure_recovery_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/failure_recovery_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/release_notes"">
-      <fileset dir=""${workdir}/${tag}/docs/release_notes/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/development_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/transactions_overview_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/transactions_overview_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/txbridge_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/txbridge_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <unzip src=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/narayana-jts-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/jts""/>
-    <unzip src=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/jta""/>
-    <unzip src=""${workdir}/${tag}/rest-tx/tx/target/rest-tx-api-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/rts""/>
-    <unzip src=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/xts""/>
-    <move todir=""${downloads.dir}/${version}"" verbose=""true"">
+    <copy file=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/jbossjts-jacorb-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/jts""/>
+    <copy file=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/jta""/>
+    <copy file=""${workdir}/${tag}/rest-tx/tx/target/restat-api-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/rts""/>
+    <copy file=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/xts""/>
+    <unzip src=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/jbossjts-jacorb-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/jts""/>
+    <unzip src=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/jta""/>
+    <unzip src=""${workdir}/${tag}/rest-tx/tx/target/restat-api-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/rts""/>
+    <unzip src=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/xts""/>
+    <move todir=""${downloads.dir}/${tag}"" verbose=""true"">
       <fileset dir=""tmp-downloads-dir""/>
     </move>
-    <move todir=""${docs.dir}/${version}"" verbose=""true"">
+    <move todir=""${docs.dir}/${tag}"" verbose=""true"">
       <fileset dir=""tmp-docs-dir""/>
     </move>
   </target>
-  <!-- copy the release artifacts to the maven repository -->
-  <target name=""mvn-repository"" description=""copy the release artifacts to the maven repository"">
-    <!-- xts -->
-    <mvn-artifact.macro artifact=""jbossxts-tests"" packaging=""zip"" dir=""${workdir}/build/${tag}/xts/tests""/>
-    <mvn-artifact.macro artifact=""jbossxts-interop-tests"" packaging=""zip"" dir=""${workdir}/build/${tag}/xts/interop-tests""/>
-  </target>
   <!-- magnolia (the cms that sits behind jboss.org/jbosstm pages) is a pain. This target generates
      xml for /downloads/somerelease.xml pages to ease some of the pain in publishing an upload
       right click jbosstm/downloads node, import from xml, then right click new node and activate.
@@ -261,20 +282,24 @@
     <exec executable=""date"" outputproperty=""date"">
       <arg line=""+'%FT%H:%M:%S.000Z'""/>
     </exec>
-    <length property=""jta-src-length"" file=""${workdir}/jbossts-jta-${version}-src.zip""/>
-    <length property=""full-src-length"" file=""${workdir}/jbossts-full-${version}-src.zip""/>
-    <length property=""jta-bin-length"" file=""${workdir}/jbossts-jta-${version}.zip""/>
-    <length property=""full-bin-length"" file=""${workdir}/jbossts-full-${version}.zip""/>
-    <copy file=""magnolia-release-download-page-template.xml"" tofile=""${workdir}/website.jbosstm.downloads.${version}.xml"" filtering=""true"" overwrite=""true"">
+    <length property=""full-src-length"" file=""${workdir}/narayana-full-${tag}-src.zip""/>
+    <length property=""full-bin-length"" file=""${workdir}/${tag}/narayana-full/target/narayana-full-${tag}-bin.zip""/>
+    <copy file=""magnolia-release-download-page-template.xml"" tofile=""${workdir}/website.jbosstm.downloads.${pageName}.xml"" filtering=""true"" overwrite=""true"">
       <filterset>
+        <filter token=""pageName"" value=""${pageName}""/>
         <filter token=""tag"" value=""${tag}""/>
-        <filter token=""version"" value=""${version}""/>
+        <filter token=""version"" value=""${tag}""/>
         <filter token=""date"" value=""${date}""/>
-        <filter token=""jta-src-length"" value=""${jta-src-length}""/>
         <filter token=""full-src-length"" value=""${full-src-length}""/>
-        <filter token=""jta-bin-length"" value=""${jta-bin-length}""/>
         <filter token=""full-bin-length"" value=""${full-bin-length}""/>
       </filterset>
     </copy>
+    <copy file=""magnolia-release-documentation-page-template.xml"" tofile=""${workdir}/website.jbosstm.documentation.${pageName}.xml"" filtering=""true"" overwrite=""true"">
+      <filterset>
+        <filter token=""pageName"" value=""${pageName}""/>
+        <filter token=""tag"" value=""${tag}""/>
+        <filter token=""date"" value=""${date}""/>
+      </filterset>
+    </copy>
   </target>
 </project>",2012-09-25T19:52:29Z,269
"@@ -0,0 +1,237 @@
+<?xml version=""1.0"" encoding=""UTF-8""?>
+<sv:node sv:name=""@pageName@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
+  <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+    <sv:value>mgnl:content</sv:value>
+  </sv:property>
+  <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+    <sv:value>mix:lockable</sv:value>
+  </sv:property>
+  <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+    <sv:value>14f62a08-1dfe-41b3-bdce-61ce87b8129d</sv:value>
+  </sv:property>
+  <sv:property sv:name=""enableRSS"" sv:type=""String"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""hideInNav"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""menubar"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaCache"" sv:type=""String"">
+    <sv:value>disable</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaExpire"" sv:type=""String"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaRobots"" sv:type=""String"">
+    <sv:value>all</sv:value>
+  </sv:property>
+  <sv:property sv:name=""redirectWindow"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""title"" sv:type=""String"">
+    <sv:value>Narayana Documentation @tag@</sv:value>
+  </sv:property>
+  <sv:property sv:name=""useTitle"" sv:type=""Boolean"">
+    <sv:value>true</sv:value>
+  </sv:property>
+  <sv:node sv:name=""MetaData"">
+    <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+      <sv:value>mgnl:metaData</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+      <sv:value>true</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+      <sv:value>superuser</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+      <sv:value>tm</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:comment"" sv:type=""String"">
+      <sv:value>Made references to git and subversion</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+      <sv:value>2009-12-10T11:47:09.824-05:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+      <sv:value>2012-04-27T05:09:36.605-04:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+      <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:template"" sv:type=""String"">
+      <sv:value>jbossorgProjectSubPage</sv:value>
+    </sv:property>
+  </sv:node>
+  <sv:node sv:name=""mainColumnParagraphs"">
+    <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+      <sv:value>mgnl:contentNode</sv:value>
+    </sv:property>
+    <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+      <sv:value>mix:lockable</sv:value>
+    </sv:property>
+    <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+      <sv:value>43dab693-c6e7-4eda-869e-5b1d9ad358d5</sv:value>
+    </sv:property>
+    <sv:node sv:name=""MetaData"">
+      <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+        <sv:value>mgnl:metaData</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+        <sv:value>true</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+        <sv:value>superuser</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+        <sv:value>tm</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+        <sv:value>2009-12-10T11:47:46.060-05:00</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+        <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+        <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+      </sv:property>
+    </sv:node>
+    <sv:node sv:name=""0"">
+      <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+        <sv:value>mgnl:contentNode</sv:value>
+      </sv:property>
+      <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+        <sv:value>mix:lockable</sv:value>
+      </sv:property>
+      <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+        <sv:value>6aec081e-5217-4adf-b06c-8c5bf92a886b</sv:value>
+      </sv:property>
+      <sv:property sv:name=""flow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""headerSize"" sv:type=""String"">
+        <sv:value>h3</sv:value>
+      </sv:property>
+      <sv:property sv:name=""imageLinkNewWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""imageLocation"" sv:type=""String"">
+        <sv:value>left</sv:value>
+      </sv:property>
+      <sv:property sv:name=""inherit"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""lineAbove"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkImage"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkText"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkTitle"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkWindowMenubar"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""spacer"" sv:type=""Long"">
+        <sv:value>0</sv:value>
+      </sv:property>
+      <sv:property sv:name=""text"" sv:type=""String"">
+        <sv:value>&lt;h1&gt;JBoss Narayana Documentation Library&lt;/h1&gt; &lt;p&gt; &lt;table cellspacing=""5"" class=""infotable"" style=""margin: 2px; padding: 2px; font-size: 90%;""&gt;     &lt;tbody&gt;         &lt;tr&gt;             &lt;th width=""220"" class=""grey""&gt;JBoss Narayana Document&lt;/th&gt;             &lt;th width=""80"" class=""grey""&gt;Version&lt;/th&gt;             &lt;th width=""80"" class=""grey""&gt;Released&lt;/th&gt;             &lt;th class=""blank""&gt;&amp;nbsp;&lt;/th&gt;             &lt;th class=""blank""&gt;&amp;nbsp;&lt;/th&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ORB Portability Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-orbportability_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;NarayanaJTS Quick Start Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-quick_start_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTS Administration Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-administration_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTS Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ArjunaCore Failure Recovery Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/arjunacore-failure_recovery_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ArjunaCore Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/arjunacore-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Quick Start Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-quick_start/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Installation Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-installation_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Administration Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-administration_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;XTS Administration and Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/xts-administration_and_development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Failure Recovery Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/failure_recovery_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Release Notes&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/release_notes/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Transactions Overview Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/transactions_overview_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;TXBridge Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/txbridge_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/jts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/jts/jbossjts-jacorb-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTA API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/jta/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/jta/narayana-jta-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;RTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/rts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/rts/restat-api-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;XTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/xts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/xts/jbossxts-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - ArjunaOTS&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/ArjunaOTS.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - CosTransactions.idl&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/CosTransactions.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - XA&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/XA.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;     &lt;/tbody&gt; &lt;/table&gt; &lt;/p&gt;</sv:value>
+      </sv:property>
+      <sv:property sv:name=""titleLinkNewWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:node sv:name=""MetaData"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:metaData</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+          <sv:value>true</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+          <sv:value>superuser</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+          <sv:value>tm</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+          <sv:value>2009-12-10T11:47:46.061-05:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+          <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+          <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:template"" sv:type=""String"">
+          <sv:value>richTextHtml</sv:value>
+        </sv:property>
+      </sv:node>
+      <sv:node sv:name=""text_files"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:contentNode</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+          <sv:value>mix:lockable</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+          <sv:value>41f11088-5628-42b3-8c36-51b7a4199eaf</sv:value>
+        </sv:property>
+        <sv:node sv:name=""MetaData"">
+          <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+            <sv:value>mgnl:metaData</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+            <sv:value>true</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+            <sv:value>superuser</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+            <sv:value>2009-12-10T11:47:46.061-05:00</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+            <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+          </sv:property>
+        </sv:node>
+      </sv:node>
+      <sv:node sv:name=""imageFooter_files"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:contentNode</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+          <sv:value>mix:lockable</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+          <sv:value>6b6abc15-1022-44a0-917e-29a9691832e4</sv:value>
+        </sv:property>
+        <sv:node sv:name=""MetaData"">
+          <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+            <sv:value>mgnl:metaData</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+            <sv:value>true</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+            <sv:value>superuser</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+            <sv:value>2009-12-10T11:47:46.064-05:00</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+            <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+          </sv:property>
+        </sv:node>
+      </sv:node>
+    </sv:node>
+  </sv:node>
+</sv:node>",2012-09-25T19:52:29Z,270
"@@ -1,5 +1,5 @@
 <?xml version=""1.0"" encoding=""UTF-8""?>
-<sv:node sv:name=""@tag@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
+<sv:node sv:name=""@pageName@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
   <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
     <sv:value>mgnl:content</sv:value>
   </sv:property>
@@ -31,7 +31,7 @@
     <sv:value>false</sv:value>
   </sv:property>
   <sv:property sv:name=""title"" sv:type=""String"">
-    <sv:value>JBossTS @filename@ release</sv:value>
+    <sv:value>JBossTS @tag@ release</sv:value>
   </sv:property>
   <sv:property sv:name=""useTitle"" sv:type=""String"">
     <sv:value>true</sv:value>
@@ -99,12 +99,6 @@
       <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
         <sv:value>00bd1847-65cd-4ff1-b7ce-20b8084be52b</sv:value>
       </sv:property>
-      <sv:property sv:name=""desc21"" sv:type=""String"">
-        <sv:value>The JBoss Transactions JTA @filename@ Source</sv:value>
-      </sv:property>
-      <sv:property sv:name=""desc22"" sv:type=""String"">
-        <sv:value>JBoss Transactions JTA @filename@ Binary</sv:value>
-      </sv:property>
       <sv:property sv:name=""desc23"" sv:type=""String"">
         <sv:value>JBoss Transactions JTS (and JTA) and WS-T Source Code</sv:value>
       </sv:property>
@@ -123,17 +117,11 @@
       <sv:property sv:name=""license24"" sv:type=""String"">
         <sv:value>LGPL</sv:value>
       </sv:property>
-      <sv:property sv:name=""name21"" sv:type=""String"">
-        <sv:value>jbossts-jta-@filename@-src.zip</sv:value>
-      </sv:property>
-      <sv:property sv:name=""name22"" sv:type=""String"">
-        <sv:value>jbossts-jta-@filename@.zip</sv:value>
-      </sv:property>
       <sv:property sv:name=""name23"" sv:type=""String"">
-        <sv:value>jbossts-full-@filename@-src.zip</sv:value>
+        <sv:value>narayana-full-@tag@-src.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""name24"" sv:type=""String"">
-        <sv:value>jbossts-full-@filename@.zip</sv:value>
+        <sv:value>narayana-full-@tag@-bin.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""popup"" sv:type=""String"">
         <sv:value>true</sv:value>
@@ -168,20 +156,14 @@
       <sv:property sv:name=""showVersion"" sv:type=""String"">
         <sv:value>false</sv:value>
       </sv:property>
-      <sv:property sv:name=""size21"" sv:type=""String"">
-        <sv:value>@jta-src-length@</sv:value>
-      </sv:property>
-      <sv:property sv:name=""size22"" sv:type=""String"">
-        <sv:value>@full-src-length@</sv:value>
-      </sv:property>
       <sv:property sv:name=""size23"" sv:type=""String"">
-        <sv:value>@jta-bin-length@</sv:value>
+        <sv:value>@full-src-length@</sv:value>
       </sv:property>
       <sv:property sv:name=""size24"" sv:type=""String"">
         <sv:value>@full-bin-length@</sv:value>
       </sv:property>
       <sv:property sv:name=""tableTitle"" sv:type=""String"">
-        <sv:value>JBossTS @filename@ release</sv:value>
+        <sv:value>JBossTS @tag@ release</sv:value>
       </sv:property>
       <sv:property sv:name=""text21"" sv:type=""String"">
         <sv:value>Download</sv:value>
@@ -195,17 +177,11 @@
       <sv:property sv:name=""text24"" sv:type=""String"">
         <sv:value>Download</sv:value>
       </sv:property>
-      <sv:property sv:name=""url21"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/src/jbossts-jta-@filename@-src.zip</sv:value>
-      </sv:property>
-      <sv:property sv:name=""url22"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/binary/jbossts-jta-@filename@.zip</sv:value>
-      </sv:property>
       <sv:property sv:name=""url23"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/src/jbossts-full-@filename@-src.zip</sv:value>
+        <sv:value>http://www.jboss.org/jbosstm/downloads/@tag@/src/narayana-full-@tag@-src.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""url24"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/binary/jbossts-full-@filename@.zip</sv:value>
+        <sv:value>http://www.jboss.org/jbosstm/downloads/@tag@/binary/narayana-full-@tag@-bin.zip</sv:value>
       </sv:property>
       <sv:node sv:name=""MetaData"">
         <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">",2012-09-25T19:52:29Z,271
"@@ -890,9 +890,6 @@ public interface wstI18NLogger {
 	@LogMessage(level = WARN)
 	public void warn_recovery_participant_ba_BAParticipantRecoveryRecord_saveState_3(String arg0, @Cause() Throwable arg1);
 
-    @Message(id = 43228, value = ""Delay of {0} ms reached before changing state from {1} to something else"", format = MESSAGE_FORMAT)
-   	@LogMessage(level = WARN)
-   	public void warn_state_change_timeout(String arg0, String arg1);
 
     /*
         Allocate new messages directly above this notice.",2013-01-15T16:13:39Z,272
"@@ -526,7 +526,6 @@ private State waitForState(final State origState, final long delay)
                 final long remaining = end - System.currentTimeMillis() ;
                 if (remaining <= 0)
                 {
-                    WSTLogger.i18NLogger.warn_state_change_timeout(String.valueOf(delay), origState.toString());
                     break ;
                 }
                 try",2013-01-15T16:13:39Z,72
"@@ -183,7 +183,7 @@
                                 <!--
                                     Used in arquillian.xml
                                 -->
-                                <server.jvm.args>${jvm.args.byteman} ${jvm.args.memory} -Dorg.jboss.jbossts.xts.transport.transportTimeout=60000</server.jvm.args>
+                                <server.jvm.args>${jvm.args.byteman} ${jvm.args.memory}</server.jvm.args>
                             </systemPropertyVariables>
                         </configuration>
                     </plugin>",2013-01-15T16:13:39Z,41
"@@ -15,15 +15,18 @@ if [ """" == ""$JBOSS_BUILD_HOME"" ]; then
 fi
 
 if [ ""$2"" == ""--clean"" ] || [ ""$3"" == ""--clean"" ]; then
+    echo ""Cleaning""
     CLEAN=clean
 fi
 
 if [ ""$2"" == ""--xts"" ] || [ ""$3"" == ""--xts"" ]; then
+    echo ""Rebuilding XTS""
     cd ..
     ./build.sh -f ./XTS/pom.xml $CLEAN install -DskipTests || fail
     cd -
 fi
 
+
 mvn $CLEAN install || fail
 kill-jboss
 $JBOSS_BUILD_HOME/build.sh $CLEAN install -f $JBOSS_BUILD_HOME/xts/pom.xml -DskipTests || fail",2013-01-15T16:13:39Z,198
"@@ -55,7 +55,7 @@ public class ATBridgeImpl implements ATBridge {
     public void incrementCounter(int how_many) {
 
         SimpleEntity entity = getSimpleEntity();
-        entity.incrimentCounter(how_many);
+        entity.incrementCounter(how_many);
         em.merge(entity);
     }
 
@@ -81,7 +81,7 @@ private SimpleEntity getSimpleEntity() {
 
         SimpleEntity entity = em.find(SimpleEntity.class, ENTITY_ID);
         if (entity == null) {
-            entity = new SimpleEntity();
+            entity = new SimpleEntity(ENTITY_ID, 0);
             em.persist(entity);
         }
 ",2013-01-15T16:13:39Z,273
"@@ -1,6 +1,6 @@
 /*
  * JBoss, Home of Professional Open Source.
- * Copyright 2012, Red Hat, Inc., and individual contributors
+ * Copyright 2013, Red Hat, Inc., and individual contributors
  * as indicated by the @author tags. See the copyright.txt file in the
  * distribution for a full listing of individual contributors.
  *",2013-01-15T16:13:39Z,201
"@@ -22,7 +22,6 @@
 package org.jboss.narayana.txframework.functional.ws.at.bridged;
 
 import javax.persistence.Entity;
-import javax.persistence.GeneratedValue;
 import javax.persistence.Id;
 import java.io.Serializable;
 
@@ -41,8 +40,13 @@ public SimpleEntity() {
 
     }
 
+    public SimpleEntity(int id, int initialCounterValue) {
+
+        this.id = id;
+        this.bookingCount = initialCounterValue;
+    }
+
     @Id
-    @GeneratedValue
     public int getId() {
 
         return id;
@@ -63,8 +67,8 @@ public void setCounter(int counter) {
         this.bookingCount = counter;
     }
 
-    public void incrimentCounter(int how_many) {
+    public void incrementCounter(int howMany) {
 
-        setCounter(getCounter() + how_many);
+        setCounter(getCounter() + howMany);
     }
 }",2013-01-15T16:13:39Z,274
"@@ -87,26 +87,6 @@
                     <target>1.6</target>
                 </configuration>
             </plugin>
-            <plugin>
-                <groupId>org.apache.maven.plugins</groupId>
-                <artifactId>maven-surefire-plugin</artifactId>
-                <configuration>
-                    <skip>true</skip>
-                    <!-- Prevent test and server output appearing in console. -->
-                    <redirectTestOutputToFile>true</redirectTestOutputToFile>
-                    <enableAssertions>true</enableAssertions>
-                    <!-- Tests to execute. -->
-                    <includes>
-                        <include>**/*Tests.java</include>
-                    </includes>
-                    <!-- System properties passed to test cases -->
-                    <systemPropertyVariables>
-                        <!-- Used in arquillian.xml - arguments for all JBoss AS instances. -->
-                        <server.jvm.args>${general.server.jvm.args} ${byteman.server.jvm.args} ${jpda.server.jvm.args}</server.jvm.args>
-                        <java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
-                    </systemPropertyVariables>
-                </configuration>
-            </plugin>
         </plugins>
         <pluginManagement>
         	<plugins>
@@ -233,4 +213,58 @@
         </dependency>
 
     </dependencies>
+	<profiles>
+		<profile>
+			<id>default</id>
+			<activation>
+				<activeByDefault>true</activeByDefault>
+			</activation>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-surefire-plugin</artifactId>
+						<configuration>
+							<skip>true</skip>
+						</configuration>
+					</plugin>
+				</plugins>
+			</build>
+		</profile>
+		<profile>
+			<id>arq</id>
+			<activation>
+				<activeByDefault>false</activeByDefault>
+			</activation>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-surefire-plugin</artifactId>
+						<configuration>
+							<!-- Prevent test and server output appearing in console. -->
+							<redirectTestOutputToFile>true</redirectTestOutputToFile>
+							<enableAssertions>true</enableAssertions>
+							<!-- Tests to execute. -->
+							<includes>
+								<include>**/*Tests.java</include>
+							</includes>
+							<!-- System properties passed to test cases -->
+							<systemPropertyVariables>
+								<!-- Used in arquillian.xml - arguments for all JBoss AS instances. -->
+								<server.jvm.args>${general.server.jvm.args} ${byteman.server.jvm.args} ${jpda.server.jvm.args}</server.jvm.args>
+								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
+							</systemPropertyVariables>
+						</configuration>
+					</plugin>
+				</plugins>
+			</build>
+			<dependencies>
+				<dependency>
+					<groupId>org.jboss.as</groupId>
+					<artifactId>jboss-as-arquillian-container-managed</artifactId>
+					<version>${jboss-as.version}</version>
+					<scope>test</scope>
+				</dependency>
+			</dependencies>
+		</profile>
+	</profiles>
 </project>",2012-05-07T06:29:32Z,162
"@@ -0,0 +1,30 @@
+<?xml version=""1.0"" encoding=""UTF-8""?>
+<!-- JBoss, Home of Professional Open Source Copyright 2008, Red Hat Middleware LLC, and others contributors as indicated by the @authors tag. All rights reserved. See the copyright.txt in the distribution 
+	for a full listing of individual contributors. This copyrighted material is made available to anyone wishing to use, modify, copy, or redistribute it subject to the terms and conditions of the GNU Lesser 
+	General Public License, v. 2.1. This program is distributed in the hope that it will be useful, but WITHOUT A WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR 
+	PURPOSE. See the GNU Lesser General Public License for more details. You should have received a copy of the GNU Lesser General Public License, v.2.1 along with this distribution; if not, write to the Free 
+	Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA. -->
+<project xmlns=""http://maven.apache.org/POM/4.0.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
+         xsi:schemaLocation=""http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"">
+    <parent>
+        <groupId>org.jboss.narayana.xts</groupId>
+        <artifactId>xts-all</artifactId>
+        <version>5.0.0.M2-SNAPSHOT</version>
+        <relativePath>../pom.xml</relativePath>
+    </parent>
+    <modelVersion>4.0.0</modelVersion>
+    <artifactId>byteman_support</artifactId>
+    <packaging>jar</packaging>
+    <name>Reusable Byteman rules for xts</name>
+    
+    <dependencies>
+        <dependency>
+            <groupId>org.jboss.byteman</groupId>
+            <artifactId>byteman</artifactId>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.byteman</groupId>
+            <artifactId>byteman-submit</artifactId>
+        </dependency>
+    </dependencies>
+</project>",2012-12-07T10:03:43Z,275
"@@ -0,0 +1,53 @@
+package org.jboss.jbossts.xts.bytemanSupport;
+
+import org.jboss.byteman.agent.submit.Submit;
+
+import java.io.IOException;
+import java.io.InputStream;
+import java.net.URL;
+import java.util.ArrayList;
+import java.util.List;
+
+/**
+ * @Author paul.robinson@redhat.com 22/11/2012
+ */
+public class BMScript {
+
+    private static final Submit submit = new Submit();
+
+    public static void submit(String scriptResourcePath) {
+
+        try {
+            List<InputStream> streams = getScriptFromResource(scriptResourcePath);
+            submit.addRulesFromResources(streams);
+        } catch (Exception e) {
+            throw new RuntimeException(""Failed to submit Byteman script"", e);
+        }
+    }
+
+    public static void remove(String scriptResourcePath) {
+
+        try {
+            List<InputStream> streams = getScriptFromResource(scriptResourcePath);
+            submit.deleteRulesFromResources(streams);
+        } catch (Exception e) {
+            throw new RuntimeException(""Failed to remove Byteman script"", e);
+        }
+    }
+
+    private static List<InputStream> getScriptFromResource(String scriptResourcePath) {
+        URL resource = Thread.currentThread().getContextClassLoader().getResource(scriptResourcePath);
+        if (resource == null) {
+            throw new RuntimeException(""'"" + scriptResourcePath + ""' can't be found on the classpath"");
+        }
+
+        List<InputStream> streams = new ArrayList<InputStream>();
+        try {
+            streams.add(resource.openStream());
+        } catch (IOException e) {
+            throw new RuntimeException(""Unable to open stream at url location: "" + resource.toString());
+        }
+        return streams;
+    }
+
+}",2012-12-07T10:03:43Z,276
"@@ -0,0 +1,13 @@
+package org.jboss.jbossts.xts.bytemanSupport.participantCompletion;
+
+/**
+ * @Author paul.robinson@redhat.com 26/11/2012
+ */
+public class ParticipantCompletionCoordinatorRules {
+
+    public static String RESOURCE_PATH= ""org/jboss/jbossts/xts/bytemanSupport/participantCompletion/participant_completion_coordinator_rules.btm"";
+
+    public static void setParticipantCount(Integer participantCount) {
+        //Dummy method, detected by Byteman Rules
+    }
+}",2012-12-07T10:03:43Z,277
"@@ -0,0 +1,40 @@
+RULE create counter
+CLASS org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules
+METHOD setParticipantCount(Integer)
+BIND counter:Integer=$1
+IF TRUE
+DO debug(""participant_completion.counter.create: "" + counter),
+  deleteCounter(""completes""),
+  createCounter(""completes"", counter)
+ENDRULE
+
+RULE complete called
+CLASS com.arjuna.webservices11.wsba.sei.BusinessAgreementWithParticipantCompletionCoordinatorPortTypeImpl
+METHOD completedOperation(NotificationType)
+AT RETURN
+BIND NOTHING
+IF (debug(""participant_completion.counter.decrement"") AND decrementCounter(""completes"") == 0)
+DO debug(""participant_completion.called.waking""),
+   signalWake(""complete"", true),
+   debug(""participant_completion.called.donewake"")
+ENDRULE
+
+RULE close called
+CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
+METHOD closeOperation(NotificationType)
+BIND NOTHING
+IF TRUE
+DO debug(""participant_completion.close.waiting""),
+   waitFor(""complete""),
+   debug(""participant_completion.close.woken"")
+ENDRULE
+
+RULE cancel called
+CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
+METHOD cancelOperation(NotificationType)
+BIND NOTHING
+IF TRUE
+DO debug(""participant_completion.cancel.waiting""),
+   waitFor(""complete""),
+   debug(""participant_completion.cancel.woken"")
+ENDRULE
\ No newline at end of file",2012-12-07T10:03:43Z,278
"@@ -67,8 +67,6 @@ public void testClose()
             throw eouter;
         }
 
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
 
 	    assertTrue(p.passed());",2012-12-07T10:03:43Z,279
"@@ -68,8 +68,6 @@ public void testExit()
             throw eouter;
         }
 
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
 
 	    assertTrue(p.passed());",2012-12-07T10:03:43Z,280
"@@ -73,8 +73,6 @@ public void testMultiClose()
             }
             throw eouter;
         }
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
         assertTrue(p.passed());
     }",2012-12-07T10:03:43Z,281
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -20,11 +24,23 @@ public class CloseTest {
 	public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				Close.class,
-				DemoBusinessParticipant.class);
+				DemoBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
 		test.testClose();
 	}
 }",2012-12-07T10:03:43Z,282
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -20,11 +24,23 @@ public class CompensateTest {
 	public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				Compensate.class,
-				DemoBusinessParticipant.class);
+				DemoBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
 		test.testCompensate();
 	}
 }",2012-12-07T10:03:43Z,283
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -14,6 +18,7 @@
 
 @RunWith(Arquillian.class)
 public class MultiCloseTest {
+    
 	@Inject
 	MultiClose test;
 	
@@ -22,11 +27,23 @@ public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				MultiClose.class,
 				DemoBusinessParticipant.class,
-				FailureBusinessParticipant.class);
+				FailureBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
-	
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(2);
 		test.testMultiClose();
 	}
 }",2012-12-07T10:03:43Z,281
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -22,11 +26,23 @@ public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				MultiCompensate.class,
 				DemoBusinessParticipant.class,
-				FailureBusinessParticipant.class);
+				FailureBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(2);
 		test.testMultiCompensate();
 	}
 }",2012-12-07T10:03:43Z,284
"@@ -18,18 +18,51 @@
 	<description>localjunit tests for xts</description>
         <properties>
             <buildType>11</buildType>
-            <general.server.jvm.args>-Xms64m -Xmx1024m -XX:MaxPermSize=512m</general.server.jvm.args>
+            <general.server.jvm.args>-Xms64m -Xmx1024m -XX:MaxPermSize=512m
+                                     -Dorg.jboss.byteman.verbose
+                                    -Djboss.modules.system.pkgs=org.jboss.byteman
+                                    -Dorg.jboss.byteman.transform.all
+                                    -javaagent:${project.build.directory}/lib/byteman.jar=listener:true
+            </general.server.jvm.args>
             <ipv4.server.jvm.args></ipv4.server.jvm.args>
             <ipv6.server.jvm.args>-Djboss.bind.address=[::1] -Djboss.bind.address.management=[::1] -Djboss.bind.address.unsecure=[::1] -Djava.net.preferIPv4Stack=false -Djava.net.preferIPv6Addresses=true</ipv6.server.jvm.args>
             <server.debug.args>Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5006</server.debug.args>
         </properties>
 
+    <build>
+        <plugins>
+                <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                      <artifactId>maven-dependency-plugin</artifactId>
+                      <executions>
+                        <execution>
+                          <id>copy-dependencies</id>
+                          <phase>test-compile</phase>
+                          <goals>
+                            <goal>copy-dependencies</goal>
+                          </goals>
+                          <configuration>
+                              <stripVersion>true</stripVersion>
+                              <includeGroupIds>org.jboss.byteman</includeGroupIds>
+                            <outputDirectory>${project.build.directory}/lib</outputDirectory>
+                          </configuration>
+                        </execution>
+                      </executions>
+                </plugin>
+        </plugins>
+    </build>
+
 	<dependencies>
 		<dependency>
 			<groupId>org.jboss.narayana.xts</groupId>
 			<artifactId>jbossxts</artifactId>
 			<scope>provided</scope>
 		</dependency>
+		<dependency>
+			<groupId>org.jboss.narayana.xts</groupId>
+			<artifactId>byteman_support</artifactId>
+            <scope>test</scope>
+		</dependency>
 		<dependency>
 			<groupId>junit</groupId>
 			<artifactId>junit</artifactId>
@@ -67,6 +100,37 @@
 				</plugins>
 			</build>
 		</profile>
+        <profile>
+      			<id>arq-remote</id>
+      			<activation>
+      				<activeByDefault>false</activeByDefault>
+      			</activation>
+      			<build>
+      				<plugins>
+      					<plugin>
+      						<artifactId>maven-surefire-plugin</artifactId>
+      						<configuration>
+      							<forkMode>once</forkMode>
+      							<systemPropertyVariables combine.children=""append"">
+      							<!--
+      							  Used in arquillian.xml
+      							-->
+      							  <server.jvm.args>${general.server.jvm.args} ${ipv4.server.jvm.args}</server.jvm.args>
+                                    <node.address>127.0.0.1</node.address>
+      							</systemPropertyVariables>
+      						</configuration>
+      					</plugin>
+      				</plugins>
+      			</build>
+      			<dependencies>
+      				<dependency>
+      					<groupId>org.jboss.as</groupId>
+      					<artifactId>jboss-as-arquillian-container-remote</artifactId>
+      					<version>${jboss-as.version}</version>
+      					<scope>test</scope>
+      				</dependency>
+      			</dependencies>
+      		</profile>
 		<profile>
 			<id>arq</id>
 			<activation>
@@ -83,7 +147,7 @@
 							  Used in arquillian.xml
 							-->
 							  <server.jvm.args>${general.server.jvm.args} ${ipv4.server.jvm.args}</server.jvm.args>
-                                                          <node.address>127.0.0.1</node.address>
+                              <node.address>127.0.0.1</node.address>
 							</systemPropertyVariables>
 						</configuration>
 					</plugin>",2012-12-07T10:03:43Z,34
"@@ -37,6 +37,7 @@
     </plugins>
   </build>
   <modules>
+    <module>byteman_support</module>
     <module>WSAS</module>
     <module>WSAS/xts-test-servlet</module>
     <module>WS-C</module>",2012-12-07T10:03:43Z,285
"@@ -52,6 +52,14 @@
     </plugins>
   </build>
   <dependencies>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman-submit</artifactId>
+    </dependency>
     <!-- START TEST -->
     <dependency>
       <groupId>junit</groupId>",2012-12-07T10:03:43Z,286
"@@ -942,6 +942,11 @@
         <artifactId>service</artifactId>
         <version>${project.version}</version>
       </dependency>
+      <dependency>
+	<groupId>org.jboss.narayana.xts</groupId>
+	<artifactId>byteman_support</artifactId>
+        <version>${project.version}</version>
+      </dependency>
       <dependency>
         <groupId>org.jboss.narayana.rts</groupId>
         <artifactId>restat-web</artifactId>
@@ -973,27 +978,27 @@
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-install</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-submit</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-bmunit</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-dtest</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
   </dependencies>
   </dependencyManagement>",2012-12-07T10:03:43Z,39
"@@ -37,6 +37,24 @@
                     <skip>true</skip>
                 </configuration>
             </plugin>
+            <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-dependency-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>copy-dependencies</id>
+                      <phase>test-compile</phase>
+                      <goals>
+                        <goal>copy-dependencies</goal>
+                      </goals>
+                      <configuration>
+                          <stripVersion>true</stripVersion>
+                          <includeGroupIds>org.jboss.byteman</includeGroupIds>
+                        <outputDirectory>${project.build.directory}/lib</outputDirectory>
+                      </configuration>
+                    </execution>
+                  </executions>
+            </plugin>
         </plugins>
     </build>
 
@@ -112,6 +130,11 @@
                 </exclusion>
             </exclusions>
         </dependency>
+	<dependency>
+	   <groupId>org.jboss.narayana.xts</groupId>
+	   <artifactId>byteman_support</artifactId>
+           <scope>test</scope>
+	</dependency>
         <dependency>
             <groupId>org.jboss.narayana.rts</groupId>
             <artifactId>restat-util</artifactId>",2012-12-07T10:03:43Z,41
"@@ -5,6 +5,8 @@
 import com.arjuna.wst.TransactionRolledBackException;
 import junit.framework.Assert;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Close;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Compensate;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.ConfirmCompleted;
@@ -13,7 +15,9 @@
 import org.jboss.narayana.txframework.functional.common.SomeApplicationException;
 import org.jboss.narayana.txframework.functional.interfaces.BAParticipantCompletion;
 import org.junit.After;
+import org.junit.AfterClass;
 import org.junit.Before;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -27,6 +31,17 @@ public class BAParticipantCompletionTest extends BaseFunctionalTest
     UserBusinessActivity uba;
     BAParticipantCompletion client;
 
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
     @Before
     public void setupTest() throws Exception
     {
@@ -45,9 +60,10 @@ public void teardownTest() throws Exception
     @Test
     public void testAutoComplete() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+        
         uba.begin();
         client.saveDataAutoComplete();
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -57,9 +73,10 @@ public void testAutoComplete() throws Exception
     @Test
     public void testManualComplete() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
         uba.begin();
         client.saveDataManualComplete(ServiceCommand.COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -68,10 +85,11 @@ public void testManualComplete() throws Exception
     @Test
     public void testMultiInvoke() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+        
         uba.begin();
         client.saveDataManualComplete();
         client.saveDataManualComplete(ServiceCommand.COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -80,9 +98,10 @@ public void testMultiInvoke() throws Exception
     @Test
     public void testClientDrivenCompensate() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
         uba.begin();
         client.saveDataAutoComplete();
-        Thread.sleep(10000); //JBTM-1203
         uba.cancel();
 
         assertOrder(ConfirmCompleted.class, Compensate.class);
@@ -113,8 +132,8 @@ public void testCannotComplete() throws Exception
     {
         uba.begin();
         client.saveDataAutoComplete(ServiceCommand.CANNOT_COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
+        
         assertOrder();
     }
 ",2012-12-07T10:03:43Z,287
"@@ -16,6 +16,11 @@
       <!-- If you want to use the JBOSS_HOME environment variable, just delete the jbossHome property -->
       <configuration>
 			<property name=""serverConfig"">standalone-xts.xml</property>
+            <property name=""javaVmArguments"">-Dorg.jboss.byteman.verbose
+                                    -Djboss.modules.system.pkgs=org.jboss.byteman
+                                    -Dorg.jboss.byteman.transform.all
+                                    -javaagent:../lib/byteman.jar=listener:true
+            </property>
       </configuration>
    </container>
 ",2012-12-07T10:03:43Z,129
"@@ -144,6 +144,17 @@
         <id>release</id>
         <build>
           <plugins>
+              <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                <artifactId>maven-install-plugin</artifactId>
+                <executions>
+                  <execution>
+                    <id>default-install</id>
+                    <phase>install</phase>
+                  </execution>
+                </executions>
+                <inherited>false</inherited>
+              </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,237
"@@ -42,4 +42,24 @@
     <module>txoj</module>
     <module>arjunacore</module>
   </modules>
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,288
"@@ -114,4 +114,24 @@
       <scope>test</scope>
     </dependency>
   </dependencies>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,289
"@@ -160,6 +160,17 @@
         <id>release</id>
         <build>
           <plugins>
+              <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                <artifactId>maven-install-plugin</artifactId>
+                <executions>
+                  <execution>
+                    <id>default-install</id>
+                    <phase>install</phase>
+                  </execution>
+                </executions>
+                <inherited>false</inherited>
+              </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,238
"@@ -41,4 +41,24 @@
     <module>jdbc</module>
     <module>narayana-jta</module>
   </modules>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,223
"@@ -61,18 +61,22 @@
     <dependency>
       <groupId>org.jboss.narayana.jta</groupId>
       <artifactId>jta</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss</groupId>
@@ -146,6 +150,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,69
"@@ -167,10 +167,22 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
@@ -179,6 +191,12 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>tanukisoft</groupId>
@@ -201,6 +219,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,29
"@@ -167,14 +167,32 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>tanukisoft</groupId>
@@ -221,6 +239,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,30
"@@ -45,4 +45,24 @@
     <module>narayana-jts-idlj</module>
     <module>integration</module>
   </modules>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,290
"@@ -27,4 +27,24 @@
             <artifactId>byteman-submit</artifactId>
         </dependency>
     </dependencies>
+    <profiles>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                    <plugin>
+                        <groupId>org.apache.maven.plugins</groupId>
+                        <artifactId>maven-install-plugin</artifactId>
+                        <executions>
+                            <execution>
+                                <id>default-install</id>
+                                <phase>install</phase>
+                            </execution>
+                        </executions>
+                        <inherited>false</inherited>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,275
"@@ -215,6 +215,17 @@
         <id>release</id>
         <build>
           <plugins>
+            <plugin>
+              <groupId>org.apache.maven.plugins</groupId>
+              <artifactId>maven-install-plugin</artifactId>
+              <executions>
+                <execution>
+                  <id>default-install</id>
+                  <phase>install</phase>
+                </execution>
+              </executions>
+              <inherited>false</inherited>
+            </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,33
"@@ -29,6 +29,16 @@
     </properties>
 
     <build>
+        <pluginManagement>
+            <plugins>
+                <plugin>
+                    <artifactId>maven-surefire-plugin</artifactId>
+                    <configuration>
+                        <skip>true</skip>
+                    </configuration>
+                </plugin>
+            </plugins>
+        </pluginManagement>
         <plugins>
             <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
@@ -94,26 +104,6 @@
         </dependency>
     </dependencies>
     <profiles>
-        <!-- The default profile skips all tests, though you can tune it
-            to run just unit tests based on a custom pattern -->
-        <!-- Seperate profiles are provided for running all tests, including
-            Arquillian tests that execute in the specified container -->
-        <profile>
-            <id>default</id>
-            <activation>
-                <activeByDefault>true</activeByDefault>
-            </activation>
-            <build>
-                <plugins>
-                    <plugin>
-                        <artifactId>maven-surefire-plugin</artifactId>
-                        <configuration>
-                            <skip>true</skip>
-                        </configuration>
-                    </plugin>
-                </plugins>
-            </build>
-        </profile>
         <profile>
             <id>arq-remote</id>
             <activation>
@@ -132,6 +122,7 @@
                                 <server.jvm.args>${jvm.args.memory} ${ipv4.server.jvm.args}</server.jvm.args>
                                 <node.address>127.0.0.1</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>
@@ -165,6 +156,7 @@
                                 </server.jvm.args>
                                 <node.address>127.0.0.1</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>
@@ -199,6 +191,7 @@
                                 </server.jvm.args>
                                 <node.address>[::1]</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>",2013-01-22T15:55:37Z,34
"@@ -50,4 +50,24 @@
     <module>jbossxts</module>
     <module>localjunit</module>
   </modules>
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,285
"@@ -69,4 +69,25 @@
     </dependency>
     <!-- END TEST -->
   </dependencies>
+
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,286
"@@ -1099,5 +1099,37 @@
         <module>STM</module>
       </modules>
     </profile>
+    <profile>
+      <id>release</id>
+      <build>
+          <pluginManagement>
+              <plugins>
+                  <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                    <artifactId>maven-install-plugin</artifactId>
+                    <executions>
+                      <execution>
+                        <id>default-install</id>
+                        <phase>none</phase>
+                      </execution>
+                    </executions>
+                  </plugin>
+              </plugins>
+          </pluginManagement>
+          <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
+          </plugins>
+      </build>
+    </profile>
   </profiles>
 </project>",2013-01-22T15:55:37Z,39
"@@ -51,4 +51,24 @@ Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
   <properties>
     <version.org.jboss.resteasy>2.0.0.GA</version.org.jboss.resteasy>
   </properties>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,291
"@@ -171,4 +171,24 @@
       </plugin>
     </plugins>
   </build>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                  <plugin>
+                      <groupId>org.apache.maven.plugins</groupId>
+                      <artifactId>maven-install-plugin</artifactId>
+                      <executions>
+                          <execution>
+                              <id>default-install</id>
+                              <phase>install</phase>
+                          </execution>
+                      </executions>
+                      <inherited>false</inherited>
+                  </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,292
"@@ -94,6 +94,13 @@
                     <target>1.6</target>
                 </configuration>
             </plugin>
+            <plugin>
+                <artifactId>maven-surefire-plugin</artifactId>
+                <version>2.11</version>
+                <configuration>
+                    <skip>true</skip>
+                </configuration>
+            </plugin>
         </plugins>
         <pluginManagement>
         	<plugins>
@@ -221,23 +228,6 @@
 
     </dependencies>
 	<profiles>
-		<profile>
-			<id>default</id>
-			<activation>
-				<activeByDefault>true</activeByDefault>
-			</activation>
-			<build>
-				<plugins>
-					<plugin>
-						<artifactId>maven-surefire-plugin</artifactId>
-						<version>2.11</version>
-						<configuration>
-							<skip>true</skip>
-						</configuration>
-					</plugin>
-				</plugins>
-			</build>
-		</profile>
 		<profile>
 			<id>arq</id>
 			<activation>
@@ -263,6 +253,7 @@
 								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
 								<node.address>localhost</node.address>
 							</systemPropertyVariables>
+                            <skip>false</skip>
 						</configuration>
 					</plugin>
 				</plugins>
@@ -305,6 +296,7 @@
 								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
 								<node.address>[::1]</node.address>
 							</systemPropertyVariables>
+                            <skip>false</skip>
 						</configuration>
 					</plugin>
 				</plugins>
@@ -333,5 +325,23 @@
 				</dependency>
 			</dependencies>
 		</profile>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                  <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                    <artifactId>maven-install-plugin</artifactId>
+                    <executions>
+                      <execution>
+                        <id>default-install</id>
+                        <phase>install</phase>
+                      </execution>
+                    </executions>
+                    <inherited>false</inherited>
+                  </plugin>
+                </plugins>
+            </build>
+        </profile>
 	</profiles>
 </project>",2013-01-22T15:55:37Z,162
"@@ -214,6 +214,24 @@
                 </dependency>
             </dependencies>
         </profile>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                    <plugin>
+                        <groupId>org.apache.maven.plugins</groupId>
+                        <artifactId>maven-install-plugin</artifactId>
+                        <executions>
+                            <execution>
+                                <id>default-install</id>
+                                <phase>install</phase>
+                            </execution>
+                        </executions>
+                        <inherited>false</inherited>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
     </profiles>
 
 </project>",2013-01-22T15:55:37Z,41
"@@ -144,6 +144,17 @@
         <id>release</id>
         <build>
           <plugins>
+              <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                <artifactId>maven-install-plugin</artifactId>
+                <executions>
+                  <execution>
+                    <id>default-install</id>
+                    <phase>install</phase>
+                  </execution>
+                </executions>
+                <inherited>false</inherited>
+              </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,237
"@@ -42,4 +42,24 @@
     <module>txoj</module>
     <module>arjunacore</module>
   </modules>
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,288
"@@ -114,4 +114,24 @@
       <scope>test</scope>
     </dependency>
   </dependencies>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,289
"@@ -160,6 +160,17 @@
         <id>release</id>
         <build>
           <plugins>
+              <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                <artifactId>maven-install-plugin</artifactId>
+                <executions>
+                  <execution>
+                    <id>default-install</id>
+                    <phase>install</phase>
+                  </execution>
+                </executions>
+                <inherited>false</inherited>
+              </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,238
"@@ -41,4 +41,24 @@
     <module>jdbc</module>
     <module>narayana-jta</module>
   </modules>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,223
"@@ -61,18 +61,22 @@
     <dependency>
       <groupId>org.jboss.narayana.jta</groupId>
       <artifactId>jta</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+      <scope>provided</scope>
     </dependency>
     <dependency>
       <groupId>org.jboss</groupId>
@@ -146,6 +150,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,69
"@@ -167,10 +167,22 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
@@ -179,6 +191,12 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>jacorb-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>tanukisoft</groupId>
@@ -201,6 +219,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,29
"@@ -167,14 +167,32 @@
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>orbportability</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jts</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>org.jboss.narayana.jts</groupId>
       <artifactId>jtax</artifactId>
+        <exclusions>
+          <exclusion>
+            <groupId>org.jboss.narayana.jts</groupId>
+            <artifactId>idlj-idl</artifactId>
+          </exclusion>
+        </exclusions>
     </dependency>
     <dependency>
       <groupId>tanukisoft</groupId>
@@ -221,6 +239,17 @@
         <id>release</id>
         <build>
           <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,30
"@@ -45,4 +45,24 @@
     <module>narayana-jts-idlj</module>
     <module>integration</module>
   </modules>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,290
"@@ -27,4 +27,24 @@
             <artifactId>byteman-submit</artifactId>
         </dependency>
     </dependencies>
+    <profiles>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                    <plugin>
+                        <groupId>org.apache.maven.plugins</groupId>
+                        <artifactId>maven-install-plugin</artifactId>
+                        <executions>
+                            <execution>
+                                <id>default-install</id>
+                                <phase>install</phase>
+                            </execution>
+                        </executions>
+                        <inherited>false</inherited>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,275
"@@ -215,6 +215,17 @@
         <id>release</id>
         <build>
           <plugins>
+            <plugin>
+              <groupId>org.apache.maven.plugins</groupId>
+              <artifactId>maven-install-plugin</artifactId>
+              <executions>
+                <execution>
+                  <id>default-install</id>
+                  <phase>install</phase>
+                </execution>
+              </executions>
+              <inherited>false</inherited>
+            </plugin>
 	      <plugin>
         	<groupId>org.codehaus.mojo</groupId>
 	        <artifactId>buildnumber-maven-plugin</artifactId>",2013-01-22T15:55:37Z,33
"@@ -29,6 +29,16 @@
     </properties>
 
     <build>
+        <pluginManagement>
+            <plugins>
+                <plugin>
+                    <artifactId>maven-surefire-plugin</artifactId>
+                    <configuration>
+                        <skip>true</skip>
+                    </configuration>
+                </plugin>
+            </plugins>
+        </pluginManagement>
         <plugins>
             <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
@@ -94,26 +104,6 @@
         </dependency>
     </dependencies>
     <profiles>
-        <!-- The default profile skips all tests, though you can tune it
-            to run just unit tests based on a custom pattern -->
-        <!-- Seperate profiles are provided for running all tests, including
-            Arquillian tests that execute in the specified container -->
-        <profile>
-            <id>default</id>
-            <activation>
-                <activeByDefault>true</activeByDefault>
-            </activation>
-            <build>
-                <plugins>
-                    <plugin>
-                        <artifactId>maven-surefire-plugin</artifactId>
-                        <configuration>
-                            <skip>true</skip>
-                        </configuration>
-                    </plugin>
-                </plugins>
-            </build>
-        </profile>
         <profile>
             <id>arq-remote</id>
             <activation>
@@ -132,6 +122,7 @@
                                 <server.jvm.args>${jvm.args.memory} ${ipv4.server.jvm.args}</server.jvm.args>
                                 <node.address>127.0.0.1</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>
@@ -165,6 +156,7 @@
                                 </server.jvm.args>
                                 <node.address>127.0.0.1</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>
@@ -199,6 +191,7 @@
                                 </server.jvm.args>
                                 <node.address>[::1]</node.address>
                             </systemPropertyVariables>
+                            <skip>false</skip>
                         </configuration>
                     </plugin>
                 </plugins>",2013-01-22T15:55:37Z,34
"@@ -50,4 +50,24 @@
     <module>jbossxts</module>
     <module>localjunit</module>
   </modules>
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,285
"@@ -69,4 +69,25 @@
     </dependency>
     <!-- END TEST -->
   </dependencies>
+
+    <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+    </profiles>
 </project>",2013-01-22T15:55:37Z,286
"@@ -1099,5 +1099,37 @@
         <module>STM</module>
       </modules>
     </profile>
+    <profile>
+      <id>release</id>
+      <build>
+          <pluginManagement>
+              <plugins>
+                  <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                    <artifactId>maven-install-plugin</artifactId>
+                    <executions>
+                      <execution>
+                        <id>default-install</id>
+                        <phase>none</phase>
+                      </execution>
+                    </executions>
+                  </plugin>
+              </plugins>
+          </pluginManagement>
+          <plugins>
+          <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-install-plugin</artifactId>
+            <executions>
+              <execution>
+                <id>default-install</id>
+                <phase>install</phase>
+              </execution>
+            </executions>
+            <inherited>false</inherited>
+          </plugin>
+          </plugins>
+      </build>
+    </profile>
   </profiles>
 </project>",2013-01-22T15:55:37Z,39
"@@ -51,4 +51,24 @@ Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
   <properties>
     <version.org.jboss.resteasy>2.0.0.GA</version.org.jboss.resteasy>
   </properties>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                <plugin>
+                  <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-install-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>default-install</id>
+                      <phase>install</phase>
+                    </execution>
+                  </executions>
+                  <inherited>false</inherited>
+                </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,291
"@@ -171,4 +171,24 @@
       </plugin>
     </plugins>
   </build>
+  <profiles>
+      <profile>
+          <id>release</id>
+          <build>
+              <plugins>
+                  <plugin>
+                      <groupId>org.apache.maven.plugins</groupId>
+                      <artifactId>maven-install-plugin</artifactId>
+                      <executions>
+                          <execution>
+                              <id>default-install</id>
+                              <phase>install</phase>
+                          </execution>
+                      </executions>
+                      <inherited>false</inherited>
+                  </plugin>
+              </plugins>
+          </build>
+      </profile>
+  </profiles>
 </project>",2013-01-22T15:55:37Z,292
"@@ -94,6 +94,13 @@
                     <target>1.6</target>
                 </configuration>
             </plugin>
+            <plugin>
+                <artifactId>maven-surefire-plugin</artifactId>
+                <version>2.11</version>
+                <configuration>
+                    <skip>true</skip>
+                </configuration>
+            </plugin>
         </plugins>
         <pluginManagement>
         	<plugins>
@@ -221,23 +228,6 @@
 
     </dependencies>
 	<profiles>
-		<profile>
-			<id>default</id>
-			<activation>
-				<activeByDefault>true</activeByDefault>
-			</activation>
-			<build>
-				<plugins>
-					<plugin>
-						<artifactId>maven-surefire-plugin</artifactId>
-						<version>2.11</version>
-						<configuration>
-							<skip>true</skip>
-						</configuration>
-					</plugin>
-				</plugins>
-			</build>
-		</profile>
 		<profile>
 			<id>arq</id>
 			<activation>
@@ -263,6 +253,7 @@
 								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
 								<node.address>localhost</node.address>
 							</systemPropertyVariables>
+                            <skip>false</skip>
 						</configuration>
 					</plugin>
 				</plugins>
@@ -305,6 +296,7 @@
 								<java.rmi.server.codebase>file://target/test-classes/</java.rmi.server.codebase>
 								<node.address>[::1]</node.address>
 							</systemPropertyVariables>
+                            <skip>false</skip>
 						</configuration>
 					</plugin>
 				</plugins>
@@ -333,5 +325,23 @@
 				</dependency>
 			</dependencies>
 		</profile>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                  <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                    <artifactId>maven-install-plugin</artifactId>
+                    <executions>
+                      <execution>
+                        <id>default-install</id>
+                        <phase>install</phase>
+                      </execution>
+                    </executions>
+                    <inherited>false</inherited>
+                  </plugin>
+                </plugins>
+            </build>
+        </profile>
 	</profiles>
 </project>",2013-01-22T15:55:37Z,162
"@@ -214,6 +214,24 @@
                 </dependency>
             </dependencies>
         </profile>
+        <profile>
+            <id>release</id>
+            <build>
+                <plugins>
+                    <plugin>
+                        <groupId>org.apache.maven.plugins</groupId>
+                        <artifactId>maven-install-plugin</artifactId>
+                        <executions>
+                            <execution>
+                                <id>default-install</id>
+                                <phase>install</phase>
+                            </execution>
+                        </executions>
+                        <inherited>false</inherited>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
     </profiles>
 
 </project>",2013-01-22T15:55:37Z,41
"@@ -69,13 +69,12 @@
     <property name=""version"" value=""4.17.2.Final-SNAPSHOT""/>
 -->
   <!-- a working directory for the process. Can contain output from previous releases if you like to keep them archived locally. -->
-  <!--property name=""workdir"" location=""/tmp/narayana_releases""/-->
+  <property name=""workdir"" location=""/tmp/narayana_releases""/>
   <!-- where to get the source -->
-  <property name=""svnbase"" value=""https://svn.jboss.org/repos/labs/labs/jbosstm/tags""/>
+  <property name=""gitbase"" value=""https://github.com/jbosstm""/>
   <!-- The tag as it appears under svnbase -->
-  <property name=""tag"" value=""5_0_0_M1""/>
-  <!-- The file name base for the user downloadable files. Derive it from the tag -->
-  <property name=""version"" value=""5.0.0.M1""/>
+  <property name=""pageName"" value=""4_17_0_Final""/>
+  <property name=""tag"" value=""4.17.0.Final""/>
   <!-- which uber jar to use -->
   <property name=""orb"" value=""jacorb""/>
   <!-- the location the JBossTS web site content is copied to -->
@@ -100,40 +99,116 @@
         </not>
       </condition>
     </fail>
-    <fail message=""You must not already have a local maven cached repository to do a release build"">
-      <condition>
-        <available file=""repository"" type=""dir""/>
-      </condition>
-    </fail>
     <fail message=""You cannot perform a build without cleaning the old version out"">
       <condition>
         <available file=""${workdir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <mkdir dir=""${workdir}""/>
-    <!-- pull the source code from svn -->
-    <exec executable=""svn"" dir=""${workdir}"">
+    <!-- pull the source code from git -->
+    <exec executable=""git"" dir=""${workdir}"">
+      <arg value=""clone""/>
+      <arg value=""${gitbase}/narayana.git""/>
+      <arg value=""${tag}""/>
+    </exec>
+    <exec executable=""git"" dir=""${workdir}/${tag}"">
       <arg value=""checkout""/>
-      <arg value=""${svnbase}/${tag}""/>
+      <arg value=""${tag}""/>
     </exec>
   </target>
   <target name=""dist"" depends=""dist-init"" description=""build the end-user release bundles (src and binary)"">
     <!-- build the binary releases -->
     <exec dir=""${workdir}/${tag}"" executable=""tools/maven/bin/mvn"" failonerror=""true"">
       <arg line=""clean -gs tools/maven/conf/settings.xml -Demma.jar.location=${user.dir}/ext/emma.jar -Dorson.jar.location=${user.dir}/ext/orson-0.5.0.jar""/>
     </exec>
-    <!-- package the JTA only src tree (no JTS, XTS, txbridge, RTS) -->
-    <delete file=""${workdir}/narayana-jta-${version}-src.zip""/>
-    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-jta-${version}-src.zip"" includes=""${tag}/**"" excludes=""${tag}/ArjunaJTS/**, ${tag}/XTS/** ${tag}/txbridge/**, ${tag}/rest-tx/**, ${tag}/repository/**""/>
     <!-- package the full source release (all src tree) -->
-    <delete file=""${workdir}/narayana-full-${version}-src.zip""/>
-    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-full-${version}-src.zip"" includes=""${tag}/**"" excludes=""${tag}/repository/**""/>
+    <delete file=""${workdir}/narayana-full-${tag}-src.zip""/>
+    <zip basedir=""${workdir}"" destfile=""${workdir}/narayana-full-${tag}-src.zip"" includes=""${tag}/**""/>
     <!-- build the binary releases -->
     <exec dir=""${workdir}/${tag}"" executable=""tools/maven/bin/mvn"" failonerror=""true"">
       <arg line=""deploy -DskipTests -gs tools/maven/conf/settings.xml -Demma.jar.location=${user.dir}/ext/emma.jar -Dorson.jar.location=${user.dir}/ext/orson-0.5.0.jar""/>
     </exec>
   </target>
   <!-- copy the release into the downloads dir tree (http://www.jboss.org/jbosstm web site content) -->
+  <target name=""docs"">
+    <fail>
+      <condition>
+        <not>
+          <available file=""${downloads.dir}"" type=""dir""/>
+        </not>
+      </condition>
+    </fail>
+    <fail>
+      <condition>
+        <not>
+          <available file=""${docs.dir}"" type=""dir""/>
+        </not>
+      </condition>
+    </fail>
+
+    <exec executable=""git"" dir=""${workdir}"">
+      <arg value=""clone""/>
+      <arg value=""${gitbase}/documentation.git""/>
+      <arg value=""${tag}-docs""/>
+    </exec>
+    <exec executable=""git"" dir=""${workdir}/${tag}-docs"">
+      <arg value=""checkout""/>
+      <arg value=""${tag}""/>
+    </exec>
+    <exec dir=""${workdir}/${tag}-docs"" executable=""mvn"" failonerror=""true"">
+      <arg line=""install""/>
+    </exec>
+    <delete dir=""tmp-docs-dir-docs""/>
+    <mkdir dir=""tmp-docs-dir-docs""/>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-orbportability_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/orbportability_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-quick_start_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/quick_start_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-administration_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/administration_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jts-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTS/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/arjunacore-failure_recovery_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaCore/docs/failure_recovery_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/arjunacore-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaCore/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-quick_start_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/quick_start_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-installation_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/installation_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-administration_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/administration_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/narayana-jta-development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/ArjunaJTA/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/xts-administration_and_development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/XTS/docs/administration_and_development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/failure_recovery_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/failure_recovery_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/development_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/development_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/transactions_overview_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/transactions_overview_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <copy todir=""tmp-docs-dir-docs/guides/txbridge_guide"">
+      <fileset dir=""${workdir}/${tag}-docs/docs/txbridge_guide/target/docbook/publish/en-US/html_single""/>
+    </copy>
+    <move todir=""${docs.dir}/${tag}"" verbose=""true"">
+      <fileset dir=""tmp-docs-dir-docs""/>
+    </move>
+  </target> 
   <target name=""downloads"" description=""copy release bundles to JBossTS web site content"">
     <fail>
       <condition>
@@ -144,7 +219,7 @@
     </fail>
     <fail>
       <condition>
-        <available file=""${downloads.dir}/${version}"" type=""dir""/>
+        <available file=""${downloads.dir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <fail>
@@ -156,7 +231,7 @@
     </fail>
     <fail>
       <condition>
-        <available file=""${docs.dir}/${version}"" type=""dir""/>
+        <available file=""${docs.dir}/${tag}"" type=""dir""/>
       </condition>
     </fail>
     <delete dir=""tmp-downloads-dir""/>
@@ -167,91 +242,37 @@
     <delete dir=""tmp-docs-dir""/>
     <mkdir dir=""tmp-docs-dir""/>
     <copy todir=""tmp-downloads-dir/src"">
-      <fileset dir=""${workdir}"" includes=""narayana-*-${version}-src.zip""/>
+      <fileset dir=""${workdir}"" includes=""narayana-*-${tag}-src.zip""/>
     </copy>
     <copy todir=""tmp-downloads-dir/binary"">
-      <fileset dir=""${workdir}/${tag}/narayana-full/target/"" includes=""narayana-full-${version}-bin.zip""/>
+      <fileset dir=""${workdir}/${tag}/narayana-full/target/"" includes=""narayana-full-${tag}-bin.zip""/>
     </copy>
     <copy todir=""tmp-downloads-dir/idl"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/jts/idl/arjuna"">
+      <fileset dir=""${workdir}/${tag}/ArjunaJTS/idl/src/main/idl/arjuna"">
         <include name=""ArjunaOTS.idl""/>
       </fileset>
     </copy>
     <copy todir=""tmp-downloads-dir/idl"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/jts/idl/omg"">
+      <fileset dir=""${workdir}/${tag}/ArjunaJTS/idl/src/main/idl/omg"">
         <include name=""CosTransactions.idl""/>
         <include name=""XA.idl""/>
       </fileset>
     </copy>
-    <copy file=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/narayana-jts-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/jta""/>
-    <copy file=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/jts""/>
-    <copy file=""${workdir}/${tag}/rest-tx/tx/target/rest-tx-api-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/rts""/>
-    <copy file=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${version}-javadoc.jar"" todir=""tmp-downloads-dir/api/xts""/>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-orbportability_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/orbportability_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-quick_start_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/quick_start_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-administration_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/administration_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jts-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTS/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/arjunacore-failure_recovery_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaCore/docs/failure_recovery_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/arjunacore-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaCore/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-quick_start_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/quick_start_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-installation_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/installation_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-administration_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/administration_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/narayana-jta-development_guide"">
-      <fileset dir=""${workdir}/${tag}/ArjunaJTA/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/xts-administration_and_development_guide"">
-      <fileset dir=""${workdir}/${tag}/XTS/docs/administration_and_development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/failure_recovery_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/failure_recovery_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/release_notes"">
-      <fileset dir=""${workdir}/${tag}/docs/release_notes/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/development_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/development_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/transactions_overview_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/transactions_overview_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <copy todir=""tmp-docs-dir/guides/txbridge_guide"">
-      <fileset dir=""${workdir}/${tag}/docs/txbridge_guide/target/docbook/publish/en-US/html""/>
-    </copy>
-    <unzip src=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/narayana-jts-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/jts""/>
-    <unzip src=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/jta""/>
-    <unzip src=""${workdir}/${tag}/rest-tx/tx/target/rest-tx-api-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/rts""/>
-    <unzip src=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${version}-javadoc.jar"" dest=""tmp-docs-dir/api/xts""/>
-    <move todir=""${downloads.dir}/${version}"" verbose=""true"">
+    <copy file=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/jbossjts-jacorb-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/jts""/>
+    <copy file=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/jta""/>
+    <copy file=""${workdir}/${tag}/rest-tx/tx/target/restat-api-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/rts""/>
+    <copy file=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${tag}-javadoc.jar"" todir=""tmp-downloads-dir/api/xts""/>
+    <unzip src=""${workdir}/${tag}/ArjunaJTS/narayana-jts-${orb}/target/jbossjts-jacorb-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/jts""/>
+    <unzip src=""${workdir}/${tag}/ArjunaJTA/narayana-jta/target/narayana-jta-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/jta""/>
+    <unzip src=""${workdir}/${tag}/rest-tx/tx/target/restat-api-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/rts""/>
+    <unzip src=""${workdir}/${tag}/XTS/jbossxts/target/jbossxts-${tag}-javadoc.jar"" dest=""tmp-docs-dir/api/xts""/>
+    <move todir=""${downloads.dir}/${tag}"" verbose=""true"">
       <fileset dir=""tmp-downloads-dir""/>
     </move>
-    <move todir=""${docs.dir}/${version}"" verbose=""true"">
+    <move todir=""${docs.dir}/${tag}"" verbose=""true"">
       <fileset dir=""tmp-docs-dir""/>
     </move>
   </target>
-  <!-- copy the release artifacts to the maven repository -->
-  <target name=""mvn-repository"" description=""copy the release artifacts to the maven repository"">
-    <!-- xts -->
-    <mvn-artifact.macro artifact=""jbossxts-tests"" packaging=""zip"" dir=""${workdir}/build/${tag}/xts/tests""/>
-    <mvn-artifact.macro artifact=""jbossxts-interop-tests"" packaging=""zip"" dir=""${workdir}/build/${tag}/xts/interop-tests""/>
-  </target>
   <!-- magnolia (the cms that sits behind jboss.org/jbosstm pages) is a pain. This target generates
      xml for /downloads/somerelease.xml pages to ease some of the pain in publishing an upload
       right click jbosstm/downloads node, import from xml, then right click new node and activate.
@@ -261,20 +282,24 @@
     <exec executable=""date"" outputproperty=""date"">
       <arg line=""+'%FT%H:%M:%S.000Z'""/>
     </exec>
-    <length property=""jta-src-length"" file=""${workdir}/jbossts-jta-${version}-src.zip""/>
-    <length property=""full-src-length"" file=""${workdir}/jbossts-full-${version}-src.zip""/>
-    <length property=""jta-bin-length"" file=""${workdir}/jbossts-jta-${version}.zip""/>
-    <length property=""full-bin-length"" file=""${workdir}/jbossts-full-${version}.zip""/>
-    <copy file=""magnolia-release-download-page-template.xml"" tofile=""${workdir}/website.jbosstm.downloads.${version}.xml"" filtering=""true"" overwrite=""true"">
+    <length property=""full-src-length"" file=""${workdir}/narayana-full-${tag}-src.zip""/>
+    <length property=""full-bin-length"" file=""${workdir}/${tag}/narayana-full/target/narayana-full-${tag}-bin.zip""/>
+    <copy file=""magnolia-release-download-page-template.xml"" tofile=""${workdir}/website.jbosstm.downloads.${pageName}.xml"" filtering=""true"" overwrite=""true"">
       <filterset>
+        <filter token=""pageName"" value=""${pageName}""/>
         <filter token=""tag"" value=""${tag}""/>
-        <filter token=""version"" value=""${version}""/>
+        <filter token=""version"" value=""${tag}""/>
         <filter token=""date"" value=""${date}""/>
-        <filter token=""jta-src-length"" value=""${jta-src-length}""/>
         <filter token=""full-src-length"" value=""${full-src-length}""/>
-        <filter token=""jta-bin-length"" value=""${jta-bin-length}""/>
         <filter token=""full-bin-length"" value=""${full-bin-length}""/>
       </filterset>
     </copy>
+    <copy file=""magnolia-release-documentation-page-template.xml"" tofile=""${workdir}/website.jbosstm.documentation.${pageName}.xml"" filtering=""true"" overwrite=""true"">
+      <filterset>
+        <filter token=""pageName"" value=""${pageName}""/>
+        <filter token=""tag"" value=""${tag}""/>
+        <filter token=""date"" value=""${date}""/>
+      </filterset>
+    </copy>
   </target>
 </project>",2012-10-16T15:39:17Z,269
"@@ -0,0 +1,237 @@
+<?xml version=""1.0"" encoding=""UTF-8""?>
+<sv:node sv:name=""@pageName@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
+  <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+    <sv:value>mgnl:content</sv:value>
+  </sv:property>
+  <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+    <sv:value>mix:lockable</sv:value>
+  </sv:property>
+  <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+    <sv:value>14f62a08-1dfe-41b3-bdce-61ce87b8129d</sv:value>
+  </sv:property>
+  <sv:property sv:name=""enableRSS"" sv:type=""String"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""hideInNav"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""menubar"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaCache"" sv:type=""String"">
+    <sv:value>disable</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaExpire"" sv:type=""String"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""metaRobots"" sv:type=""String"">
+    <sv:value>all</sv:value>
+  </sv:property>
+  <sv:property sv:name=""redirectWindow"" sv:type=""Boolean"">
+    <sv:value>false</sv:value>
+  </sv:property>
+  <sv:property sv:name=""title"" sv:type=""String"">
+    <sv:value>Narayana Documentation @tag@</sv:value>
+  </sv:property>
+  <sv:property sv:name=""useTitle"" sv:type=""Boolean"">
+    <sv:value>true</sv:value>
+  </sv:property>
+  <sv:node sv:name=""MetaData"">
+    <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+      <sv:value>mgnl:metaData</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+      <sv:value>true</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+      <sv:value>superuser</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+      <sv:value>tm</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:comment"" sv:type=""String"">
+      <sv:value>Made references to git and subversion</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+      <sv:value>2009-12-10T11:47:09.824-05:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+      <sv:value>2012-04-27T05:09:36.605-04:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+      <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+    </sv:property>
+    <sv:property sv:name=""mgnl:template"" sv:type=""String"">
+      <sv:value>jbossorgProjectSubPage</sv:value>
+    </sv:property>
+  </sv:node>
+  <sv:node sv:name=""mainColumnParagraphs"">
+    <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+      <sv:value>mgnl:contentNode</sv:value>
+    </sv:property>
+    <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+      <sv:value>mix:lockable</sv:value>
+    </sv:property>
+    <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+      <sv:value>43dab693-c6e7-4eda-869e-5b1d9ad358d5</sv:value>
+    </sv:property>
+    <sv:node sv:name=""MetaData"">
+      <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+        <sv:value>mgnl:metaData</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+        <sv:value>true</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+        <sv:value>superuser</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+        <sv:value>tm</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+        <sv:value>2009-12-10T11:47:46.060-05:00</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+        <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+      </sv:property>
+      <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+        <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+      </sv:property>
+    </sv:node>
+    <sv:node sv:name=""0"">
+      <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+        <sv:value>mgnl:contentNode</sv:value>
+      </sv:property>
+      <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+        <sv:value>mix:lockable</sv:value>
+      </sv:property>
+      <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+        <sv:value>6aec081e-5217-4adf-b06c-8c5bf92a886b</sv:value>
+      </sv:property>
+      <sv:property sv:name=""flow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""headerSize"" sv:type=""String"">
+        <sv:value>h3</sv:value>
+      </sv:property>
+      <sv:property sv:name=""imageLinkNewWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""imageLocation"" sv:type=""String"">
+        <sv:value>left</sv:value>
+      </sv:property>
+      <sv:property sv:name=""inherit"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""lineAbove"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkImage"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkText"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkTitle"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""linkWindowMenubar"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:property sv:name=""spacer"" sv:type=""Long"">
+        <sv:value>0</sv:value>
+      </sv:property>
+      <sv:property sv:name=""text"" sv:type=""String"">
+        <sv:value>&lt;h1&gt;JBoss Narayana Documentation Library&lt;/h1&gt; &lt;p&gt; &lt;table cellspacing=""5"" class=""infotable"" style=""margin: 2px; padding: 2px; font-size: 90%;""&gt;     &lt;tbody&gt;         &lt;tr&gt;             &lt;th width=""220"" class=""grey""&gt;JBoss Narayana Document&lt;/th&gt;             &lt;th width=""80"" class=""grey""&gt;Version&lt;/th&gt;             &lt;th width=""80"" class=""grey""&gt;Released&lt;/th&gt;             &lt;th class=""blank""&gt;&amp;nbsp;&lt;/th&gt;             &lt;th class=""blank""&gt;&amp;nbsp;&lt;/th&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ORB Portability Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-orbportability_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;NarayanaJTS Quick Start Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-quick_start_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTS Administration Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-administration_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTS Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jts-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ArjunaCore Failure Recovery Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/arjunacore-failure_recovery_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;ArjunaCore Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/arjunacore-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Quick Start Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-quick_start/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Installation Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-installation_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Administration Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-administration_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Narayana JTA Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/narayana-jta-development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;XTS Administration and Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/xts-administration_and_development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Failure Recovery Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/failure_recovery_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Release Notes&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/release_notes/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Development Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/development_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;Transactions Overview Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/transactions_overview_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;TXBridge Guide&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/guides/txbridge_guide/index.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/jts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/jts/jbossjts-jacorb-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTA API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/jta/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/jta/narayana-jta-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;RTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/rts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/rts/restat-api-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;XTS API&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://docs.jboss.org/jbosstm/@tag@/api/xts/overview-summary.html"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;View Online&lt;/a&gt;&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/api/xts/jbossxts-@tag@-javadoc.jar"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - ArjunaOTS&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/ArjunaOTS.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - CosTransactions.idl&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/CosTransactions.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;         &lt;tr&gt;             &lt;td&gt;&lt;b&gt;JTS IDL - XA&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;&lt;b&gt;@tag@&lt;/b&gt;&lt;/td&gt;             &lt;td&gt;@date@&lt;/td&gt;             &lt;td class=""button""&gt;&lt;a href=""http://download.jboss.org/jbosstm/@tag@/idl/XA.idl"" onmouseover=""this.parentNode.style.backgroundColor='#cccccc';"" onmouseout=""this. parentNode.style.backgroundColor='#777777';""&gt;Download&lt;/a&gt;&lt;/td&gt;         &lt;/tr&gt;     &lt;/tbody&gt; &lt;/table&gt; &lt;/p&gt;</sv:value>
+      </sv:property>
+      <sv:property sv:name=""titleLinkNewWindow"" sv:type=""Boolean"">
+        <sv:value>false</sv:value>
+      </sv:property>
+      <sv:node sv:name=""MetaData"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:metaData</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+          <sv:value>true</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+          <sv:value>superuser</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:authorid"" sv:type=""String"">
+          <sv:value>tm</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+          <sv:value>2009-12-10T11:47:46.061-05:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+          <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:lastmodified"" sv:type=""Date"">
+          <sv:value>2011-09-05T08:44:35.809-04:00</sv:value>
+        </sv:property>
+        <sv:property sv:name=""mgnl:template"" sv:type=""String"">
+          <sv:value>richTextHtml</sv:value>
+        </sv:property>
+      </sv:node>
+      <sv:node sv:name=""text_files"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:contentNode</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+          <sv:value>mix:lockable</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+          <sv:value>41f11088-5628-42b3-8c36-51b7a4199eaf</sv:value>
+        </sv:property>
+        <sv:node sv:name=""MetaData"">
+          <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+            <sv:value>mgnl:metaData</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+            <sv:value>true</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+            <sv:value>superuser</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+            <sv:value>2009-12-10T11:47:46.061-05:00</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+            <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+          </sv:property>
+        </sv:node>
+      </sv:node>
+      <sv:node sv:name=""imageFooter_files"">
+        <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+          <sv:value>mgnl:contentNode</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:mixinTypes"" sv:type=""Name"">
+          <sv:value>mix:lockable</sv:value>
+        </sv:property>
+        <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
+          <sv:value>6b6abc15-1022-44a0-917e-29a9691832e4</sv:value>
+        </sv:property>
+        <sv:node sv:name=""MetaData"">
+          <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
+            <sv:value>mgnl:metaData</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activated"" sv:type=""Boolean"">
+            <sv:value>true</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:activatorid"" sv:type=""String"">
+            <sv:value>superuser</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:creationdate"" sv:type=""Date"">
+            <sv:value>2009-12-10T11:47:46.064-05:00</sv:value>
+          </sv:property>
+          <sv:property sv:name=""mgnl:lastaction"" sv:type=""Date"">
+            <sv:value>2012-04-27T05:09:36.606-04:00</sv:value>
+          </sv:property>
+        </sv:node>
+      </sv:node>
+    </sv:node>
+  </sv:node>
+</sv:node>",2012-10-16T15:39:17Z,270
"@@ -1,5 +1,5 @@
 <?xml version=""1.0"" encoding=""UTF-8""?>
-<sv:node sv:name=""@tag@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
+<sv:node sv:name=""@pageName@"" xmlns:sv=""http://www.jcp.org/jcr/sv/1.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"">
   <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">
     <sv:value>mgnl:content</sv:value>
   </sv:property>
@@ -31,7 +31,7 @@
     <sv:value>false</sv:value>
   </sv:property>
   <sv:property sv:name=""title"" sv:type=""String"">
-    <sv:value>JBossTS @filename@ release</sv:value>
+    <sv:value>JBossTS @tag@ release</sv:value>
   </sv:property>
   <sv:property sv:name=""useTitle"" sv:type=""String"">
     <sv:value>true</sv:value>
@@ -99,12 +99,6 @@
       <sv:property sv:name=""jcr:uuid"" sv:type=""String"">
         <sv:value>00bd1847-65cd-4ff1-b7ce-20b8084be52b</sv:value>
       </sv:property>
-      <sv:property sv:name=""desc21"" sv:type=""String"">
-        <sv:value>The JBoss Transactions JTA @filename@ Source</sv:value>
-      </sv:property>
-      <sv:property sv:name=""desc22"" sv:type=""String"">
-        <sv:value>JBoss Transactions JTA @filename@ Binary</sv:value>
-      </sv:property>
       <sv:property sv:name=""desc23"" sv:type=""String"">
         <sv:value>JBoss Transactions JTS (and JTA) and WS-T Source Code</sv:value>
       </sv:property>
@@ -123,17 +117,11 @@
       <sv:property sv:name=""license24"" sv:type=""String"">
         <sv:value>LGPL</sv:value>
       </sv:property>
-      <sv:property sv:name=""name21"" sv:type=""String"">
-        <sv:value>jbossts-jta-@filename@-src.zip</sv:value>
-      </sv:property>
-      <sv:property sv:name=""name22"" sv:type=""String"">
-        <sv:value>jbossts-jta-@filename@.zip</sv:value>
-      </sv:property>
       <sv:property sv:name=""name23"" sv:type=""String"">
-        <sv:value>jbossts-full-@filename@-src.zip</sv:value>
+        <sv:value>narayana-full-@tag@-src.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""name24"" sv:type=""String"">
-        <sv:value>jbossts-full-@filename@.zip</sv:value>
+        <sv:value>narayana-full-@tag@-bin.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""popup"" sv:type=""String"">
         <sv:value>true</sv:value>
@@ -168,20 +156,14 @@
       <sv:property sv:name=""showVersion"" sv:type=""String"">
         <sv:value>false</sv:value>
       </sv:property>
-      <sv:property sv:name=""size21"" sv:type=""String"">
-        <sv:value>@jta-src-length@</sv:value>
-      </sv:property>
-      <sv:property sv:name=""size22"" sv:type=""String"">
-        <sv:value>@full-src-length@</sv:value>
-      </sv:property>
       <sv:property sv:name=""size23"" sv:type=""String"">
-        <sv:value>@jta-bin-length@</sv:value>
+        <sv:value>@full-src-length@</sv:value>
       </sv:property>
       <sv:property sv:name=""size24"" sv:type=""String"">
         <sv:value>@full-bin-length@</sv:value>
       </sv:property>
       <sv:property sv:name=""tableTitle"" sv:type=""String"">
-        <sv:value>JBossTS @filename@ release</sv:value>
+        <sv:value>JBossTS @tag@ release</sv:value>
       </sv:property>
       <sv:property sv:name=""text21"" sv:type=""String"">
         <sv:value>Download</sv:value>
@@ -195,17 +177,11 @@
       <sv:property sv:name=""text24"" sv:type=""String"">
         <sv:value>Download</sv:value>
       </sv:property>
-      <sv:property sv:name=""url21"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/src/jbossts-jta-@filename@-src.zip</sv:value>
-      </sv:property>
-      <sv:property sv:name=""url22"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/binary/jbossts-jta-@filename@.zip</sv:value>
-      </sv:property>
       <sv:property sv:name=""url23"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/src/jbossts-full-@filename@-src.zip</sv:value>
+        <sv:value>http://www.jboss.org/jbosstm/downloads/@tag@/src/narayana-full-@tag@-src.zip</sv:value>
       </sv:property>
       <sv:property sv:name=""url24"" sv:type=""String"">
-        <sv:value>http://www.jboss.org/jbosstm/downloads/@filename@/binary/jbossts-full-@filename@.zip</sv:value>
+        <sv:value>http://www.jboss.org/jbosstm/downloads/@tag@/binary/narayana-full-@tag@-bin.zip</sv:value>
       </sv:property>
       <sv:node sv:name=""MetaData"">
         <sv:property sv:name=""jcr:primaryType"" sv:type=""Name"">",2012-10-16T15:39:17Z,271
"@@ -223,6 +223,7 @@
 				<plugins>
 					<plugin>
 						<artifactId>maven-surefire-plugin</artifactId>
+						<version>2.11</version>
 						<configuration>
 							<skip>true</skip>
 						</configuration>
@@ -239,6 +240,7 @@
 				<plugins>
 					<plugin>
 						<artifactId>maven-surefire-plugin</artifactId>
+						<version>2.11</version>
 						<configuration>
 							<!-- Prevent test and server output appearing in console. -->
 							<redirectTestOutputToFile>true</redirectTestOutputToFile>",2012-06-12T13:38:05Z,162
"@@ -57,7 +57,7 @@ protected void cleanTxStore() throws Exception {
     protected void rebootServer(ContainerController controller) throws Exception {
 
         instrumentor.removeLocalState();
-        File rulesFile = File.createTempFile(""jbosstxbridgetests"", "".btm"");
+        File rulesFile = File.createTempFile(""jbosstxbridgetests"", """");
         rulesFile.deleteOnExit();
         instrumentor.setRedirectedSubmissionsFile(rulesFile);
 ",2012-06-12T13:38:05Z,293
"@@ -22,7 +22,6 @@
 
 import javax.jws.WebService;
 import javax.jws.soap.SOAPBinding;
-import javax.xml.ws.WebServiceClient;
 
 /**
  * Interface for a web service used by txbridge test cases. Client side version.",2012-06-12T13:38:05Z,294
"@@ -74,7 +74,7 @@ public void init(final ServletConfig config)
             userTransaction = (UserTransaction) ic.lookup(""java:comp/UserTransaction"");
 
             URL wsdlLocation = new URL(""http://localhost:8080/txbridge-outbound-tests-service/TestServiceImpl?wsdl"");
-            QName serviceName = new QName(""http://service.outbound.tests.txbridge.jbossts.jboss.org/"", ""TestServiceImplService"");
+            QName serviceName = new QName(""http://client.outbound.tests.txbridge.jbossts.jboss.org/"", ""TestServiceImplService"");
 
             Service service = Service.create(wsdlLocation, serviceName);
             testService = service.getPort(TestService.class);",2012-06-12T13:38:05Z,295
"@@ -28,8 +28,7 @@
  *
  * @author Jonathan Halliday (jonathan.halliday@redhat.com) 2010-03
  */
-@WebService(targetNamespace = ""http://service.outbound.tests.txbridge.jbossts.jboss.org/"",
-        portName = ""TestServiceImplPort"")
+@WebService(name = ""TestServiceImpl"", targetNamespace = ""http://client.outbound.tests.txbridge.jbossts.jboss.org/"")
 @SOAPBinding(style = SOAPBinding.Style.RPC)
 public interface TestService {
     public void doNothing();",2012-06-12T13:38:05Z,296
"@@ -40,7 +40,7 @@
  *
  * @author Jonathan Halliday (jonathan.halliday@redhat.com) 2010-03
  */
-@WebService()
+@WebService(targetNamespace = ""http://client.outbound.tests.txbridge.jbossts.jboss.org/"")
 @SOAPBinding(style = SOAPBinding.Style.RPC)
 @HandlerChain(file = ""/jaxws-handlers-server.xml"") // relative path from the class file
 @WebServlet(name=""OutboundTestServiceServlet"", urlPatterns=TestServiceImpl.URL_PATTERN)",2012-06-12T13:38:05Z,297
"@@ -50,6 +50,7 @@
 import com.arjuna.ats.arjuna.objectstore.RecoveryStore;
 import com.arjuna.ats.arjuna.objectstore.StateStatus;
 import com.arjuna.ats.arjuna.objectstore.StoreManager;
+import com.arjuna.ats.arjuna.recovery.RecoveryManager;
 import com.arjuna.ats.arjuna.recovery.RecoveryModule;
 import com.arjuna.ats.arjuna.state.InputObjectState;
 import com.arjuna.ats.internal.arjuna.common.UidHelper;
@@ -70,6 +71,7 @@
 
 public class XARecoveryModule implements RecoveryModule
 {
+
 	public XARecoveryModule()
 	{
 		this(new com.arjuna.ats.internal.jta.recovery.arjunacore.XARecoveryResourceManagerImple(),
@@ -116,8 +118,12 @@ public List<SerializableXAResourceDeserializer> getSeriablizableXAResourceDeseri
 	}
 
 
-	public void periodicWorkFirstPass()
+	public synchronized void periodicWorkFirstPass()
 	{
+		// JBTM-1354 allow a second thread to execute the first pass but make sure it is only done once per scan (TMSTART/ENDSCAN)
+		if (!requireFirstPass) {
+			return;
+		}
         if(jtaLogger.logger.isDebugEnabled()) {
             jtaLogger.logger.debugv(""{0} - first pass"", _logName);
         }
@@ -143,6 +149,27 @@ public void periodicWorkFirstPass()
 		{
             jtaLogger.i18NLogger.warn_recovery_periodicfirstpass(_logName+"".periodicWorkFirstPass"", e);
 		}
+		// JBTM-1354 JCA needs to be able to recover XAResources associated with a subordinate transaction so we have to do at least
+		// the start scan to make sure that we have loaded all the XAResources we possibly can to assist subordinate transactions recovering
+
+		// scan using statically configured plugins;
+		_resources = resourceInitiatedRecovery();
+		// scan using dynamically configured plugins:
+		_resources.addAll(resourceInitiatedRecoveryForRecoveryHelpers());
+
+		for (XAResource xaResource : _resources) {
+			try {
+				// This calls out to remote systems and may block. Consider
+				// using alternate concurrency
+				// control rather than sync on __xaResourceRecoveryHelpers
+				// to
+				// avoid blocking problems?
+				xaRecoveryFirstPass(xaResource);
+			} catch (Exception ex) {
+				jtaLogger.i18NLogger.warn_recovery_getxaresource(ex);
+			}
+		}
+		requireFirstPass = false;
 	}
 
 	public void periodicWorkSecondPass()
@@ -176,6 +203,10 @@ public void periodicWorkSecondPass()
 		}
 
 		clearAllFailures();
+
+		synchronized (this) {
+			requireFirstPass = true;
+		}
 	}
 
 	public String id()
@@ -189,12 +220,13 @@ public String id()
 	 * @return the XAResource than can be used to commit/rollback the specified
 	 *         transaction.
 	 */
-
 	private XAResource getNewXAResource(Xid xid)
 	{
-		if (_xidScans == null) {
-			bottomUpRecovery();
-        }
+		// JBTM-1354 JCA needs to be able to recover XAResources associated with a subordinate transaction so we have to do at least
+		// the start scan to make sure that we have loaded all the XAResources we possibly can to assist subordinate transactions recovering
+    	// the reason we can't do bottom up recovery is if this server has an XAResource which tries to recover a remote server (e.g. distributed JTA)
+    	// then we get deadlock on the secondpass
+    	periodicWorkFirstPass();
 
         if (_xidScans != null)
 		{
@@ -212,14 +244,14 @@ private XAResource getNewXAResource(Xid xid)
 		}
 
 		return null;
-	}
+    }
 
-	/**
-	 * @param xaResourceRecord The record to reassociate.
-	 *
-	 * @return the XAResource than can be used to commit/rollback the specified
-	 *         record.
-	 */
+       /**
+        * @param xaResourceRecord The record to reassociate.
+        *
+        * @return the XAResource than can be used to commit/rollback the specified
+        *         record.
+        */
     public XAResource getNewXAResource(XAResourceRecord xaResourceRecord)
     {
         return getNewXAResource(xaResourceRecord.getXid());
@@ -371,11 +403,19 @@ record = _recoveryManagerClass.getResource(theUid);
 	 * @see XARecoveryModule#getNewXAResource(XAResourceRecord)
 	 */
     private void bottomUpRecovery() {
+			for (XAResource xaResource : _resources) {
+				try {
+					// This calls out to remote systems and may block. Consider
+					// using alternate concurrency
+					// control rather than sync on __xaResourceRecoveryHelpers
+					// to
+					// avoid blocking problems?
+					xaRecoverySecondPass(xaResource);
+				} catch (Exception ex) {
+					jtaLogger.i18NLogger.warn_recovery_getxaresource(ex);
+				}
+			}
 
-        // scan using statically configured plugins;
-        resourceInitiatedRecovery();
-        // scan using dynamically configured plugins:
-        resourceInitiatedRecoveryForRecoveryHelpers();
 
         // JBTM-895 garbage collection is now done when we return XAResources {@see XARecoveryModule#getNewXAResource(XAResourceRecord)}
         // JBTM-924 requires this here garbage collection, see JBTM-1155:
@@ -413,35 +453,25 @@ private void bottomUpRecovery() {
 	 * transaction, because we don't know which process it was.
 	 */
 
-	private final boolean resourceInitiatedRecovery()
+	private final List<XAResource> resourceInitiatedRecovery()
 	{
 		/*
 		 * Now any additional connections we may need to create. Relies upon
 		 * information provided by the application.
 		 */
 
+		List<XAResource> xaresources = new ArrayList<XAResource>();
 		if (_xaRecoverers.size() > 0)
 		{
 			for (int i = 0; i < _xaRecoverers.size(); i++)
 			{
-				XAResource resource = null;
-
 				try
 				{
 					XAResourceRecovery ri = (XAResourceRecovery) _xaRecoverers.get(i);
 
 					while (ri.hasMoreResources())
 					{
-						try
-						{
-							resource = ri.getXAResource();
-
-							xaRecovery(resource);
-						}
-						catch (Exception exp)
-						{
-                            jtaLogger.i18NLogger.warn_recovery_getxaresource(exp);
-						}
+						xaresources.add(ri.getXAResource());
 					}
 				}
 				catch (Exception ex)
@@ -451,11 +481,12 @@ private final boolean resourceInitiatedRecovery()
 			}
 		}
 
-		return true;
+		return xaresources;
 	}
 
-    private boolean resourceInitiatedRecoveryForRecoveryHelpers()
+    private List<XAResource> resourceInitiatedRecoveryForRecoveryHelpers()
     {
+		List<XAResource> xaresources = new ArrayList<XAResource>();
         synchronized (_xaResourceRecoveryHelpers)
         {
             for (XAResourceRecoveryHelper xaResourceRecoveryHelper : _xaResourceRecoveryHelpers)
@@ -467,16 +498,7 @@ private boolean resourceInitiatedRecoveryForRecoveryHelpers()
                     {
                         for (XAResource xaResource : xaResources)
                         {
-                            try
-                            {
-                                // This calls out to remote systems and may block. Consider using alternate concurrency
-                                // control rather than sync on __xaResourceRecoveryHelpers to avoid blocking problems?
-                                xaRecovery(xaResource);
-                            }
-                            catch (Exception ex)
-                            {
-                                jtaLogger.i18NLogger.warn_recovery_getxaresource(ex);
-                            }
+                        	xaresources.add(xaResource);
                         }
                     }
                 }
@@ -487,18 +509,17 @@ private boolean resourceInitiatedRecoveryForRecoveryHelpers()
             }
         }
 
-        return true;
+        return xaresources;
     }
 
 
-	private final boolean xaRecovery(XAResource xares)
+	private final void xaRecoveryFirstPass(XAResource xares)
 	{
 		if (jtaLogger.logger.isDebugEnabled()) {
             jtaLogger.logger.debug(""xarecovery of "" + xares);
         }
 
-		try
-		{
+		
 			Xid[] trans = null;
 
 			try
@@ -523,7 +544,7 @@ private final boolean xaRecovery(XAResource xares)
 				{
 				}
 
-				return false;
+				return;
 			}
 
 			RecoveryXids xidsToRecover = null;
@@ -569,7 +590,11 @@ private final boolean xaRecovery(XAResource xares)
 			}
 
 			xidsToRecover.nextScan(trans);
-
+	}
+	
+	private void xaRecoverySecondPass(XAResource xares) { 		
+		RecoveryXids xidsToRecover = _xidScans.get(xares);
+		try {
 			Xid[] xids = xidsToRecover.toRecover();
 
 			if (xids != null)
@@ -667,7 +692,7 @@ private final boolean xaRecovery(XAResource xares)
             jtaLogger.i18NLogger.warn_recovery_xarecovery1(_logName+"".xaRecovery"", XAHelper.printXAErrorCode(e), e);
 		}
 
-		return true;
+		return;
 	}
 
     /**
@@ -860,6 +885,10 @@ private void clearAllFailures()
 
 	private InputObjectState _uids = new InputObjectState();
 
+	private List<XAResource> _resources;
+
+	private boolean requireFirstPass = true;
+
 	private final List<XAResourceRecovery> _xaRecoverers;
 
     private final List<XAResourceRecoveryHelper> _xaResourceRecoveryHelpers = new LinkedList<XAResourceRecoveryHelper>();",2012-12-14T14:34:44Z,18
"@@ -79,7 +79,8 @@ public void testHeuristicRollback() throws Exception {
 
 		RecoveryEnvironmentBean recoveryEnvironmentBean = BeanPopulator
 				.getDefaultInstance(RecoveryEnvironmentBean.class);
-		recoveryEnvironmentBean.setRecoveryBackoffPeriod(Integer.MAX_VALUE);
+		// JBTM-1354 we need to make sure that a full scan has gone off
+		recoveryEnvironmentBean.setRecoveryBackoffPeriod(1);
 		recoveryEnvironmentBean.setPeriodicRecoveryPeriod(Integer.MAX_VALUE);
 
 		List<String> recoveryModuleClassNames = new ArrayList<String>();
@@ -113,6 +114,10 @@ public void testHeuristicRollback() throws Exception {
 			throw new Exception(""No XARM"");
 		}
 
+		// JBTM-1354 Run a scan to make sure that the recovery thread has completed a full run before starting the test
+		// The important thing is that replayCompletion is allowed to do a scan of the transactions 
+		RecoveryManager.manager().scan();
+
 		XAResource firstResource = new SimpleResource();
 		Object toWakeUp = new Object();
 		final SimpleResourceXA_RETRYHeuristicRollback secondResource = new SimpleResourceXA_RETRYHeuristicRollback();",2012-12-14T14:34:44Z,298
"@@ -1,19 +1,20 @@
 RULE create counter
 CLASS org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules
 METHOD setParticipantCount(Integer)
-BIND counter:Integer=$1
+BIND counter:Integer=$1, disabled:boolean=false
 IF TRUE
 DO debug(""participant_completion.counter.create: "" + counter),
   deleteCounter(""completes""),
-  createCounter(""completes"", counter)
+  createCounter(""completes"", counter),
+  flag(""enabled"")
 ENDRULE
 
 RULE complete called
 CLASS com.arjuna.webservices11.wsba.sei.BusinessAgreementWithParticipantCompletionCoordinatorPortTypeImpl
 METHOD completedOperation(NotificationType)
 AT RETURN
 BIND NOTHING
-IF (debug(""participant_completion.counter.decrement"") AND decrementCounter(""completes"") == 0)
+IF (flagged(""enabled"") AND debug(""participant_completion.counter.decrement"") AND decrementCounter(""completes"") == 0)
 DO debug(""participant_completion.called.waking""),
    signalWake(""complete"", true),
    debug(""participant_completion.called.donewake"")
@@ -23,18 +24,20 @@ RULE close called
 CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
 METHOD closeOperation(NotificationType)
 BIND NOTHING
-IF TRUE
+IF (flagged(""enabled""))
 DO debug(""participant_completion.close.waiting""),
    waitFor(""complete""),
-   debug(""participant_completion.close.woken"")
+   debug(""participant_completion.close.woken""),
+   clear(""enabled"")
 ENDRULE
 
 RULE cancel called
 CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
 METHOD cancelOperation(NotificationType)
 BIND NOTHING
-IF TRUE
+IF (flagged(""enabled""))
 DO debug(""participant_completion.cancel.waiting""),
    waitFor(""complete""),
-   debug(""participant_completion.cancel.woken"")
+   debug(""participant_completion.cancel.woken""),
+   clear(""enabled"")
 ENDRULE
\ No newline at end of file",2012-12-13T17:27:38Z,278
"@@ -27,6 +27,7 @@ $JBOSS_BUILD_HOME/build.sh $CLEAN install -f $JBOSS_BUILD_HOME/build/pom.xml -Ds
 JBOSS_BUILD_NAME=$(ls $JBOSS_BUILD_HOME/build/target/ | grep jboss-as)
 cp $JBOSS_BUILD_HOME/build/target/$JBOSS_BUILD_NAME/docs/examples/configs/standalone-xts.xml $JBOSS_BUILD_HOME/build/target/$JBOSS_BUILD_NAME/standalone/configuration/ || fail
 echo JAVA_OPTS=\""\$JAVA_OPTS -Xrunjdwp:transport=dt_socket,address=8787,server=y,suspend=n\"" >> $JBOSS_BUILD_HOME/build/target/$JBOSS_BUILD_NAME/bin/standalone.conf
+echo JAVA_OPTS=\""\$JAVA_OPTS -Dorg.jboss.byteman.verbose -Djboss.modules.system.pkgs=org.jboss.byteman -Dorg.jboss.byteman.transform.all -javaagent:/opt/byteman-download-2.1.0/lib/byteman.jar=listener:true\"" >> $JBOSS_BUILD_HOME/build/target/$JBOSS_BUILD_NAME/bin/standalone.conf
 cp ../rest-tx/webservice/target/restat-web-*.war $JBOSS_BUILD_HOME/build/target/$JBOSS_BUILD_NAME/standalone/deployments/
 
 END=$(date +%s)",2012-12-13T17:27:38Z,198
"@@ -3,6 +3,7 @@
 import com.arjuna.mw.wst11.UserBusinessActivity;
 import com.arjuna.mw.wst11.UserTransaction;
 import org.jboss.arquillian.container.test.api.Deployment;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.ArchivePaths;
 import org.jboss.shrinkwrap.api.ShrinkWrap;
 import org.jboss.shrinkwrap.api.asset.ByteArrayAsset;
@@ -18,6 +19,7 @@ public static JavaArchive createTestArchive() {
                 .addPackages(true, ""org.jboss.narayana.txframework.functional"")
                 .addAsResource(""jaxws-handlers-jaxws-service.xml"")
                 .addAsManifestResource(""persistence.xml"")
+                .addClass(ParticipantCompletionCoordinatorRules.class)
                 .addAsManifestResource(new ByteArrayAsset(""<interceptors><class>org.jboss.narayana.txframework.impl.ServiceRequestInterceptor</class></interceptors>"".getBytes()),
                         ArchivePaths.create(""beans.xml""));
 ",2012-12-13T17:27:38Z,299
"@@ -47,7 +47,6 @@ public class Service1Impl implements Service1 {
     @Inject
     Map TXDataMap;
 
-    private boolean rollback = false;
     private EventLog eventLog = new EventLog();
 
     @WebMethod
@@ -61,7 +60,7 @@ public Response someServiceRequest(String serviceCommand) throws SomeApplication
         }
 
         if (VOTE_ROLLBACK.equals(serviceCommand)) {
-            rollback = true;
+            TXDataMap.put(""rollback"", true);
         }
         return Response.ok().build();
     }
@@ -93,7 +92,7 @@ private void rollback() {
     private Boolean prepare() {
 
         logEvent(Prepare.class);
-        if (rollback) {
+        if (TXDataMap.containsKey(""rollback"")) {
             return false;
         } else {
             return true;",2013-01-05T20:49:39Z,300
"@@ -47,7 +47,6 @@ public class Service2Impl implements Service2 {
     @Inject
     Map TXDataMap;
 
-    private boolean rollback = false;
     private EventLog eventLog = new EventLog();
 
     @WebMethod
@@ -62,7 +61,7 @@ public Response someServiceRequest(String serviceCommand) throws SomeApplication
 
 
         if (VOTE_ROLLBACK.equals(serviceCommand)) {
-            rollback = true;
+            TXDataMap.put(""rollback"", true);
         }
         return Response.ok().build();
     }
@@ -94,7 +93,7 @@ private void rollback() {
     private Boolean prepare() {
 
         logEvent(Prepare.class);
-        if (rollback) {
+        if (TXDataMap.containsKey(""rollback"")) {
             return false;
         } else {
             return true;",2013-01-05T20:49:39Z,301
"@@ -1 +1,5 @@
-<!DOCTYPE properties SYSTEM ""http://java.sun.com/dtd/properties.dtd""><properties/>
\ No newline at end of file
+<!DOCTYPE properties SYSTEM ""http://java.sun.com/dtd/properties.dtd"">
+<properties>
+  <entry key=""ObjectStoreEnvironmentBean.objectStoreDir"">PutObjectStoreDirHere</entry>
+  <entry key=""ObjectStoreEnvironmentBean.communicationStore.objectStoreDir"">PutObjectStoreDirHere</entry>
+</properties>
\ No newline at end of file",2012-11-07T11:02:37Z,302
"@@ -53,6 +53,7 @@ public void test() throws Exception
 
         XACreator creator = (XACreator) Thread.currentThread().getContextClassLoader().loadClass(xaResource).newInstance();
         XAResource theResource = creator.create(connectionString, true);
+        XAResource theResource2 = creator.create(connectionString, true);
 
         assertNotNull(xaResource);
 
@@ -63,6 +64,7 @@ public void test() throws Exception
         javax.transaction.Transaction theTransaction = tm.getTransaction();
 
         assertTrue( theTransaction.enlistResource(theResource) );
+        assertTrue( theTransaction.enlistResource(theResource2) );
 
         /*
         * XA does not support subtransactions.",2012-11-07T11:02:37Z,303
"@@ -1,19 +1,20 @@
 RULE create counter
 CLASS org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules
 METHOD setParticipantCount(Integer)
-BIND counter:Integer=$1
+BIND counter:Integer=$1, disabled:boolean=false
 IF TRUE
 DO debug(""participant_completion.counter.create: "" + counter),
   deleteCounter(""completes""),
-  createCounter(""completes"", counter)
+  createCounter(""completes"", counter),
+  flag(""enabled"")
 ENDRULE
 
 RULE complete called
 CLASS com.arjuna.webservices11.wsba.sei.BusinessAgreementWithParticipantCompletionCoordinatorPortTypeImpl
 METHOD completedOperation(NotificationType)
 AT RETURN
 BIND NOTHING
-IF (debug(""participant_completion.counter.decrement"") AND decrementCounter(""completes"") == 0)
+IF (flagged(""enabled"") AND debug(""participant_completion.counter.decrement"") AND decrementCounter(""completes"") == 0)
 DO debug(""participant_completion.called.waking""),
    signalWake(""complete"", true),
    debug(""participant_completion.called.donewake"")
@@ -23,18 +24,20 @@ RULE close called
 CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
 METHOD closeOperation(NotificationType)
 BIND NOTHING
-IF TRUE
+IF (flagged(""enabled""))
 DO debug(""participant_completion.close.waiting""),
    waitFor(""complete""),
-   debug(""participant_completion.close.woken"")
+   debug(""participant_completion.close.woken""),
+   clear(""enabled"")
 ENDRULE
 
 RULE cancel called
 CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
 METHOD cancelOperation(NotificationType)
 BIND NOTHING
-IF TRUE
+IF (flagged(""enabled""))
 DO debug(""participant_completion.cancel.waiting""),
    waitFor(""complete""),
-   debug(""participant_completion.cancel.woken"")
+   debug(""participant_completion.cancel.woken""),
+   clear(""enabled"")
 ENDRULE
\ No newline at end of file",2012-12-13T17:27:38Z,278
"@@ -27,6 +27,7 @@ $JBOSS_BUILD_HOME/build.sh $CLEAN install -f $JBOSS_BUILD_HOME/build/pom.xml -Ds
 JBOSS_BUILD_NAME=$(ls $JBOSS_BUILD_HOME/build/target/ | grep jboss-as)
 cp $JBOSS_BUILD_HOME/build/target/$JBOSS_BUILD_NAME/docs/examples/configs/standalone-xts.xml $JBOSS_BUILD_HOME/build/target/$JBOSS_BUILD_NAME/standalone/configuration/ || fail
 echo JAVA_OPTS=\""\$JAVA_OPTS -Xrunjdwp:transport=dt_socket,address=8787,server=y,suspend=n\"" >> $JBOSS_BUILD_HOME/build/target/$JBOSS_BUILD_NAME/bin/standalone.conf
+echo JAVA_OPTS=\""\$JAVA_OPTS -Dorg.jboss.byteman.verbose -Djboss.modules.system.pkgs=org.jboss.byteman -Dorg.jboss.byteman.transform.all -javaagent:/opt/byteman-download-2.1.0/lib/byteman.jar=listener:true\"" >> $JBOSS_BUILD_HOME/build/target/$JBOSS_BUILD_NAME/bin/standalone.conf
 cp ../rest-tx/webservice/target/restat-web-*.war $JBOSS_BUILD_HOME/build/target/$JBOSS_BUILD_NAME/standalone/deployments/
 
 END=$(date +%s)",2012-12-13T17:27:38Z,198
"@@ -3,6 +3,7 @@
 import com.arjuna.mw.wst11.UserBusinessActivity;
 import com.arjuna.mw.wst11.UserTransaction;
 import org.jboss.arquillian.container.test.api.Deployment;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.ArchivePaths;
 import org.jboss.shrinkwrap.api.ShrinkWrap;
 import org.jboss.shrinkwrap.api.asset.ByteArrayAsset;
@@ -18,6 +19,7 @@ public static JavaArchive createTestArchive() {
                 .addPackages(true, ""org.jboss.narayana.txframework.functional"")
                 .addAsResource(""jaxws-handlers-jaxws-service.xml"")
                 .addAsManifestResource(""persistence.xml"")
+                .addClass(ParticipantCompletionCoordinatorRules.class)
                 .addAsManifestResource(new ByteArrayAsset(""<interceptors><class>org.jboss.narayana.txframework.impl.ServiceRequestInterceptor</class></interceptors>"".getBytes()),
                         ArchivePaths.create(""beans.xml""));
 ",2012-12-13T17:27:38Z,299
"@@ -47,7 +47,6 @@ public class Service1Impl implements Service1 {
     @Inject
     Map TXDataMap;
 
-    private boolean rollback = false;
     private EventLog eventLog = new EventLog();
 
     @WebMethod
@@ -61,7 +60,7 @@ public Response someServiceRequest(String serviceCommand) throws SomeApplication
         }
 
         if (VOTE_ROLLBACK.equals(serviceCommand)) {
-            rollback = true;
+            TXDataMap.put(""rollback"", true);
         }
         return Response.ok().build();
     }
@@ -93,7 +92,7 @@ private void rollback() {
     private Boolean prepare() {
 
         logEvent(Prepare.class);
-        if (rollback) {
+        if (TXDataMap.containsKey(""rollback"")) {
             return false;
         } else {
             return true;",2013-01-05T20:49:39Z,300
"@@ -47,7 +47,6 @@ public class Service2Impl implements Service2 {
     @Inject
     Map TXDataMap;
 
-    private boolean rollback = false;
     private EventLog eventLog = new EventLog();
 
     @WebMethod
@@ -62,7 +61,7 @@ public Response someServiceRequest(String serviceCommand) throws SomeApplication
 
 
         if (VOTE_ROLLBACK.equals(serviceCommand)) {
-            rollback = true;
+            TXDataMap.put(""rollback"", true);
         }
         return Response.ok().build();
     }
@@ -94,7 +93,7 @@ private void rollback() {
     private Boolean prepare() {
 
         logEvent(Prepare.class);
-        if (rollback) {
+        if (TXDataMap.containsKey(""rollback"")) {
             return false;
         } else {
             return true;",2013-01-05T20:49:39Z,301
"@@ -26,6 +26,7 @@
 
 import java.io.File;
 import java.io.IOException;
+import java.io.InputStream;
 import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Iterator;
@@ -45,6 +46,7 @@
 import org.jboss.byteman.contrib.bmunit.BMScript;
 import org.jboss.byteman.contrib.bmunit.BMUnitRunner;
 import org.jboss.byteman.rule.exception.ExecuteException;
+import org.jfree.io.IOUtils;
 import org.junit.AfterClass;
 import org.junit.BeforeClass;
 import org.junit.Test;
@@ -293,14 +295,24 @@ public void run() {
 
 		synchronized (lock) {
 			while (lock.getCount() < 2) {
-				lock.wait();
+				lock.wait(300000);
+			}
+			
+			if (lock.getCount() < 2) {
+				fail(""Did not get notification for both recovery runs, deadlock in recovery manager scan detected"");
+				ProcessBuilder processBuilder = new ProcessBuilder(""/bin/sh"", ""-c"", ""kill -3 $PPID"");  
+				processBuilder.redirectErrorStream(true);
+				Process process = processBuilder.start();       
+				InputStream inputStream = process.getInputStream();       
+				IOUtils.getInstance().copyStreams(inputStream, System.out);
 			}
 		}
 
 		assertTrue("""" + completionCounter.getCommitCount(""1000""), completionCounter.getCommitCount(""1000"") == 0);
-		assertTrue("""" + completionCounter.getRollbackCount(""1000""), completionCounter.getRollbackCount(""1000"") == 3);
+		// JBTM-1260 simultaneous recover can cause spurious Xid rollback of normally completed Xid, should not be an issue
+		assertTrue("""" + completionCounter.getRollbackCount(""1000""), Arrays.asList(new Integer[] {3, 4}).contains(completionCounter.getRollbackCount(""1000"")));
 		assertTrue("""" + completionCounter.getCommitCount(""2000""), completionCounter.getCommitCount(""2000"") == 0);
-		assertTrue("""" + completionCounter.getRollbackCount(""2000""), completionCounter.getRollbackCount(""2000"") == 3);
+		assertTrue("""" + completionCounter.getRollbackCount(""2000""), Arrays.asList(new Integer[] {3, 4}).contains(completionCounter.getRollbackCount(""2000"")));
 
 	}
 ",2012-09-20T09:04:36Z,16
"@@ -0,0 +1,30 @@
+<?xml version=""1.0"" encoding=""UTF-8""?>
+<!-- JBoss, Home of Professional Open Source Copyright 2008, Red Hat Middleware LLC, and others contributors as indicated by the @authors tag. All rights reserved. See the copyright.txt in the distribution 
+	for a full listing of individual contributors. This copyrighted material is made available to anyone wishing to use, modify, copy, or redistribute it subject to the terms and conditions of the GNU Lesser 
+	General Public License, v. 2.1. This program is distributed in the hope that it will be useful, but WITHOUT A WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR 
+	PURPOSE. See the GNU Lesser General Public License for more details. You should have received a copy of the GNU Lesser General Public License, v.2.1 along with this distribution; if not, write to the Free 
+	Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA. -->
+<project xmlns=""http://maven.apache.org/POM/4.0.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
+         xsi:schemaLocation=""http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"">
+    <parent>
+        <groupId>org.jboss.narayana.xts</groupId>
+        <artifactId>xts-all</artifactId>
+        <version>5.0.0.M2-SNAPSHOT</version>
+        <relativePath>../pom.xml</relativePath>
+    </parent>
+    <modelVersion>4.0.0</modelVersion>
+    <artifactId>byteman_support</artifactId>
+    <packaging>jar</packaging>
+    <name>Reusable Byteman rules for xts</name>
+    
+    <dependencies>
+        <dependency>
+            <groupId>org.jboss.byteman</groupId>
+            <artifactId>byteman</artifactId>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.byteman</groupId>
+            <artifactId>byteman-submit</artifactId>
+        </dependency>
+    </dependencies>
+</project>",2012-12-07T10:03:43Z,275
"@@ -0,0 +1,53 @@
+package org.jboss.jbossts.xts.bytemanSupport;
+
+import org.jboss.byteman.agent.submit.Submit;
+
+import java.io.IOException;
+import java.io.InputStream;
+import java.net.URL;
+import java.util.ArrayList;
+import java.util.List;
+
+/**
+ * @Author paul.robinson@redhat.com 22/11/2012
+ */
+public class BMScript {
+
+    private static final Submit submit = new Submit();
+
+    public static void submit(String scriptResourcePath) {
+
+        try {
+            List<InputStream> streams = getScriptFromResource(scriptResourcePath);
+            submit.addRulesFromResources(streams);
+        } catch (Exception e) {
+            throw new RuntimeException(""Failed to submit Byteman script"", e);
+        }
+    }
+
+    public static void remove(String scriptResourcePath) {
+
+        try {
+            List<InputStream> streams = getScriptFromResource(scriptResourcePath);
+            submit.deleteRulesFromResources(streams);
+        } catch (Exception e) {
+            throw new RuntimeException(""Failed to remove Byteman script"", e);
+        }
+    }
+
+    private static List<InputStream> getScriptFromResource(String scriptResourcePath) {
+        URL resource = Thread.currentThread().getContextClassLoader().getResource(scriptResourcePath);
+        if (resource == null) {
+            throw new RuntimeException(""'"" + scriptResourcePath + ""' can't be found on the classpath"");
+        }
+
+        List<InputStream> streams = new ArrayList<InputStream>();
+        try {
+            streams.add(resource.openStream());
+        } catch (IOException e) {
+            throw new RuntimeException(""Unable to open stream at url location: "" + resource.toString());
+        }
+        return streams;
+    }
+
+}",2012-12-07T10:03:43Z,276
"@@ -0,0 +1,13 @@
+package org.jboss.jbossts.xts.bytemanSupport.participantCompletion;
+
+/**
+ * @Author paul.robinson@redhat.com 26/11/2012
+ */
+public class ParticipantCompletionCoordinatorRules {
+
+    public static String RESOURCE_PATH= ""org/jboss/jbossts/xts/bytemanSupport/participantCompletion/participant_completion_coordinator_rules.btm"";
+
+    public static void setParticipantCount(Integer participantCount) {
+        //Dummy method, detected by Byteman Rules
+    }
+}",2012-12-07T10:03:43Z,277
"@@ -0,0 +1,40 @@
+RULE create counter
+CLASS org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules
+METHOD setParticipantCount(Integer)
+BIND counter:Integer=$1
+IF TRUE
+DO debug(""participant_completion.counter.create: "" + counter),
+  deleteCounter(""completes""),
+  createCounter(""completes"", counter)
+ENDRULE
+
+RULE complete called
+CLASS com.arjuna.webservices11.wsba.sei.BusinessAgreementWithParticipantCompletionCoordinatorPortTypeImpl
+METHOD completedOperation(NotificationType)
+AT RETURN
+BIND NOTHING
+IF (debug(""participant_completion.counter.decrement"") AND decrementCounter(""completes"") == 0)
+DO debug(""participant_completion.called.waking""),
+   signalWake(""complete"", true),
+   debug(""participant_completion.called.donewake"")
+ENDRULE
+
+RULE close called
+CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
+METHOD closeOperation(NotificationType)
+BIND NOTHING
+IF TRUE
+DO debug(""participant_completion.close.waiting""),
+   waitFor(""complete""),
+   debug(""participant_completion.close.woken"")
+ENDRULE
+
+RULE cancel called
+CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
+METHOD cancelOperation(NotificationType)
+BIND NOTHING
+IF TRUE
+DO debug(""participant_completion.cancel.waiting""),
+   waitFor(""complete""),
+   debug(""participant_completion.cancel.woken"")
+ENDRULE
\ No newline at end of file",2012-12-07T10:03:43Z,278
"@@ -67,8 +67,6 @@ public void testClose()
             throw eouter;
         }
 
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
 
 	    assertTrue(p.passed());",2012-12-07T10:03:43Z,279
"@@ -68,8 +68,6 @@ public void testExit()
             throw eouter;
         }
 
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
 
 	    assertTrue(p.passed());",2012-12-07T10:03:43Z,280
"@@ -73,8 +73,6 @@ public void testMultiClose()
             }
             throw eouter;
         }
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
         assertTrue(p.passed());
     }",2012-12-07T10:03:43Z,281
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -20,11 +24,23 @@ public class CloseTest {
 	public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				Close.class,
-				DemoBusinessParticipant.class);
+				DemoBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
 		test.testClose();
 	}
 }",2012-12-07T10:03:43Z,282
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -20,11 +24,23 @@ public class CompensateTest {
 	public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				Compensate.class,
-				DemoBusinessParticipant.class);
+				DemoBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
 		test.testCompensate();
 	}
 }",2012-12-07T10:03:43Z,283
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -14,6 +18,7 @@
 
 @RunWith(Arquillian.class)
 public class MultiCloseTest {
+    
 	@Inject
 	MultiClose test;
 	
@@ -22,11 +27,23 @@ public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				MultiClose.class,
 				DemoBusinessParticipant.class,
-				FailureBusinessParticipant.class);
+				FailureBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
-	
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(2);
 		test.testMultiClose();
 	}
 }",2012-12-07T10:03:43Z,281
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -22,11 +26,23 @@ public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				MultiCompensate.class,
 				DemoBusinessParticipant.class,
-				FailureBusinessParticipant.class);
+				FailureBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(2);
 		test.testMultiCompensate();
 	}
 }",2012-12-07T10:03:43Z,284
"@@ -18,18 +18,51 @@
 	<description>localjunit tests for xts</description>
         <properties>
             <buildType>11</buildType>
-            <general.server.jvm.args>-Xms64m -Xmx1024m -XX:MaxPermSize=512m</general.server.jvm.args>
+            <general.server.jvm.args>-Xms64m -Xmx1024m -XX:MaxPermSize=512m
+                                     -Dorg.jboss.byteman.verbose
+                                    -Djboss.modules.system.pkgs=org.jboss.byteman
+                                    -Dorg.jboss.byteman.transform.all
+                                    -javaagent:${project.build.directory}/lib/byteman.jar=listener:true
+            </general.server.jvm.args>
             <ipv4.server.jvm.args></ipv4.server.jvm.args>
             <ipv6.server.jvm.args>-Djboss.bind.address=[::1] -Djboss.bind.address.management=[::1] -Djboss.bind.address.unsecure=[::1] -Djava.net.preferIPv4Stack=false -Djava.net.preferIPv6Addresses=true</ipv6.server.jvm.args>
             <server.debug.args>Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5006</server.debug.args>
         </properties>
 
+    <build>
+        <plugins>
+                <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                      <artifactId>maven-dependency-plugin</artifactId>
+                      <executions>
+                        <execution>
+                          <id>copy-dependencies</id>
+                          <phase>test-compile</phase>
+                          <goals>
+                            <goal>copy-dependencies</goal>
+                          </goals>
+                          <configuration>
+                              <stripVersion>true</stripVersion>
+                              <includeGroupIds>org.jboss.byteman</includeGroupIds>
+                            <outputDirectory>${project.build.directory}/lib</outputDirectory>
+                          </configuration>
+                        </execution>
+                      </executions>
+                </plugin>
+        </plugins>
+    </build>
+
 	<dependencies>
 		<dependency>
 			<groupId>org.jboss.narayana.xts</groupId>
 			<artifactId>jbossxts</artifactId>
 			<scope>provided</scope>
 		</dependency>
+		<dependency>
+			<groupId>org.jboss.narayana.xts</groupId>
+			<artifactId>byteman_support</artifactId>
+            <scope>test</scope>
+		</dependency>
 		<dependency>
 			<groupId>junit</groupId>
 			<artifactId>junit</artifactId>
@@ -67,6 +100,37 @@
 				</plugins>
 			</build>
 		</profile>
+        <profile>
+      			<id>arq-remote</id>
+      			<activation>
+      				<activeByDefault>false</activeByDefault>
+      			</activation>
+      			<build>
+      				<plugins>
+      					<plugin>
+      						<artifactId>maven-surefire-plugin</artifactId>
+      						<configuration>
+      							<forkMode>once</forkMode>
+      							<systemPropertyVariables combine.children=""append"">
+      							<!--
+      							  Used in arquillian.xml
+      							-->
+      							  <server.jvm.args>${general.server.jvm.args} ${ipv4.server.jvm.args}</server.jvm.args>
+                                    <node.address>127.0.0.1</node.address>
+      							</systemPropertyVariables>
+      						</configuration>
+      					</plugin>
+      				</plugins>
+      			</build>
+      			<dependencies>
+      				<dependency>
+      					<groupId>org.jboss.as</groupId>
+      					<artifactId>jboss-as-arquillian-container-remote</artifactId>
+      					<version>${jboss-as.version}</version>
+      					<scope>test</scope>
+      				</dependency>
+      			</dependencies>
+      		</profile>
 		<profile>
 			<id>arq</id>
 			<activation>
@@ -83,7 +147,7 @@
 							  Used in arquillian.xml
 							-->
 							  <server.jvm.args>${general.server.jvm.args} ${ipv4.server.jvm.args}</server.jvm.args>
-                                                          <node.address>127.0.0.1</node.address>
+                              <node.address>127.0.0.1</node.address>
 							</systemPropertyVariables>
 						</configuration>
 					</plugin>",2012-12-07T10:03:43Z,34
"@@ -37,6 +37,7 @@
     </plugins>
   </build>
   <modules>
+    <module>byteman_support</module>
     <module>WSAS</module>
     <module>WSAS/xts-test-servlet</module>
     <module>WS-C</module>",2012-12-07T10:03:43Z,285
"@@ -52,6 +52,14 @@
     </plugins>
   </build>
   <dependencies>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman-submit</artifactId>
+    </dependency>
     <!-- START TEST -->
     <dependency>
       <groupId>junit</groupId>",2012-12-07T10:03:43Z,286
"@@ -942,6 +942,11 @@
         <artifactId>service</artifactId>
         <version>${project.version}</version>
       </dependency>
+      <dependency>
+	<groupId>org.jboss.narayana.xts</groupId>
+	<artifactId>byteman_support</artifactId>
+        <version>${project.version}</version>
+      </dependency>
       <dependency>
         <groupId>org.jboss.narayana.rts</groupId>
         <artifactId>restat-web</artifactId>
@@ -973,27 +978,27 @@
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-install</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-submit</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-bmunit</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-dtest</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
   </dependencies>
   </dependencyManagement>",2012-12-07T10:03:43Z,39
"@@ -37,6 +37,24 @@
                     <skip>true</skip>
                 </configuration>
             </plugin>
+            <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-dependency-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>copy-dependencies</id>
+                      <phase>test-compile</phase>
+                      <goals>
+                        <goal>copy-dependencies</goal>
+                      </goals>
+                      <configuration>
+                          <stripVersion>true</stripVersion>
+                          <includeGroupIds>org.jboss.byteman</includeGroupIds>
+                        <outputDirectory>${project.build.directory}/lib</outputDirectory>
+                      </configuration>
+                    </execution>
+                  </executions>
+            </plugin>
         </plugins>
     </build>
 
@@ -112,6 +130,11 @@
                 </exclusion>
             </exclusions>
         </dependency>
+	<dependency>
+	   <groupId>org.jboss.narayana.xts</groupId>
+	   <artifactId>byteman_support</artifactId>
+           <scope>test</scope>
+	</dependency>
         <dependency>
             <groupId>org.jboss.narayana.rts</groupId>
             <artifactId>restat-util</artifactId>",2012-12-07T10:03:43Z,41
"@@ -5,6 +5,8 @@
 import com.arjuna.wst.TransactionRolledBackException;
 import junit.framework.Assert;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Close;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Compensate;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.ConfirmCompleted;
@@ -13,7 +15,9 @@
 import org.jboss.narayana.txframework.functional.common.SomeApplicationException;
 import org.jboss.narayana.txframework.functional.interfaces.BAParticipantCompletion;
 import org.junit.After;
+import org.junit.AfterClass;
 import org.junit.Before;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -27,6 +31,17 @@ public class BAParticipantCompletionTest extends BaseFunctionalTest
     UserBusinessActivity uba;
     BAParticipantCompletion client;
 
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
     @Before
     public void setupTest() throws Exception
     {
@@ -45,9 +60,10 @@ public void teardownTest() throws Exception
     @Test
     public void testAutoComplete() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+        
         uba.begin();
         client.saveDataAutoComplete();
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -57,9 +73,10 @@ public void testAutoComplete() throws Exception
     @Test
     public void testManualComplete() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
         uba.begin();
         client.saveDataManualComplete(ServiceCommand.COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -68,10 +85,11 @@ public void testManualComplete() throws Exception
     @Test
     public void testMultiInvoke() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+        
         uba.begin();
         client.saveDataManualComplete();
         client.saveDataManualComplete(ServiceCommand.COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -80,9 +98,10 @@ public void testMultiInvoke() throws Exception
     @Test
     public void testClientDrivenCompensate() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
         uba.begin();
         client.saveDataAutoComplete();
-        Thread.sleep(10000); //JBTM-1203
         uba.cancel();
 
         assertOrder(ConfirmCompleted.class, Compensate.class);
@@ -113,8 +132,8 @@ public void testCannotComplete() throws Exception
     {
         uba.begin();
         client.saveDataAutoComplete(ServiceCommand.CANNOT_COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
+        
         assertOrder();
     }
 ",2012-12-07T10:03:43Z,287
"@@ -16,6 +16,11 @@
       <!-- If you want to use the JBOSS_HOME environment variable, just delete the jbossHome property -->
       <configuration>
 			<property name=""serverConfig"">standalone-xts.xml</property>
+            <property name=""javaVmArguments"">-Dorg.jboss.byteman.verbose
+                                    -Djboss.modules.system.pkgs=org.jboss.byteman
+                                    -Dorg.jboss.byteman.transform.all
+                                    -javaagent:../lib/byteman.jar=listener:true
+            </property>
       </configuration>
    </container>
 ",2012-12-07T10:03:43Z,129
"@@ -0,0 +1,50 @@
+<?xml version=""1.0"" encoding=""UTF-8""?>
+<!-- JBoss, Home of Professional Open Source Copyright 2008, Red Hat Middleware LLC, and others contributors as indicated by the @authors tag. All rights reserved. See the copyright.txt in the distribution 
+	for a full listing of individual contributors. This copyrighted material is made available to anyone wishing to use, modify, copy, or redistribute it subject to the terms and conditions of the GNU Lesser 
+	General Public License, v. 2.1. This program is distributed in the hope that it will be useful, but WITHOUT A WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR 
+	PURPOSE. See the GNU Lesser General Public License for more details. You should have received a copy of the GNU Lesser General Public License, v.2.1 along with this distribution; if not, write to the Free 
+	Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA. -->
+<project xmlns=""http://maven.apache.org/POM/4.0.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
+         xsi:schemaLocation=""http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"">
+    <parent>
+        <groupId>org.jboss.jbossts.xts</groupId>
+        <artifactId>xts-all</artifactId>
+        <version>4.17.4.Final-SNAPSHOT</version>
+        <relativePath>../pom.xml</relativePath>
+    </parent>
+    <modelVersion>4.0.0</modelVersion>
+    <artifactId>byteman_support</artifactId>
+    <packaging>jar</packaging>
+    <name>Reusable Byteman rules for xts</name>
+    
+    <dependencies>
+        <dependency>
+            <groupId>org.jboss.byteman</groupId>
+            <artifactId>byteman</artifactId>
+        </dependency>
+        <dependency>
+            <groupId>org.jboss.byteman</groupId>
+            <artifactId>byteman-submit</artifactId>
+        </dependency>
+    </dependencies>
+  <profiles>
+    <profile>
+        <id>release</id>
+        <build>
+            <plugins>
+              <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                <artifactId>maven-install-plugin</artifactId>
+                <executions>
+                  <execution>
+                    <id>default-install</id>
+                    <phase>install</phase>
+                  </execution>
+                </executions>
+                <inherited>false</inherited>
+              </plugin>
+            </plugins>
+        </build>
+    </profile>
+  </profiles>
+</project>",2012-12-07T10:27:20Z,275
"@@ -0,0 +1,53 @@
+package org.jboss.jbossts.xts.bytemanSupport;
+
+import org.jboss.byteman.agent.submit.Submit;
+
+import java.io.IOException;
+import java.io.InputStream;
+import java.net.URL;
+import java.util.ArrayList;
+import java.util.List;
+
+/**
+ * @Author paul.robinson@redhat.com 22/11/2012
+ */
+public class BMScript {
+
+    private static final Submit submit = new Submit();
+
+    public static void submit(String scriptResourcePath) {
+
+        try {
+            List<InputStream> streams = getScriptFromResource(scriptResourcePath);
+            submit.addRulesFromResources(streams);
+        } catch (Exception e) {
+            throw new RuntimeException(""Failed to submit Byteman script"", e);
+        }
+    }
+
+    public static void remove(String scriptResourcePath) {
+
+        try {
+            List<InputStream> streams = getScriptFromResource(scriptResourcePath);
+            submit.deleteRulesFromResources(streams);
+        } catch (Exception e) {
+            throw new RuntimeException(""Failed to remove Byteman script"", e);
+        }
+    }
+
+    private static List<InputStream> getScriptFromResource(String scriptResourcePath) {
+        URL resource = Thread.currentThread().getContextClassLoader().getResource(scriptResourcePath);
+        if (resource == null) {
+            throw new RuntimeException(""'"" + scriptResourcePath + ""' can't be found on the classpath"");
+        }
+
+        List<InputStream> streams = new ArrayList<InputStream>();
+        try {
+            streams.add(resource.openStream());
+        } catch (IOException e) {
+            throw new RuntimeException(""Unable to open stream at url location: "" + resource.toString());
+        }
+        return streams;
+    }
+
+}",2012-12-07T10:27:20Z,276
"@@ -0,0 +1,13 @@
+package org.jboss.jbossts.xts.bytemanSupport.participantCompletion;
+
+/**
+ * @Author paul.robinson@redhat.com 26/11/2012
+ */
+public class ParticipantCompletionCoordinatorRules {
+
+    public static String RESOURCE_PATH= ""org/jboss/jbossts/xts/bytemanSupport/participantCompletion/participant_completion_coordinator_rules.btm"";
+
+    public static void setParticipantCount(Integer participantCount) {
+        //Dummy method, detected by Byteman Rules
+    }
+}",2012-12-07T10:27:20Z,277
"@@ -0,0 +1,40 @@
+RULE create counter
+CLASS org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules
+METHOD setParticipantCount(Integer)
+BIND counter:Integer=$1
+IF TRUE
+DO debug(""participant_completion.counter.create: "" + counter),
+  deleteCounter(""completes""),
+  createCounter(""completes"", counter)
+ENDRULE
+
+RULE complete called
+CLASS com.arjuna.webservices11.wsba.sei.BusinessAgreementWithParticipantCompletionCoordinatorPortTypeImpl
+METHOD completedOperation(NotificationType)
+AT RETURN
+BIND NOTHING
+IF (debug(""participant_completion.counter.decrement"") AND decrementCounter(""completes"") == 0)
+DO debug(""participant_completion.called.waking""),
+   signalWake(""complete"", true),
+   debug(""participant_completion.called.donewake"")
+ENDRULE
+
+RULE close called
+CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
+METHOD closeOperation(NotificationType)
+BIND NOTHING
+IF TRUE
+DO debug(""participant_completion.close.waiting""),
+   waitFor(""complete""),
+   debug(""participant_completion.close.woken"")
+ENDRULE
+
+RULE cancel called
+CLASS com.arjuna.webservices11.wsarjtx.sei.TerminationCoordinatorPortTypeImpl
+METHOD cancelOperation(NotificationType)
+BIND NOTHING
+IF TRUE
+DO debug(""participant_completion.cancel.waiting""),
+   waitFor(""complete""),
+   debug(""participant_completion.cancel.woken"")
+ENDRULE
\ No newline at end of file",2012-12-07T10:27:20Z,278
"@@ -67,8 +67,6 @@ public void testClose()
             throw eouter;
         }
 
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
 
 	    assertTrue(p.passed());",2012-12-07T10:27:20Z,279
"@@ -68,8 +68,6 @@ public void testExit()
             throw eouter;
         }
 
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
 
 	    assertTrue(p.passed());",2012-12-07T10:27:20Z,280
"@@ -73,8 +73,6 @@ public void testMultiClose()
             }
             throw eouter;
         }
-        //[JBTM-1292]
-        Thread.sleep(3*1000);
 	    uba.close();
         assertTrue(p.passed());
     }",2012-12-07T10:27:20Z,281
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -20,11 +24,23 @@ public class CloseTest {
 	public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				Close.class,
-				DemoBusinessParticipant.class);
+				DemoBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
 		test.testClose();
 	}
 }",2012-12-07T10:27:20Z,282
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -20,11 +24,23 @@ public class CompensateTest {
 	public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				Compensate.class,
-				DemoBusinessParticipant.class);
+				DemoBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
 		test.testCompensate();
 	}
 }",2012-12-07T10:27:20Z,283
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -14,6 +18,7 @@
 
 @RunWith(Arquillian.class)
 public class MultiCloseTest {
+    
 	@Inject
 	MultiClose test;
 	
@@ -22,11 +27,23 @@ public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				MultiClose.class,
 				DemoBusinessParticipant.class,
-				FailureBusinessParticipant.class);
+				FailureBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
-	
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(2);
 		test.testMultiClose();
 	}
 }",2012-12-07T10:27:20Z,281
"@@ -4,7 +4,11 @@
 
 import org.jboss.arquillian.container.test.api.Deployment;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.shrinkwrap.api.spec.WebArchive;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
@@ -22,11 +26,23 @@ public static WebArchive createDeployment() {
 		return WarDeployment.getDeployment(
 				MultiCompensate.class,
 				DemoBusinessParticipant.class,
-				FailureBusinessParticipant.class);
+				FailureBusinessParticipant.class,
+                ParticipantCompletionCoordinatorRules.class);
 	}
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
 	
 	@Test
 	public void test() throws Exception {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(2);
 		test.testMultiCompensate();
 	}
 }",2012-12-07T10:27:20Z,284
"@@ -18,7 +18,12 @@
 	<description>localjunit tests for xts</description>
         <properties>
             <buildType>11</buildType>
-            <general.server.jvm.args>-Xms64m -Xmx1024m -XX:MaxPermSize=512m</general.server.jvm.args>
+            <general.server.jvm.args>-Xms64m -Xmx1024m -XX:MaxPermSize=512m
+                                     -Dorg.jboss.byteman.verbose
+                                    -Djboss.modules.system.pkgs=org.jboss.byteman
+                                    -Dorg.jboss.byteman.transform.all
+                                    -javaagent:${project.build.directory}/lib/byteman.jar=listener:true
+            </general.server.jvm.args>
             <ipv4.server.jvm.args></ipv4.server.jvm.args>
             <ipv6.server.jvm.args>-Djboss.bind.address=[::1] -Djboss.bind.address.management=[::1] -Djboss.bind.address.unsecure=[::1] -Djava.net.preferIPv4Stack=false -Djava.net.preferIPv6Addresses=true</ipv6.server.jvm.args>
             <server.debug.args>Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5006</server.debug.args>
@@ -35,6 +40,26 @@
                 </plugin>
             </plugins>
         </pluginManagement>
+        <plugins>
+                <plugin>
+                    <groupId>org.apache.maven.plugins</groupId>
+                      <artifactId>maven-dependency-plugin</artifactId>
+                      <executions>
+                        <execution>
+                          <id>copy-dependencies</id>
+                          <phase>test-compile</phase>
+                          <goals>
+                            <goal>copy-dependencies</goal>
+                          </goals>
+                          <configuration>
+                              <stripVersion>true</stripVersion>
+                              <includeGroupIds>org.jboss.byteman</includeGroupIds>
+                            <outputDirectory>${project.build.directory}/lib</outputDirectory>
+                          </configuration>
+                        </execution>
+                      </executions>
+                </plugin>
+        </plugins>
     </build>
 
 	<dependencies>
@@ -43,6 +68,16 @@
 			<artifactId>jbossxts</artifactId>
 			<scope>provided</scope>
 		</dependency>
+		<dependency>
+			<groupId>org.jboss.jbossts.xts</groupId>
+			<artifactId>byteman_support</artifactId>
+            <scope>test</scope>
+		</dependency>
+        <dependency>
+            <groupId>org.jboss.jbossts</groupId>
+            <artifactId>common</artifactId>
+            <scope>provided</scope>
+        </dependency>
 		<dependency>
 			<groupId>junit</groupId>
 			<artifactId>junit</artifactId>",2012-12-07T10:27:20Z,34
"@@ -37,6 +37,7 @@
     </plugins>
   </build>
   <modules>
+    <module>byteman_support</module>
     <module>WSAS</module>
     <module>WSAS/xts-test-servlet</module>
     <module>WS-C</module>",2012-12-07T10:27:20Z,285
"@@ -52,6 +52,14 @@
     </plugins>
   </build>
   <dependencies>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman</artifactId>
+    </dependency>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman-submit</artifactId>
+    </dependency>
     <!-- START TEST -->
     <dependency>
       <groupId>junit</groupId>",2012-12-07T10:27:20Z,286
"@@ -942,6 +942,11 @@
         <artifactId>service</artifactId>
         <version>${project.version}</version>
       </dependency>
+      <dependency>
+		<groupId>org.jboss.jbossts.xts</groupId>
+		<artifactId>byteman_support</artifactId>
+        <version>${project.version}</version>
+	  </dependency>
       <dependency>
         <groupId>org.jboss.jbossts.rts</groupId>
         <artifactId>restat-web</artifactId>
@@ -973,27 +978,27 @@
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-install</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-submit</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-bmunit</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
       <dependency>
         <groupId>org.jboss.byteman</groupId>
         <artifactId>byteman-dtest</artifactId>
-        <version>2.0.1</version>
+        <version>2.1.2</version>
       </dependency>
   </dependencies>
   </dependencyManagement>",2012-12-07T10:27:20Z,39
"@@ -37,6 +37,24 @@
                     <skip>true</skip>
                 </configuration>
             </plugin>
+            <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                  <artifactId>maven-dependency-plugin</artifactId>
+                  <executions>
+                    <execution>
+                      <id>copy-dependencies</id>
+                      <phase>test-compile</phase>
+                      <goals>
+                        <goal>copy-dependencies</goal>
+                      </goals>
+                      <configuration>
+                          <stripVersion>true</stripVersion>
+                          <includeGroupIds>org.jboss.byteman</includeGroupIds>
+                        <outputDirectory>${project.build.directory}/lib</outputDirectory>
+                      </configuration>
+                    </execution>
+                  </executions>
+            </plugin>
         </plugins>
     </build>
 
@@ -112,6 +130,11 @@
                 </exclusion>
             </exclusions>
         </dependency>
+		<dependency>
+			<groupId>org.jboss.jbossts.xts</groupId>
+			<artifactId>byteman_support</artifactId>
+            <scope>test</scope>
+		</dependency>
         <dependency>
             <groupId>org.jboss.jbossts.rts</groupId>
             <artifactId>restat-util</artifactId>",2012-12-07T10:27:20Z,41
"@@ -5,14 +5,18 @@
 import com.arjuna.wst.TransactionRolledBackException;
 import junit.framework.Assert;
 import org.jboss.arquillian.junit.Arquillian;
+import org.jboss.jbossts.xts.bytemanSupport.BMScript;
+import org.jboss.jbossts.xts.bytemanSupport.participantCompletion.ParticipantCompletionCoordinatorRules;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Close;
 import org.jboss.narayana.txframework.functional.clients.BAParticipantCompletionClient;
 import org.jboss.narayana.txframework.functional.common.ServiceCommand;
 import org.jboss.narayana.txframework.functional.interfaces.BAParticipantCompletion;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.Compensate;
 import org.jboss.narayana.txframework.api.annotation.lifecycle.ba.ConfirmCompleted;
 import org.junit.After;
+import org.junit.AfterClass;
 import org.junit.Before;
+import org.junit.BeforeClass;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import javax.xml.ws.soap.SOAPFaultException;
@@ -26,6 +30,17 @@ public class BAParticipantCompletionTest extends BaseFunctionalTest
     UserBusinessActivity uba;
     BAParticipantCompletion client;
 
+
+    @BeforeClass()
+    public static void submitBytemanScript() throws Exception {
+        BMScript.submit(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
+    @AfterClass()
+    public static void removeBytemanScript() {
+        BMScript.remove(ParticipantCompletionCoordinatorRules.RESOURCE_PATH);
+    }
+
     @Before
     public void setupTest() throws Exception
     {
@@ -44,9 +59,10 @@ public void teardownTest() throws Exception
     @Test
     public void testAutoComplete() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+        
         uba.begin();
         client.saveDataAutoComplete();
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -56,9 +72,10 @@ public void testAutoComplete() throws Exception
     @Test
     public void testManualComplete() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
         uba.begin();
         client.saveDataManualComplete(ServiceCommand.COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -67,10 +84,11 @@ public void testManualComplete() throws Exception
     @Test
     public void testMultiInvoke() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+        
         uba.begin();
         client.saveDataManualComplete();
         client.saveDataManualComplete(ServiceCommand.COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
 
         assertOrder(ConfirmCompleted.class, Close.class);
@@ -79,9 +97,10 @@ public void testMultiInvoke() throws Exception
     @Test
     public void testClientDrivenCompensate() throws Exception
     {
+        ParticipantCompletionCoordinatorRules.setParticipantCount(1);
+
         uba.begin();
         client.saveDataAutoComplete();
-        Thread.sleep(10000); //JBTM-1203
         uba.cancel();
 
         assertOrder(ConfirmCompleted.class, Compensate.class);
@@ -113,8 +132,8 @@ public void testCannotComplete() throws Exception
     {
         uba.begin();
         client.saveDataAutoComplete(ServiceCommand.CANNOT_COMPLETE);
-        Thread.sleep(10000); //JBTM-1203
         uba.close();
+        
         assertOrder();
     }
 ",2012-12-07T10:27:20Z,287
"@@ -16,6 +16,11 @@
       <!-- If you want to use the JBOSS_HOME environment variable, just delete the jbossHome property -->
       <configuration>
 			<property name=""serverConfig"">standalone-xts.xml</property>
+            <property name=""javaVmArguments"">-Dorg.jboss.byteman.verbose
+                                    -Djboss.modules.system.pkgs=org.jboss.byteman
+                                    -Dorg.jboss.byteman.transform.all
+                                    -javaagent:../lib/byteman.jar=listener:true
+            </property>
       </configuration>
    </container>
 ",2012-12-07T10:27:20Z,129
"@@ -13,4 +13,5 @@ qa/transaction.log.1
 qa/transaction.log.2
 qa/value_1
 qa/value_2
-
+qa/testoutput-idlj.zip
+qa/testoutput-jacorb.zip",2012-10-22T08:37:20Z,304
"@@ -34,6 +34,7 @@
 import static org.junit.Assert.assertFalse;
 import static org.junit.Assert.assertTrue;
 
+import java.lang.reflect.Field;
 import java.util.ArrayList;
 import java.util.List;
 import java.util.Vector;
@@ -49,6 +50,8 @@
 import com.arjuna.ats.arjuna.common.RecoveryEnvironmentBean;
 import com.arjuna.ats.arjuna.common.Uid;
 import com.arjuna.ats.arjuna.coordinator.ActionStatus;
+import com.arjuna.ats.arjuna.coordinator.BasicAction;
+import com.arjuna.ats.arjuna.coordinator.RecordList;
 import com.arjuna.ats.arjuna.objectstore.StoreManager;
 import com.arjuna.ats.arjuna.recovery.ActionStatusService;
 import com.arjuna.ats.arjuna.recovery.RecoverAtomicAction;
@@ -166,8 +169,8 @@ public void testHeuristicRollback() throws Exception {
 
 		RecoveryEnvironmentBean recoveryEnvironmentBean = BeanPopulator
 				.getDefaultInstance(RecoveryEnvironmentBean.class);
-		recoveryEnvironmentBean.setRecoveryBackoffPeriod(1);
-		recoveryEnvironmentBean.setPeriodicRecoveryPeriod(1);
+		recoveryEnvironmentBean.setRecoveryBackoffPeriod(Integer.MAX_VALUE);
+		recoveryEnvironmentBean.setPeriodicRecoveryPeriod(Integer.MAX_VALUE);
 
 		List<String> recoveryModuleClassNames = new ArrayList<String>();
 
@@ -202,8 +205,7 @@ public void testHeuristicRollback() throws Exception {
 
 		XAResource firstResource = new SimpleResource();
 		Object toWakeUp = new Object();
-		final SimpleResourceXA_RETRYHeuristicRollback secondResource = new SimpleResourceXA_RETRYHeuristicRollback(
-				toWakeUp);
+		final SimpleResourceXA_RETRYHeuristicRollback secondResource = new SimpleResourceXA_RETRYHeuristicRollback();
 
 		xaRecoveryModule
 				.addXAResourceRecoveryHelper(new XAResourceRecoveryHelper() {
@@ -239,36 +241,57 @@ public XAResource[] getXAResources() throws Exception {
 
 		tm.commit();
 
-		synchronized (toWakeUp) {
-			toWakeUp.wait();
-		}
-		assertTrue(secondResource.wasCommitted());
-
 		InputObjectState uids = new InputObjectState();
 		String type = new AtomicAction().type();
-		StoreManager.getRecoveryStore().allObjUids(
-				type,
-				uids);
+		StoreManager.getRecoveryStore().allObjUids(type, uids);
 		boolean moreUids = true;
 
 		boolean found = false;
 		while (moreUids) {
 			Uid theUid = UidHelper.unpackFrom(uids);
 			if (theUid.equals(txUid)) {
-	            ActionStatusService ass = new ActionStatusService();
-
-	            int theStatus = ass.getTransactionStatus(type, theUid.stringForm());
-	            System.out.println(ActionStatus.stringForm( theStatus )) ;
-	            RecoverAtomicAction rcvAtomicAction =
-	                    new RecoverAtomicAction( theUid, theStatus ) ;
-	            theStatus = rcvAtomicAction.status();
-	            System.out.println(ActionStatus.stringForm( theStatus )) ;
 				found = true;
+				Field heuristicListField = BasicAction.class
+						.getDeclaredField(""heuristicList"");
+				heuristicListField.setAccessible(true);
+				ActionStatusService ass = new ActionStatusService();
+
+				{
+					int theStatus = ass.getTransactionStatus(type,
+							theUid.stringForm());
+					assertTrue(theStatus == ActionStatus.COMMITTED);
+					RecoverAtomicAction rcvAtomicAction = new RecoverAtomicAction(
+							theUid, theStatus);
+					theStatus = rcvAtomicAction.status();
+					rcvAtomicAction.replayPhase2();
+					assertTrue(theStatus == ActionStatus.COMMITTED);
+					assertTrue(secondResource.wasCommitted());
+					RecordList heuristicList = (RecordList) heuristicListField
+							.get(rcvAtomicAction);
+					assertTrue(
+							""Expected 1 heuristics: "" + heuristicList.size(),
+							heuristicList.size() == 1);
+				}
+				{
+					int theStatus = ass.getTransactionStatus(type,
+							theUid.stringForm());
+					assertTrue(theStatus == ActionStatus.COMMITTED);
+					RecoverAtomicAction rcvAtomicAction = new RecoverAtomicAction(
+							theUid, theStatus);
+					theStatus = rcvAtomicAction.status();
+					assertTrue(theStatus == ActionStatus.COMMITTED);
+					RecordList heuristicList = (RecordList) heuristicListField
+							.get(rcvAtomicAction);
+					assertTrue(
+							""Expected 1 heuristics: "" + heuristicList.size(),
+							heuristicList.size() == 1);
+					assertTrue(secondResource.wasCommitted());
+				}
 			} else if (theUid.equals(Uid.nullUid())) {
 				moreUids = false;
 			}
 		}
-		
+
 		if (!found) {
 			throw new Exception(""Could not locate the Uid"");
 		}",2012-05-29T14:52:19Z,305
"@@ -28,11 +28,6 @@ public class SimpleResourceXA_RETRYHeuristicRollback implements XAResource {
 	private Xid xid;
 	private boolean firstAttemptToCommit = true;
 	private boolean committed = false;
-	private Object toWakeUp;
-
-	public SimpleResourceXA_RETRYHeuristicRollback(Object toWakeUp) {
-		this.toWakeUp = toWakeUp;
-	}
 
 	public void commit(Xid xid, boolean onePhase) throws XAException {
 		System.out.println(""SimpleResourceXA_RETRY commit called: "" + xid);
@@ -43,9 +38,6 @@ public void commit(Xid xid, boolean onePhase) throws XAException {
 		}
 		xid = null;
 		committed = true;
-		synchronized (toWakeUp) {
-			toWakeUp.notify();
-		}
 		throw new XAException(XAException.XA_HEURRB);
 	}
 ",2012-05-29T14:52:19Z,306
"@@ -1,121 +1,174 @@
-if [ -z ""${WORKSPACE}"" ]; then
-  echo ""UNSET WORKSPACE""
-  exit -1;
-fi
-
-isIdlj=0
-for arg in ""$@""; do
-  if [ `echo ""$arg"" |grep ""idlj""` ]; then
-    isIdlj=1
+function fatal {
+  echo ""$1""
+  exit -1
+}
+
+#BUILD NARAYANA WITH FINDBUGS
+function build_narayana {
+  echo ""Building Narayana""
+  cd $WORKSPACE
+  [ $NARAYANA_TESTS == 1 ] && NARAYANA_ARGS= || NARAYANA_ARGS=""-DskipTests""
+  [ $IDLJ == 1 ] && NARAYANA_ARGS=""$NARAYANA_ARGS -Pidlj""
+
+  ./build.sh -Dfindbugs.skip=false -Dfindbugs.failOnError=false ""$@"" $NARAYANA_ARGS $IPV6_OPTS clean install
+  [ $? = 0 ] || fatal ""narayana build failed""
+  cp_narayana_to_as
+  return 0
+}
+
+function cp_narayana_to_as {
+  echo ""Copying Narayana to AS""
+  cd $WORKSPACE
+  JBOSS_VERSION=`ls -1 ${WORKSPACE}/jboss-as/build/target | grep jboss-as`
+  [ $? = 0 ] || return 1
+  export JBOSS_HOME=${WORKSPACE}/jboss-as/build/target/${JBOSS_VERSION}
+  [ -d $JBOSS_HOME ] || return 1
+
+  echo ""WARNING - check that narayana version ${NARAYANA_VERSION} is the one you want""
+  JAR1=narayana-jts-integration-${NARAYANA_VERSION}.jar
+  JAR2=narayana-jts-${NARAYANA_VERSION}.jar
+# TODO make sure ${JBOSS_HOME} doesn't already contain a different version of narayana
+  echo ""cp ./ArjunaJTS/integration/target/$JAR1 ${JBOSS_HOME}/modules/org/jboss/jts/integration/main/""
+  echo ""cp ./ArjunaJTS/narayana-jts/target/$JAR2 ${JBOSS_HOME}/modules/org/jboss/jts/main/""
+  cp ./ArjunaJTS/integration/target/$JAR1 ${JBOSS_HOME}/modules/org/jboss/jts/integration/main/
+  [ $? = 0 ] || return 1
+  cp ./ArjunaJTS/narayana-jts/target/$JAR2 ${JBOSS_HOME}/modules/org/jboss/jts/main/
+}
+
+function build_as {
+  echo ""Building AS""
+  GIT_URL=""https://github.com/jbosstm/jboss-as.git""
+  UPSTREAM_GIT_URL=""https://github.com/jbossas/jboss-as.git""
+
+  cd ${WORKSPACE}
+  rm -rf jboss-as
+  git clone $GIT_URL
+  [ $? = 0 ] || fatal ""git clone $GIT_URL failed""
+
+  cd jboss-as
+  git checkout -t origin/5_BRANCH
+  [ $? = 0 ] || fatal ""git checkout 5_BRANCH failed""
+
+  git remote add upstream $UPSTREAM_GIT_URL
+  git pull --rebase --ff-only upstream master
+  [ $? = 0 ] || fatal ""git rebase failed""
+
+  export MAVEN_OPTS=""-XX:MaxPermSize=512m""
+  export JAVA_OPTS=""-Xms1303m -Xmx1303m -XX:MaxPermSize=512m""
+  ./build.sh clean install -DskipTests -Dts.smoke=false $IPV6_OPTS
+  [ $? = 0 ] || fatal ""AS build failed""
+  init_jboss_home
+}
+
+function init_jboss_home {
+  cd $WORKSPACE
+  JBOSS_VERSION=`ls -1 ${WORKSPACE}/jboss-as/build/target | grep jboss-as`
+  [ $? = 0 ] || fatal ""missing AS - cannot set JBOSS_VERSION""
+  export JBOSS_HOME=${WORKSPACE}/jboss-as/build/target/${JBOSS_VERSION}
+  [ -d $JBOSS_HOME ] || fatal ""missing AS - $JBOSS_HOME is not a directory""
+  echo ""JBOSS_HOME=$JBOSS_HOME""
+}
+
+function txframework_tests {
+  echo ""#0. TXFramework Test""
+  cp ./rest-tx/webservice/target/rest-tx-web-*.war $JBOSS_HOME/standalone/deployments
+  ./build.sh -f ./txframework/pom.xml $mvn_arqprof ""$@"" test
+  [ $? = 0 ] || fatal ""TxFramework build failed""
+}
+
+function xts_tests {
+  echo ""#1 XTS: WSTX11 INTEROP, UNIT TESTS, xtstest and CRASH RECOVERY TESTS""
+
+  cd $WORKSPACE
+  ran_crt=0
+
+  if [ $WSTX_MODULES ]; then
+    [[ $WSTX_MODULES = *crash-recovery-tests* ]] && ran_crt=1
+    echo ""BUILDING SPECIFIC WSTX11 modules""
+    ./build.sh -f XTS/localjunit/pom.xml --projects ""$WSTX_MODULES"" -P$ARQ_PROF ""$@"" $IPV6_OPTS clean test
+  else
+    ./build.sh -f XTS/localjunit/pom.xml -P$ARQ_PROF ""$@"" $IPV6_OPTS clean test
+    ran_crt=0
+  fi
+
+  [ $? = 0 ] || fatal ""XTS: SOME TESTS failed""
+
+  if [ $ran_crt = 1 ]; then
+    (cd XTS/sar/crash-recovery-tests && java -cp target/classes/ com.arjuna.qa.simplifylogs.SimplifyLogs ./target/log/ ./target/log-simplified)
+    [ $? = 0 ] || fatal ""Simplify CRASH RECOVERY logs failed""
   fi
-done
+}
+
+function tx_bridge_tests {
+  echo ""XTS: TXBRIDGE TESTS update conf""
+  cd $WORKSPACE
+  CONF=""${JBOSS_HOME}/docs/examples/configs/standalone-xts.xml""
+  grep recovery-listener ""$CONF""
+  sed -e s/recovery-listener=\""true\""//g -i $CONF
+  sed -e ""s#\(recovery-environment\) \(socket-binding\)#\\1 recovery-listener=\""true\"" \\2#"" -i $CONF
+
+#  sed -e ""s#\(recovery-environment\) \(socket-binding\)#\\1 recovery-listener=\""true\"" \\2#"" -i $CONF
+  [ $? = 0 ] || fatal ""#3.TXBRIDGE TESTS: sed failed""
+
+  echo ""XTS: TXBRIDGE TESTS""
+  ./build.sh -f txbridge/pom.xml -P$ARQ_PROF ""$@"" $IPV6_OPTS test
+  [ $? = 0 ] || fatal ""#3.TXBRIDGE TESTS failed""
+}
+
+function qa_tests {
+  echo ""QA Test Suite""
+  cd $WORKSPACE/qa
+
+  sed -i TaskImpl.properties -e ""s#^COMMAND_LINE_0=.*#COMMAND_LINE_0=${JAVA_HOME}/bin/java#""
+  [ $? = 0 ] || fatal ""sed TaskImpl.properties failed""
 
-# test whether the IPV6 evironment variable is set
-if [ -v IPV6 ]; then
-  mvn_arqprof=""-ParqIPv6""
-else
-  mvn_arqprof=""-Parq""
-fi
+  # delete lines containing jacorb
+  [ $IDLJ == 1 ] && sed -i TaskImpl.properties -e  '/^.*separator}jacorb/ d'
 
+  ant -DisIdlj=$IDLJ ""$QA_BUILD_ARGS"" get.drivers dist
+  [ $? = 0 ] || fatal ""qa build failed""
+
+  [ $IPV6_OPTS ] && target=""junit-testsuite"" || target=""ci-tests""
+  ant -f run-tests.xml $target
+  [ $? = 0 ] || fatal ""some qa tests failed""
+}
+
+# if the following env variables have not been set initialize them to their defaults
+[ $NARAYANA_VERSION ] || NARAYANA_VERSION=""5.0.0.M2-SNAPSHOT""
+[ $ARQ_PROF ] || ARQ_PROF=arq	# IPv4 arquillian profile
+
+[ $NARAYANA_TESTS ] || NARAYANA_TESTS=1	# run the narayana surefire tests
+[ $NARAYANA_BUILD ] || NARAYANA_BUILD=1 # build narayana
+[ $AS_BUILD ] || AS_BUILD=1 # git clone and build a fresh copy of the AS
+[ $TXF_TESTS ] || TXF_TESTS=0 # TxFramework tests
+[ $XTS_TESTS ] || XTS_TESTS=1 # XTS tests
+[ $QA_TESTS ] || QA_TESTS=1 # QA test suite
+[ $txbridge ] || txbridge=1 # bridge tests
+[ $IDLJ ] || IDLJ=0 # use the Sun orb instead of the default JacORB
+
+QA_BUILD_ARGS=""-Ddriver.url=file:///home/hudson/dbdrivers""
+
+# for IPv6 testing use export ARQ_PROF=arqIPv6
+# if you don't want to run all the XTS tests set WSTX_MODULES to the ones you want, eg:
+# export WSTX_MODULES=""WSAS,WSCF,WSTX,WS-C,WS-T,xtstest,crash-recovery-tests""
+
+[ -z ""${WORKSPACE}"" ] && fatal ""UNSET WORKSPACE""
 
 # FOR DEBUGGING SUBSEQUENT ISSUES
 free -m
 
 #Make sure no JBoss processes running
-for i in `ps -eaf | grep java | grep ""standalone"" | grep -v grep | cut -c10-15`; do kill $i; done
+for i in `ps -eaf | grep java | grep ""standalone*.xml"" | grep -v grep | cut -c10-15`; do kill $i; done
 
-#BUILD NARAYANA WITH FINDBUGS
-./build.sh -Dfindbugs.skip=false -Dfindbugs.failOnError=false ""$@"" clean install
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-GIT_URL=""https://github.com/jbosstm/jboss-as.git""
-UPSTREAM_GIT_URL=""https://github.com/jbossas/jboss-as.git""
-
-#BUILD JBOSS-AS
-cd ${WORKSPACE}
-rm -rf jboss-as
-git clone $GIT_URL
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-cd jboss-as
-git checkout -t origin/5_BRANCH
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-git remote add upstream $UPSTREAM_GIT_URL
-git pull --rebase --ff-only upstream master
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-MAVEN_OPTS=-XX:MaxPermSize=256m ./build.sh ""$@"" clean install -DskipTests
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-JBOSS_VERSION=`ls -1 ${WORKSPACE}/jboss-as/build/target | grep jboss-as`
-export JBOSS_HOME=${WORKSPACE}/jboss-as/build/target/${JBOSS_VERSION}
-
-cd ${WORKSPACE}
-
-#0. TXFramework Tests
-#cp ./rest-tx/webservice/target/rest-tx-web-*.war $JBOSS_HOME/standalone/deployments
-#./build.sh -f ./txframework/pom.xml $mvn_arqprof ""$@"" test
-#if [ ""$?"" != ""0"" ]; then
-#        exit -1
-#fi
-
-#1.WSTX11 INTEROP and UNIT TESTS and CRASH RECOVERY TESTS
-./build.sh -f XTS/localjunit/pom.xml $mvn_arqprof ""$@"" clean install
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-#2.CHECK CRASH REC OUTPUT
-(cd XTS/localjunit/crash-recovery-tests && java -cp target/classes/ com.arjuna.qa.simplifylogs.SimplifyLogs ./target/log/ ./target/log-simplified)
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-#3.TXBRIDGE TESTS
-cd ${WORKSPACE}
-sed -e ""s#\(recovery-environment\) \(socket-binding\)#\\1 recovery-listener=\""true\"" \\2#"" -i ${JBOSS_HOME}/docs/examples/configs/standalone-xts.xml
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-./build.sh -f txbridge/pom.xml $mvn_arqprof ""$@"" clean test
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-#RUN QA TESTS
-cd $WORKSPACE/qa
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-sed -i TaskImpl.properties -e ""s#^COMMAND_LINE_0=.*#COMMAND_LINE_0=${JAVA_HOME}/bin/java#""
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-if [ $isIdlj == 1 ]; then
-# delete lines containing jacorb
-	sed -i TaskImpl.properties -e  '/^.*separator}jacorb/ d'
-fi
-
-ant -DisIdlj=$isIdlj -Ddriver.url=file:///home/hudson/dbdrivers get.drivers dist
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-ant -f run-tests.xml ci-tests
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
+# if we are building with IPv6 tell ant about it
+export ANT_OPTS=""$ANT_OPTS $IPV6_OPTS""
+
+# run the job
+[ $NARAYANA_BUILD = 1 ] && build_narayana ""$@""
+[ $AS_BUILD = 1 ] && build_as ""$@"" || init_jboss_home
+[ $TXF_TESTS = 1 ] && txframework_tests ""$@""
+[ $XTS_TESTS = 1 ] && xts_tests ""$@""
+[ $txbridge = 1 ] && tx_bridge_tests ""$@""
+[ $QA_TESTS = 1 ] && qa_tests ""$@""
+
+exit 0",2012-07-13T19:18:21Z,10
"@@ -1028,6 +1028,7 @@
         <module>txbridge</module>
         <module>fileio</module>
         <module>STM</module>
+        <module>txframework</module>
         <module>narayana-full</module>
       </modules>
     </profile>",2012-06-20T13:38:51Z,39
"@@ -1,121 +1,174 @@
-if [ -z ""${WORKSPACE}"" ]; then
-  echo ""UNSET WORKSPACE""
-  exit -1;
-fi
-
-isIdlj=0
-for arg in ""$@""; do
-  if [ `echo ""$arg"" |grep ""idlj""` ]; then
-    isIdlj=1
+function fatal {
+  echo ""$1""
+  exit -1
+}
+
+#BUILD NARAYANA WITH FINDBUGS
+function build_narayana {
+  echo ""Building Narayana""
+  cd $WORKSPACE
+  [ $NARAYANA_TESTS == 1 ] && NARAYANA_ARGS= || NARAYANA_ARGS=""-DskipTests""
+  [ $IDLJ == 1 ] && NARAYANA_ARGS=""$NARAYANA_ARGS -Pidlj""
+
+  ./build.sh -Dfindbugs.skip=false -Dfindbugs.failOnError=false ""$@"" $NARAYANA_ARGS $IPV6_OPTS clean install
+  [ $? = 0 ] || fatal ""narayana build failed""
+  cp_narayana_to_as
+  return 0
+}
+
+function cp_narayana_to_as {
+  echo ""Copying Narayana to AS""
+  cd $WORKSPACE
+  JBOSS_VERSION=`ls -1 ${WORKSPACE}/jboss-as/build/target | grep jboss-as`
+  [ $? = 0 ] || return 1
+  export JBOSS_HOME=${WORKSPACE}/jboss-as/build/target/${JBOSS_VERSION}
+  [ -d $JBOSS_HOME ] || return 1
+
+  echo ""WARNING - check that narayana version ${NARAYANA_VERSION} is the one you want""
+  JAR1=narayana-jts-integration-${NARAYANA_VERSION}.jar
+  JAR2=narayana-jts-${NARAYANA_VERSION}.jar
+# TODO make sure ${JBOSS_HOME} doesn't already contain a different version of narayana
+  echo ""cp ./ArjunaJTS/integration/target/$JAR1 ${JBOSS_HOME}/modules/org/jboss/jts/integration/main/""
+  echo ""cp ./ArjunaJTS/narayana-jts/target/$JAR2 ${JBOSS_HOME}/modules/org/jboss/jts/main/""
+  cp ./ArjunaJTS/integration/target/$JAR1 ${JBOSS_HOME}/modules/org/jboss/jts/integration/main/
+  [ $? = 0 ] || return 1
+  cp ./ArjunaJTS/narayana-jts/target/$JAR2 ${JBOSS_HOME}/modules/org/jboss/jts/main/
+}
+
+function build_as {
+  echo ""Building AS""
+  GIT_URL=""https://github.com/jbosstm/jboss-as.git""
+  UPSTREAM_GIT_URL=""https://github.com/jbossas/jboss-as.git""
+
+  cd ${WORKSPACE}
+  rm -rf jboss-as
+  git clone $GIT_URL
+  [ $? = 0 ] || fatal ""git clone $GIT_URL failed""
+
+  cd jboss-as
+  git checkout -t origin/5_BRANCH
+  [ $? = 0 ] || fatal ""git checkout 5_BRANCH failed""
+
+  git remote add upstream $UPSTREAM_GIT_URL
+  git pull --rebase --ff-only upstream master
+  [ $? = 0 ] || fatal ""git rebase failed""
+
+  export MAVEN_OPTS=""-XX:MaxPermSize=512m""
+  export JAVA_OPTS=""-Xms1303m -Xmx1303m -XX:MaxPermSize=512m""
+  ./build.sh clean install -DskipTests -Dts.smoke=false $IPV6_OPTS
+  [ $? = 0 ] || fatal ""AS build failed""
+  init_jboss_home
+}
+
+function init_jboss_home {
+  cd $WORKSPACE
+  JBOSS_VERSION=`ls -1 ${WORKSPACE}/jboss-as/build/target | grep jboss-as`
+  [ $? = 0 ] || fatal ""missing AS - cannot set JBOSS_VERSION""
+  export JBOSS_HOME=${WORKSPACE}/jboss-as/build/target/${JBOSS_VERSION}
+  [ -d $JBOSS_HOME ] || fatal ""missing AS - $JBOSS_HOME is not a directory""
+  echo ""JBOSS_HOME=$JBOSS_HOME""
+}
+
+function txframework_tests {
+  echo ""#0. TXFramework Test""
+  cp ./rest-tx/webservice/target/rest-tx-web-*.war $JBOSS_HOME/standalone/deployments
+  ./build.sh -f ./txframework/pom.xml $mvn_arqprof ""$@"" test
+  [ $? = 0 ] || fatal ""TxFramework build failed""
+}
+
+function xts_tests {
+  echo ""#1 XTS: WSTX11 INTEROP, UNIT TESTS, xtstest and CRASH RECOVERY TESTS""
+
+  cd $WORKSPACE
+  ran_crt=0
+
+  if [ $WSTX_MODULES ]; then
+    [[ $WSTX_MODULES = *crash-recovery-tests* ]] && ran_crt=1
+    echo ""BUILDING SPECIFIC WSTX11 modules""
+    ./build.sh -f XTS/localjunit/pom.xml --projects ""$WSTX_MODULES"" -P$ARQ_PROF ""$@"" $IPV6_OPTS clean test
+  else
+    ./build.sh -f XTS/localjunit/pom.xml -P$ARQ_PROF ""$@"" $IPV6_OPTS clean test
+    ran_crt=0
+  fi
+
+  [ $? = 0 ] || fatal ""XTS: SOME TESTS failed""
+
+  if [ $ran_crt = 1 ]; then
+    (cd XTS/sar/crash-recovery-tests && java -cp target/classes/ com.arjuna.qa.simplifylogs.SimplifyLogs ./target/log/ ./target/log-simplified)
+    [ $? = 0 ] || fatal ""Simplify CRASH RECOVERY logs failed""
   fi
-done
+}
+
+function tx_bridge_tests {
+  echo ""XTS: TXBRIDGE TESTS update conf""
+  cd $WORKSPACE
+  CONF=""${JBOSS_HOME}/docs/examples/configs/standalone-xts.xml""
+  grep recovery-listener ""$CONF""
+  sed -e s/recovery-listener=\""true\""//g -i $CONF
+  sed -e ""s#\(recovery-environment\) \(socket-binding\)#\\1 recovery-listener=\""true\"" \\2#"" -i $CONF
+
+#  sed -e ""s#\(recovery-environment\) \(socket-binding\)#\\1 recovery-listener=\""true\"" \\2#"" -i $CONF
+  [ $? = 0 ] || fatal ""#3.TXBRIDGE TESTS: sed failed""
+
+  echo ""XTS: TXBRIDGE TESTS""
+  ./build.sh -f txbridge/pom.xml -P$ARQ_PROF ""$@"" $IPV6_OPTS test
+  [ $? = 0 ] || fatal ""#3.TXBRIDGE TESTS failed""
+}
+
+function qa_tests {
+  echo ""QA Test Suite""
+  cd $WORKSPACE/qa
+
+  sed -i TaskImpl.properties -e ""s#^COMMAND_LINE_0=.*#COMMAND_LINE_0=${JAVA_HOME}/bin/java#""
+  [ $? = 0 ] || fatal ""sed TaskImpl.properties failed""
 
-# test whether the IPV6 evironment variable is set
-if [ -v IPV6 ]; then
-  mvn_arqprof=""-ParqIPv6""
-else
-  mvn_arqprof=""-Parq""
-fi
+  # delete lines containing jacorb
+  [ $IDLJ == 1 ] && sed -i TaskImpl.properties -e  '/^.*separator}jacorb/ d'
 
+  ant -DisIdlj=$IDLJ ""$QA_BUILD_ARGS"" get.drivers dist
+  [ $? = 0 ] || fatal ""qa build failed""
+
+  [ $IPV6_OPTS ] && target=""junit-testsuite"" || target=""ci-tests""
+  ant -f run-tests.xml $target
+  [ $? = 0 ] || fatal ""some qa tests failed""
+}
+
+# if the following env variables have not been set initialize them to their defaults
+[ $NARAYANA_VERSION ] || NARAYANA_VERSION=""5.0.0.M2-SNAPSHOT""
+[ $ARQ_PROF ] || ARQ_PROF=arq	# IPv4 arquillian profile
+
+[ $NARAYANA_TESTS ] || NARAYANA_TESTS=1	# run the narayana surefire tests
+[ $NARAYANA_BUILD ] || NARAYANA_BUILD=1 # build narayana
+[ $AS_BUILD ] || AS_BUILD=1 # git clone and build a fresh copy of the AS
+[ $TXF_TESTS ] || TXF_TESTS=0 # TxFramework tests
+[ $XTS_TESTS ] || XTS_TESTS=1 # XTS tests
+[ $QA_TESTS ] || QA_TESTS=1 # QA test suite
+[ $txbridge ] || txbridge=1 # bridge tests
+[ $IDLJ ] || IDLJ=0 # use the Sun orb instead of the default JacORB
+
+QA_BUILD_ARGS=""-Ddriver.url=file:///home/hudson/dbdrivers""
+
+# for IPv6 testing use export ARQ_PROF=arqIPv6
+# if you don't want to run all the XTS tests set WSTX_MODULES to the ones you want, eg:
+# export WSTX_MODULES=""WSAS,WSCF,WSTX,WS-C,WS-T,xtstest,crash-recovery-tests""
+
+[ -z ""${WORKSPACE}"" ] && fatal ""UNSET WORKSPACE""
 
 # FOR DEBUGGING SUBSEQUENT ISSUES
 free -m
 
 #Make sure no JBoss processes running
-for i in `ps -eaf | grep java | grep ""standalone"" | grep -v grep | cut -c10-15`; do kill $i; done
+for i in `ps -eaf | grep java | grep ""standalone*.xml"" | grep -v grep | cut -c10-15`; do kill $i; done
 
-#BUILD NARAYANA WITH FINDBUGS
-./build.sh -Dfindbugs.skip=false -Dfindbugs.failOnError=false ""$@"" clean install
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-GIT_URL=""https://github.com/jbosstm/jboss-as.git""
-UPSTREAM_GIT_URL=""https://github.com/jbossas/jboss-as.git""
-
-#BUILD JBOSS-AS
-cd ${WORKSPACE}
-rm -rf jboss-as
-git clone $GIT_URL
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-cd jboss-as
-git checkout -t origin/5_BRANCH
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-git remote add upstream $UPSTREAM_GIT_URL
-git pull --rebase --ff-only upstream master
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-MAVEN_OPTS=-XX:MaxPermSize=256m ./build.sh ""$@"" clean install -DskipTests
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-JBOSS_VERSION=`ls -1 ${WORKSPACE}/jboss-as/build/target | grep jboss-as`
-export JBOSS_HOME=${WORKSPACE}/jboss-as/build/target/${JBOSS_VERSION}
-
-cd ${WORKSPACE}
-
-#0. TXFramework Tests
-#cp ./rest-tx/webservice/target/rest-tx-web-*.war $JBOSS_HOME/standalone/deployments
-#./build.sh -f ./txframework/pom.xml $mvn_arqprof ""$@"" test
-#if [ ""$?"" != ""0"" ]; then
-#        exit -1
-#fi
-
-#1.WSTX11 INTEROP and UNIT TESTS and CRASH RECOVERY TESTS
-./build.sh -f XTS/localjunit/pom.xml $mvn_arqprof ""$@"" clean install
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-#2.CHECK CRASH REC OUTPUT
-(cd XTS/localjunit/crash-recovery-tests && java -cp target/classes/ com.arjuna.qa.simplifylogs.SimplifyLogs ./target/log/ ./target/log-simplified)
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-#3.TXBRIDGE TESTS
-cd ${WORKSPACE}
-sed -e ""s#\(recovery-environment\) \(socket-binding\)#\\1 recovery-listener=\""true\"" \\2#"" -i ${JBOSS_HOME}/docs/examples/configs/standalone-xts.xml
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-./build.sh -f txbridge/pom.xml $mvn_arqprof ""$@"" clean test
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-#RUN QA TESTS
-cd $WORKSPACE/qa
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-sed -i TaskImpl.properties -e ""s#^COMMAND_LINE_0=.*#COMMAND_LINE_0=${JAVA_HOME}/bin/java#""
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-if [ $isIdlj == 1 ]; then
-# delete lines containing jacorb
-	sed -i TaskImpl.properties -e  '/^.*separator}jacorb/ d'
-fi
-
-ant -DisIdlj=$isIdlj -Ddriver.url=file:///home/hudson/dbdrivers get.drivers dist
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-ant -f run-tests.xml ci-tests
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
+# if we are building with IPv6 tell ant about it
+export ANT_OPTS=""$ANT_OPTS $IPV6_OPTS""
+
+# run the job
+[ $NARAYANA_BUILD = 1 ] && build_narayana ""$@""
+[ $AS_BUILD = 1 ] && build_as ""$@"" || init_jboss_home
+[ $TXF_TESTS = 1 ] && txframework_tests ""$@""
+[ $XTS_TESTS = 1 ] && xts_tests ""$@""
+[ $txbridge = 1 ] && tx_bridge_tests ""$@""
+[ $QA_TESTS = 1 ] && qa_tests ""$@""
+
+exit 0",2012-07-13T19:18:21Z,10
"@@ -1028,6 +1028,7 @@
         <module>txbridge</module>
         <module>fileio</module>
         <module>STM</module>
+        <module>txframework</module>
         <module>narayana-full</module>
       </modules>
     </profile>",2012-06-20T13:38:51Z,39
"@@ -25,7 +25,6 @@
   <packaging>jar</packaging>
   <build>
     <sourceDirectory>../../atsintegration/classes</sourceDirectory>
-<!--
     <testSourceDirectory>../../atsintegration/tests</testSourceDirectory>
     <testResources>
       <testResource>
@@ -35,7 +34,6 @@
         <directory>../../atsintegration/tests/byteman-scripts</directory>
       </testResource>
     </testResources>
--->
     <plugins>
       <plugin>
         <inherited>false</inherited>
@@ -84,6 +82,13 @@
           </excludes>
         </configuration>
       </plugin>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-surefire-plugin</artifactId>
+        <configuration>
+          <useManifestOnlyJar>false</useManifestOnlyJar>
+        </configuration>
+      </plugin>
     </plugins>
   </build>
   <dependencies>",2012-04-20T07:06:53Z,307
"@@ -25,7 +25,6 @@
   <packaging>jar</packaging>
   <build>
     <sourceDirectory>../../atsintegration/classes</sourceDirectory>
-<!--
     <testSourceDirectory>../../atsintegration/tests</testSourceDirectory>
     <testResources>
       <testResource>
@@ -35,7 +34,6 @@
         <directory>../../atsintegration/tests/byteman-scripts</directory>
       </testResource>
     </testResources>
--->
     <plugins>
       <plugin>
         <inherited>false</inherited>
@@ -75,6 +73,13 @@
           </archive>
         </configuration>
       </plugin>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-surefire-plugin</artifactId>
+        <configuration>
+          <useManifestOnlyJar>false</useManifestOnlyJar>
+        </configuration>
+      </plugin>
     </plugins>
   </build>
   <dependencies>
@@ -122,5 +127,31 @@
       <artifactId>jboss-logging-processor</artifactId>
       <scope>provided</scope>
     </dependency>
+    <dependency>
+      <groupId>junit</groupId>
+      <artifactId>junit</artifactId>
+      <version>4.8.1</version>
+      <scope>test</scope>
+    </dependency>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman</artifactId>
+      <scope>test</scope>
+    </dependency>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman-install</artifactId>
+      <scope>test</scope>
+    </dependency>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman-submit</artifactId>
+      <scope>test</scope>
+    </dependency>
+    <dependency>
+      <groupId>org.jboss.byteman</groupId>
+      <artifactId>byteman-bmunit</artifactId>
+      <scope>test</scope>
+    </dependency>
   </dependencies>
 </project>",2012-04-20T07:06:53Z,69
"@@ -49,7 +49,7 @@ function build_as {
   [ $? = 0 ] || fatal ""git checkout 4_BRANCH failed""
 
   git remote add upstream $UPSTREAM_GIT_URL
-  git pull --rebase --ff-only upstream master
+  git pull --rebase --ff-only -s ours upstream master
   [ $? = 0 ] || fatal ""git rebase failed""
 
   export MAVEN_OPTS=""$MAVEN_OPTS -XX:MaxPermSize=512m""",2012-10-03T12:03:12Z,10
"@@ -1,121 +1,174 @@
-if [ -z ""${WORKSPACE}"" ]; then
-  echo ""UNSET WORKSPACE""
-  exit -1;
-fi
-
-isIdlj=0
-for arg in ""$@""; do
-  if [ `echo ""$arg"" |grep ""idlj""` ]; then
-    isIdlj=1
+function fatal {
+  echo ""$1""
+  exit -1
+}
+
+#BUILD NARAYANA WITH FINDBUGS
+function build_narayana {
+  echo ""Building Narayana""
+  cd $WORKSPACE
+  [ $NARAYANA_TESTS == 1 ] && NARAYANA_ARGS= || NARAYANA_ARGS=""-DskipTests""
+  [ $IDLJ == 1 ] && NARAYANA_ARGS=""$NARAYANA_ARGS -Pidlj""
+
+  ./build.sh -Dfindbugs.skip=false -Dfindbugs.failOnError=false ""$@"" $NARAYANA_ARGS $IPV6_OPTS clean install
+  [ $? = 0 ] || fatal ""narayana build failed""
+  cp_narayana_to_as
+  return 0
+}
+
+function cp_narayana_to_as {
+  echo ""Copying Narayana to AS""
+  cd $WORKSPACE
+  JBOSS_VERSION=`ls -1 ${WORKSPACE}/jboss-as/build/target | grep jboss-as`
+  [ $? = 0 ] || return 1
+  export JBOSS_HOME=${WORKSPACE}/jboss-as/build/target/${JBOSS_VERSION}
+  [ -d $JBOSS_HOME ] || return 1
+
+  echo ""WARNING - check that narayana version ${NARAYANA_VERSION} is the one you want""
+  JAR1=narayana-jts-integration-${NARAYANA_VERSION}.jar
+  JAR2=narayana-jts-${NARAYANA_VERSION}.jar
+# TODO make sure ${JBOSS_HOME} doesn't already contain a different version of narayana
+  echo ""cp ./ArjunaJTS/integration/target/$JAR1 ${JBOSS_HOME}/modules/org/jboss/jts/integration/main/""
+  echo ""cp ./ArjunaJTS/narayana-jts/target/$JAR2 ${JBOSS_HOME}/modules/org/jboss/jts/main/""
+  cp ./ArjunaJTS/integration/target/$JAR1 ${JBOSS_HOME}/modules/org/jboss/jts/integration/main/
+  [ $? = 0 ] || return 1
+  cp ./ArjunaJTS/narayana-jts/target/$JAR2 ${JBOSS_HOME}/modules/org/jboss/jts/main/
+}
+
+function build_as {
+  echo ""Building AS""
+  GIT_URL=""https://github.com/jbosstm/jboss-as.git""
+  UPSTREAM_GIT_URL=""https://github.com/jbossas/jboss-as.git""
+
+  cd ${WORKSPACE}
+  rm -rf jboss-as
+  git clone $GIT_URL
+  [ $? = 0 ] || fatal ""git clone $GIT_URL failed""
+
+  cd jboss-as
+  git checkout -t origin/5_BRANCH
+  [ $? = 0 ] || fatal ""git checkout 5_BRANCH failed""
+
+  git remote add upstream $UPSTREAM_GIT_URL
+  git pull --rebase --ff-only upstream master
+  [ $? = 0 ] || fatal ""git rebase failed""
+
+  export MAVEN_OPTS=""-XX:MaxPermSize=512m""
+  export JAVA_OPTS=""-Xms1303m -Xmx1303m -XX:MaxPermSize=512m""
+  ./build.sh clean install -DskipTests -Dts.smoke=false $IPV6_OPTS
+  [ $? = 0 ] || fatal ""AS build failed""
+  init_jboss_home
+}
+
+function init_jboss_home {
+  cd $WORKSPACE
+  JBOSS_VERSION=`ls -1 ${WORKSPACE}/jboss-as/build/target | grep jboss-as`
+  [ $? = 0 ] || fatal ""missing AS - cannot set JBOSS_VERSION""
+  export JBOSS_HOME=${WORKSPACE}/jboss-as/build/target/${JBOSS_VERSION}
+  [ -d $JBOSS_HOME ] || fatal ""missing AS - $JBOSS_HOME is not a directory""
+  echo ""JBOSS_HOME=$JBOSS_HOME""
+}
+
+function txframework_tests {
+  echo ""#0. TXFramework Test""
+  cp ./rest-tx/webservice/target/rest-tx-web-*.war $JBOSS_HOME/standalone/deployments
+  ./build.sh -f ./txframework/pom.xml $mvn_arqprof ""$@"" test
+  [ $? = 0 ] || fatal ""TxFramework build failed""
+}
+
+function xts_tests {
+  echo ""#1 XTS: WSTX11 INTEROP, UNIT TESTS, xtstest and CRASH RECOVERY TESTS""
+
+  cd $WORKSPACE
+  ran_crt=0
+
+  if [ $WSTX_MODULES ]; then
+    [[ $WSTX_MODULES = *crash-recovery-tests* ]] && ran_crt=1
+    echo ""BUILDING SPECIFIC WSTX11 modules""
+    ./build.sh -f XTS/localjunit/pom.xml --projects ""$WSTX_MODULES"" -P$ARQ_PROF ""$@"" $IPV6_OPTS clean test
+  else
+    ./build.sh -f XTS/localjunit/pom.xml -P$ARQ_PROF ""$@"" $IPV6_OPTS clean test
+    ran_crt=0
+  fi
+
+  [ $? = 0 ] || fatal ""XTS: SOME TESTS failed""
+
+  if [ $ran_crt = 1 ]; then
+    (cd XTS/sar/crash-recovery-tests && java -cp target/classes/ com.arjuna.qa.simplifylogs.SimplifyLogs ./target/log/ ./target/log-simplified)
+    [ $? = 0 ] || fatal ""Simplify CRASH RECOVERY logs failed""
   fi
-done
+}
+
+function tx_bridge_tests {
+  echo ""XTS: TXBRIDGE TESTS update conf""
+  cd $WORKSPACE
+  CONF=""${JBOSS_HOME}/docs/examples/configs/standalone-xts.xml""
+  grep recovery-listener ""$CONF""
+  sed -e s/recovery-listener=\""true\""//g -i $CONF
+  sed -e ""s#\(recovery-environment\) \(socket-binding\)#\\1 recovery-listener=\""true\"" \\2#"" -i $CONF
+
+#  sed -e ""s#\(recovery-environment\) \(socket-binding\)#\\1 recovery-listener=\""true\"" \\2#"" -i $CONF
+  [ $? = 0 ] || fatal ""#3.TXBRIDGE TESTS: sed failed""
+
+  echo ""XTS: TXBRIDGE TESTS""
+  ./build.sh -f txbridge/pom.xml -P$ARQ_PROF ""$@"" $IPV6_OPTS test
+  [ $? = 0 ] || fatal ""#3.TXBRIDGE TESTS failed""
+}
+
+function qa_tests {
+  echo ""QA Test Suite""
+  cd $WORKSPACE/qa
+
+  sed -i TaskImpl.properties -e ""s#^COMMAND_LINE_0=.*#COMMAND_LINE_0=${JAVA_HOME}/bin/java#""
+  [ $? = 0 ] || fatal ""sed TaskImpl.properties failed""
 
-# test whether the IPV6 evironment variable is set
-if [ -v IPV6 ]; then
-  mvn_arqprof=""-ParqIPv6""
-else
-  mvn_arqprof=""-Parq""
-fi
+  # delete lines containing jacorb
+  [ $IDLJ == 1 ] && sed -i TaskImpl.properties -e  '/^.*separator}jacorb/ d'
 
+  ant -DisIdlj=$IDLJ ""$QA_BUILD_ARGS"" get.drivers dist
+  [ $? = 0 ] || fatal ""qa build failed""
+
+  [ $IPV6_OPTS ] && target=""junit-testsuite"" || target=""ci-tests""
+  ant -f run-tests.xml $target
+  [ $? = 0 ] || fatal ""some qa tests failed""
+}
+
+# if the following env variables have not been set initialize them to their defaults
+[ $NARAYANA_VERSION ] || NARAYANA_VERSION=""5.0.0.M2-SNAPSHOT""
+[ $ARQ_PROF ] || ARQ_PROF=arq	# IPv4 arquillian profile
+
+[ $NARAYANA_TESTS ] || NARAYANA_TESTS=1	# run the narayana surefire tests
+[ $NARAYANA_BUILD ] || NARAYANA_BUILD=1 # build narayana
+[ $AS_BUILD ] || AS_BUILD=1 # git clone and build a fresh copy of the AS
+[ $TXF_TESTS ] || TXF_TESTS=0 # TxFramework tests
+[ $XTS_TESTS ] || XTS_TESTS=1 # XTS tests
+[ $QA_TESTS ] || QA_TESTS=1 # QA test suite
+[ $txbridge ] || txbridge=1 # bridge tests
+[ $IDLJ ] || IDLJ=0 # use the Sun orb instead of the default JacORB
+
+QA_BUILD_ARGS=""-Ddriver.url=file:///home/hudson/dbdrivers""
+
+# for IPv6 testing use export ARQ_PROF=arqIPv6
+# if you don't want to run all the XTS tests set WSTX_MODULES to the ones you want, eg:
+# export WSTX_MODULES=""WSAS,WSCF,WSTX,WS-C,WS-T,xtstest,crash-recovery-tests""
+
+[ -z ""${WORKSPACE}"" ] && fatal ""UNSET WORKSPACE""
 
 # FOR DEBUGGING SUBSEQUENT ISSUES
 free -m
 
 #Make sure no JBoss processes running
-for i in `ps -eaf | grep java | grep ""standalone"" | grep -v grep | cut -c10-15`; do kill $i; done
+for i in `ps -eaf | grep java | grep ""standalone*.xml"" | grep -v grep | cut -c10-15`; do kill $i; done
 
-#BUILD NARAYANA WITH FINDBUGS
-./build.sh -Dfindbugs.skip=false -Dfindbugs.failOnError=false ""$@"" clean install
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-GIT_URL=""https://github.com/jbosstm/jboss-as.git""
-UPSTREAM_GIT_URL=""https://github.com/jbossas/jboss-as.git""
-
-#BUILD JBOSS-AS
-cd ${WORKSPACE}
-rm -rf jboss-as
-git clone $GIT_URL
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-cd jboss-as
-git checkout -t origin/5_BRANCH
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-git remote add upstream $UPSTREAM_GIT_URL
-git pull --rebase --ff-only upstream master
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-MAVEN_OPTS=-XX:MaxPermSize=256m ./build.sh ""$@"" clean install -DskipTests
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-JBOSS_VERSION=`ls -1 ${WORKSPACE}/jboss-as/build/target | grep jboss-as`
-export JBOSS_HOME=${WORKSPACE}/jboss-as/build/target/${JBOSS_VERSION}
-
-cd ${WORKSPACE}
-
-#0. TXFramework Tests
-#cp ./rest-tx/webservice/target/rest-tx-web-*.war $JBOSS_HOME/standalone/deployments
-#./build.sh -f ./txframework/pom.xml $mvn_arqprof ""$@"" test
-#if [ ""$?"" != ""0"" ]; then
-#        exit -1
-#fi
-
-#1.WSTX11 INTEROP and UNIT TESTS and CRASH RECOVERY TESTS
-./build.sh -f XTS/localjunit/pom.xml $mvn_arqprof ""$@"" clean install
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-#2.CHECK CRASH REC OUTPUT
-(cd XTS/localjunit/crash-recovery-tests && java -cp target/classes/ com.arjuna.qa.simplifylogs.SimplifyLogs ./target/log/ ./target/log-simplified)
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-#3.TXBRIDGE TESTS
-cd ${WORKSPACE}
-sed -e ""s#\(recovery-environment\) \(socket-binding\)#\\1 recovery-listener=\""true\"" \\2#"" -i ${JBOSS_HOME}/docs/examples/configs/standalone-xts.xml
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-./build.sh -f txbridge/pom.xml $mvn_arqprof ""$@"" clean test
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-#RUN QA TESTS
-cd $WORKSPACE/qa
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-sed -i TaskImpl.properties -e ""s#^COMMAND_LINE_0=.*#COMMAND_LINE_0=${JAVA_HOME}/bin/java#""
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-if [ $isIdlj == 1 ]; then
-# delete lines containing jacorb
-	sed -i TaskImpl.properties -e  '/^.*separator}jacorb/ d'
-fi
-
-ant -DisIdlj=$isIdlj -Ddriver.url=file:///home/hudson/dbdrivers get.drivers dist
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
-
-ant -f run-tests.xml ci-tests
-if [ ""$?"" != ""0"" ]; then
-	exit -1
-fi
+# if we are building with IPv6 tell ant about it
+export ANT_OPTS=""$ANT_OPTS $IPV6_OPTS""
+
+# run the job
+[ $NARAYANA_BUILD = 1 ] && build_narayana ""$@""
+[ $AS_BUILD = 1 ] && build_as ""$@"" || init_jboss_home
+[ $TXF_TESTS = 1 ] && txframework_tests ""$@""
+[ $XTS_TESTS = 1 ] && xts_tests ""$@""
+[ $txbridge = 1 ] && tx_bridge_tests ""$@""
+[ $QA_TESTS = 1 ] && qa_tests ""$@""
+
+exit 0",2012-07-13T19:18:21Z,10
"@@ -65,7 +65,7 @@ function build_as {
     git remote add upstream $UPSTREAM_GIT_URL
   fi
 
-  git pull --rebase --ff-only upstream master
+  git pull --rebase --ff-only -s ours upstream master
   [ $? = 0 ] || fatal ""git rebase failed""
 
   export MAVEN_OPTS=""$MAVEN_OPTS -XX:MaxPermSize=512m""",2012-10-03T11:58:50Z,10
"@@ -118,14 +118,17 @@ function qa_tests_once {
   echo ""QA Test Suite $@""
   cd $WORKSPACE/qa
 
+  for i in $@; do
+    [ ${i%%=*} = ""orb"" ] && orb=${i##*=}
+  done
+
+  # check to see if we were called with orb=idlj as one of the arguments
+  [ x$orb = x""idlj"" ] && IDLJ=1 || IDLJ=0
+
   git checkout TaskImpl.properties
   sed -i TaskImpl.properties -e ""s#^COMMAND_LINE_0=.*#COMMAND_LINE_0=${JAVA_HOME}/bin/java#""
   [ $? = 0 ] || fatal ""sed TaskImpl.properties failed""
 
-  # check to see if we were called with orb=xyz as the first argument
-  [ ${1%%=*} = ""orb"" ] && orb=${1##*=}
-  [ x$orb = x""idlj"" ] && IDLJ=1 || IDLJ=0
-
   # delete lines containing jacorb
   [ $IDLJ == 1 ] && sed -i TaskImpl.properties -e  '/^.*separator}jacorb/ d'
 
@@ -134,6 +137,7 @@ function qa_tests_once {
 
   [ $IPV6_OPTS ] && target=""junit-testsuite"" || target=""ci-tests""
   [ $IDLJ == 1 ] && target=""junit-jts-testsuite""
+  [ x$QA_TARGET = x ] || target=$QA_TARGET
 
   ant -f run-tests.xml $target
 }
@@ -146,7 +150,7 @@ function qa_tests {
     ok1=$?
   fi
   if [ $SUN_ORB = 1 ]; then
-    qa_tests_once ""orb=idlj"" ""$@"" # run qa against the Sun orb
+    qa_tests_once ""$@"" ""orb=idlj"" ""$@"" # run qa against the Sun orb
     ok2=$?
   fi
 
@@ -169,8 +173,7 @@ function qa_tests {
 [ $SUN_ORB ] || SUN_ORB=1 # Run QA test suite against the Sun orb
 [ $JAC_ORB ] || JAC_ORB=1 # Run QA test suite against JacORB
 [ $txbridge ] || txbridge=1 # bridge tests
-
-QA_BUILD_ARGS=""-Ddriver.url=file:///home/hudson/dbdrivers""
+# set QA_TARGET if you want to override the QA test ant target
 
 # for IPv6 testing use export ARQ_PROF=arqIPv6
 # if you don't want to run all the XTS tests set WSTX_MODULES to the ones you want, eg:
@@ -195,4 +198,6 @@ export ANT_OPTS=""$ANT_OPTS $IPV6_OPTS""
 [ $txbridge = 1 ] && tx_bridge_tests ""$@""
 [ $QA_TESTS = 1 ] && qa_tests ""$@""
 
+QA_BUILD_ARGS=""-Ddriver.url=file:///home/hudson/dbdrivers""
+
 exit 0",2012-08-15T12:57:58Z,10
"@@ -133,9 +133,12 @@ function qa_tests_once {
   # delete lines containing jacorb
   [ $IDLJ = 1 ] && sed -i TaskImpl.properties -e  '/^.*separator}jacorb/ d'
 
-  [ $IPV6_OPTS ] || ant -DisIdlj=$IDLJ ""$QA_BUILD_ARGS"" get.drivers dist
+  # if IPV6_OPTS is not set get the jdbc drivers (we do not run the jdbc tests in IPv6 mode)
+  [ -z ""${IPV6_OPTS+x}"" ] && ant -DisIdlj=$IDLJ ""$QA_BUILD_ARGS"" get.drivers dist
   [ $? = 0 ] || fatal ""qa build failed""
 
+  # if IPV6_OPTS is not set then run everything (ci-tests) otherwise don't do the jdbc tests
+  [ -z ""${IPV6_OPTS+x}"" ] || target=""junit-testsuite"" && target=""ci-tests""
   [ $IPV6_OPTS ] && target=""junit-testsuite"" || target=""ci-tests""
   [ $IDLJ = 1 ] && target=""junit-jts-testsuite""
   [ x$QA_TARGET = x ] || target=$QA_TARGET",2012-08-31T09:46:03Z,10
"@@ -114,7 +114,12 @@ public synchronized void cancel ()
          */
         final State state = participant.cancel() ;
 
-        if (state == State.STATE_CANCELING)
+        if (state == State.STATE_COMPLETED)
+        {
+            //Complete arrived, whilst the coordinator was trying to abort.
+            compensate();
+        }
+        else if (state == State.STATE_CANCELING)
         {
             throw new SystemException() ;
         }",2012-04-19T16:37:28Z,308
"@@ -281,6 +281,8 @@ public synchronized void participantCompleted (String participantId)
         int status = status();
         // completed is only legitimate when the TX is in these states
         switch (status) {
+            case ActionStatus.ABORTED:
+                break;
             case ActionStatus.RUNNING:
             case ActionStatus.ABORT_ONLY:
                 changeParticipantStatus(participantId, COMPLETED);",2012-04-19T16:37:28Z,309
"@@ -9,13 +9,15 @@ fi
 
 SCRIPTS=$(find $DIR -name \*.txt)
 
-JARS=$(cd ../../..; find -name \*.jar)
+JARS=$(cd ../../..; find . -name \*.jar)
 
 for i in $JARS; do
 	CP=""$CP:../../../$i"";
 done
 
+CP=""$CP:../../sar/tests/target/classes""
+
 for s in $SCRIPTS; do
 	echo $s
-	bmcheck.sh -cp $CP $s | grep TestScript
+	bmcheck.sh -cp $CP $s
 done",2012-04-19T16:37:28Z,310
"@@ -18,7 +18,7 @@
 public class BaseCrashTest
 {
     protected String XTSServiceTest = "" -Dorg.jboss.jbossts.xts.servicetests.XTSServiceTestName=@TestName@"";
-    protected String BytemanArgs = ""-Xms64m -Xmx512m -XX:MaxPermSize=256m -Djboss.modules.system.pkgs=org.jboss.byteman -Dorg.jboss.byteman.transform.all -javaagent:target/test-classes/lib/byteman.jar=script:target/test-classes/scripts/@BMScript@.txt,boot:target/test-classes/lib/byteman.jar,listener:true"";
+    protected String BytemanArgs = ""-Xms64m -Xmx512m -XX:MaxPermSize=256m -Dorg.jboss.byteman.verbose -Djboss.modules.system.pkgs=org.jboss.byteman -Dorg.jboss.byteman.transform.all -javaagent:target/test-classes/lib/byteman.jar=script:target/test-classes/scripts/@BMScript@.txt,boot:target/test-classes/lib/byteman.jar,listener:true"";
     protected String javaVmArguments;
     protected String testName;
     protected String scriptName;",2012-04-19T16:37:28Z,311
"@@ -20,7 +20,7 @@ public void MultiParticipantCoordinatorCompletionParticipantCloseTest() throws E
 	@Test
 	public void MultiParticipantCoordinatorCompletionParticipantCloseAndExitTest() throws Exception {
 		testName = ""MultiParticipantCoordinatorCompletionParticipantCloseAndExitTest"";
-		String testClass = ""org.jboss.jbossts.xts.servicetests.test.ba.MultiParticipantCoordinatorCompletionParticipantCloseAndExitTest"";
+		String testClass = ""org.jboss.jbossts.xts.servicetests.test.ba.MultiParticipantCoordinatorCompletionParticipantCloseTest"";
 		runTest(testClass);
 	}
 	",2012-04-19T16:37:28Z,312
"@@ -20,7 +20,7 @@ public void SingleCoordinatorCompletionParticipantCloseTest() throws Exception {
 	@Test
 	public void SingleParticipantCompletionParticipantCloseTest() throws Exception {
 		testName = ""SingleParticipantCompletionParticipantCloseTest"";
-		String testClass = ""org.jboss.jbossts.xts.servicetests.test.ba.SingleCoordinatorCompletionParticipantCloseTest"";
+		String testClass = ""org.jboss.jbossts.xts.servicetests.test.ba.SingleParticipantCompletionParticipantCloseTest"";
 		runTest(testClass);
 
 	}",2012-04-19T16:37:28Z,313
"@@ -20,7 +20,7 @@ public void SingleCoordinatorCompletionParticipantCloseTest() throws Exception {
 	@Test
 	public void SingleParticipantCompletionParticipantCloseTest() throws Exception {
 		testName = ""SingleParticipantCompletionParticipantCloseTest"";
-		String testClass = ""org.jboss.jbossts.xts.servicetests.test.ba.SingleCoordinatorCompletionParticipantCloseTest"";
+		String testClass = ""org.jboss.jbossts.xts.servicetests.test.ba.SingleParticipantCompletionParticipantCloseTest"";
 		runTest(testClass);
 
 	}",2012-04-19T16:37:28Z,314
"@@ -273,6 +273,140 @@
 #   received closed message for XXXXXXX completion participant stub XXXXXX
 #   removed committed activity XXXXXX
 #
+
+######################################################################
+#JBTM-1115 Rules
+#
+
+#####################################################################
+# Setup counter MultiParticipantParticipantCompletionParticipantCloseTest
+#
+RULE setup counter MultiParticipantParticipantCompletionParticipantCloseTest
+CLASS org.jboss.jbossts.xts.servicetests.test.ba.MultiParticipantParticipantCompletionParticipantCloseTest
+METHOD run()
+AT ENTRY
+IF TRUE
+DO debug(""creating counter and rendezvous""),
+   createCounter(""closes"", 3),
+   createRendezvous(""closes-complete"", 2)
+ENDRULE
+#####################################################################
+# Setup counter MultiParticipantCoordinatorCompletionParticipantCloseTest
+#
+RULE setup counter MultiParticipantCoordinatorCompletionParticipantCloseTest
+CLASS org.jboss.jbossts.xts.servicetests.test.ba.MultiParticipantParticipantCompletionParticipantCloseAndExitTest
+METHOD run()
+AT ENTRY
+IF TRUE
+DO debug(""creating counter and rendezvous""),
+   createCounter(""closes"", 3),
+   createRendezvous(""closes-complete"", 2)
+ENDRULE
+#####################################################################
+# Setup counter MultiServiceParticipantCompletionParticipantCloseTest
+#
+RULE setup counter MultiServiceParticipantCompletionParticipantCloseTest
+CLASS org.jboss.jbossts.xts.servicetests.test.ba.MultiServiceParticipantCompletionParticipantCloseTest
+METHOD run()
+AT ENTRY
+IF TRUE
+DO debug(""creating counter and rendezvous""),
+   createCounter(""closes"", 3),
+   createRendezvous(""closes-complete"", 2)
+ENDRULE
+#####################################################################
+# Setup counter MultiServiceParticipantCompletionParticipantCloseAndExitTest
+#
+RULE setup counter MultiServiceParticipantCompletionParticipantCloseAndExitTest
+CLASS org.jboss.jbossts.xts.servicetests.test.ba.MultiServiceParticipantCompletionParticipantCloseAndExitTest
+METHOD run()
+AT ENTRY
+IF TRUE
+DO debug(""creating counter and rendezvous""),
+   createCounter(""closes"", 3),
+   createRendezvous(""closes-complete"", 2)
+ENDRULE
+
+
+
+#####################################################################
+# Trigger Rendezvous after three calls to BACoordinator.complete()
+# 
+RULE trigger rendezvous on complete
+CLASS com.arjuna.mwlabs.wscf.model.sagas.arjunacore.BACoordinator
+METHOD participantCompleted(String)
+AT EXIT
+IF (debug(""decrementing"") AND decrementCounter(""closes"") == 0)
+DO debug(""closes-complete, triggering rendezvous""),
+   rendezvous(""closes-complete"")
+ENDRULE
+
+#####################################################################
+# Trigger Rendezvous after three calls to BACoordinator.exit()
+#
+RULE trigger rendezvous on exit
+CLASS com.arjuna.mwlabs.wscf.model.sagas.arjunacore.BACoordinator
+METHOD delistParticipant(String)
+AT EXIT
+IF (debug(""decrementing"") AND decrementCounter(""closes"") == 0)
+DO debug(""closes-complete, triggering rendezvous""),
+   rendezvous(""closes-complete"")
+ENDRULE
+
+
+
+#####################################################################
+# Wait on Rendezvous before calling uba.close() on MultiServiceParticipantCompletionParticipantCloseTest
+# 
+RULE wait for closes MultiParticipantParticipantCompletionParticipantCloseTest
+CLASS org.jboss.jbossts.xts.servicetests.test.ba.MultiParticipantParticipantCompletionParticipantCloseTest
+METHOD run()
+AT CALL UserBusinessActivity.close()
+IF TRUE
+DO debug(""waiting to call close""),
+   rendezvous(""closes-complete""),
+   debug(""rendezvous complete, calling close"")
+ENDRULE
+#####################################################################
+# Wait on Rendezvous before calling uba.close() on MultiParticipantParticipantCompletionParticipantCloseAndExitTest
+#
+RULE wait for closes MultiParticipantParticipantCompletionParticipantCloseAndExitTest
+CLASS org.jboss.jbossts.xts.servicetests.test.ba.MultiParticipantParticipantCompletionParticipantCloseAndExitTest
+METHOD run()
+AT CALL UserBusinessActivity.close()
+IF TRUE
+DO debug(""waiting to call close""),
+   rendezvous(""closes-complete""),
+   debug(""rendezvous complete, calling close"")
+ENDRULE
+#####################################################################
+# Wait on Rendezvous before calling uba.close() on MultiServiceParticipantCompletionParticipantCloseTest
+#
+RULE wait for closes MultiServiceParticipantCompletionParticipantCloseTest
+CLASS org.jboss.jbossts.xts.servicetests.test.ba.MultiServiceParticipantCompletionParticipantCloseTest
+METHOD run()
+AT CALL UserBusinessActivity.close()
+IF TRUE
+DO debug(""waiting to call close""),
+   rendezvous(""closes-complete""),
+   debug(""rendezvous complete, calling close"")
+ENDRULE
+#####################################################################
+# Wait on Rendezvous before calling uba.close() on MultiServiceParticipantCompletionParticipantCloseAndExitTest
+#
+RULE wait for closes MultiServiceParticipantCompletionParticipantCloseAndExitTest
+CLASS org.jboss.jbossts.xts.servicetests.test.ba.MultiServiceParticipantCompletionParticipantCloseAndExitTest
+METHOD run()
+AT CALL UserBusinessActivity.close()
+IF TRUE
+DO debug(""waiting to call close""),
+   rendezvous(""closes-complete""),
+   debug(""rendezvous complete, calling close"")
+ENDRULE
+
+
+
+
 #######################################################################
 # This rule resets the periodic recovery wait period to 10 seconds
 # in order to speed up the test. Setting this any lower may result",2012-04-19T16:37:28Z,315
"@@ -206,6 +206,51 @@
 #   compensated recovered XXXXXXX completion participant XXXXXX
 #   JVM exit
 #
+
+######################################################################
+#JBTM-1115 Rules
+#
+
+#####################################################################
+# Setup counter SingleParticipantCompletionParticipantCloseTest
+#
+RULE setup counter SingleParticipantCompletionParticipantCloseTest
+CLASS org.jboss.jbossts.xts.servicetests.test.ba.SingleParticipantCompletionParticipantCloseTest
+METHOD run()
+AT ENTRY
+IF TRUE
+DO debug(""creating counter and rendezvous""),
+   createCounter(""closes"", 1),
+   createRendezvous(""closes-complete"", 2)
+ENDRULE
+
+#####################################################################
+# Trigger Rendezvous after three calls to BACoordinator.complete()
+#
+RULE trigger rendezvous on complete
+CLASS com.arjuna.mwlabs.wscf.model.sagas.arjunacore.BACoordinator
+METHOD participantCompleted(String)
+AT EXIT
+IF (debug(""decrementing"") AND decrementCounter(""closes"") == 0)
+DO debug(""closes-complete, triggering rendezvous""),
+   rendezvous(""closes-complete"")
+ENDRULE
+
+#####################################################################
+# Wait on Rendezvous before calling uba.close() on SingleParticipantCompletionParticipantCloseTest
+#
+RULE wait for closes SingleParticipantCompletionParticipantCloseTest
+CLASS org.jboss.jbossts.xts.servicetests.test.ba.SingleParticipantCompletionParticipantCloseTest
+METHOD run()
+AT CALL UserBusinessActivity.close()
+IF TRUE
+DO debug(""waiting to call close""),
+   rendezvous(""closes-complete""),
+   debug(""rendezvous complete, calling close"")
+ENDRULE
+
+
+
 #######################################################################
 # This rule resets the periodic recovery wait period to 10 seconds
 # in order to speed up the test. Setting this any lower may result",2012-04-19T16:37:28Z,316
"@@ -303,6 +303,52 @@
 #   removed transaction XXXXXX
 #   JVM exit after removing both transactions
 #
+
+#####################################################################
+#JBTM-1115 Rules
+#
+
+#####################################################################
+# Setup counter MultiParticipantParticipantCompletionParticipantCloseTest
+#
+RULE setup counter subordinate.MultiParticipantParticipantCompletionParticipantCloseTest
+CLASS org.jboss.jbossts.xts.servicetests.test.ba.subordinate.MultiParticipantParticipantCompletionParticipantCloseTest
+METHOD run()
+AT ENTRY
+IF TRUE
+DO debug(""creating counter and rendezvous""),
+   createCounter(""closes"", 1),
+   createRendezvous(""closes-complete"", 2)
+ENDRULE
+
+#####################################################################
+# Trigger Rendezvous after three calls to BACoordinator.complete()
+#
+RULE trigger rendezvous on complete
+CLASS com.arjuna.mwlabs.wscf.model.sagas.arjunacore.BACoordinator
+METHOD participantCompleted(String)
+AT EXIT
+IF (debug(""decrementing"") AND decrementCounter(""closes"") == 0)
+DO debug(""closes-complete, triggering rendezvous""),
+   rendezvous(""closes-complete"")
+ENDRULE
+
+#####################################################################
+# Wait on Rendezvous before calling uba.close() on MultiParticipantParticipantCompletionParticipantCloseTest
+#
+RULE wait for closes subordinate.MultiParticipantParticipantCompletionParticipantCloseTest
+CLASS org.jboss.jbossts.xts.servicetests.test.ba.subordinate.MultiParticipantParticipantCompletionParticipantCloseTest
+METHOD run()
+AT CALL UserBusinessActivity.close()
+IF TRUE
+DO debug(""waiting to call close""),
+   rendezvous(""closes-complete""),
+   debug(""rendezvous complete, calling close"")
+ENDRULE
+
+
+
+
 #######################################################################
 # This rule opens a file for the trace output during XTS startup
 # It will be opened for append at reboot so messages from both runs",2012-04-19T16:37:28Z,317
"@@ -253,6 +253,7 @@
 #   JVM exit
 #
 
+
 #######################################################################
 # This rule opens a file for the trace output during XTS startup
 # It will be opened for append at reboot so messages from both runs",2012-04-19T16:37:28Z,318
"@@ -277,6 +277,53 @@
 #
 #   JVM exit
 #
+
+
+#####################################################################
+#JBTM-1115 Rules
+#
+
+#####################################################################
+# Setup counter MultiParticipantParticipantCompletionParticipantCloseTest
+#
+RULE setup counter subordinate.MultiParticipantParticipantCompletionParticipantCloseTest
+CLASS org.jboss.jbossts.xts.servicetests.test.ba.subordinate.MultiParticipantParticipantCompletionParticipantCloseTest
+METHOD run()
+AT ENTRY
+IF TRUE
+DO debug(""creating counter and rendezvous""),
+   createCounter(""closes"", 1),
+   createRendezvous(""closes-complete"", 2)
+ENDRULE
+
+#####################################################################
+# Trigger Rendezvous after three calls to BACoordinator.complete()
+#
+RULE trigger rendezvous on complete
+CLASS com.arjuna.mwlabs.wscf.model.sagas.arjunacore.BACoordinator
+METHOD participantCompleted(String)
+AT EXIT
+IF (debug(""decrementing"") AND decrementCounter(""closes"") == 0)
+DO debug(""closes-complete, triggering rendezvous""),
+   rendezvous(""closes-complete"")
+ENDRULE
+
+#####################################################################
+# Wait on Rendezvous before calling uba.close() on MultiParticipantParticipantCompletionParticipantCloseTest
+#
+RULE wait for closes subordinate.MultiParticipantParticipantCompletionParticipantCloseTest
+CLASS org.jboss.jbossts.xts.servicetests.test.ba.subordinate.MultiParticipantParticipantCompletionParticipantCloseTest
+METHOD run()
+AT CALL UserBusinessActivity.close()
+IF TRUE
+DO debug(""waiting to call close""),
+   rendezvous(""closes-complete""),
+   debug(""rendezvous complete, calling close"")
+ENDRULE
+
+
+
+
 #######################################################################
 # This rule opens a file for the trace output during XTS startup
 # It will be opened for append at reboot so messages from both runs",2012-04-19T16:37:28Z,319
"@@ -154,6 +154,7 @@ public void run() {
         // now close the activity
 
         try {
+            Thread.sleep(10000);
             ba.close();
         } catch (TransactionRolledBackException e) {
             exception = e;
@@ -163,6 +164,8 @@ public void run() {
             exception = e;
         } catch (WrongStateException e) {
             exception = e;
+        } catch (InterruptedException e) {
+            exception = e;
         }
 
         if (exception != null) {",2012-04-19T16:37:28Z,320
"@@ -6,6 +6,9 @@ fi
 # FOR DEBUGGING SUBSEQUENT ISSUES
 free -m
 
+#Make sure no JBoss processes running
+for i in `ps -eaf | grep java | grep ""standalone*.xml"" | grep -v grep | cut -c10-15`; do echo $i; done
+
 #BUILD NARAYANA WITH FINDBUGS
 ./build.sh -Dfindbugs.skip=false -Dfindbugs.failOnError=false clean install
 if [ ""$?"" != ""0"" ]; then
@@ -41,13 +44,13 @@ export JBOSS_HOME=${WORKSPACE}/jboss-as/build/target/jboss-as-7.1.2.Final-SNAPSH
 cd ${WORKSPACE}
 
 #1.WSTX11 INTEROP and UNIT TESTS
-./build.sh -f XTS/localjunit/pom.xml -Parq test
+./build.sh -f XTS/localjunit/pom.xml -Parq clean test
 if [ ""$?"" != ""0"" ]; then
 	exit -1
 fi
 
 #2.XTS CRASH RECOVERY TESTS
-./build.sh -f XTS/sar/crash-recovery-tests/pom.xml -Parq test
+./build.sh -f XTS/sar/crash-recovery-tests/pom.xml -Parq clean test
 if [ ""$?"" != ""0"" ]; then
 	exit -1
 fi",2012-04-19T16:37:28Z,10
